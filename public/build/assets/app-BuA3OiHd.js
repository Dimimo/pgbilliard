function se(m,x){return function(){return m.apply(x,arguments)}}const{toString:xe}=Object.prototype,{getPrototypeOf:Kt}=Object,wt=(m=>x=>{const P=xe.call(x);return m[P]||(m[P]=P.slice(8,-1).toLowerCase())})(Object.create(null)),pt=m=>(m=m.toLowerCase(),x=>wt(x)===m),xt=m=>x=>typeof x===m,{isArray:Ot}=Array,St=xt("undefined");function De(m){return m!==null&&!St(m)&&m.constructor!==null&&!St(m.constructor)&&lt(m.constructor.isBuffer)&&m.constructor.isBuffer(m)}const ue=pt("ArrayBuffer");function Le(m){let x;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?x=ArrayBuffer.isView(m):x=m&&m.buffer&&ue(m.buffer),x}const Ue=xt("string"),lt=xt("function"),fe=xt("number"),Dt=m=>m!==null&&typeof m=="object",Ne=m=>m===!0||m===!1,Mt=m=>{if(wt(m)!=="object")return!1;const x=Kt(m);return(x===null||x===Object.prototype||Object.getPrototypeOf(x)===null)&&!(Symbol.toStringTag in m)&&!(Symbol.iterator in m)},Be=pt("Date"),je=pt("File"),He=pt("Blob"),Ge=pt("FileList"),Fe=m=>Dt(m)&&lt(m.pipe),ke=m=>{let x;return m&&(typeof FormData=="function"&&m instanceof FormData||lt(m.append)&&((x=wt(m))==="formdata"||x==="object"&&lt(m.toString)&&m.toString()==="[object FormData]"))},_e=pt("URLSearchParams"),We=m=>m.trim?m.trim():m.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function At(m,x,{allOwnKeys:P=!1}={}){if(m===null||typeof m>"u")return;let s,a;if(typeof m!="object"&&(m=[m]),Ot(m))for(s=0,a=m.length;s<a;s++)x.call(null,m[s],s,m);else{const f=P?Object.getOwnPropertyNames(m):Object.keys(m),e=f.length;let b;for(s=0;s<e;s++)b=f[s],x.call(null,m[b],b,m)}}function le(m,x){x=x.toLowerCase();const P=Object.keys(m);let s=P.length,a;for(;s-- >0;)if(a=P[s],x===a.toLowerCase())return a;return null}const ce=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,de=m=>!St(m)&&m!==ce;function Ft(){const{caseless:m}=de(this)&&this||{},x={},P=(s,a)=>{const f=m&&le(x,a)||a;Mt(x[f])&&Mt(s)?x[f]=Ft(x[f],s):Mt(s)?x[f]=Ft({},s):Ot(s)?x[f]=s.slice():x[f]=s};for(let s=0,a=arguments.length;s<a;s++)arguments[s]&&At(arguments[s],P);return x}const Ve=(m,x,P,{allOwnKeys:s}={})=>(At(x,(a,f)=>{P&&lt(a)?m[f]=se(a,P):m[f]=a},{allOwnKeys:s}),m),ze=m=>(m.charCodeAt(0)===65279&&(m=m.slice(1)),m),Ke=(m,x,P,s)=>{m.prototype=Object.create(x.prototype,s),m.prototype.constructor=m,Object.defineProperty(m,"super",{value:x.prototype}),P&&Object.assign(m.prototype,P)},Je=(m,x,P,s)=>{let a,f,e;const b={};if(x=x||{},m==null)return x;do{for(a=Object.getOwnPropertyNames(m),f=a.length;f-- >0;)e=a[f],(!s||s(e,m,x))&&!b[e]&&(x[e]=m[e],b[e]=!0);m=P!==!1&&Kt(m)}while(m&&(!P||P(m,x))&&m!==Object.prototype);return x},Qe=(m,x,P)=>{m=String(m),(P===void 0||P>m.length)&&(P=m.length),P-=x.length;const s=m.indexOf(x,P);return s!==-1&&s===P},qe=m=>{if(!m)return null;if(Ot(m))return m;let x=m.length;if(!fe(x))return null;const P=new Array(x);for(;x-- >0;)P[x]=m[x];return P},Xe=(m=>x=>m&&x instanceof m)(typeof Uint8Array<"u"&&Kt(Uint8Array)),$e=(m,x)=>{const s=(m&&m[Symbol.iterator]).call(m);let a;for(;(a=s.next())&&!a.done;){const f=a.value;x.call(m,f[0],f[1])}},Ye=(m,x)=>{let P;const s=[];for(;(P=m.exec(x))!==null;)s.push(P);return s},Ze=pt("HTMLFormElement"),tn=m=>m.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(P,s,a){return s.toUpperCase()+a}),Xt=(({hasOwnProperty:m})=>(x,P)=>m.call(x,P))(Object.prototype),en=pt("RegExp"),he=(m,x)=>{const P=Object.getOwnPropertyDescriptors(m),s={};At(P,(a,f)=>{let e;(e=x(a,f,m))!==!1&&(s[f]=e||a)}),Object.defineProperties(m,s)},nn=m=>{he(m,(x,P)=>{if(lt(m)&&["arguments","caller","callee"].indexOf(P)!==-1)return!1;const s=m[P];if(lt(s)){if(x.enumerable=!1,"writable"in x){x.writable=!1;return}x.set||(x.set=()=>{throw Error("Can not rewrite read-only method '"+P+"'")})}})},rn=(m,x)=>{const P={},s=a=>{a.forEach(f=>{P[f]=!0})};return Ot(m)?s(m):s(String(m).split(x)),P},on=()=>{},an=(m,x)=>(m=+m,Number.isFinite(m)?m:x),Bt="abcdefghijklmnopqrstuvwxyz",$t="0123456789",pe={DIGIT:$t,ALPHA:Bt,ALPHA_DIGIT:Bt+Bt.toUpperCase()+$t},sn=(m=16,x=pe.ALPHA_DIGIT)=>{let P="";const{length:s}=x;for(;m--;)P+=x[Math.random()*s|0];return P};function un(m){return!!(m&&lt(m.append)&&m[Symbol.toStringTag]==="FormData"&&m[Symbol.iterator])}const fn=m=>{const x=new Array(10),P=(s,a)=>{if(Dt(s)){if(x.indexOf(s)>=0)return;if(!("toJSON"in s)){x[a]=s;const f=Ot(s)?[]:{};return At(s,(e,b)=>{const S=P(e,a+1);!St(S)&&(f[b]=S)}),x[a]=void 0,f}}return s};return P(m,0)},ln=pt("AsyncFunction"),cn=m=>m&&(Dt(m)||lt(m))&&lt(m.then)&&lt(m.catch),V={isArray:Ot,isArrayBuffer:ue,isBuffer:De,isFormData:ke,isArrayBufferView:Le,isString:Ue,isNumber:fe,isBoolean:Ne,isObject:Dt,isPlainObject:Mt,isUndefined:St,isDate:Be,isFile:je,isBlob:He,isRegExp:en,isFunction:lt,isStream:Fe,isURLSearchParams:_e,isTypedArray:Xe,isFileList:Ge,forEach:At,merge:Ft,extend:Ve,trim:We,stripBOM:ze,inherits:Ke,toFlatObject:Je,kindOf:wt,kindOfTest:pt,endsWith:Qe,toArray:qe,forEachEntry:$e,matchAll:Ye,isHTMLForm:Ze,hasOwnProperty:Xt,hasOwnProp:Xt,reduceDescriptors:he,freezeMethods:nn,toObjectSet:rn,toCamelCase:tn,noop:on,toFiniteNumber:an,findKey:le,global:ce,isContextDefined:de,ALPHABET:pe,generateString:sn,isSpecCompliantForm:un,toJSONObject:fn,isAsyncFn:ln,isThenable:cn};function nt(m,x,P,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=m,this.name="AxiosError",x&&(this.code=x),P&&(this.config=P),s&&(this.request=s),a&&(this.response=a)}V.inherits(nt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:V.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const ge=nt.prototype,me={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(m=>{me[m]={value:m}});Object.defineProperties(nt,me);Object.defineProperty(ge,"isAxiosError",{value:!0});nt.from=(m,x,P,s,a,f)=>{const e=Object.create(ge);return V.toFlatObject(m,e,function(S){return S!==Error.prototype},b=>b!=="isAxiosError"),nt.call(e,m.message,x,P,s,a),e.cause=m,e.name=m.name,f&&Object.assign(e,f),e};const dn=null;function kt(m){return V.isPlainObject(m)||V.isArray(m)}function ve(m){return V.endsWith(m,"[]")?m.slice(0,-2):m}function Yt(m,x,P){return m?m.concat(x).map(function(a,f){return a=ve(a),!P&&f?"["+a+"]":a}).join(P?".":""):x}function hn(m){return V.isArray(m)&&!m.some(kt)}const pn=V.toFlatObject(V,{},null,function(x){return/^is[A-Z]/.test(x)});function Lt(m,x,P){if(!V.isObject(m))throw new TypeError("target must be an object");x=x||new FormData,P=V.toFlatObject(P,{metaTokens:!0,dots:!1,indexes:!1},!1,function(h,M){return!V.isUndefined(M[h])});const s=P.metaTokens,a=P.visitor||w,f=P.dots,e=P.indexes,S=(P.Blob||typeof Blob<"u"&&Blob)&&V.isSpecCompliantForm(x);if(!V.isFunction(a))throw new TypeError("visitor must be a function");function I(r){if(r===null)return"";if(V.isDate(r))return r.toISOString();if(!S&&V.isBlob(r))throw new nt("Blob is not supported. Use a Buffer instead.");return V.isArrayBuffer(r)||V.isTypedArray(r)?S&&typeof Blob=="function"?new Blob([r]):Buffer.from(r):r}function w(r,h,M){let O=r;if(r&&!M&&typeof r=="object"){if(V.endsWith(h,"{}"))h=s?h:h.slice(0,-2),r=JSON.stringify(r);else if(V.isArray(r)&&hn(r)||(V.isFileList(r)||V.endsWith(h,"[]"))&&(O=V.toArray(r)))return h=ve(h),O.forEach(function(c,g){!(V.isUndefined(c)||c===null)&&x.append(e===!0?Yt([h],g,f):e===null?h:h+"[]",I(c))}),!1}return kt(r)?!0:(x.append(Yt(M,h,f),I(r)),!1)}const y=[],v=Object.assign(pn,{defaultVisitor:w,convertValue:I,isVisitable:kt});function A(r,h){if(!V.isUndefined(r)){if(y.indexOf(r)!==-1)throw Error("Circular reference detected in "+h.join("."));y.push(r),V.forEach(r,function(O,p){(!(V.isUndefined(O)||O===null)&&a.call(x,O,V.isString(p)?p.trim():p,h,v))===!0&&A(O,h?h.concat(p):[p])}),y.pop()}}if(!V.isObject(m))throw new TypeError("data must be an object");return A(m),x}function Zt(m){const x={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(m).replace(/[!'()~]|%20|%00/g,function(s){return x[s]})}function Jt(m,x){this._pairs=[],m&&Lt(m,this,x)}const ye=Jt.prototype;ye.append=function(x,P){this._pairs.push([x,P])};ye.toString=function(x){const P=x?function(s){return x.call(this,s,Zt)}:Zt;return this._pairs.map(function(a){return P(a[0])+"="+P(a[1])},"").join("&")};function gn(m){return encodeURIComponent(m).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Oe(m,x,P){if(!x)return m;const s=P&&P.encode||gn,a=P&&P.serialize;let f;if(a?f=a(x,P):f=V.isURLSearchParams(x)?x.toString():new Jt(x,P).toString(s),f){const e=m.indexOf("#");e!==-1&&(m=m.slice(0,e)),m+=(m.indexOf("?")===-1?"?":"&")+f}return m}class te{constructor(){this.handlers=[]}use(x,P,s){return this.handlers.push({fulfilled:x,rejected:P,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(x){this.handlers[x]&&(this.handlers[x]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(x){V.forEach(this.handlers,function(s){s!==null&&x(s)})}}const Ce={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},mn=typeof URLSearchParams<"u"?URLSearchParams:Jt,vn=typeof FormData<"u"?FormData:null,yn=typeof Blob<"u"?Blob:null,On={isBrowser:!0,classes:{URLSearchParams:mn,FormData:vn,Blob:yn},protocols:["http","https","file","blob","url","data"]},Re=typeof window<"u"&&typeof document<"u",Cn=(m=>Re&&["ReactNative","NativeScript","NS"].indexOf(m)<0)(typeof navigator<"u"&&navigator.product),Rn=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Sn=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Re,hasStandardBrowserEnv:Cn,hasStandardBrowserWebWorkerEnv:Rn},Symbol.toStringTag,{value:"Module"})),ht={...Sn,...On};function An(m,x){return Lt(m,new ht.classes.URLSearchParams,Object.assign({visitor:function(P,s,a,f){return ht.isNode&&V.isBuffer(P)?(this.append(s,P.toString("base64")),!1):f.defaultVisitor.apply(this,arguments)}},x))}function En(m){return V.matchAll(/\w+|\[(\w*)]/g,m).map(x=>x[0]==="[]"?"":x[1]||x[0])}function Tn(m){const x={},P=Object.keys(m);let s;const a=P.length;let f;for(s=0;s<a;s++)f=P[s],x[f]=m[f];return x}function Se(m){function x(P,s,a,f){let e=P[f++];if(e==="__proto__")return!0;const b=Number.isFinite(+e),S=f>=P.length;return e=!e&&V.isArray(a)?a.length:e,S?(V.hasOwnProp(a,e)?a[e]=[a[e],s]:a[e]=s,!b):((!a[e]||!V.isObject(a[e]))&&(a[e]=[]),x(P,s,a[e],f)&&V.isArray(a[e])&&(a[e]=Tn(a[e])),!b)}if(V.isFormData(m)&&V.isFunction(m.entries)){const P={};return V.forEachEntry(m,(s,a)=>{x(En(s),a,P,0)}),P}return null}function bn(m,x,P){if(V.isString(m))try{return(x||JSON.parse)(m),V.trim(m)}catch(s){if(s.name!=="SyntaxError")throw s}return(P||JSON.stringify)(m)}const Et={transitional:Ce,adapter:["xhr","http"],transformRequest:[function(x,P){const s=P.getContentType()||"",a=s.indexOf("application/json")>-1,f=V.isObject(x);if(f&&V.isHTMLForm(x)&&(x=new FormData(x)),V.isFormData(x))return a?JSON.stringify(Se(x)):x;if(V.isArrayBuffer(x)||V.isBuffer(x)||V.isStream(x)||V.isFile(x)||V.isBlob(x))return x;if(V.isArrayBufferView(x))return x.buffer;if(V.isURLSearchParams(x))return P.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),x.toString();let b;if(f){if(s.indexOf("application/x-www-form-urlencoded")>-1)return An(x,this.formSerializer).toString();if((b=V.isFileList(x))||s.indexOf("multipart/form-data")>-1){const S=this.env&&this.env.FormData;return Lt(b?{"files[]":x}:x,S&&new S,this.formSerializer)}}return f||a?(P.setContentType("application/json",!1),bn(x)):x}],transformResponse:[function(x){const P=this.transitional||Et.transitional,s=P&&P.forcedJSONParsing,a=this.responseType==="json";if(x&&V.isString(x)&&(s&&!this.responseType||a)){const e=!(P&&P.silentJSONParsing)&&a;try{return JSON.parse(x)}catch(b){if(e)throw b.name==="SyntaxError"?nt.from(b,nt.ERR_BAD_RESPONSE,this,null,this.response):b}}return x}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ht.classes.FormData,Blob:ht.classes.Blob},validateStatus:function(x){return x>=200&&x<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};V.forEach(["delete","get","head","post","put","patch"],m=>{Et.headers[m]={}});const In=V.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Mn=m=>{const x={};let P,s,a;return m&&m.split(`
`).forEach(function(e){a=e.indexOf(":"),P=e.substring(0,a).trim().toLowerCase(),s=e.substring(a+1).trim(),!(!P||x[P]&&In[P])&&(P==="set-cookie"?x[P]?x[P].push(s):x[P]=[s]:x[P]=x[P]?x[P]+", "+s:s)}),x},ee=Symbol("internals");function Rt(m){return m&&String(m).trim().toLowerCase()}function Pt(m){return m===!1||m==null?m:V.isArray(m)?m.map(Pt):String(m)}function Pn(m){const x=Object.create(null),P=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=P.exec(m);)x[s[1]]=s[2];return x}const wn=m=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(m.trim());function jt(m,x,P,s,a){if(V.isFunction(s))return s.call(this,x,P);if(a&&(x=P),!!V.isString(x)){if(V.isString(s))return x.indexOf(s)!==-1;if(V.isRegExp(s))return s.test(x)}}function xn(m){return m.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(x,P,s)=>P.toUpperCase()+s)}function Dn(m,x){const P=V.toCamelCase(" "+x);["get","set","has"].forEach(s=>{Object.defineProperty(m,s+P,{value:function(a,f,e){return this[s].call(this,x,a,f,e)},configurable:!0})})}class ct{constructor(x){x&&this.set(x)}set(x,P,s){const a=this;function f(b,S,I){const w=Rt(S);if(!w)throw new Error("header name must be a non-empty string");const y=V.findKey(a,w);(!y||a[y]===void 0||I===!0||I===void 0&&a[y]!==!1)&&(a[y||S]=Pt(b))}const e=(b,S)=>V.forEach(b,(I,w)=>f(I,w,S));return V.isPlainObject(x)||x instanceof this.constructor?e(x,P):V.isString(x)&&(x=x.trim())&&!wn(x)?e(Mn(x),P):x!=null&&f(P,x,s),this}get(x,P){if(x=Rt(x),x){const s=V.findKey(this,x);if(s){const a=this[s];if(!P)return a;if(P===!0)return Pn(a);if(V.isFunction(P))return P.call(this,a,s);if(V.isRegExp(P))return P.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(x,P){if(x=Rt(x),x){const s=V.findKey(this,x);return!!(s&&this[s]!==void 0&&(!P||jt(this,this[s],s,P)))}return!1}delete(x,P){const s=this;let a=!1;function f(e){if(e=Rt(e),e){const b=V.findKey(s,e);b&&(!P||jt(s,s[b],b,P))&&(delete s[b],a=!0)}}return V.isArray(x)?x.forEach(f):f(x),a}clear(x){const P=Object.keys(this);let s=P.length,a=!1;for(;s--;){const f=P[s];(!x||jt(this,this[f],f,x,!0))&&(delete this[f],a=!0)}return a}normalize(x){const P=this,s={};return V.forEach(this,(a,f)=>{const e=V.findKey(s,f);if(e){P[e]=Pt(a),delete P[f];return}const b=x?xn(f):String(f).trim();b!==f&&delete P[f],P[b]=Pt(a),s[b]=!0}),this}concat(...x){return this.constructor.concat(this,...x)}toJSON(x){const P=Object.create(null);return V.forEach(this,(s,a)=>{s!=null&&s!==!1&&(P[a]=x&&V.isArray(s)?s.join(", "):s)}),P}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([x,P])=>x+": "+P).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(x){return x instanceof this?x:new this(x)}static concat(x,...P){const s=new this(x);return P.forEach(a=>s.set(a)),s}static accessor(x){const s=(this[ee]=this[ee]={accessors:{}}).accessors,a=this.prototype;function f(e){const b=Rt(e);s[b]||(Dn(a,e),s[b]=!0)}return V.isArray(x)?x.forEach(f):f(x),this}}ct.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);V.reduceDescriptors(ct.prototype,({value:m},x)=>{let P=x[0].toUpperCase()+x.slice(1);return{get:()=>m,set(s){this[P]=s}}});V.freezeMethods(ct);function Ht(m,x){const P=this||Et,s=x||P,a=ct.from(s.headers);let f=s.data;return V.forEach(m,function(b){f=b.call(P,f,a.normalize(),x?x.status:void 0)}),a.normalize(),f}function Ae(m){return!!(m&&m.__CANCEL__)}function Tt(m,x,P){nt.call(this,m??"canceled",nt.ERR_CANCELED,x,P),this.name="CanceledError"}V.inherits(Tt,nt,{__CANCEL__:!0});function Ln(m,x,P){const s=P.config.validateStatus;!P.status||!s||s(P.status)?m(P):x(new nt("Request failed with status code "+P.status,[nt.ERR_BAD_REQUEST,nt.ERR_BAD_RESPONSE][Math.floor(P.status/100)-4],P.config,P.request,P))}const Un=ht.hasStandardBrowserEnv?{write(m,x,P,s,a,f){const e=[m+"="+encodeURIComponent(x)];V.isNumber(P)&&e.push("expires="+new Date(P).toGMTString()),V.isString(s)&&e.push("path="+s),V.isString(a)&&e.push("domain="+a),f===!0&&e.push("secure"),document.cookie=e.join("; ")},read(m){const x=document.cookie.match(new RegExp("(^|;\\s*)("+m+")=([^;]*)"));return x?decodeURIComponent(x[3]):null},remove(m){this.write(m,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Nn(m){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(m)}function Bn(m,x){return x?m.replace(/\/?\/$/,"")+"/"+x.replace(/^\/+/,""):m}function Ee(m,x){return m&&!Nn(x)?Bn(m,x):x}const jn=ht.hasStandardBrowserEnv?function(){const x=/(msie|trident)/i.test(navigator.userAgent),P=document.createElement("a");let s;function a(f){let e=f;return x&&(P.setAttribute("href",e),e=P.href),P.setAttribute("href",e),{href:P.href,protocol:P.protocol?P.protocol.replace(/:$/,""):"",host:P.host,search:P.search?P.search.replace(/^\?/,""):"",hash:P.hash?P.hash.replace(/^#/,""):"",hostname:P.hostname,port:P.port,pathname:P.pathname.charAt(0)==="/"?P.pathname:"/"+P.pathname}}return s=a(window.location.href),function(e){const b=V.isString(e)?a(e):e;return b.protocol===s.protocol&&b.host===s.host}}():function(){return function(){return!0}}();function Hn(m){const x=/^([-+\w]{1,25})(:?\/\/|:)/.exec(m);return x&&x[1]||""}function Gn(m,x){m=m||10;const P=new Array(m),s=new Array(m);let a=0,f=0,e;return x=x!==void 0?x:1e3,function(S){const I=Date.now(),w=s[f];e||(e=I),P[a]=S,s[a]=I;let y=f,v=0;for(;y!==a;)v+=P[y++],y=y%m;if(a=(a+1)%m,a===f&&(f=(f+1)%m),I-e<x)return;const A=w&&I-w;return A?Math.round(v*1e3/A):void 0}}function ne(m,x){let P=0;const s=Gn(50,250);return a=>{const f=a.loaded,e=a.lengthComputable?a.total:void 0,b=f-P,S=s(b),I=f<=e;P=f;const w={loaded:f,total:e,progress:e?f/e:void 0,bytes:b,rate:S||void 0,estimated:S&&e&&I?(e-f)/S:void 0,event:a};w[x?"download":"upload"]=!0,m(w)}}const Fn=typeof XMLHttpRequest<"u",kn=Fn&&function(m){return new Promise(function(P,s){let a=m.data;const f=ct.from(m.headers).normalize();let{responseType:e,withXSRFToken:b}=m,S;function I(){m.cancelToken&&m.cancelToken.unsubscribe(S),m.signal&&m.signal.removeEventListener("abort",S)}let w;if(V.isFormData(a)){if(ht.hasStandardBrowserEnv||ht.hasStandardBrowserWebWorkerEnv)f.setContentType(!1);else if((w=f.getContentType())!==!1){const[h,...M]=w?w.split(";").map(O=>O.trim()).filter(Boolean):[];f.setContentType([h||"multipart/form-data",...M].join("; "))}}let y=new XMLHttpRequest;if(m.auth){const h=m.auth.username||"",M=m.auth.password?unescape(encodeURIComponent(m.auth.password)):"";f.set("Authorization","Basic "+btoa(h+":"+M))}const v=Ee(m.baseURL,m.url);y.open(m.method.toUpperCase(),Oe(v,m.params,m.paramsSerializer),!0),y.timeout=m.timeout;function A(){if(!y)return;const h=ct.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders()),O={data:!e||e==="text"||e==="json"?y.responseText:y.response,status:y.status,statusText:y.statusText,headers:h,config:m,request:y};Ln(function(c){P(c),I()},function(c){s(c),I()},O),y=null}if("onloadend"in y?y.onloadend=A:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(A)},y.onabort=function(){y&&(s(new nt("Request aborted",nt.ECONNABORTED,m,y)),y=null)},y.onerror=function(){s(new nt("Network Error",nt.ERR_NETWORK,m,y)),y=null},y.ontimeout=function(){let M=m.timeout?"timeout of "+m.timeout+"ms exceeded":"timeout exceeded";const O=m.transitional||Ce;m.timeoutErrorMessage&&(M=m.timeoutErrorMessage),s(new nt(M,O.clarifyTimeoutError?nt.ETIMEDOUT:nt.ECONNABORTED,m,y)),y=null},ht.hasStandardBrowserEnv&&(b&&V.isFunction(b)&&(b=b(m)),b||b!==!1&&jn(v))){const h=m.xsrfHeaderName&&m.xsrfCookieName&&Un.read(m.xsrfCookieName);h&&f.set(m.xsrfHeaderName,h)}a===void 0&&f.setContentType(null),"setRequestHeader"in y&&V.forEach(f.toJSON(),function(M,O){y.setRequestHeader(O,M)}),V.isUndefined(m.withCredentials)||(y.withCredentials=!!m.withCredentials),e&&e!=="json"&&(y.responseType=m.responseType),typeof m.onDownloadProgress=="function"&&y.addEventListener("progress",ne(m.onDownloadProgress,!0)),typeof m.onUploadProgress=="function"&&y.upload&&y.upload.addEventListener("progress",ne(m.onUploadProgress)),(m.cancelToken||m.signal)&&(S=h=>{y&&(s(!h||h.type?new Tt(null,m,y):h),y.abort(),y=null)},m.cancelToken&&m.cancelToken.subscribe(S),m.signal&&(m.signal.aborted?S():m.signal.addEventListener("abort",S)));const r=Hn(v);if(r&&ht.protocols.indexOf(r)===-1){s(new nt("Unsupported protocol "+r+":",nt.ERR_BAD_REQUEST,m));return}y.send(a||null)})},_t={http:dn,xhr:kn};V.forEach(_t,(m,x)=>{if(m){try{Object.defineProperty(m,"name",{value:x})}catch{}Object.defineProperty(m,"adapterName",{value:x})}});const re=m=>`- ${m}`,_n=m=>V.isFunction(m)||m===null||m===!1,Te={getAdapter:m=>{m=V.isArray(m)?m:[m];const{length:x}=m;let P,s;const a={};for(let f=0;f<x;f++){P=m[f];let e;if(s=P,!_n(P)&&(s=_t[(e=String(P)).toLowerCase()],s===void 0))throw new nt(`Unknown adapter '${e}'`);if(s)break;a[e||"#"+f]=s}if(!s){const f=Object.entries(a).map(([b,S])=>`adapter ${b} `+(S===!1?"is not supported by the environment":"is not available in the build"));let e=x?f.length>1?`since :
`+f.map(re).join(`
`):" "+re(f[0]):"as no adapter specified";throw new nt("There is no suitable adapter to dispatch the request "+e,"ERR_NOT_SUPPORT")}return s},adapters:_t};function Gt(m){if(m.cancelToken&&m.cancelToken.throwIfRequested(),m.signal&&m.signal.aborted)throw new Tt(null,m)}function ie(m){return Gt(m),m.headers=ct.from(m.headers),m.data=Ht.call(m,m.transformRequest),["post","put","patch"].indexOf(m.method)!==-1&&m.headers.setContentType("application/x-www-form-urlencoded",!1),Te.getAdapter(m.adapter||Et.adapter)(m).then(function(s){return Gt(m),s.data=Ht.call(m,m.transformResponse,s),s.headers=ct.from(s.headers),s},function(s){return Ae(s)||(Gt(m),s&&s.response&&(s.response.data=Ht.call(m,m.transformResponse,s.response),s.response.headers=ct.from(s.response.headers))),Promise.reject(s)})}const oe=m=>m instanceof ct?{...m}:m;function yt(m,x){x=x||{};const P={};function s(I,w,y){return V.isPlainObject(I)&&V.isPlainObject(w)?V.merge.call({caseless:y},I,w):V.isPlainObject(w)?V.merge({},w):V.isArray(w)?w.slice():w}function a(I,w,y){if(V.isUndefined(w)){if(!V.isUndefined(I))return s(void 0,I,y)}else return s(I,w,y)}function f(I,w){if(!V.isUndefined(w))return s(void 0,w)}function e(I,w){if(V.isUndefined(w)){if(!V.isUndefined(I))return s(void 0,I)}else return s(void 0,w)}function b(I,w,y){if(y in x)return s(I,w);if(y in m)return s(void 0,I)}const S={url:f,method:f,data:f,baseURL:e,transformRequest:e,transformResponse:e,paramsSerializer:e,timeout:e,timeoutMessage:e,withCredentials:e,withXSRFToken:e,adapter:e,responseType:e,xsrfCookieName:e,xsrfHeaderName:e,onUploadProgress:e,onDownloadProgress:e,decompress:e,maxContentLength:e,maxBodyLength:e,beforeRedirect:e,transport:e,httpAgent:e,httpsAgent:e,cancelToken:e,socketPath:e,responseEncoding:e,validateStatus:b,headers:(I,w)=>a(oe(I),oe(w),!0)};return V.forEach(Object.keys(Object.assign({},m,x)),function(w){const y=S[w]||a,v=y(m[w],x[w],w);V.isUndefined(v)&&y!==b||(P[w]=v)}),P}const be="1.6.8",Qt={};["object","boolean","number","function","string","symbol"].forEach((m,x)=>{Qt[m]=function(s){return typeof s===m||"a"+(x<1?"n ":" ")+m}});const ae={};Qt.transitional=function(x,P,s){function a(f,e){return"[Axios v"+be+"] Transitional option '"+f+"'"+e+(s?". "+s:"")}return(f,e,b)=>{if(x===!1)throw new nt(a(e," has been removed"+(P?" in "+P:"")),nt.ERR_DEPRECATED);return P&&!ae[e]&&(ae[e]=!0,console.warn(a(e," has been deprecated since v"+P+" and will be removed in the near future"))),x?x(f,e,b):!0}};function Wn(m,x,P){if(typeof m!="object")throw new nt("options must be an object",nt.ERR_BAD_OPTION_VALUE);const s=Object.keys(m);let a=s.length;for(;a-- >0;){const f=s[a],e=x[f];if(e){const b=m[f],S=b===void 0||e(b,f,m);if(S!==!0)throw new nt("option "+f+" must be "+S,nt.ERR_BAD_OPTION_VALUE);continue}if(P!==!0)throw new nt("Unknown option "+f,nt.ERR_BAD_OPTION)}}const Wt={assertOptions:Wn,validators:Qt},mt=Wt.validators;class vt{constructor(x){this.defaults=x,this.interceptors={request:new te,response:new te}}async request(x,P){try{return await this._request(x,P)}catch(s){if(s instanceof Error){let a;Error.captureStackTrace?Error.captureStackTrace(a={}):a=new Error;const f=a.stack?a.stack.replace(/^.+\n/,""):"";s.stack?f&&!String(s.stack).endsWith(f.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+f):s.stack=f}throw s}}_request(x,P){typeof x=="string"?(P=P||{},P.url=x):P=x||{},P=yt(this.defaults,P);const{transitional:s,paramsSerializer:a,headers:f}=P;s!==void 0&&Wt.assertOptions(s,{silentJSONParsing:mt.transitional(mt.boolean),forcedJSONParsing:mt.transitional(mt.boolean),clarifyTimeoutError:mt.transitional(mt.boolean)},!1),a!=null&&(V.isFunction(a)?P.paramsSerializer={serialize:a}:Wt.assertOptions(a,{encode:mt.function,serialize:mt.function},!0)),P.method=(P.method||this.defaults.method||"get").toLowerCase();let e=f&&V.merge(f.common,f[P.method]);f&&V.forEach(["delete","get","head","post","put","patch","common"],r=>{delete f[r]}),P.headers=ct.concat(e,f);const b=[];let S=!0;this.interceptors.request.forEach(function(h){typeof h.runWhen=="function"&&h.runWhen(P)===!1||(S=S&&h.synchronous,b.unshift(h.fulfilled,h.rejected))});const I=[];this.interceptors.response.forEach(function(h){I.push(h.fulfilled,h.rejected)});let w,y=0,v;if(!S){const r=[ie.bind(this),void 0];for(r.unshift.apply(r,b),r.push.apply(r,I),v=r.length,w=Promise.resolve(P);y<v;)w=w.then(r[y++],r[y++]);return w}v=b.length;let A=P;for(y=0;y<v;){const r=b[y++],h=b[y++];try{A=r(A)}catch(M){h.call(this,M);break}}try{w=ie.call(this,A)}catch(r){return Promise.reject(r)}for(y=0,v=I.length;y<v;)w=w.then(I[y++],I[y++]);return w}getUri(x){x=yt(this.defaults,x);const P=Ee(x.baseURL,x.url);return Oe(P,x.params,x.paramsSerializer)}}V.forEach(["delete","get","head","options"],function(x){vt.prototype[x]=function(P,s){return this.request(yt(s||{},{method:x,url:P,data:(s||{}).data}))}});V.forEach(["post","put","patch"],function(x){function P(s){return function(f,e,b){return this.request(yt(b||{},{method:x,headers:s?{"Content-Type":"multipart/form-data"}:{},url:f,data:e}))}}vt.prototype[x]=P(),vt.prototype[x+"Form"]=P(!0)});class qt{constructor(x){if(typeof x!="function")throw new TypeError("executor must be a function.");let P;this.promise=new Promise(function(f){P=f});const s=this;this.promise.then(a=>{if(!s._listeners)return;let f=s._listeners.length;for(;f-- >0;)s._listeners[f](a);s._listeners=null}),this.promise.then=a=>{let f;const e=new Promise(b=>{s.subscribe(b),f=b}).then(a);return e.cancel=function(){s.unsubscribe(f)},e},x(function(f,e,b){s.reason||(s.reason=new Tt(f,e,b),P(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(x){if(this.reason){x(this.reason);return}this._listeners?this._listeners.push(x):this._listeners=[x]}unsubscribe(x){if(!this._listeners)return;const P=this._listeners.indexOf(x);P!==-1&&this._listeners.splice(P,1)}static source(){let x;return{token:new qt(function(a){x=a}),cancel:x}}}function Vn(m){return function(P){return m.apply(null,P)}}function zn(m){return V.isObject(m)&&m.isAxiosError===!0}const Vt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Vt).forEach(([m,x])=>{Vt[x]=m});function Ie(m){const x=new vt(m),P=se(vt.prototype.request,x);return V.extend(P,vt.prototype,x,{allOwnKeys:!0}),V.extend(P,x,null,{allOwnKeys:!0}),P.create=function(a){return Ie(yt(m,a))},P}const ot=Ie(Et);ot.Axios=vt;ot.CanceledError=Tt;ot.CancelToken=qt;ot.isCancel=Ae;ot.VERSION=be;ot.toFormData=Lt;ot.AxiosError=nt;ot.Cancel=ot.CanceledError;ot.all=function(x){return Promise.all(x)};ot.spread=Vn;ot.isAxiosError=zn;ot.mergeConfig=yt;ot.AxiosHeaders=ct;ot.formToJSON=m=>Se(V.isHTMLForm(m)?new FormData(m):m);ot.getAdapter=Te.getAdapter;ot.HttpStatusCode=Vt;ot.default=ot;function zt(m){"@babel/helpers - typeof";return zt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},zt(m)}typeof window>"u"||zt(window);var Kn={exports:{}};/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.50
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */(function(m,x){(function(s,a){m.exports=a()})(window,function(){return function(P){var s={};function a(f){if(s[f])return s[f].exports;var e=s[f]={i:f,l:!1,exports:{}};return P[f].call(e.exports,e,e.exports,a),e.l=!0,e.exports}return a.m=P,a.c=s,a.d=function(f,e,b){a.o(f,e)||Object.defineProperty(f,e,{enumerable:!0,get:b})},a.r=function(f){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(f,"__esModule",{value:!0})},a.t=function(f,e){if(e&1&&(f=a(f)),e&8||e&4&&typeof f=="object"&&f&&f.__esModule)return f;var b=Object.create(null);if(a.r(b),Object.defineProperty(b,"default",{enumerable:!0,value:f}),e&2&&typeof f!="string")for(var S in f)a.d(b,S,(function(I){return f[I]}).bind(null,S));return b},a.n=function(f){var e=f&&f.__esModule?function(){return f.default}:function(){return f};return a.d(e,"a",e),e},a.o=function(f,e){return Object.prototype.hasOwnProperty.call(f,e)},a.p="",a(a.s=42)}([function(P,s,a){a.r(s),a.d(s,"__extends",function(){return e}),a.d(s,"__assign",function(){return b}),a.d(s,"__rest",function(){return S}),a.d(s,"__decorate",function(){return I}),a.d(s,"__param",function(){return w}),a.d(s,"__metadata",function(){return y}),a.d(s,"__awaiter",function(){return v}),a.d(s,"__generator",function(){return A}),a.d(s,"__createBinding",function(){return r}),a.d(s,"__exportStar",function(){return h}),a.d(s,"__values",function(){return M}),a.d(s,"__read",function(){return O}),a.d(s,"__spread",function(){return p}),a.d(s,"__spreadArrays",function(){return c}),a.d(s,"__spreadArray",function(){return g}),a.d(s,"__await",function(){return o}),a.d(s,"__asyncGenerator",function(){return i}),a.d(s,"__asyncDelegator",function(){return n}),a.d(s,"__asyncValues",function(){return t}),a.d(s,"__makeTemplateObject",function(){return l}),a.d(s,"__importStar",function(){return d}),a.d(s,"__importDefault",function(){return U}),a.d(s,"__classPrivateFieldGet",function(){return L}),a.d(s,"__classPrivateFieldSet",function(){return D});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var f=function(E,T){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,j){R.__proto__=j}||function(R,j){for(var G in j)Object.prototype.hasOwnProperty.call(j,G)&&(R[G]=j[G])},f(E,T)};function e(E,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");f(E,T);function R(){this.constructor=E}E.prototype=T===null?Object.create(T):(R.prototype=T.prototype,new R)}var b=function(){return b=Object.assign||function(T){for(var R,j=1,G=arguments.length;j<G;j++){R=arguments[j];for(var k in R)Object.prototype.hasOwnProperty.call(R,k)&&(T[k]=R[k])}return T},b.apply(this,arguments)};function S(E,T){var R={};for(var j in E)Object.prototype.hasOwnProperty.call(E,j)&&T.indexOf(j)<0&&(R[j]=E[j]);if(E!=null&&typeof Object.getOwnPropertySymbols=="function")for(var G=0,j=Object.getOwnPropertySymbols(E);G<j.length;G++)T.indexOf(j[G])<0&&Object.prototype.propertyIsEnumerable.call(E,j[G])&&(R[j[G]]=E[j[G]]);return R}function I(E,T,R,j){var G=arguments.length,k=G<3?T:j===null?j=Object.getOwnPropertyDescriptor(T,R):j,J;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(E,T,R,j);else for(var z=E.length-1;z>=0;z--)(J=E[z])&&(k=(G<3?J(k):G>3?J(T,R,k):J(T,R))||k);return G>3&&k&&Object.defineProperty(T,R,k),k}function w(E,T){return function(R,j){T(R,j,E)}}function y(E,T){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(E,T)}function v(E,T,R,j){function G(k){return k instanceof R?k:new R(function(J){J(k)})}return new(R||(R=Promise))(function(k,J){function z(N){try{C(j.next(N))}catch(B){J(B)}}function _(N){try{C(j.throw(N))}catch(B){J(B)}}function C(N){N.done?k(N.value):G(N.value).then(z,_)}C((j=j.apply(E,T||[])).next())})}function A(E,T){var R={label:0,sent:function(){if(k[0]&1)throw k[1];return k[1]},trys:[],ops:[]},j,G,k,J;return J={next:z(0),throw:z(1),return:z(2)},typeof Symbol=="function"&&(J[Symbol.iterator]=function(){return this}),J;function z(C){return function(N){return _([C,N])}}function _(C){if(j)throw new TypeError("Generator is already executing.");for(;R;)try{if(j=1,G&&(k=C[0]&2?G.return:C[0]?G.throw||((k=G.return)&&k.call(G),0):G.next)&&!(k=k.call(G,C[1])).done)return k;switch(G=0,k&&(C=[C[0]&2,k.value]),C[0]){case 0:case 1:k=C;break;case 4:return R.label++,{value:C[1],done:!1};case 5:R.label++,G=C[1],C=[0];continue;case 7:C=R.ops.pop(),R.trys.pop();continue;default:if(k=R.trys,!(k=k.length>0&&k[k.length-1])&&(C[0]===6||C[0]===2)){R=0;continue}if(C[0]===3&&(!k||C[1]>k[0]&&C[1]<k[3])){R.label=C[1];break}if(C[0]===6&&R.label<k[1]){R.label=k[1],k=C;break}if(k&&R.label<k[2]){R.label=k[2],R.ops.push(C);break}k[2]&&R.ops.pop(),R.trys.pop();continue}C=T.call(E,R)}catch(N){C=[6,N],G=0}finally{j=k=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}}var r=Object.create?function(E,T,R,j){j===void 0&&(j=R),Object.defineProperty(E,j,{enumerable:!0,get:function(){return T[R]}})}:function(E,T,R,j){j===void 0&&(j=R),E[j]=T[R]};function h(E,T){for(var R in E)R!=="default"&&!Object.prototype.hasOwnProperty.call(T,R)&&r(T,E,R)}function M(E){var T=typeof Symbol=="function"&&Symbol.iterator,R=T&&E[T],j=0;if(R)return R.call(E);if(E&&typeof E.length=="number")return{next:function(){return E&&j>=E.length&&(E=void 0),{value:E&&E[j++],done:!E}}};throw new TypeError(T?"Object is not iterable.":"Symbol.iterator is not defined.")}function O(E,T){var R=typeof Symbol=="function"&&E[Symbol.iterator];if(!R)return E;var j=R.call(E),G,k=[],J;try{for(;(T===void 0||T-- >0)&&!(G=j.next()).done;)k.push(G.value)}catch(z){J={error:z}}finally{try{G&&!G.done&&(R=j.return)&&R.call(j)}finally{if(J)throw J.error}}return k}function p(){for(var E=[],T=0;T<arguments.length;T++)E=E.concat(O(arguments[T]));return E}function c(){for(var E=0,T=0,R=arguments.length;T<R;T++)E+=arguments[T].length;for(var j=Array(E),G=0,T=0;T<R;T++)for(var k=arguments[T],J=0,z=k.length;J<z;J++,G++)j[G]=k[J];return j}function g(E,T,R){if(R||arguments.length===2)for(var j=0,G=T.length,k;j<G;j++)(k||!(j in T))&&(k||(k=Array.prototype.slice.call(T,0,j)),k[j]=T[j]);return E.concat(k||Array.prototype.slice.call(T))}function o(E){return this instanceof o?(this.v=E,this):new o(E)}function i(E,T,R){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var j=R.apply(E,T||[]),G,k=[];return G={},J("next"),J("throw"),J("return"),G[Symbol.asyncIterator]=function(){return this},G;function J(H){j[H]&&(G[H]=function(W){return new Promise(function(q,X){k.push([H,W,q,X])>1||z(H,W)})})}function z(H,W){try{_(j[H](W))}catch(q){B(k[0][3],q)}}function _(H){H.value instanceof o?Promise.resolve(H.value.v).then(C,N):B(k[0][2],H)}function C(H){z("next",H)}function N(H){z("throw",H)}function B(H,W){H(W),k.shift(),k.length&&z(k[0][0],k[0][1])}}function n(E){var T,R;return T={},j("next"),j("throw",function(G){throw G}),j("return"),T[Symbol.iterator]=function(){return this},T;function j(G,k){T[G]=E[G]?function(J){return(R=!R)?{value:o(E[G](J)),done:G==="return"}:k?k(J):J}:k}}function t(E){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var T=E[Symbol.asyncIterator],R;return T?T.call(E):(E=typeof M=="function"?M(E):E[Symbol.iterator](),R={},j("next"),j("throw"),j("return"),R[Symbol.asyncIterator]=function(){return this},R);function j(k){R[k]=E[k]&&function(J){return new Promise(function(z,_){J=E[k](J),G(z,_,J.done,J.value)})}}function G(k,J,z,_){Promise.resolve(_).then(function(C){k({value:C,done:z})},J)}}function l(E,T){return Object.defineProperty?Object.defineProperty(E,"raw",{value:T}):E.raw=T,E}var u=Object.create?function(E,T){Object.defineProperty(E,"default",{enumerable:!0,value:T})}:function(E,T){E.default=T};function d(E){if(E&&E.__esModule)return E;var T={};if(E!=null)for(var R in E)R!=="default"&&Object.prototype.hasOwnProperty.call(E,R)&&r(T,E,R);return u(T,E),T}function U(E){return E&&E.__esModule?E:{default:E}}function L(E,T,R,j){if(R==="a"&&!j)throw new TypeError("Private accessor was defined without a getter");if(typeof T=="function"?E!==T||!j:!T.has(E))throw new TypeError("Cannot read private member from an object whose class did not declare it");return R==="m"?j:R==="a"?j.call(E):j?j.value:T.get(E)}function D(E,T,R,j,G){if(j==="m")throw new TypeError("Private method is not writable");if(j==="a"&&!G)throw new TypeError("Private accessor was defined without a setter");if(typeof T=="function"?E!==T||!G:!T.has(E))throw new TypeError("Cannot write private member to an object whose class did not declare it");return j==="a"?G.call(E,R):G?G.value=R:T.set(E,R),R}},function(P,s,a){(function(f){Object.defineProperty(s,"__esModule",{value:!0}),s.allToUpperCase=s.allToLowerCase=s.encodeBody=s.decodeBody=s.Format=s.promisify=s.trim=s.arrChooseN=s.randomHexString=s.randomString=s.cheapRandStr=s.dataSizeBytes=s.inspectBody=s.inspectError=s.isErrorInfoOrPartialErrorInfo=s.now=s.parseQueryString=s.toQueryString=s.arrPopRandomElement=s.defaultPostHeaders=s.defaultGetHeaders=s.allSame=s.arrEvery=s.arrFilter=s.arrMap=s.safeArrForEach=s.arrForEach=s.forInOwnNonNullProperties=s.valuesArray=s.keysArray=s.arrWithoutValue=s.arrDeleteValue=s.arrIn=s.arrIndexOf=s.arrSubtract=s.arrIntersectOb=s.arrIntersect=s.intersect=s.containsValue=s.inherits=s.prototypicalClone=s.shallowClone=s.isEmptyArg=s.isOnlyPropIn=s.isEmpty=s.isObject=s.ensureArray=s.isArray=s.copy=s.mixin=void 0,s.arrEquals=s.toBase64=s.matchDerivedChannel=s.shallowEquals=s.getGlobalObject=s.getRetryTime=s.getJitterCoefficient=s.getBackoffCoefficient=void 0;var e=a(0),b=e.__importDefault(a(3)),S=e.__importStar(a(8)),I=e.__importDefault(a(4)),w=a(11),y=a(31);function v(F){return Math.floor(Math.random()*F.length)}function A(F){for(var K=[],Q=1;Q<arguments.length;Q++)K[Q-1]=arguments[Q];for(var Y=0;Y<K.length;Y++){var et=K[Y];if(!et)break;var ft=Object.prototype.hasOwnProperty;for(var Ct in et)(!ft||ft.call(et,Ct))&&(F[Ct]=et[Ct])}return F}s.mixin=A;function r(F){return A({},F)}s.copy=r,s.isArray=Array.isArray||function(F){return Object.prototype.toString.call(F)=="[object Array]"};function h(F){return c(F)?[]:(0,s.isArray)(F)?F:[F]}s.ensureArray=h;function M(F){return Object.prototype.toString.call(F)=="[object Object]"}s.isObject=M;function O(F){for(var K in F)return!1;return!0}s.isEmpty=O;function p(F,K){for(var Q in F)if(Q!==K)return!1;return!0}s.isOnlyPropIn=p;function c(F){return F==null}s.isEmptyArg=c;function g(F){var K=new Object;for(var Q in F)K[Q]=F[Q];return K}s.shallowClone=g;function o(F,K){var Q=function(){function et(){}return et}();Q.prototype=F;var Y=new Q;return K&&A(Y,K),Y}s.prototypicalClone=o;var i=function(F,K){if(b.default.Config.inherits){b.default.Config.inherits(F,K);return}F.super_=K,F.prototype=o(K.prototype,{constructor:F})};s.inherits=i;function n(F,K){for(var Q in F)if(F[Q]==K)return!0;return!1}s.containsValue=n;function t(F,K){return(0,s.isArray)(K)?l(F,K):u(F,K)}s.intersect=t;function l(F,K){for(var Q=[],Y=0;Y<F.length;Y++){var et=F[Y];(0,s.arrIndexOf)(K,et)!=-1&&Q.push(et)}return Q}s.arrIntersect=l;function u(F,K){for(var Q=[],Y=0;Y<F.length;Y++){var et=F[Y];et in K&&Q.push(et)}return Q}s.arrIntersectOb=u;function d(F,K){for(var Q=[],Y=0;Y<F.length;Y++){var et=F[Y];(0,s.arrIndexOf)(K,et)==-1&&Q.push(et)}return Q}s.arrSubtract=d,s.arrIndexOf=Array.prototype.indexOf?function(F,K,Q){return F.indexOf(K,Q)}:function(F,K,Q){Q=Q||0;for(var Y=F.length;Q<Y;Q++)if(F[Q]===K)return Q;return-1};function U(F,K){return(0,s.arrIndexOf)(F,K)!==-1}s.arrIn=U;function L(F,K){var Q=(0,s.arrIndexOf)(F,K),Y=Q!=-1;return Y&&F.splice(Q,1),Y}s.arrDeleteValue=L;function D(F,K){var Q=F.slice();return L(Q,K),Q}s.arrWithoutValue=D;function E(F,K){var Q=[];for(var Y in F)K&&!Object.prototype.hasOwnProperty.call(F,Y)||Q.push(Y);return Q}s.keysArray=E;function T(F,K){var Q=[];for(var Y in F)K&&!Object.prototype.hasOwnProperty.call(F,Y)||Q.push(F[Y]);return Q}s.valuesArray=T;function R(F,K){for(var Q in F)Object.prototype.hasOwnProperty.call(F,Q)&&F[Q]&&K(Q)}s.forInOwnNonNullProperties=R,s.arrForEach=Array.prototype.forEach?function(F,K){F.forEach(K)}:function(F,K){for(var Q=F.length,Y=0;Y<Q;Y++)K(F[Y],Y,F)};function j(F,K){return(0,s.arrForEach)(F.slice(),K)}s.safeArrForEach=j,s.arrMap=Array.prototype.map?function(F,K){return F.map(K)}:function(F,K){for(var Q=[],Y=F.length,et=0;et<Y;et++)Q.push(K(F[et],et,F));return Q},s.arrFilter=Array.prototype.filter?function(F,K){return F.filter(K)}:function(F,K){for(var Q=[],Y=F.length,et=0;et<Y;et++)K(F[et])&&Q.push(F[et]);return Q},s.arrEvery=Array.prototype.every?function(F,K){return F.every(K)}:function(F,K){for(var Q=F.length,Y=0;Y<Q;Y++)if(!K(F[Y],Y,F))return!1;return!0};function G(F,K){if(F.length===0)return!0;var Q=F[0][K];return(0,s.arrEvery)(F,function(Y){return Y[K]===Q})}s.allSame=G;var k={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function J(F,K){var Q=k[K||it.json];return{accept:Q,"X-Ably-Version":S.default.protocolVersion.toString(),"Ably-Agent":(0,S.getAgentString)(F)}}s.defaultGetHeaders=J;function z(F,K){var Q,Y=Q=k[K||it.json];return{accept:Y,"content-type":Q,"X-Ably-Version":S.default.protocolVersion.toString(),"Ably-Agent":(0,S.getAgentString)(F)}}s.defaultPostHeaders=z;function _(F){return F.splice(v(F),1)[0]}s.arrPopRandomElement=_;function C(F){var K=[];if(F)for(var Q in F)K.push(encodeURIComponent(Q)+"="+encodeURIComponent(F[Q]));return K.length?"?"+K.join("&"):""}s.toQueryString=C;function N(F){for(var K,Q=/([^?&=]+)=?([^&]*)/g,Y={};K=Q.exec(F);)Y[decodeURIComponent(K[1])]=decodeURIComponent(K[2]);return Y}s.parseQueryString=N,s.now=Date.now||function(){return new Date().getTime()};function B(F){return typeof F=="object"&&F!==null&&(F.constructor.name=="ErrorInfo"||F.constructor.name=="PartialErrorInfo")}s.isErrorInfoOrPartialErrorInfo=B;function H(F){var K,Q;return F instanceof Error||((K=F==null?void 0:F.constructor)===null||K===void 0?void 0:K.name)==="ErrorInfo"||((Q=F==null?void 0:F.constructor)===null||Q===void 0?void 0:Q.name)==="PartialErrorInfo"?F.toString():b.default.Config.inspect(F)}s.inspectError=H;function W(F){return b.default.BufferUtils.isBuffer(F)?F.toString():typeof F=="string"?F:b.default.Config.inspect(F)}s.inspectBody=W;function q(F){if(b.default.BufferUtils.isBuffer(F))return b.default.BufferUtils.byteLength(F);if(typeof F=="string")return b.default.Config.stringByteSize(F);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof F)}s.dataSizeBytes=q;function X(){return String(Math.random()).substr(2)}s.cheapRandStr=X;var Z=function(F){if(b.default.Config.getRandomValues&&typeof Uint8Array<"u"){var K=new Uint8Array(F);return b.default.Config.getRandomValues(K),b.default.BufferUtils.base64Encode(K)}for(var Q=b.default.BufferUtils.base64CharSet,Y=Math.round(F*4/3),et="",ft=0;ft<Y;ft++)et+=Q[v(Q)];return et};s.randomString=Z;var tt=function(F){if(b.default.Config.getRandomValues&&typeof Uint8Array<"u"){var K=new Uint8Array(F);return b.default.Config.getRandomValues(K),b.default.BufferUtils.hexEncode(K)}for(var Q=b.default.BufferUtils.hexCharSet,Y=F*2,et="",ft=0;ft<Y;ft++)et+=Q[v(Q)];return et};s.randomHexString=tt;function rt(F,K){for(var Q=Math.min(K,F.length),Y=F.slice(),et=[],ft=0;ft<Q;ft++)et.push(_(Y));return et}s.arrChooseN=rt,s.trim=String.prototype.trim?function(F){return F.trim()}:function(F){return F.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function $(F,K,Q){return new Promise(function(Y,et){F[K].apply(F,e.__spreadArray(e.__spreadArray([],Q,!1),[function(ft,Ct){ft?et(ft):Y(Ct)}],!1))})}s.promisify=$;var it;(function(F){F.msgpack="msgpack",F.json="json"})(it=s.Format||(s.Format={}));function st(F,K){return K=="msgpack"?b.default.Config.msgpack.decode(F):JSON.parse(String(F))}s.decodeBody=st;function ut(F,K){return K=="msgpack"?b.default.Config.msgpack.encode(F,!0):JSON.stringify(F)}s.encodeBody=ut;function at(F){return F.map(function(K){return K&&K.toLowerCase()})}s.allToLowerCase=at;function gt(F){return F.map(function(K){return K&&K.toUpperCase()})}s.allToUpperCase=gt;function bt(F){return Math.min((F+2)/3,2)}s.getBackoffCoefficient=bt;function dt(){return 1-Math.random()*.2}s.getJitterCoefficient=dt;function It(F,K){return F*bt(K)*dt()}s.getRetryTime=It;function Ut(){return f||(typeof window<"u"?window:self)}s.getGlobalObject=Ut;function Nt(F,K){return Object.keys(F).every(function(Q){return F[Q]===K[Q]})&&Object.keys(K).every(function(Q){return K[Q]===F[Q]})}s.shallowEquals=Nt;function Me(F){var K=/^(\[([^?]*)(?:(.*))\])?(.+)$/,Q=F.match(K);if(!Q||!Q.length||Q.length<5)throw new I.default("regex match failed",400,40010);if(Q[2])throw new I.default("cannot use a derived option with a ".concat(Q[2]," channel"),400,40010);return{qualifierParam:Q[3]||"",channelName:Q[4]}}s.matchDerivedChannel=Me;function Pe(F){return b.default.Config.createHmac?Buffer.from(F,"ascii").toString("base64"):(0,w.stringify)((0,y.parse)(F))}s.toBase64=Pe;function we(F,K){return F.length===K.length&&(0,s.arrEvery)(F,function(Q,Y){return Q===K[Y]})}s.arrEquals=we}).call(this,a(13))},function(P,s,a){(function(f){Object.defineProperty(s,"__esModule",{value:!0});var e=a(0),b=e.__importDefault(a(3)),S=f||(typeof window<"u"?window:self),I;(function(r){r[r.None=0]="None",r[r.Error=1]="Error",r[r.Major=2]="Major",r[r.Minor=3]="Minor",r[r.Micro=4]="Micro"})(I||(I={}));function w(r,h){return"".concat(r).padStart(h?3:2,"0")}function y(r){return b.default.Config.logTimestamps?function(h){var M=new Date;r(w(M.getHours())+":"+w(M.getMinutes())+":"+w(M.getSeconds())+"."+w(M.getMilliseconds(),1)+" "+h)}:r}var v=function(){var r,h,M,O;return typeof Window>"u"&&typeof WorkerGlobalScope>"u"||typeof((h=(r=S==null?void 0:S.console)===null||r===void 0?void 0:r.log)===null||h===void 0?void 0:h.apply)=="function"?(M=function(){for(var p=[],c=0;c<arguments.length;c++)p[c]=arguments[c];console.log.apply(console,p)},O=console.warn?function(){for(var p=[],c=0;c<arguments.length;c++)p[c]=arguments[c];console.warn.apply(console,p)}:M):S!=null&&S.console.log?M=O=function(){Function.prototype.apply.call(console.log,console,arguments)}:M=O=function(){},[M,O].map(y)},A=function(){function r(){r.logLevel=r.LOG_DEFAULT}return r.initLogHandlers=function(){var h=v(),M=h[0],O=h[1];this.logHandler=M,this.logErrorHandler=O},r.renamedClientOption=function(h,M){r.deprecationWarning("The `".concat(h,"` client option has been renamed to `").concat(M,"`. Please update your code to use `").concat(M,"` instead. `").concat(h,"` will be removed in a future version."))},r.renamedMethod=function(h,M,O){r.deprecationWarning("`".concat(h,"`â€™s `").concat(M,"` method has been renamed to `").concat(O,"`. Please update your code to use `").concat(O,"` instead. `").concat(M,"` will be removed in a future version."))},r.deprecationWarning=function(h){r.shouldLog(I.Error)&&r.logErrorHandler("Ably: Deprecation warning - ".concat(h))},r.logLevel=I.Error,r.LOG_NONE=I.None,r.LOG_ERROR=I.Error,r.LOG_MAJOR=I.Major,r.LOG_MINOR=I.Minor,r.LOG_MICRO=I.Micro,r.LOG_DEFAULT=I.Error,r.LOG_DEBUG=I.Micro,r.logAction=function(h,M,O){r.shouldLog(h)&&(h===I.Error?r.logErrorHandler:r.logHandler)("Ably: "+M+": "+O)},r.deprecated=function(h,M){r.deprecationWarning("".concat(h," is deprecated and will be removed in a future version. ").concat(M))},r.shouldLog=function(h){return h<=r.logLevel},r.setLog=function(h,M){h!==void 0&&(r.logLevel=h),M!==void 0&&(r.logHandler=r.logErrorHandler=M)},r}();s.default=A}).call(this,a(13))},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=function(){function e(){}return e}();s.default=f},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0}),s.PartialErrorInfo=void 0;var f=a(0),e=f.__importDefault(a(3)),b=f.__importStar(a(1));function S(y){var v="["+y.constructor.name;return y.message&&(v+=": "+y.message),y.statusCode&&(v+="; statusCode="+y.statusCode),y.code&&(v+="; code="+y.code),y.cause&&(v+="; cause="+b.inspectError(y.cause)),y.href&&!(y.message&&y.message.indexOf("help.ably.io")>-1)&&(v+="; see "+y.href+" "),v+="]",v}var I=function(y){f.__extends(v,y);function v(A,r,h,M){var O=y.call(this,A)||this;return typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(O,v.prototype),O.code=r,O.statusCode=h,O.cause=M,O}return v.prototype.toString=function(){return S(this)},v.fromValues=function(A){var r=A,h=r.message,M=r.code,O=r.statusCode;if(typeof h!="string"||typeof M!="number"||typeof O!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+e.default.Config.inspect(A));var p=Object.assign(new v(h,M,O),A);return p.code&&!p.href&&(p.href="https://help.ably.io/error/"+p.code),p},v}(Error);s.default=I;var w=function(y){f.__extends(v,y);function v(A,r,h,M){var O=y.call(this,A)||this;return typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(O,v.prototype),O.code=r,O.statusCode=h,O.cause=M,O}return v.prototype.toString=function(){return S(this)},v}(Error);s.PartialErrorInfo=w},function(P,s,a){(function(f,e){P.exports=e(a(6))})(this,function(f){return function(){if(typeof ArrayBuffer=="function"){var e=f,b=e.lib,S=b.WordArray,I=S.init,w=S.init=function(y){if(y instanceof ArrayBuffer&&(y=new Uint8Array(y)),(y instanceof Int8Array||typeof Uint8ClampedArray<"u"&&y instanceof Uint8ClampedArray||y instanceof Int16Array||y instanceof Uint16Array||y instanceof Int32Array||y instanceof Uint32Array||y instanceof Float32Array||y instanceof Float64Array)&&(y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength)),y instanceof Uint8Array){for(var v=y.byteLength,A=[],r=0;r<v;r++)A[r>>>2]|=y[r]<<24-r%4*8;I.call(this,A,v)}else I.apply(this,arguments)};w.prototype=S}}(),f.lib.WordArray})},function(P,s,a){(function(f){(function(e,b){P.exports=b()})(this,function(){var e=e||function(b,S){var I;if(typeof window<"u"&&window.crypto&&(I=window.crypto),!I&&typeof window<"u"&&window.msCrypto&&(I=window.msCrypto),!I&&typeof f<"u"&&f.crypto&&(I=f.crypto),!I)try{I=a(44)}catch{}var w=function(){if(I){if(typeof I.getRandomValues=="function")try{return I.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof I.randomBytes=="function")try{return I.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},y=Object.create||function(){function i(){}return function(n){var t;return i.prototype=n,t=new i,i.prototype=null,t}}(),v={},A=v.lib={},r=A.Base=function(){return{extend:function(i){var n=y(this);return i&&n.mixIn(i),(!n.hasOwnProperty("init")||this.init===n.init)&&(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var i=this.extend();return i.init.apply(i,arguments),i},init:function(){},mixIn:function(i){for(var n in i)i.hasOwnProperty(n)&&(this[n]=i[n]);i.hasOwnProperty("toString")&&(this.toString=i.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),h=A.WordArray=r.extend({init:function(i,n){i=this.words=i||[],n!=S?this.sigBytes=n:this.sigBytes=i.length*4},toString:function(i){return(i||O).stringify(this)},concat:function(i){var n=this.words,t=i.words,l=this.sigBytes,u=i.sigBytes;if(this.clamp(),l%4)for(var d=0;d<u;d++){var U=t[d>>>2]>>>24-d%4*8&255;n[l+d>>>2]|=U<<24-(l+d)%4*8}else for(var d=0;d<u;d+=4)n[l+d>>>2]=t[d>>>2];return this.sigBytes+=u,this},clamp:function(){var i=this.words,n=this.sigBytes;i[n>>>2]&=4294967295<<32-n%4*8,i.length=b.ceil(n/4)},clone:function(){var i=r.clone.call(this);return i.words=this.words.slice(0),i},random:function(i){for(var n=[],t=0;t<i;t+=4)n.push(w());return new h.init(n,i)}}),M=v.enc={},O=M.Hex={stringify:function(i){for(var n=i.words,t=i.sigBytes,l=[],u=0;u<t;u++){var d=n[u>>>2]>>>24-u%4*8&255;l.push((d>>>4).toString(16)),l.push((d&15).toString(16))}return l.join("")},parse:function(i){for(var n=i.length,t=[],l=0;l<n;l+=2)t[l>>>3]|=parseInt(i.substr(l,2),16)<<24-l%8*4;return new h.init(t,n/2)}},p=M.Latin1={stringify:function(i){for(var n=i.words,t=i.sigBytes,l=[],u=0;u<t;u++){var d=n[u>>>2]>>>24-u%4*8&255;l.push(String.fromCharCode(d))}return l.join("")},parse:function(i){for(var n=i.length,t=[],l=0;l<n;l++)t[l>>>2]|=(i.charCodeAt(l)&255)<<24-l%4*8;return new h.init(t,n)}},c=M.Utf8={stringify:function(i){try{return decodeURIComponent(escape(p.stringify(i)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(i){return p.parse(unescape(encodeURIComponent(i)))}},g=A.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(i){typeof i=="string"&&(i=c.parse(i)),this._data.concat(i),this._nDataBytes+=i.sigBytes},_process:function(i){var n,t=this._data,l=t.words,u=t.sigBytes,d=this.blockSize,U=d*4,L=u/U;i?L=b.ceil(L):L=b.max((L|0)-this._minBufferSize,0);var D=L*d,E=b.min(D*4,u);if(D){for(var T=0;T<D;T+=d)this._doProcessBlock(l,T);n=l.splice(0,D),t.sigBytes-=E}return new h.init(n,E)},clone:function(){var i=r.clone.call(this);return i._data=this._data.clone(),i},_minBufferSize:0});A.Hasher=g.extend({cfg:r.extend(),init:function(i){this.cfg=this.cfg.extend(i),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(i){return this._append(i),this._process(),this},finalize:function(i){i&&this._append(i);var n=this._doFinalize();return n},blockSize:16,_createHelper:function(i){return function(n,t){return new i.init(t).finalize(n)}},_createHmacHelper:function(i){return function(n,t){return new o.HMAC.init(i,t).finalize(n)}}});var o=v.algo={};return v}(Math);return e})}).call(this,a(13))},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importStar(a(1)),b=f.__importDefault(a(2)),S=f.__importDefault(a(3));function I(v,A,r){try{A.apply(v,r)}catch(h){b.default.logAction(b.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+h+"; stack = "+(h&&h.stack))}}function w(v,A,r){for(var h,M,O,p=0;p<v.length;p++)if(h=v[p],r&&(h=h[r]),e.isArray(h)){for(;(M=e.arrIndexOf(h,A))!==-1;)h.splice(M,1);r&&h.length===0&&delete v[p][r]}else if(e.isObject(h))for(O in h)Object.prototype.hasOwnProperty.call(h,O)&&e.isArray(h[O])&&w([h],A,O)}var y=function(){function v(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return v.prototype.on=function(){for(var A=this,r=[],h=0;h<arguments.length;h++)r[h]=arguments[h];if(r.length===1){var M=r[0];if(typeof M=="function")this.any.push(M);else throw new Error("EventListener.on(): Invalid arguments: "+S.default.Config.inspect(r))}if(r.length===2){var O=r[0],p=r[1];if(typeof p!="function")throw new Error("EventListener.on(): Invalid arguments: "+S.default.Config.inspect(r));if(e.isEmptyArg(O))this.any.push(p);else if(e.isArray(O))O.forEach(function(g){A.on(g,p)});else{if(typeof O!="string")throw new Error("EventListener.on(): Invalid arguments: "+S.default.Config.inspect(r));var c=this.events[O]||(this.events[O]=[]);c.push(p)}}},v.prototype.off=function(){for(var A,r=this,h=[],M=0;M<arguments.length;M++)h[M]=arguments[M];if(h.length==0||e.isEmptyArg(h[0])&&e.isEmptyArg(h[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var O=h[0],p=h[1],c=null,g=null;if(h.length===1||!p)typeof O=="function"?c=O:g=O;else{if(typeof p!="function")throw new Error("EventEmitter.off(): invalid arguments:"+S.default.Config.inspect(h));A=[O,p],g=A[0],c=A[1]}if(c&&e.isEmptyArg(g)){w([this.any,this.events,this.anyOnce,this.eventsOnce],c);return}if(e.isArray(g)){g.forEach(function(o){r.off(o,c)});return}if(typeof g!="string")throw new Error("EventEmitter.off(): invalid arguments:"+S.default.Config.inspect(h));c?w([this.events,this.eventsOnce],c,g):(delete this.events[g],delete this.eventsOnce[g])},v.prototype.listeners=function(A){if(A){var r=this.events[A]||[];return this.eventsOnce[A]&&Array.prototype.push.apply(r,this.eventsOnce[A]),r.length?r:null}return this.any.length?this.any:null},v.prototype.emit=function(A){for(var r=[],h=1;h<arguments.length;h++)r[h-1]=arguments[h];var M={event:A},O=[];this.anyOnce.length&&(Array.prototype.push.apply(O,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(O,this.any);var p=this.eventsOnce[A];p&&(Array.prototype.push.apply(O,p),delete this.eventsOnce[A]);var c=this.events[A];c&&Array.prototype.push.apply(O,c),e.arrForEach(O,function(g){I(M,g,r)})},v.prototype.once=function(){for(var A=this,r=[],h=0;h<arguments.length;h++)r[h]=arguments[h];var M=r.length;if((M===0||M===1&&typeof r[0]!="function")&&S.default.Config.Promise){var O=r[0];return new S.default.Config.Promise(function(n){A.once(O,n)})}var p=r[0],c=r[1];if(r.length===1&&typeof p=="function")this.anyOnce.push(p);else if(e.isEmptyArg(p)){if(typeof c!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+S.default.Config.inspect(r));this.anyOnce.push(c)}else if(e.isArray(p)){var g=this,o=function(){var n=Array.prototype.slice.call(arguments);if(e.arrForEach(p,function(t){g.off(t,o)}),typeof c!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+S.default.Config.inspect(r));c.apply(this,n)};e.arrForEach(p,function(n){g.on(n,o)})}else{if(typeof p!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+S.default.Config.inspect(r));var i=this.eventsOnce[p]||(this.eventsOnce[p]=[]);if(c){if(typeof c!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+S.default.Config.inspect(r));i.push(c)}}},v.prototype.whenState=function(A,r,h){for(var M=this,O=[],p=3;p<arguments.length;p++)O[p-3]=arguments[p];var c={event:A};if(typeof A!="string"||typeof r!="string")throw"whenState requires a valid event String argument";if(typeof h!="function"&&S.default.Config.Promise)return new S.default.Config.Promise(function(g){v.prototype.whenState.apply(M,[A,r,g].concat(O))});A===r?I(c,h,O):this.once(A,h)},v}();s.default=y},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0}),s.getDefaults=s.normaliseOptions=s.objectifyOptions=s.getAgentString=s.getHosts=s.getFallbackHosts=s.environmentFallbackHosts=s.getHttpScheme=s.getPort=s.getHost=void 0;var f=a(0),e=f.__importDefault(a(3)),b=f.__importStar(a(1)),S=f.__importDefault(a(2)),I=f.__importDefault(a(4)),w=a(43),y="ably-js/"+w.version,v={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:w.version,protocolVersion:2,agent:y,getHost:A,getPort:r,getHttpScheme:h,environmentFallbackHosts:M,getFallbackHosts:O,getHosts:p,checkHost:c,objectifyOptions:n,normaliseOptions:t};function A(u,d,U){return U?d=d==u.restHost&&u.realtimeHost||d||u.realtimeHost:d=d||u.restHost,d}s.getHost=A;function r(u,d){return d||u.tls?u.tlsPort:u.port}s.getPort=r;function h(u){return u.tls?"https://":"http://"}s.getHttpScheme=h;function M(u){return[u+"-a-fallback.ably-realtime.com",u+"-b-fallback.ably-realtime.com",u+"-c-fallback.ably-realtime.com",u+"-d-fallback.ably-realtime.com",u+"-e-fallback.ably-realtime.com"]}s.environmentFallbackHosts=M;function O(u){var d=u.fallbackHosts,U=typeof u.httpMaxRetryCount<"u"?u.httpMaxRetryCount:v.httpMaxRetryCount;return d?b.arrChooseN(d,U):[]}s.getFallbackHosts=O;function p(u){return[u.restHost].concat(O(u))}s.getHosts=p;function c(u){if(typeof u!="string")throw new I.default("host must be a string; was a "+typeof u,4e4,400);if(!u.length)throw new I.default("host must not be zero-length",4e4,400)}function g(u,d,U){return u.realtimeHost?u.realtimeHost:u.restHost?(S.default.logAction(S.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+u.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+u.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),u.restHost):d?v.REALTIME_HOST:U+"-"+v.REALTIME_HOST}function o(u){var d={};for(var U in v.TIMEOUTS)d[U]=u[U]||v.TIMEOUTS[U];return d}function i(u){var d=v.agent;if(u.agents)for(var U in u.agents)d+=" "+U+"/"+u.agents[U];return d}s.getAgentString=i;function n(u){return typeof u=="string"?u.indexOf(":")==-1?{token:u}:{key:u}:u}s.objectifyOptions=n;function t(u){if(u.host&&(S.default.renamedClientOption("host","restHost"),u.restHost=u.host),u.wsHost&&(S.default.renamedClientOption("wsHost","realtimeHost"),u.realtimeHost=u.wsHost),u.queueEvents&&(S.default.renamedClientOption("queueEvents","queueMessages"),u.queueMessages=u.queueEvents),u.headers&&S.default.deprecated("the `headers` client option",""),u.fallbackHostsUseDefault){if(u.fallbackHosts){var d="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw S.default.logAction(S.default.LOG_ERROR,"Defaults.normaliseOptions",d),new I.default(d,4e4,400)}if(u.port||u.tlsPort){var d="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw S.default.logAction(S.default.LOG_ERROR,"Defaults.normaliseOptions",d),new I.default(d,4e4,400)}u.environment?S.default.deprecated("The `fallbackHostsUseDefault` client option","If youâ€™re using this client option to force the library to make use of fallback hosts even though youâ€™ve set the `environment` client option, then this is no longer necessary: remove your usage of the `fallbackHostsUseDefault` client option and the library will then automatically choose the correct fallback hosts to use for the specified environment."):S.default.deprecated("The `fallbackHostsUseDefault` client option","If youâ€™re using this client option to force the library to make use of fallback hosts even though youâ€™re not using the primary Ably environment, then stop using `fallbackHostsUseDefault`, and update your code to either pass the `environment` client option (in which case the library will automatically choose the correct fallback hosts to use for the specified environment), or to pass the `fallbackHosts` client option to specify a custom list of fallback hosts to use (for example, if youâ€™re using a custom CNAME, in which case Ably will have provided you with an explicit list of fallback hosts)."),u.fallbackHosts=v.FALLBACK_HOSTS}u.recover===!0&&(S.default.deprecated("The ability to use a boolean value for the `recover` client option","If you wish for the connection to always be recovered, replace `{ recover: true }` with a function that always passes `true` to its callback: `{ recover: function(lastConnectionDetails, cb) { cb(true); } }`"),u.recover=function(_,C){C(!0)}),typeof u.recover=="function"&&u.closeOnUnload===!0&&(S.default.logAction(S.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),u.recover=void 0),"closeOnUnload"in u||(u.closeOnUnload=!u.recover),u.transports&&b.arrIn(u.transports,"xhr")&&(S.default.deprecationWarning('The "xhr" transport has been renamed to "xhr_streaming". Please update your client options code to use `transports: ["xhr_streaming"]` instead. The ability to use `transports: ["xhr"]` will be removed in a future version.'),b.arrDeleteValue(u.transports,"xhr"),u.transports.push("xhr_streaming")),"queueMessages"in u||(u.queueMessages=!0);var U=u.environment&&String(u.environment).toLowerCase()||v.ENVIRONMENT,L=!U||U==="production";!u.fallbackHosts&&!u.restHost&&!u.realtimeHost&&!u.port&&!u.tlsPort&&(u.fallbackHosts=L?v.FALLBACK_HOSTS:M(U));var D=u.restHost||(L?v.REST_HOST:U+"-"+v.REST_HOST),E=g(u,L,U);b.arrForEach((u.fallbackHosts||[]).concat(D,E),c),u.port=u.port||v.PORT,u.tlsPort=u.tlsPort||v.TLS_PORT,"tls"in u||(u.tls=!0);var T=o(u);if("useBinaryProtocol"in u?u.useBinaryProtocol=e.default.Config.supportsBinary&&u.useBinaryProtocol:u.useBinaryProtocol=e.default.Config.preferBinary,u.clientId){var R=u.headers=u.headers||{};R["X-Ably-ClientId"]=e.default.BufferUtils.base64Encode(e.default.BufferUtils.utf8Encode(u.clientId))}"idempotentRestPublishing"in u||(u.idempotentRestPublishing=!0),u.promises&&!e.default.Config.Promise&&(S.default.logAction(S.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),u.promises=!1);var j=null,G=u.connectivityCheckUrl;if(u.connectivityCheckUrl){var k=u.connectivityCheckUrl.split("?"),J=k[0],z=k[1];j=z?b.parseQueryString(z):{},J.indexOf("://")===-1&&(J="https://"+J),G=J}return f.__assign(f.__assign({},u),{useBinaryProtocol:"useBinaryProtocol"in u?e.default.Config.supportsBinary&&u.useBinaryProtocol:e.default.Config.preferBinary,realtimeHost:E,restHost:D,maxMessageSize:u.maxMessageSize||v.maxMessageSize,timeouts:T,connectivityCheckParams:j,connectivityCheckUrl:G})}s.normaliseOptions=t,s.default=v;function l(u){return Object.assign(v,u)}s.getDefaults=l},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importDefault(a(3)),b=f.__importDefault(a(2)),S=f.__importDefault(a(4)),I=f.__importStar(a(1));function w(r){return!r||!r.channelOptions?{channelOptions:r,plugins:{},baseEncodedPreviousPayload:void 0}:r}function y(r){if(r&&r.cipher){if(!e.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var h=e.default.Crypto.getCipher(r.cipher);return{cipher:h.cipherParams,channelCipher:h.cipher}}return r??{}}function v(r){var h=0;return r.name&&(h+=r.name.length),r.clientId&&(h+=r.clientId.length),r.extras&&(h+=JSON.stringify(r.extras).length),r.data&&(h+=I.dataSizeBytes(r.data)),h}var A=function(){function r(){}return r.prototype.toJSON=function(){var h=this.encoding,M=this.data;return M&&e.default.BufferUtils.isBuffer(M)&&(arguments.length>0?(h=h?h+"/base64":"base64",M=e.default.BufferUtils.base64Encode(M)):M=e.default.BufferUtils.toBuffer(M)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:h,data:M}},r.prototype.toString=function(){var h="[Message";return this.name&&(h+="; name="+this.name),this.id&&(h+="; id="+this.id),this.timestamp&&(h+="; timestamp="+this.timestamp),this.clientId&&(h+="; clientId="+this.clientId),this.connectionId&&(h+="; connectionId="+this.connectionId),this.encoding&&(h+="; encoding="+this.encoding),this.extras&&(h+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?h+="; data="+this.data:e.default.BufferUtils.isBuffer(this.data)?h+="; data (buffer)="+e.default.BufferUtils.base64Encode(this.data):h+="; data (json)="+JSON.stringify(this.data)),this.extras&&(h+="; extras="+JSON.stringify(this.extras)),h+="]",h},r.encrypt=function(h,M,O){var p=h.data,c=h.encoding,g=M.channelCipher;c=c?c+"/":"",e.default.BufferUtils.isBuffer(p)||(p=e.default.BufferUtils.utf8Encode(String(p)),c=c+"utf-8/"),g.encrypt(p,function(o,i){if(o){O(o);return}h.data=i,h.encoding=c+"cipher+"+g.algorithm,O(null,h)})},r.encode=function(h,M,O){var p=h.data,c=typeof p=="string"||e.default.BufferUtils.isBuffer(p)||p===null||p===void 0;if(!c)if(I.isObject(p)||I.isArray(p))h.data=JSON.stringify(p),h.encoding=h.encoding?h.encoding+"/json":"json";else throw new S.default("Data type is unsupported",40013,400);M!=null&&M.cipher?r.encrypt(h,M,O):O(null,h)},r.encodeArray=function(h,M,O){for(var p=0,c=0;c<h.length;c++)r.encode(h[c],M,function(g){if(g){O(g);return}p++,p==h.length&&O(null,h)})},r.decode=function(h,M){var O=w(M),p=h.data,c=h.encoding;if(c){var g=c.split("/"),o=void 0,i=g.length,n=h.data,t="";try{for(;(o=i)>0;){var l=g[--i].match(/([-\w]+)(\+([\w-]+))?/);if(!l)break;switch(t=l[1],t){case"base64":n=e.default.BufferUtils.base64Decode(String(n)),o==g.length&&(p=n);continue;case"utf-8":n=e.default.BufferUtils.utf8Decode(n);continue;case"json":n=JSON.parse(n);continue;case"cipher":if(O.channelOptions!=null&&O.channelOptions.cipher&&O.channelOptions.channelCipher){var u=l[3],d=O.channelOptions.channelCipher;if(u!=d.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");n=d.decrypt(n);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!O.plugins||!O.plugins.vcdiff)throw new S.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array>"u")throw new S.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var U=O.baseEncodedPreviousPayload;typeof U=="string"&&(U=e.default.BufferUtils.utf8Encode(U)),U=e.default.BufferUtils.toBuffer(U),n=e.default.BufferUtils.toBuffer(n),n=e.default.BufferUtils.typedArrayToBuffer(O.plugins.vcdiff.decode(n,U)),p=n}catch(D){throw new S.default("Vcdiff delta decode failed with "+D,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(D){var L=D;throw new S.default("Error processing the "+t+" encoding, decoder returned â€˜"+L.message+"â€™",L.code||40013,400)}finally{h.encoding=o<=0?null:g.slice(0,o).join("/"),h.data=n}}O.baseEncodedPreviousPayload=p},r.fromResponseBody=function(h,M,O){O&&(h=I.decodeBody(h,O));for(var p=0;p<h.length;p++){var c=h[p]=r.fromValues(h[p]);try{r.decode(c,M)}catch(g){b.default.logAction(b.default.LOG_ERROR,"Message.fromResponseBody()",g.toString())}}return h},r.fromValues=function(h){return Object.assign(new r,h)},r.fromValuesArray=function(h){for(var M=h.length,O=new Array(M),p=0;p<M;p++)O[p]=r.fromValues(h[p]);return O},r.fromEncoded=function(h,M){var O=r.fromValues(h),p=y(M??null);try{r.decode(O,p)}catch(c){b.default.logAction(b.default.LOG_ERROR,"Message.fromEncoded()",c.toString())}return O},r.fromEncodedArray=function(h,M){return h.map(function(O){return r.fromEncoded(O,M)})},r.getMessagesSize=function(h){for(var M,O=0,p=0;p<h.length;p++)M=h[p],O+=M.size||(M.size=v(M));return O},r.serialize=I.encodeBody,r}();s.default=A},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importStar(a(1)),b=f.__importDefault(a(4)),S=f.__importDefault(a(9)),I=f.__importDefault(a(16)),w={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18},y=[];Object.keys(w).forEach(function(O){y[w[O]]=O});var v={HAS_PRESENCE:1,HAS_BACKLOG:2,RESUMED:4,TRANSIENT:16,ATTACH_RESUME:32,PRESENCE:65536,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},A=Object.keys(v);v.MODE_ALL=v.PRESENCE|v.PUBLISH|v.SUBSCRIBE|v.PRESENCE_SUBSCRIBE;function r(O){var p=[];if(O)for(var c=0;c<O.length;c++)p.push(O[c].toString());return"[ "+p.join(", ")+" ]"}var h="id channel channelSerial connectionId count msgSerial timestamp".split(" "),M=function(){function O(){var p=this;this.hasFlag=function(c){return(p.flags&v[c])>0}}return O.prototype.setFlag=function(p){return this.flags=this.flags|v[p]},O.prototype.getMode=function(){return this.flags&&this.flags&v.MODE_ALL},O.prototype.encodeModesToFlags=function(p){var c=this;p.forEach(function(g){return c.setFlag(g)})},O.prototype.decodeModesFromFlags=function(){var p=this,c=[];return O.channelModes.forEach(function(g){p.hasFlag(g)&&c.push(g)}),c.length>0?c:void 0},O.fromValues=function(p){return Object.assign(new O,p)},O.Action=w,O.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],O.ActionName=y,O.serialize=e.encodeBody,O.deserialize=function(p,c){var g=e.decodeBody(p,c);return O.fromDeserialized(g)},O.fromDeserialized=function(p){var c=p.error;c&&(p.error=b.default.fromValues(c));var g=p.messages;if(g)for(var o=0;o<g.length;o++)g[o]=S.default.fromValues(g[o]);var i=p.presence;if(i)for(var o=0;o<i.length;o++)i[o]=I.default.fromValues(i[o],!0);return Object.assign(new O,p)},O.stringify=function(p){var c="[ProtocolMessage";p.action!==void 0&&(c+="; action="+O.ActionName[p.action]||!1);for(var g,o=0;o<h.length;o++)g=h[o],p[g]!==void 0&&(c+="; "+g+"="+p[g]);if(p.messages&&(c+="; messages="+r(S.default.fromValuesArray(p.messages))),p.presence&&(c+="; presence="+r(I.default.fromValuesArray(p.presence))),p.error&&(c+="; error="+b.default.fromValues(p.error).toString()),p.auth&&p.auth.accessToken&&(c+="; token="+p.auth.accessToken),p.flags&&(c+="; flags="+A.filter(p.hasFlag).join(",")),p.params){var i="";e.forInOwnNonNullProperties(p.params,function(n){i.length>0&&(i+="; "),i+=n+"="+p.params[n]}),i.length>0&&(c+="; params=["+i+"]")}return c+="]",c},O}();s.default=M},function(P,s,a){(function(f,e){P.exports=e(a(6))})(this,function(f){return function(){var e=f,b=e.lib,S=b.WordArray,I=e.enc;I.Base64={stringify:function(y){var v=y.words,A=y.sigBytes,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";y.clamp();for(var h=[],M=0;M<A;M+=3)for(var O=v[M>>>2]>>>24-M%4*8&255,p=v[M+1>>>2]>>>24-(M+1)%4*8&255,c=v[M+2>>>2]>>>24-(M+2)%4*8&255,g=O<<16|p<<8|c,o=0;o<4&&M+o*.75<A;o++)h.push(r.charAt(g>>>6*(3-o)&63));var i=r.charAt(64);if(i)for(;h.length%4;)h.push(i);return h.join("")},parse:function(y){var v=y.length,A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var h=0;h<A.length;h++)r[A.charCodeAt(h)]=h}var M=A.charAt(64);if(M){var O=y.indexOf(M);O!==-1&&(v=O)}return w(y,v,r)}};function w(y,v,A){for(var r=[],h=0,M=0;M<v;M++)if(M%4){var O=A[y.charCodeAt(M-1)]<<M%4*2,p=A[y.charCodeAt(M)]>>>6-M%4*2,c=O|p;r[h>>>2]|=c<<24-h%4*8,h++}return S.create(r,h)}}(),f.enc.Base64})},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importStar(a(1)),b=f.__importDefault(a(10)),S=f.__importDefault(a(26)),I=f.__importDefault(a(2)),w=f.__importDefault(a(8)),y=f.__importDefault(a(21)),v=f.__importDefault(a(18)),A=f.__importDefault(a(4)),r=f.__importDefault(a(22)),h=f.__importDefault(a(3));function M(c){var g=[80015,80017,80030];return c.code?v.default.isTokenErr(c)?!1:e.arrIn(g,c.code)?!0:c.code>=4e4&&c.code<5e4:!1}function O(c){return M(c)?[b.default.fromValues({action:b.default.Action.ERROR,error:c})]:[b.default.fromValues({action:b.default.Action.DISCONNECTED,error:c})]}var p=function(c){f.__extends(g,c);function g(o,i,n){var t=c.call(this,o,i,n,!0)||this;return t.onAuthUpdated=function(l){t.authParams={access_token:l.token}},t.stream="stream"in n?n.stream:!0,t.sendRequest=null,t.recvRequest=null,t.pendingCallback=null,t.pendingItems=null,t}return g.prototype.connect=function(){var o=this;I.default.logAction(I.default.LOG_MINOR,"CometTransport.connect()","starting"),S.default.prototype.connect.call(this);var i=this.params,n=i.options,t=w.default.getHost(n,i.host),l=w.default.getPort(n),u=n.tls?"https://":"http://";this.baseUri=u+t+":"+l+"/comet/";var d=this.baseUri+"connect";I.default.logAction(I.default.LOG_MINOR,"CometTransport.connect()","uri: "+d),this.auth.getAuthParams(function(U,L){if(U){o.disconnect(U);return}if(!o.isDisposed){o.authParams=L;var D=o.params.getConnectParams(L);"stream"in D&&(o.stream=D.stream),I.default.logAction(I.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+e.toQueryString(D));var E=!1,T=o.recvRequest=o.createRequest(d,null,D,null,o.stream?r.default.REQ_RECV_STREAM:r.default.REQ_RECV);T.on("data",function(R){o.recvRequest&&(E||(E=!0,o.emit("preconnect")),o.onData(R))}),T.on("complete",function(R){if(o.recvRequest||(R=R||new A.default("Request cancelled",80003,400)),o.recvRequest=null,!E&&!R&&(E=!0,o.emit("preconnect")),o.onActivity(),R){R.code?o.onData(O(R)):o.disconnect(R);return}h.default.Config.nextTick(function(){o.recv()})}),T.exec()}})},g.prototype.requestClose=function(){I.default.logAction(I.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},g.prototype.requestDisconnect=function(){I.default.logAction(I.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},g.prototype._requestCloseOrDisconnect=function(o){var i=this,n=o?this.closeUri:this.disconnectUri;if(n){var t=this.createRequest(n,null,this.authParams,null,r.default.REQ_SEND);t.on("complete",function(l){l&&(I.default.logAction(I.default.LOG_ERROR,"CometTransport.request"+(o?"Close()":"Disconnect()"),"request returned err = "+e.inspectError(l)),i.finish("disconnected",l))}),t.exec()}},g.prototype.dispose=function(){var o=this;I.default.logAction(I.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(I.default.logAction(I.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",y.default.disconnected()),h.default.Config.nextTick(function(){o.emit("disposed")}))},g.prototype.onConnect=function(o){var i;if(!this.isDisposed){var n=(i=o.connectionDetails)===null||i===void 0?void 0:i.connectionKey;S.default.prototype.onConnect.call(this,o);var t=this.baseUri+n;I.default.logAction(I.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+t),this.sendUri=t+"/send",this.recvUri=t+"/recv",this.closeUri=t+"/close",this.disconnectUri=t+"/disconnect"}},g.prototype.send=function(o){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(o);return}var i=this.pendingItems||[];i.push(o),this.pendingItems=null,this.sendItems(i)},g.prototype.sendAnyPending=function(){var o=this.pendingItems;o&&(this.pendingItems=null,this.sendItems(o))},g.prototype.sendItems=function(o){var i=this,n=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(o),r.default.REQ_SEND);n.on("complete",function(t,l){if(t&&I.default.logAction(I.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+e.inspectError(t)),i.sendRequest=null,t){t.code?i.onData(O(t)):i.disconnect(t);return}l&&i.onData(l),i.pendingItems&&h.default.Config.nextTick(function(){i.sendRequest||i.sendAnyPending()})}),n.exec()},g.prototype.recv=function(){var o=this;if(!this.recvRequest&&this.isConnected){var i=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?r.default.REQ_RECV_STREAM:r.default.REQ_RECV_POLL);i.on("data",function(n){o.onData(n)}),i.on("complete",function(n){if(o.recvRequest=null,o.onActivity(),n){n.code?o.onData(O(n)):o.disconnect(n);return}h.default.Config.nextTick(function(){o.recv()})}),i.exec()}},g.prototype.onData=function(o){try{var i=this.decodeResponse(o);if(i&&i.length)for(var n=0;n<i.length;n++)this.onProtocolMessage(b.default.fromDeserialized(i[n]))}catch(t){I.default.logAction(I.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+t.stack)}},g.prototype.encodeRequest=function(o){return JSON.stringify(o)},g.prototype.decodeResponse=function(o){return typeof o=="string"?JSON.parse(o):o},g}(S.default);s.default=p},function(P,s){var a;a=function(){return this}();try{a=a||new Function("return this")()}catch{typeof window=="object"&&(a=window)}P.exports=a},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0}),s.isSuccessCode=void 0;var f;(function(b){b[b.Success=200]="Success",b[b.NoContent=204]="NoContent",b[b.BadRequest=400]="BadRequest",b[b.Unauthorized=401]="Unauthorized",b[b.Forbidden=403]="Forbidden",b[b.RequestTimeout=408]="RequestTimeout",b[b.InternalServerError=500]="InternalServerError"})(f||(f={}));function e(b){return b>=f.Success&&b<f.BadRequest}s.isSuccessCode=e,s.default=f},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importDefault(a(3)),b=f.__importStar(a(1)),S=f.__importDefault(a(2)),I=f.__importDefault(a(18)),w=f.__importDefault(a(19)),y=a(4),v=f.__importDefault(a(14));function A(c,g,o,i,n){c.http.supportsAuthHeaders?c.auth.getAuthHeaders(function(t,l){t?i(t):n(b.mixin(l,g),o)}):c.auth.getAuthParams(function(t,l){t?i(t):n(g,b.mixin(l,o))})}function r(c,g){return function(o,i,n,t,l){if(o&&!i){c(o);return}if(l===v.default.NoContent){c(o,[],n,!0,l);return}if(!t)try{i=b.decodeBody(i,g)}catch(E){b.isErrorInfoOrPartialErrorInfo(E)?c(E):c(new y.PartialErrorInfo(b.inspectError(E),null));return}if(!i){c(new y.PartialErrorInfo("unenvelope(): Response body is missing",null));return}var u=i,d=u.statusCode,U=u.response,L=u.headers;if(d===void 0){c(o,i,n,!0,l);return}if(d<200||d>=300){var D=U&&U.error||o;D||(D=new Error("Error in unenveloping "+i),D.statusCode=d),c(D,U,L,!0,d);return}c(o,U,L,!0,d)}}function h(c){var g=[];if(c)for(var o in c)g.push(o+"="+c[o]);return g.join("&")}function M(c,g){return c+(g?"?":"")+h(g)}function O(c,g,o,i){return function(n,t,l,u,d){n?S.default.logAction(S.default.LOG_MICRO,"Resource."+g+"()","Received Error; "+M(o,i)+"; Error: "+b.inspectError(n)):S.default.logAction(S.default.LOG_MICRO,"Resource."+g+"()","Received; "+M(o,i)+"; Headers: "+h(l)+"; StatusCode: "+d+"; Body: "+(e.default.BufferUtils.isBuffer(t)?t.toString():t)),c&&c(n,t,l,u,d)}}var p=function(){function c(){}return c.get=function(g,o,i,n,t,l){c.do(w.default.Get,g,o,null,i,n,t,l)},c.delete=function(g,o,i,n,t,l){c.do(w.default.Delete,g,o,null,i,n,t,l)},c.post=function(g,o,i,n,t,l,u){c.do(w.default.Post,g,o,i,n,t,l,u)},c.patch=function(g,o,i,n,t,l,u){c.do(w.default.Patch,g,o,i,n,t,l,u)},c.put=function(g,o,i,n,t,l,u){c.do(w.default.Put,g,o,i,n,t,l,u)},c.do=function(g,o,i,n,t,l,u,d){S.default.shouldLog(S.default.LOG_MICRO)&&(d=O(d,g,i,l)),u&&(d=d&&r(d,u),(l=l||{}).envelope=u);function U(L,D){var E;if(S.default.shouldLog(S.default.LOG_MICRO)&&S.default.logAction(S.default.LOG_MICRO,"Resource."+g+"()","Sending; "+M(i,D)),S.default.shouldLog(S.default.LOG_MICRO)){var T=n;if(((E=L["content-type"])===null||E===void 0?void 0:E.indexOf("msgpack"))>0)try{T=e.default.Config.msgpack.decode(n)}catch(R){S.default.logAction(S.default.LOG_MICRO,"Resource."+g+"()","Sending MsgPack Decoding Error: "+b.inspectError(R))}S.default.logAction(S.default.LOG_MICRO,"Resource."+g+"()","Sending; "+M(i,D)+"; Body: "+T)}o.http.do(g,o,i,L,n,D,function(R,j,G,k,J){if(R&&I.default.isTokenErr(R)){o.auth.authorize(null,null,function(z){if(z){d(z);return}A(o,L,D,d,U)});return}d(R,j,G,k,J)})}A(o,t,l,d,U)},c}();s.default=p},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importDefault(a(2)),b=f.__importDefault(a(3)),S=f.__importDefault(a(9)),I=f.__importStar(a(1));function w(v){return y.Actions.indexOf(v)}var y=function(){function v(){}return v.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},v.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var A=this.id.split(":");return{connectionId:A[0],msgSerial:parseInt(A[1],10),index:parseInt(A[2],10)}},v.prototype.toJSON=function(){var A=this.data,r=this.encoding;return A&&b.default.BufferUtils.isBuffer(A)&&(arguments.length>0?(r=r?r+"/base64":"base64",A=b.default.BufferUtils.base64Encode(A)):A=b.default.BufferUtils.toBuffer(A)),{id:this.id,clientId:this.clientId,action:w(this.action),data:A,encoding:r,extras:this.extras}},v.prototype.toString=function(){var A="[PresenceMessage";return A+="; action="+this.action,this.id&&(A+="; id="+this.id),this.timestamp&&(A+="; timestamp="+this.timestamp),this.clientId&&(A+="; clientId="+this.clientId),this.connectionId&&(A+="; connectionId="+this.connectionId),this.encoding&&(A+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?A+="; data="+this.data:b.default.BufferUtils.isBuffer(this.data)?A+="; data (buffer)="+b.default.BufferUtils.base64Encode(this.data):A+="; data (json)="+JSON.stringify(this.data)),this.extras&&(A+="; extras="+JSON.stringify(this.extras)),A+="]",A},v.fromResponseBody=function(A,r,h){var M=[];h&&(A=I.decodeBody(A,h));for(var O=0;O<A.length;O++){var p=M[O]=v.fromValues(A[O],!0);try{v.decode(p,r)}catch(c){e.default.logAction(e.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",c.toString())}}return M},v.fromValues=function(A,r){return r&&(A.action=v.Actions[A.action]),Object.assign(new v,A)},v.fromValuesArray=function(A){for(var r=A.length,h=new Array(r),M=0;M<r;M++)h[M]=v.fromValues(A[M]);return h},v.fromEncoded=function(A,r){var h=v.fromValues(A,!0);try{v.decode(h,r??{})}catch(M){e.default.logAction(e.default.LOG_ERROR,"PresenceMessage.fromEncoded()",M.toString())}return h},v.fromEncodedArray=function(A,r){return A.map(function(h){return v.fromEncoded(h,r)})},v.fromData=function(A){return A instanceof v?A:v.fromValues({data:A})},v.Actions=["absent","present","enter","leave","update"],v.encode=S.default.encode,v.decode=S.default.decode,v.getMessagesSize=S.default.getMessagesSize,v}();s.default=y},function(P,s,a){(function(f){Object.defineProperty(s,"__esModule",{value:!0});var e=a(0),b=e.__importStar(a(1)),S=e.__importDefault(a(7)),I=e.__importStar(a(4)),w=e.__importDefault(a(2)),y=e.__importDefault(a(8)),v=e.__importDefault(a(22)),A=e.__importDefault(a(3));function r(u,d){return b.arrIn(b.allToLowerCase(b.keysArray(d)),"x-ably-errorcode")}function h(u,d){if(r(u,d))return u.error&&I.default.fromValues(u.error)}var M=function(){},O=0,p={},c=typeof f<"u"&&f.XDomainRequest;function g(){var u=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return u&&Number(u[1])}function o(){var u;return c&&(u=g())&&u===10}function i(u,d){return u.getResponseHeader&&u.getResponseHeader(d)}function n(u){return u.getResponseHeader&&(u.getResponseHeader("transfer-encoding")||!u.getResponseHeader("content-length"))}function t(u){for(var d=b.trim(u.getAllResponseHeaders()).split(`\r
`),U={},L=0;L<d.length;L++){var D=d[L].split(":").map(b.trim);U[D[0].toLowerCase()]=D[1]}return U}var l=function(u){e.__extends(d,u);function d(U,L,D,E,T,R,j){var G=u.call(this)||this;return D=D||{},D.rnd=b.cheapRandStr(),o()&&!D.envelope&&(D.envelope="json"),G.uri=U+b.toQueryString(D),G.headers=L||{},G.body=E,G.method=j?j.toUpperCase():b.isEmptyArg(E)?"GET":"POST",G.requestMode=T,G.timeouts=R,G.timedOut=!1,G.requestComplete=!1,G.id=String(++O),p[G.id]=G,G}return d.createRequest=function(U,L,D,E,T,R,j){var G=R||y.default.TIMEOUTS;return new d(U,L,b.copy(D),E,T,G,j)},d.prototype.complete=function(U,L,D,E,T){this.requestComplete||(this.requestComplete=!0,!U&&L&&this.emit("data",L),this.emit("complete",U,L,D,E,T),this.dispose())},d.prototype.abort=function(){this.dispose()},d.prototype.exec=function(){var U=this,L=this.headers,D=this.requestMode==v.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,E=this.timer=setTimeout(function(){U.timedOut=!0,R.abort()},D),T=this.method,R=this.xhr=new XMLHttpRequest,j=L.accept,G=this.body,k="text";if(j?j.indexOf("application/x-msgpack")===0&&(k="arraybuffer"):L.accept="application/json",G){var J=L["content-type"]||(L["content-type"]="application/json");J.indexOf("application/json")>-1&&typeof G!="string"&&(G=JSON.stringify(G))}R.open(T,this.uri,!0),R.responseType=k,"authorization"in L&&(R.withCredentials=!0);for(var z in L)R.setRequestHeader(z,L[z]);var _=function($,it,st,ut){var at,gt=it+" (event type: "+$.type+")";!((at=U==null?void 0:U.xhr)===null||at===void 0)&&at.statusText&&(gt+=", current statusText is "+U.xhr.statusText),w.default.logAction(w.default.LOG_ERROR,"Request.on"+$.type+"()",gt),U.complete(new I.PartialErrorInfo(gt,st,ut))};R.onerror=function($){_($,"XHR error occurred",null,400)},R.onabort=function($){U.timedOut?_($,"Request aborted due to request timeout expiring",null,408):_($,"Request cancelled",null,400)},R.ontimeout=function($){_($,"Request timed out",null,408)};var C,N,B,H=0,W=!1,q=function(){if(clearTimeout(E),B=N<400,N==204){U.complete(null,null,null,null,N);return}C=U.requestMode==v.default.REQ_RECV_STREAM&&B&&n(R)},X=function(){var $;try{var it=i(R,"content-type"),st=it?it.indexOf("application/json")>=0:R.responseType=="text";if(st){var ut=R.responseType==="arraybuffer"?A.default.BufferUtils.utf8Decode(R.response):String(R.responseText);ut.length?$=JSON.parse(ut):$=ut,W=!0}else $=R.response;$.response!==void 0?(N=$.statusCode,B=N<400,L=$.headers,$=$.response):L=t(R)}catch(gt){U.complete(new I.PartialErrorInfo("Malformed response body from server: "+gt.message,null,400));return}if(B||b.isArray($)){U.complete(null,$,L,W,N);return}var at=h($,L);at||(at=new I.PartialErrorInfo("Error response received from server: "+N+" body was: "+A.default.Config.inspect($),null,N)),U.complete(at,$,L,W,N)};function Z(){for(var $=R.responseText,it=$.length-1,st,ut;H<it&&(st=$.indexOf(`
`,H))>-1;)ut=$.slice(H,st),H=st+1,tt(ut)}var tt=function($){try{$=JSON.parse($)}catch(it){U.complete(new I.PartialErrorInfo("Malformed response body from server: "+it.message,null,400));return}U.emit("data",$)},rt=function(){Z(),U.streamComplete=!0,A.default.Config.nextTick(function(){U.complete()})};R.onreadystatechange=function(){var $=R.readyState;$<3||R.status!==0&&(N===void 0&&(N=R.status,N===1223&&(N=204),q()),$==3&&C?Z():$==4&&(C?rt():X()))},R.send(G)},d.prototype.dispose=function(){var U=this.xhr;if(U){U.onreadystatechange=U.onerror=U.onabort=U.ontimeout=M,this.xhr=null;var L=this.timer;L&&(clearTimeout(L),this.timer=null),this.requestComplete||U.abort()}delete p[this.id]},d}(S.default);s.default=l}).call(this,a(13))},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importDefault(a(2)),b=f.__importStar(a(1)),S=f.__importDefault(a(24)),I=f.__importDefault(a(4)),w=f.__importDefault(a(45)),y=a(11),v=f.__importDefault(a(19)),A=f.__importDefault(a(14)),r=f.__importDefault(a(3)),h=f.__importDefault(a(15)),M=Math.pow(2,17);function O(){}function p(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function c(D){return!!D.connection}function g(D){return b.isErrorInfoOrPartialErrorInfo(D)?(D.code||(D.statusCode===403?D.code=40300:(D.code=40170,D.statusCode=401)),D):new I.default(b.inspectError(D),D.code||40170,D.statusCode||401)}var o=function(D,E){if(r.default.Config.createHmac){var T=r.default.Config.createHmac("SHA256",E);return T.update(D),T.digest("base64")}return(0,y.stringify)((0,w.default)(D,E))};function i(D){if(!D)return"";typeof D=="string"&&(D=JSON.parse(D));var E=Object.create(null),T=b.keysArray(D,!0);if(!T)return"";T.sort();for(var R=0;R<T.length;R++)E[T[R]]=D[T[R]].sort();return JSON.stringify(E)}function n(D){if(D.authCallback)e.default.logAction(e.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(D.authUrl)e.default.logAction(e.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(D.key)e.default.logAction(e.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(D.tokenDetails)e.default.logAction(e.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var E="authOptions must include valid authentication parameters";throw e.default.logAction(e.default.LOG_ERROR,"Auth()",E),new Error(E)}}function t(D){return"useTokenAuth"in D&&!D.useTokenAuth}function l(D){return D.useTokenAuth||!t(D)&&(D.authCallback||D.authUrl||D.token||D.tokenDetails)}function u(D){return!D.key&&!D.authCallback&&!D.authUrl}var d=0;function U(){return d++}var L=function(){function D(E,T){if(this.authOptions={},this.client=E,this.tokenParams=T.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,l(T)){if(T.key&&!o){var R="client-side token request signing not supported";throw e.default.logAction(e.default.LOG_ERROR,"Auth()",R),new Error(R)}u(T)&&e.default.logAction(e.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(T.defaultTokenParams,T),n(this.authOptions)}else{if(!T.key){var R="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw e.default.logAction(e.default.LOG_ERROR,"Auth()",R),new I.default(R,40160,401)}e.default.logAction(e.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(T)}}return D.prototype.authorize=function(E,T,R){var j=this,G;if(typeof E=="function"&&!R?(R=E,G=E=null):typeof T=="function"&&!R?(R=T,G=null):G=T,!R&&this.client.options.promises)return b.promisify(this,"authorize",arguments);if(G&&G.key&&this.authOptions.key!==G.key)throw new I.default("Unable to update auth options with incompatible key",40102,401);G&&"force"in G&&(e.default.deprecated("The `force` auth option","If youâ€™re using this option to force `authorize()` to fetch a new token even if the current token has not expired, this is no longer necessary, as `authorize()` now always fetches a new token. Update your code to no longer pass the `force` auth option. Note that, in general, passing an auth options argument to `authorize()` will overwrite the libraryâ€™s stored auth options, which may not be what you want. The library currently contains a special case behavior where passing an auth options object which only contains `{ force: true }` will _not_ overwrite the stored options. This special case behavior will be removed alongside support for the `force` option, so if youâ€™re currently passing `authorize()` an auth options object which only contains `{ force: true }`, you should stop passing it an auth options object entirely."),b.isOnlyPropIn(G,"force")&&(G=null)),this._forceNewToken(E,G,function(k,J){if(k){j.client.connection&&k.statusCode===A.default.Forbidden&&j.client.connection.connectionManager.actOnErrorFromAuthorize(k),R==null||R(k);return}c(j.client)?j.client.connection.connectionManager.onAuthUpdated(J,R||O):R==null||R(null,J)})},D.prototype.authorise=function(E,T,R){e.default.renamedMethod("Auth","authorise","authorize"),this.authorize(E,T,R)},D.prototype._forceNewToken=function(E,T,R){var j=this;this.tokenDetails=null,this._saveTokenOptions(E,T),n(this.authOptions),this._ensureValidAuthCredentials(!0,function(G,k){delete j.tokenParams.timestamp,delete j.authOptions.queryTime,R(G,k)})},D.prototype.requestToken=function(E,T,R){var j=this;if(typeof E=="function"&&!R?(R=E,T=E=null):typeof T=="function"&&!R&&(R=T,T=null),!R&&this.client.options.promises)return b.promisify(this,"requestToken",arguments);T=T||this.authOptions,E=E||b.copy(this.tokenParams);var G=R||O,k,J=this.client;if(T.authCallback)e.default.logAction(e.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),k=T.authCallback;else if(T.authUrl)e.default.logAction(e.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),k=function(H,W){var q=b.mixin({accept:"application/json, text/plain"},T.authHeaders),X=T.authMethod&&T.authMethod.toLowerCase()==="post",Z,tt=T.authUrl.indexOf("?");tt>-1&&(Z=b.parseQueryString(T.authUrl.slice(tt)),T.authUrl=T.authUrl.slice(0,tt),X||(T.authParams=b.mixin(Z,T.authParams)));var rt=b.mixin({},T.authParams||{},H),$=function(ut,at,gt,bt){var dt;if(ut?e.default.logAction(e.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+b.inspectError(ut)):(dt=gt["content-type"],e.default.logAction(e.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+dt+"; body: "+b.inspectBody(at))),ut||bt)return W(ut,at);if(r.default.BufferUtils.isBuffer(at)&&(at=at.toString()),!dt){W(new I.default("authUrl response is missing a content-type header",40170,401));return}var It=dt.indexOf("application/json")>-1,Ut=dt.indexOf("text/plain")>-1||dt.indexOf("application/jwt")>-1;if(!It&&!Ut){W(new I.default("authUrl responded with unacceptable content-type "+dt+", should be either text/plain, application/jwt or application/json",40170,401));return}if(It){if(at.length>M){W(new I.default("authUrl response exceeded max permitted length",40170,401));return}try{at=JSON.parse(at)}catch(Nt){W(new I.default("Unexpected error processing authURL response; err = "+Nt.message,40170,401));return}}W(null,at,dt)};if(e.default.logAction(e.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+T.authUrl+"; Params: "+JSON.stringify(rt)+"; method: "+(X?"POST":"GET")),X){var it=q||{};it["content-type"]="application/x-www-form-urlencoded";var st=b.toQueryString(rt).slice(1);j.client.http.doUri(v.default.Post,J,T.authUrl,it,st,Z,$)}else j.client.http.doUri(v.default.Get,J,T.authUrl,q||{},null,rt,$)};else if(T.key)e.default.logAction(e.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),k=function(H,W){j.createTokenRequest(H,T,W)};else{var z="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";e.default.logAction(e.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),G(new I.default(z,40171,403));return}"capability"in E&&(E.capability=i(E.capability));var _=function(H,W){var q=H.keyName,X="/keys/"+q+"/requestToken",Z=function(rt){return J.baseUri(rt)+X},tt=b.defaultPostHeaders(j.client.options);T.requestHeaders&&b.mixin(tt,T.requestHeaders),e.default.logAction(e.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+X+"; Token params: "+JSON.stringify(H)),j.client.http.do(v.default.Post,J,Z,tt,JSON.stringify(H),null,W)},C=!1,N=this.client.options.timeouts.realtimeRequestTimeout,B=setTimeout(function(){C=!0;var H="Token request callback timed out after "+N/1e3+" seconds";e.default.logAction(e.default.LOG_ERROR,"Auth.requestToken()",H),G(new I.default(H,40170,401))},N);k(E,function(H,W,q){if(!C){if(clearTimeout(B),H){e.default.logAction(e.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+b.inspectError(H)),G(g(H));return}if(typeof W=="string"){W.length===0?G(new I.default("Token string is empty",40170,401)):W.length>M?G(new I.default("Token string exceeded max permitted length (was "+W.length+" bytes)",40170,401)):W==="undefined"||W==="null"?G(new I.default("Token string was literal null/undefined",40170,401)):W[0]==="{"&&!(q&&q.indexOf("application/jwt")>-1)?G(new I.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):G(null,{token:W});return}if(typeof W!="object"){var X="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof W;e.default.logAction(e.default.LOG_ERROR,"Auth.requestToken()",X),G(new I.default(X,40170,401));return}var Z=JSON.stringify(W).length;if(Z>M&&!T.suppressMaxLengthCheck){G(new I.default("Token request/details object exceeded max permitted stringified size (was "+Z+" bytes)",40170,401));return}if("issued"in W){G(null,W);return}if(!("keyName"in W)){var X="Expected token request callback to call back with a token string, token request object, or token details object";e.default.logAction(e.default.LOG_ERROR,"Auth.requestToken()",X),G(new I.default(X,40170,401));return}_(W,function(tt,rt,$,it){if(tt){e.default.logAction(e.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+b.inspectError(tt)),G(g(tt));return}it||(rt=JSON.parse(rt)),e.default.logAction(e.default.LOG_MINOR,"Auth.getToken()","token received"),G(null,rt)})}})},D.prototype.createTokenRequest=function(E,T,R){var j=this;if(typeof E=="function"&&!R?(R=E,T=E=null):typeof T=="function"&&!R&&(R=T,T=null),!R&&this.client.options.promises)return b.promisify(this,"createTokenRequest",arguments);T=T||this.authOptions,E=E||b.copy(this.tokenParams);var G=T.key;if(!G){R(new I.default("No key specified",40101,403));return}var k=G.split(":"),J=k[0],z=k[1];if(!z){R(new I.default("Invalid key specified",40101,403));return}if(E.clientId===""){R(new I.default("clientId canâ€™t be an empty string",40012,400));return}"capability"in E&&(E.capability=i(E.capability));var _=b.mixin({keyName:J},E),C=E.clientId||"",N=E.ttl||"",B=E.capability||"";(function(H){if(_.timestamp){H();return}j.getTimestamp(T&&T.queryTime,function(W,q){if(W){R(W);return}_.timestamp=q,H()})})(function(){var H=_.nonce||(_.nonce=p()),W=_.timestamp,q=_.keyName+`
`+N+`
`+B+`
`+C+`
`+W+`
`+H+`
`;_.mac=_.mac||o(q,z),e.default.logAction(e.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),R(null,_)})},D.prototype.getAuthParams=function(E){this.method=="basic"?E(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(T,R){if(T){E(T);return}if(!R)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");E(null,{access_token:R.token})})},D.prototype.getAuthHeaders=function(E){this.method=="basic"?E(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(T,R){if(T){E(T);return}if(!R)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");E(null,{authorization:"Bearer "+b.toBase64(R.token)})})},D.prototype.getTimestamp=function(E,T){!this.isTimeOffsetSet()&&(E||this.authOptions.queryTime)?this.client.time(T):T(null,this.getTimestampUsingOffset())},D.prototype.getTimestampUsingOffset=function(){return b.now()+(this.client.serverTimeOffset||0)},D.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},D.prototype._saveBasicOptions=function(E){this.method="basic",this.key=E.key,this.basicKey=b.toBase64(E.key),this.authOptions=E||{},"clientId"in E&&this._userSetClientId(E.clientId)},D.prototype._saveTokenOptions=function(E,T){this.method="token",E&&(this.tokenParams=E),T&&(T.token&&(T.tokenDetails=typeof T.token=="string"?{token:T.token}:T.token),T.tokenDetails&&(this.tokenDetails=T.tokenDetails),"clientId"in T&&this._userSetClientId(T.clientId),this.authOptions=T)},D.prototype._ensureValidAuthCredentials=function(E,T){var R=this,j=this.tokenDetails;if(j){if(this._tokenClientIdMismatch(j.clientId)){T(new I.default("Mismatch between clientId in token ("+j.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!j.expires||j.expires>=this.getTimestampUsingOffset()){e.default.logAction(e.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+j.expires),T(null,j);return}e.default.logAction(e.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=S.default.create())).push(T),!(this.currentTokenRequestId!==null&&!E)){var G=this.currentTokenRequestId=U();this.requestToken(this.tokenParams,this.authOptions,function(k,J){if(R.currentTokenRequestId>G){e.default.logAction(e.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}R.currentTokenRequestId=null;var z=R.waitingForTokenRequest||O;if(R.waitingForTokenRequest=null,k){z(k);return}z(null,R.tokenDetails=J)})}},D.prototype._userSetClientId=function(E){if(typeof E=="string"||E===null){if(E==="*")throw new I.default('Canâ€™t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var T=this._uncheckedSetClientId(E);if(T)throw T}else throw new I.default("clientId must be either a string or null",40012,400)},D.prototype._uncheckedSetClientId=function(E){if(this._tokenClientIdMismatch(E)){var T="Unexpected clientId mismatch: client has "+this.clientId+", requested "+E,R=new I.default(T,40102,401);return e.default.logAction(e.default.LOG_ERROR,"Auth._uncheckedSetClientId()",T),R}else return this.clientId=this.tokenParams.clientId=E,null},D.prototype._tokenClientIdMismatch=function(E){return!!(this.clientId&&this.clientId!=="*"&&E&&E!=="*"&&this.clientId!==E)},D.isTokenErr=function(E){return E.code&&E.code>=40140&&E.code<40150},D.prototype.revokeTokens=function(E,T,R){if(l(this.client.options))throw new I.default("Cannot revoke tokens when using token auth",40162,401);var j=this.client.options.keyName,G;if(typeof T=="function"?(R=T,G={}):G=T??{},R===void 0){if(this.client.options.promises)return b.promisify(this,"revokeTokens",[E,G]);R=O}var k=R,J=f.__assign({targets:E.map(function(N){return"".concat(N.type,":").concat(N.value)})},G),z=this.client.options.useBinaryProtocol?b.Format.msgpack:b.Format.json,_=b.defaultPostHeaders(this.client.options,z);this.client.options.headers&&b.mixin(_,this.client.options.headers);var C=b.encodeBody(J,z);h.default.post(this.client,"/keys/".concat(j,"/revokeTokens"),C,_,{newBatchResponse:"true"},null,function(N,B,H,W){if(N){k(N);return}var q=W?B:b.decodeBody(B,z);k(null,q)})},D}();s.default=L},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f;(function(e){e.Get="get",e.Delete="delete",e.Post="post",e.Put="put",e.Patch="patch"})(f||(f={})),s.default=f},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0}),s.HttpPaginatedResponse=s.PaginatedResult=void 0;var f=a(0),e=f.__importStar(a(1)),b=f.__importDefault(a(2)),S=f.__importDefault(a(15)),I=f.__importDefault(a(14));function w(M){var O=M.match(/^\.\/(\w+)\?(.*)$/);return O&&O[2]&&e.parseQueryString(O[2])}function y(M){typeof M=="string"&&(M=M.split(","));for(var O={},p=0;p<M.length;p++){var c=M[p].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(c){var g=w(c[1]);g&&(O[c[2]]=g)}}return O}function v(M,O,p){return!(p&&(O||typeof M.code=="number"))}var A=function(){function M(O,p,c,g,o,i){this.rest=O,this.path=p,this.headers=c,this.envelope=g??null,this.bodyHandler=o,this.useHttpPaginatedResponse=i||!1}return M.prototype.get=function(O,p){var c=this;S.default.get(this.rest,this.path,this.headers,O,this.envelope,function(g,o,i,n,t){c.handlePage(g,o,i,n,t,p)})},M.prototype.delete=function(O,p){var c=this;S.default.delete(this.rest,this.path,this.headers,O,this.envelope,function(g,o,i,n,t){c.handlePage(g,o,i,n,t,p)})},M.prototype.post=function(O,p,c){var g=this;S.default.post(this.rest,this.path,p,this.headers,O,this.envelope,function(o,i,n,t,l){c&&g.handlePage(o,i,n,t,l,c)})},M.prototype.put=function(O,p,c){var g=this;S.default.put(this.rest,this.path,p,this.headers,O,this.envelope,function(o,i,n,t,l){c&&g.handlePage(o,i,n,t,l,c)})},M.prototype.patch=function(O,p,c){var g=this;S.default.patch(this.rest,this.path,p,this.headers,O,this.envelope,function(o,i,n,t,l){c&&g.handlePage(o,i,n,t,l,c)})},M.prototype.handlePage=function(O,p,c,g,o,i){if(O&&v(O,p,this.useHttpPaginatedResponse)){b.default.logAction(b.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+e.inspectError(O)),i==null||i(O);return}var n,t,l;try{n=o==I.default.NoContent?[]:this.bodyHandler(p,c||{},g)}catch(u){i==null||i(O||u);return}c&&(t=c.Link||c.link)&&(l=y(t)),this.useHttpPaginatedResponse?i(null,new h(this,n,c||{},o,l,O)):i(null,new r(this,n,l))},M}(),r=function(){function M(O,p,c){var g=this;this.resource=O,this.items=p;var o=this;c&&("first"in c&&(this.first=function(i){if(!i&&o.resource.rest.options.promises)return e.promisify(o,"first",[]);o.get(c.first,i)}),"current"in c&&(this.current=function(i){if(!i&&o.resource.rest.options.promises)return e.promisify(o,"current",[]);o.get(c.current,i)}),this.next=function(i){if(!i&&o.resource.rest.options.promises)return e.promisify(o,"next",[]);"next"in c?o.get(c.next,i):i(null,null)},this.hasNext=function(){return"next"in c},this.isLast=function(){var i;return!(!((i=g.hasNext)===null||i===void 0)&&i.call(g))})}return M.prototype.get=function(O,p){var c=this.resource;S.default.get(c.rest,c.path,c.headers,O,c.envelope,function(g,o,i,n,t){c.handlePage(g,o,i,n,t,p)})},M}();s.PaginatedResult=r;var h=function(M){f.__extends(O,M);function O(p,c,g,o,i,n){var t=M.call(this,p,c,i)||this;return t.statusCode=o,t.success=o<300&&o>=200,t.headers=g,t.errorCode=n&&n.code,t.errorMessage=n&&n.message,t}return O.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},O}(r);s.HttpPaginatedResponse=h,s.default=A},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0}),s.isRetriable=void 0;var f=a(0),e=f.__importDefault(a(4)),b={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},S={disconnected:function(){return e.default.fromValues({statusCode:400,code:b.DISCONNECTED,message:"Connection to server temporarily unavailable"})},suspended:function(){return e.default.fromValues({statusCode:400,code:b.SUSPENDED,message:"Connection to server unavailable"})},failed:function(){return e.default.fromValues({statusCode:400,code:b.FAILED,message:"Connection failed or disconnected by server"})},closing:function(){return e.default.fromValues({statusCode:400,code:b.CLOSING,message:"Connection closing"})},closed:function(){return e.default.fromValues({statusCode:400,code:b.CLOSED,message:"Connection closed"})},unknownConnectionErr:function(){return e.default.fromValues({statusCode:500,code:b.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"})},unknownChannelErr:function(){return e.default.fromValues({statusCode:500,code:b.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})}};function I(w){return!w.statusCode||!w.code||w.statusCode>=500?!0:Object.values(b).includes(w.code)}s.isRetriable=I,s.default=S},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f;(function(e){e[e.REQ_SEND=0]="REQ_SEND",e[e.REQ_RECV=1]="REQ_RECV",e[e.REQ_RECV_POLL=2]="REQ_RECV_POLL",e[e.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(f||(f={})),s.default=f},function(P,s,a){(function(f,e){P.exports=e(a(6),a(5),a(58),a(11),a(40),a(32),a(25),a(27),a(28),a(59),a(60))})(this,function(f){return f})},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importDefault(a(2)),b=function(){function S(I){this.members=I||[]}return S.prototype.call=function(){for(var I=[],w=0;w<arguments.length;w++)I[w]=arguments[w];for(var y=0,v=this.members;y<v.length;y++){var A=v[y];if(A)try{A.apply(void 0,I)}catch(r){e.default.logAction(e.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+r+"; stack = "+r.stack)}}},S.prototype.push=function(){for(var I,w=[],y=0;y<arguments.length;y++)w[y]=arguments[y];(I=this.members).push.apply(I,w)},S.create=function(I){var w=new S(I);return Object.assign(function(){for(var y=[],v=0;v<arguments.length;v++)y[v]=arguments[v];return w.call.apply(w,y)},{push:function(y){return w.push(y)}})},S}();s.default=b},function(P,s,a){(function(f,e){P.exports=e(a(6))})(this,function(f){(function(){var e=f,b=e.lib,S=b.Base,I=e.enc,w=I.Utf8,y=e.algo;y.HMAC=S.extend({init:function(v,A){v=this._hasher=new v.init,typeof A=="string"&&(A=w.parse(A));var r=v.blockSize,h=r*4;A.sigBytes>h&&(A=v.finalize(A)),A.clamp();for(var M=this._oKey=A.clone(),O=this._iKey=A.clone(),p=M.words,c=O.words,g=0;g<r;g++)p[g]^=1549556828,c[g]^=909522486;M.sigBytes=O.sigBytes=h,this.reset()},reset:function(){var v=this._hasher;v.reset(),v.update(this._iKey)},update:function(v){return this._hasher.update(v),this},finalize:function(v){var A=this._hasher,r=A.finalize(v);A.reset();var h=A.finalize(this._oKey.clone().concat(r));return h}})})()})},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importDefault(a(10)),b=f.__importStar(a(1)),S=f.__importDefault(a(7)),I=f.__importDefault(a(2)),w=f.__importDefault(a(21)),y=f.__importDefault(a(4)),v=f.__importDefault(a(3)),A=e.default.Action,r=e.default.fromValues({action:A.CLOSE}),h=e.default.fromValues({action:A.DISCONNECT}),M=function(O){f.__extends(p,O);function p(c,g,o,i){var n=O.call(this)||this;return i&&(o.format=void 0,o.heartbeats=!0),n.connectionManager=c,c.registerProposedTransport(n),n.auth=g,n.params=o,n.timeouts=o.options.timeouts,n.format=o.format,n.isConnected=!1,n.isFinished=!1,n.isDisposed=!1,n.maxIdleInterval=null,n.idleTimer=null,n.lastActivity=null,n}return p.prototype.connect=function(){},p.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",w.default.closed())},p.prototype.disconnect=function(c){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",c||w.default.disconnected())},p.prototype.fail=function(c){this.isConnected&&this.requestDisconnect(),this.finish("failed",c||w.default.failed())},p.prototype.finish=function(c,g){var o;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((o=this.idleTimer)!==null&&o!==void 0?o:void 0),this.idleTimer=null,this.emit(c,g),this.dispose())},p.prototype.onProtocolMessage=function(c){switch(I.default.shouldLog(I.default.LOG_MICRO)&&I.default.logAction(I.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+e.default.stringify(c)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),c.action){case A.HEARTBEAT:I.default.logAction(I.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",c.id);break;case A.CONNECTED:this.onConnect(c),this.emit("connected",c.error,c.connectionId,c.connectionDetails,c);break;case A.CLOSED:this.onClose(c);break;case A.DISCONNECTED:this.onDisconnect(c);break;case A.ACK:this.emit("ack",c.msgSerial,c.count);break;case A.NACK:this.emit("nack",c.msgSerial,c.count,c.error);break;case A.SYNC:this.connectionManager.onChannelMessage(c,this);break;case A.ACTIVATE:break;case A.AUTH:this.auth.authorize(function(g){g&&I.default.logAction(I.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+b.inspectError(g))});break;case A.ERROR:if(I.default.logAction(I.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+v.default.Config.inspect(c.error)+(c.channel?", channel: "+c.channel:"")),c.channel===void 0){this.onFatalError(c);break}this.connectionManager.onChannelMessage(c,this);break;default:this.connectionManager.onChannelMessage(c,this)}},p.prototype.onConnect=function(c){if(this.isConnected=!0,!c.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var g=c.connectionDetails.maxIdleInterval;g&&(this.maxIdleInterval=g+this.timeouts.realtimeRequestTimeout,this.onActivity())},p.prototype.onDisconnect=function(c){var g=c&&c.error;I.default.logAction(I.default.LOG_MINOR,"Transport.onDisconnect()","err = "+b.inspectError(g)),this.finish("disconnected",g)},p.prototype.onFatalError=function(c){var g=c&&c.error;I.default.logAction(I.default.LOG_MINOR,"Transport.onFatalError()","err = "+b.inspectError(g)),this.finish("failed",g)},p.prototype.onClose=function(c){var g=c&&c.error;I.default.logAction(I.default.LOG_MINOR,"Transport.onClose()","err = "+b.inspectError(g)),this.finish("closed",g)},p.prototype.requestClose=function(){I.default.logAction(I.default.LOG_MINOR,"Transport.requestClose()",""),this.send(r)},p.prototype.requestDisconnect=function(){I.default.logAction(I.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(h)},p.prototype.ping=function(c){var g={action:e.default.Action.HEARTBEAT};c&&(g.id=c),this.send(e.default.fromValues(g))},p.prototype.dispose=function(){I.default.logAction(I.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},p.prototype.onActivity=function(){this.maxIdleInterval&&(this.lastActivity=this.connectionManager.lastActivity=b.now(),this.setIdleTimer(this.maxIdleInterval+100))},p.prototype.setIdleTimer=function(c){var g=this;this.idleTimer||(this.idleTimer=setTimeout(function(){g.onIdleTimerExpire()},c))},p.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var c=b.now()-this.lastActivity,g=this.maxIdleInterval-c;if(g<=0){var o="No activity seen from realtime in "+c+"ms; assuming connection has dropped";I.default.logAction(I.default.LOG_ERROR,"Transport.onIdleTimerExpire()",o),this.disconnect(new y.default(o,80003,408))}else this.setIdleTimer(g+100)},p.tryConnect=function(c,g,o,i,n){var t=new c(g,o,i),l,u=function(U){clearTimeout(l),n({event:this.event,error:U})},d=g.options.timeouts.realtimeRequestTimeout;l=setTimeout(function(){t.off(["preconnect","disconnected","failed"]),t.dispose(),u.call({event:"disconnected"},new y.default("Timeout waiting for transport to indicate itself viable",5e4,500))},d),t.on(["failed","disconnected"],u),t.on("preconnect",function(){I.default.logAction(I.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+t),clearTimeout(l),t.off(["failed","disconnected"],u),n(null,t)}),t.connect()},p}(S.default);s.default=M},function(P,s,a){(function(f,e){P.exports=e(a(6),a(40),a(25))})(this,function(f){return function(){var e=f,b=e.lib,S=b.Base,I=b.WordArray,w=e.algo,y=w.MD5,v=w.EvpKDF=S.extend({cfg:S.extend({keySize:128/32,hasher:y,iterations:1}),init:function(A){this.cfg=this.cfg.extend(A)},compute:function(A,r){for(var h,M=this.cfg,O=M.hasher.create(),p=I.create(),c=p.words,g=M.keySize,o=M.iterations;c.length<g;){h&&O.update(h),h=O.update(A).finalize(r),O.reset();for(var i=1;i<o;i++)h=O.finalize(h),O.reset();p.concat(h)}return p.sigBytes=g*4,p}});e.EvpKDF=function(A,r,h){return v.create(h).compute(A,r)}}(),f.EvpKDF})},function(P,s,a){(function(f,e){P.exports=e(a(6),a(27))})(this,function(f){f.lib.Cipher||function(e){var b=f,S=b.lib,I=S.Base,w=S.WordArray,y=S.BufferedBlockAlgorithm,v=b.enc;v.Utf8;var A=v.Base64,r=b.algo,h=r.EvpKDF,M=S.Cipher=y.extend({cfg:I.extend(),createEncryptor:function(L,D){return this.create(this._ENC_XFORM_MODE,L,D)},createDecryptor:function(L,D){return this.create(this._DEC_XFORM_MODE,L,D)},init:function(L,D,E){this.cfg=this.cfg.extend(E),this._xformMode=L,this._key=D,this.reset()},reset:function(){y.reset.call(this),this._doReset()},process:function(L){return this._append(L),this._process()},finalize:function(L){L&&this._append(L);var D=this._doFinalize();return D},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function L(D){return typeof D=="string"?U:l}return function(D){return{encrypt:function(E,T,R){return L(T).encrypt(D,E,T,R)},decrypt:function(E,T,R){return L(T).decrypt(D,E,T,R)}}}}()});S.StreamCipher=M.extend({_doFinalize:function(){var L=this._process(!0);return L},blockSize:1});var O=b.mode={},p=S.BlockCipherMode=I.extend({createEncryptor:function(L,D){return this.Encryptor.create(L,D)},createDecryptor:function(L,D){return this.Decryptor.create(L,D)},init:function(L,D){this._cipher=L,this._iv=D}}),c=O.CBC=function(){var L=p.extend();L.Encryptor=L.extend({processBlock:function(E,T){var R=this._cipher,j=R.blockSize;D.call(this,E,T,j),R.encryptBlock(E,T),this._prevBlock=E.slice(T,T+j)}}),L.Decryptor=L.extend({processBlock:function(E,T){var R=this._cipher,j=R.blockSize,G=E.slice(T,T+j);R.decryptBlock(E,T),D.call(this,E,T,j),this._prevBlock=G}});function D(E,T,R){var j,G=this._iv;G?(j=G,this._iv=e):j=this._prevBlock;for(var k=0;k<R;k++)E[T+k]^=j[k]}return L}(),g=b.pad={},o=g.Pkcs7={pad:function(L,D){for(var E=D*4,T=E-L.sigBytes%E,R=T<<24|T<<16|T<<8|T,j=[],G=0;G<T;G+=4)j.push(R);var k=w.create(j,T);L.concat(k)},unpad:function(L){var D=L.words[L.sigBytes-1>>>2]&255;L.sigBytes-=D}};S.BlockCipher=M.extend({cfg:M.cfg.extend({mode:c,padding:o}),reset:function(){var L;M.reset.call(this);var D=this.cfg,E=D.iv,T=D.mode;this._xformMode==this._ENC_XFORM_MODE?L=T.createEncryptor:(L=T.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==L?this._mode.init(this,E&&E.words):(this._mode=L.call(T,this,E&&E.words),this._mode.__creator=L)},_doProcessBlock:function(L,D){this._mode.processBlock(L,D)},_doFinalize:function(){var L,D=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(D.pad(this._data,this.blockSize),L=this._process(!0)):(L=this._process(!0),D.unpad(L)),L},blockSize:128/32});var i=S.CipherParams=I.extend({init:function(L){this.mixIn(L)},toString:function(L){return(L||this.formatter).stringify(this)}}),n=b.format={},t=n.OpenSSL={stringify:function(L){var D,E=L.ciphertext,T=L.salt;return T?D=w.create([1398893684,1701076831]).concat(T).concat(E):D=E,D.toString(A)},parse:function(L){var D,E=A.parse(L),T=E.words;return T[0]==1398893684&&T[1]==1701076831&&(D=w.create(T.slice(2,4)),T.splice(0,4),E.sigBytes-=16),i.create({ciphertext:E,salt:D})}},l=S.SerializableCipher=I.extend({cfg:I.extend({format:t}),encrypt:function(L,D,E,T){T=this.cfg.extend(T);var R=L.createEncryptor(E,T),j=R.finalize(D),G=R.cfg;return i.create({ciphertext:j,key:E,iv:G.iv,algorithm:L,mode:G.mode,padding:G.padding,blockSize:L.blockSize,formatter:T.format})},decrypt:function(L,D,E,T){T=this.cfg.extend(T),D=this._parse(D,T.format);var R=L.createDecryptor(E,T).finalize(D.ciphertext);return R},_parse:function(L,D){return typeof L=="string"?D.parse(L,this):L}}),u=b.kdf={},d=u.OpenSSL={execute:function(L,D,E,T){T||(T=w.random(64/8));var R=h.create({keySize:D+E}).compute(L,T),j=w.create(R.words.slice(D),E*4);return R.sigBytes=D*4,i.create({key:R,iv:j,salt:T})}},U=S.PasswordBasedCipher=l.extend({cfg:l.cfg.extend({kdf:d}),encrypt:function(L,D,E,T){T=this.cfg.extend(T);var R=T.kdf.execute(E,L.keySize,L.ivSize);T.iv=R.iv;var j=l.encrypt.call(this,L,D,R.key,T);return j.mixIn(R),j},decrypt:function(L,D,E,T){T=this.cfg.extend(T),D=this._parse(D,T.format);var R=T.kdf.execute(E,L.keySize,L.ivSize,D.salt);T.iv=R.iv;var j=l.decrypt.call(this,L,D,R.key,T);return j}})}()})},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0}),s.Request=s.createRequest=void 0;var f=a(0),e=f.__importStar(a(1)),b=f.__importDefault(a(12)),S=f.__importDefault(a(3)),I=f.__importDefault(a(7)),w=a(4),y=f.__importDefault(a(8)),v=f.__importDefault(a(2)),A=f.__importDefault(a(22)),r=e.getGlobalObject(),h=function(){},M=r._ablyjs_jsonp={};M._=function(n){return M["_"+n]||h};var O=1,p="jsonp";function c(n,t,l,u,d,U,L){return U=U||y.default.TIMEOUTS,new o(void 0,n,t,e.copy(l),u,d,U,L)}s.createRequest=c;var g=function(n){f.__extends(t,n);function t(l,u,d){var U=n.call(this,l,u,d)||this;return U.shortName=p,d.stream=!1,U}return t.isAvailable=function(){return S.default.Config.jsonpSupported&&S.default.Config.allowComet},t.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},t.prototype.createRequest=function(l,u,d,U,L,D,E){return D=(this===null||this===void 0?void 0:this.timeouts)||D||y.default.TIMEOUTS,c(l,u,d,U,L,D,E)},t}(b.default),o=function(n){f.__extends(t,n);function t(l,u,d,U,L,D,E,T){var R=n.call(this)||this;return l===void 0&&(l=O++),R.id=l,R.uri=u,R.params=U||{},R.params.rnd=e.cheapRandStr(),d&&(d["X-Ably-Version"]&&(R.params.v=d["X-Ably-Version"]),d["X-Ably-Lib"]&&(R.params.lib=d["X-Ably-Lib"])),R.body=L,R.method=T,R.requestMode=D,R.timeouts=E,R.requestComplete=!1,R}return t.prototype.exec=function(){var l=this,u=this.id,d=this.body,U=this.method,L=this.uri,D=this.params;D.callback="_ablyjs_jsonp._("+u+")",D.envelope="jsonp",d&&(D.body=d),U&&U!=="get"&&(D.method=U);var E=this.script=document.createElement("script"),T=L+e.toQueryString(D);E.src=T,E.src.split("/").slice(-1)[0]!==T.split("/").slice(-1)[0]&&v.default.logAction(v.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),E.async=!0,E.type="text/javascript",E.charset="UTF-8",E.onerror=function(G){l.complete(new w.PartialErrorInfo("JSONP script error (event: "+S.default.Config.inspect(G)+")",null,400))},M["_"+u]=function(G){if(G.statusCode){var k=G.response;if(G.statusCode==204)l.complete(null,null,null,G.statusCode);else if(!k)l.complete(new w.PartialErrorInfo("Invalid server response: no envelope detected",null,500));else if(G.statusCode<400||e.isArray(k))l.complete(null,k,G.headers,G.statusCode);else{var J=k.error||new w.PartialErrorInfo("Error response received from server",null,G.statusCode);l.complete(J)}}else l.complete(null,G)};var R=this.requestMode==A.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),R);var j=document.getElementsByTagName("head")[0];j.insertBefore(E,j.firstChild)},t.prototype.complete=function(l,u,d,U){if(d=d||{},!this.requestComplete){this.requestComplete=!0;var L=void 0;u&&(L=typeof u=="string"?"text/plain":"application/json",d["content-type"]=L,this.emit("data",u)),this.emit("complete",l,u,d,!0,U),this.dispose()}},t.prototype.abort=function(){this.dispose()},t.prototype.dispose=function(){var l=this.timer;l&&(clearTimeout(l),this.timer=null);var u=this.script;u.parentNode&&u.parentNode.removeChild(u),delete M[this.id],this.emit("disposed")},t}(I.default);s.Request=o;function i(n){return r.JSONPTransport=g,g.isAvailable()&&(n.supportedTransports[p]=g),g}s.default=i},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importStar(a(1)),b=f.__importDefault(a(2)),S=f.__importDefault(a(8)),I=f.__importDefault(a(18)),w=f.__importDefault(a(46)),y=f.__importDefault(a(20)),v=f.__importDefault(a(33)),A=f.__importDefault(a(4)),r=f.__importDefault(a(49)),h=f.__importDefault(a(19)),M=f.__importDefault(a(3)),O=f.__importDefault(a(9)),p=f.__importDefault(a(16)),c=f.__importDefault(a(15)),g=function(){},o=function(){function n(t){if(!t){var l="no options provided";throw b.default.logAction(b.default.LOG_ERROR,"Rest()",l),new Error(l)}var u=S.default.objectifyOptions(t);u.log?(b.default.setLog(u.log.level,u.log.handler),b.default.deprecated("The `log` client option","Equivalent functionality is provided by the `logLevel` and `logHandler` client options. Update your client options code of the form `{ log: { level: logLevel, handler: logHandler } }` to instead be `{ logLevel, logHandler }`.")):b.default.setLog(u.logLevel,u.logHandler),b.default.logAction(b.default.LOG_MICRO,"Rest()","initialized with clientOptions "+M.default.Config.inspect(t));var d=this.options=S.default.normaliseOptions(u);if(d.key){var U=d.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!U){var l="invalid key parameter";throw b.default.logAction(b.default.LOG_ERROR,"Rest()",l),new A.default(l,40400,404)}d.keyName=U[1],d.keySecret=U[2]}if("clientId"in d)if(typeof d.clientId=="string"||d.clientId===null){if(d.clientId==="*")throw new A.default('Canâ€™t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new A.default("clientId must be either a string or null",40012,400);b.default.logAction(b.default.LOG_MINOR,"Rest()","started; version = "+S.default.version),this.baseUri=this.authority=function(L){return S.default.getHttpScheme(d)+L+":"+S.default.getPort(d,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new M.default.Http(d),this.auth=new I.default(this,d),this.channels=new i(this),this.push=new w.default(this)}return n.prototype.stats=function(t,l){if(l===void 0)if(typeof t=="function")l=t,t=null;else{if(this.options.promises)return e.promisify(this,"stats",[t]);l=g}var u=e.defaultGetHeaders(this.options),d=this.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,U=this.http.supportsLinkHeaders?void 0:d;this.options.headers&&e.mixin(u,this.options.headers),new y.default(this,"/stats",u,U,function(L,D,E){for(var T=E?L:JSON.parse(L),R=0;R<T.length;R++)T[R]=r.default.fromValues(T[R]);return T}).get(t,l)},n.prototype.time=function(t,l){var u=this;if(l===void 0){if(typeof t=="function")l=t,t=null;else if(this.options.promises)return e.promisify(this,"time",[t])}var d=l||g,U=e.defaultGetHeaders(this.options);this.options.headers&&e.mixin(U,this.options.headers);var L=function(D){return u.authority(D)+"/time"};this.http.do(h.default.Get,this,L,U,null,t,function(D,E,T,R){if(D){d(D);return}R||(E=JSON.parse(E));var j=E[0];if(!j){d(new A.default("Internal error (unexpected result type from GET /time)",5e4,500));return}u.serverTimeOffset=j-e.now(),d(null,j)})},n.prototype.request=function(t,l,u,d,U,L){var D=this.options.useBinaryProtocol,E=D?M.default.Config.msgpack.encode:JSON.stringify,T=D?M.default.Config.msgpack.decode:JSON.parse,R=D?e.Format.msgpack:e.Format.json,j=this.http.supportsLinkHeaders?void 0:R;u=u||{};var G=t.toLowerCase(),k=G=="get"?e.defaultGetHeaders(this.options,R):e.defaultPostHeaders(this.options,R);if(L===void 0){if(this.options.promises)return e.promisify(this,"request",[t,l,u,d,U]);L=g}typeof d!="string"&&(d=E(d)),this.options.headers&&e.mixin(k,this.options.headers),U&&e.mixin(k,U);var J=new y.default(this,l,k,j,function(z,_,C){return e.ensureArray(C?z:T(z))},!0);if(!e.arrIn(M.default.Http.methods,G))throw new A.default("Unsupported method "+G,40500,405);e.arrIn(M.default.Http.methodsWithBody,G)?J[G](u,d,L):J[G](u,L)},n.prototype.batchPublish=function(t,l){if(l===void 0){if(this.options.promises)return e.promisify(this,"batchPublish",[t]);l=g}var u=l,d,U;e.isArray(t)?(d=t,U=!1):(d=[t],U=!0);var L=this.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,D=e.defaultPostHeaders(this.options,L);this.options.headers&&e.mixin(D,this.options.headers);var E=e.encodeBody(d,L);c.default.post(this,"/messages",E,D,{newBatchResponse:"true"},null,function(T,R,j,G){if(T){u(T);return}var k=G?R:e.decodeBody(R,L);U?u(null,k[0]):u(null,k)})},n.prototype.batchPresence=function(t,l){if(l===void 0){if(this.options.promises)return e.promisify(this,"batchPresence",[t]);l=g}var u=l,d=this.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,U=e.defaultPostHeaders(this.options,d);this.options.headers&&e.mixin(U,this.options.headers);var L=t.join(",");c.default.get(this,"/presence",U,{newBatchResponse:"true",channels:L},null,function(D,E,T,R){if(D){u(D);return}var j=R?E:e.decodeBody(E,d);u(null,j)})},n.prototype.setLog=function(t){b.default.setLog(t.level,t.handler)},n.Promise=function(t){return t=S.default.objectifyOptions(t),t.promises=!0,new n(t)},n.Callbacks=n,n.Platform=M.default,n.Message=O.default,n.PresenceMessage=p.default,n}(),i=function(){function n(t){this.rest=t,this.all=Object.create(null)}return n.prototype.get=function(t,l){t=String(t);var u=this.all[t];return u?l&&u.setOptions(l):this.all[t]=u=new v.default(this.rest,t,l),u},n.prototype.release=function(t){delete this.all[String(t)]},n}();s.default=o},function(P,s,a){(function(f,e){P.exports=e(a(6))})(this,function(f){return f.enc.Utf8})},function(P,s,a){(function(f,e){P.exports=e(a(6))})(this,function(f){return function(e){var b=f,S=b.lib,I=S.WordArray,w=S.Hasher,y=b.algo,v=[],A=[];(function(){function M(g){for(var o=e.sqrt(g),i=2;i<=o;i++)if(!(g%i))return!1;return!0}function O(g){return(g-(g|0))*4294967296|0}for(var p=2,c=0;c<64;)M(p)&&(c<8&&(v[c]=O(e.pow(p,1/2))),A[c]=O(e.pow(p,1/3)),c++),p++})();var r=[],h=y.SHA256=w.extend({_doReset:function(){this._hash=new I.init(v.slice(0))},_doProcessBlock:function(M,O){for(var p=this._hash.words,c=p[0],g=p[1],o=p[2],i=p[3],n=p[4],t=p[5],l=p[6],u=p[7],d=0;d<64;d++){if(d<16)r[d]=M[O+d]|0;else{var U=r[d-15],L=(U<<25|U>>>7)^(U<<14|U>>>18)^U>>>3,D=r[d-2],E=(D<<15|D>>>17)^(D<<13|D>>>19)^D>>>10;r[d]=L+r[d-7]+E+r[d-16]}var T=n&t^~n&l,R=c&g^c&o^g&o,j=(c<<30|c>>>2)^(c<<19|c>>>13)^(c<<10|c>>>22),G=(n<<26|n>>>6)^(n<<21|n>>>11)^(n<<7|n>>>25),k=u+G+T+A[d]+r[d],J=j+R;u=l,l=t,t=n,n=i+k|0,i=o,o=g,g=c,c=k+J|0}p[0]=p[0]+c|0,p[1]=p[1]+g|0,p[2]=p[2]+o|0,p[3]=p[3]+i|0,p[4]=p[4]+n|0,p[5]=p[5]+t|0,p[6]=p[6]+l|0,p[7]=p[7]+u|0},_doFinalize:function(){var M=this._data,O=M.words,p=this._nDataBytes*8,c=M.sigBytes*8;return O[c>>>5]|=128<<24-c%32,O[(c+64>>>9<<4)+14]=e.floor(p/4294967296),O[(c+64>>>9<<4)+15]=p,M.sigBytes=O.length*4,this._process(),this._hash},clone:function(){var M=w.clone.call(this);return M._hash=this._hash.clone(),M}});b.SHA256=w._createHelper(h),b.HmacSHA256=w._createHmacHelper(h)}(Math),f.SHA256})},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importStar(a(1)),b=f.__importDefault(a(7)),S=f.__importDefault(a(2)),I=f.__importDefault(a(34)),w=f.__importDefault(a(9)),y=f.__importDefault(a(4)),v=f.__importDefault(a(20)),A=f.__importDefault(a(15)),r=f.__importDefault(a(3));function h(){}var M=9;function O(g){return e.arrEvery(g,function(o){return!o.id})}function p(g){var o=g||{};if(o.cipher){if(!r.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var i=r.default.Crypto.getCipher(o.cipher);o.cipher=i.cipherParams,o.channelCipher=i.cipher}else"cipher"in o&&(o.cipher=void 0,o.channelCipher=null);return o}var c=function(g){f.__extends(o,g);function o(i,n,t){var l=g.call(this)||this;return S.default.logAction(S.default.LOG_MINOR,"Channel()","started; name = "+n),l.rest=i,l.name=n,l.basePath="/channels/"+encodeURIComponent(n),l.presence=new I.default(l),l.channelOptions=p(t),l}return o.prototype.setOptions=function(i){this.channelOptions=p(i)},o.prototype.history=function(i,n){if(S.default.logAction(S.default.LOG_MICRO,"Channel.history()","channel = "+this.name),n===void 0)if(typeof i=="function")n=i,i=null;else{if(this.rest.options.promises)return e.promisify(this,"history",arguments);n=h}this._history(i,n)},o.prototype._history=function(i,n){var t=this.rest,l=t.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,u=this.rest.http.supportsLinkHeaders?void 0:l,d=e.defaultGetHeaders(t.options,l);t.options.headers&&e.mixin(d,t.options.headers);var U=this.channelOptions;new v.default(t,this.basePath+"/messages",d,u,function(L,D,E){return w.default.fromResponseBody(L,U,E?void 0:l)}).get(i,n)},o.prototype.publish=function(){var i=this,n=arguments.length,t=arguments[0],l=arguments[1],u=arguments[n-1],d,U;if(typeof u!="function"){if(this.rest.options.promises)return e.promisify(this,"publish",arguments);u=h}if(typeof t=="string"||t===null)d=[w.default.fromValues({name:t,data:l})],U=arguments[2];else if(e.isObject(t))d=[w.default.fromValues(t)],U=arguments[1];else if(e.isArray(t))d=w.default.fromValuesArray(t),U=arguments[1];else throw new y.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof U!="object"||!U)&&(U={});var L=this.rest,D=L.options,E=D.useBinaryProtocol?e.Format.msgpack:e.Format.json,T=L.options.idempotentRestPublishing,R=e.defaultPostHeaders(L.options,E);if(D.headers&&e.mixin(R,D.headers),T&&O(d)){var j=e.randomString(M);e.arrForEach(d,function(G,k){G.id=j+":"+k.toString()})}w.default.encodeArray(d,this.channelOptions,function(G){if(G){u(G);return}var k=w.default.getMessagesSize(d),J=D.maxMessageSize;if(k>J){u(new y.default("Maximum size of messages that can be published at once exceeded ( was "+k+" bytes; limit is "+J+" bytes)",40009,400));return}i._publish(w.default.serialize(d,E),R,U,u)})},o.prototype._publish=function(i,n,t,l){A.default.post(this.rest,this.basePath+"/messages",i,n,t,null,l)},o.prototype.status=function(i){if(typeof i!="function"&&this.rest.options.promises)return e.promisify(this,"status",[]);var n=this.rest.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,t=e.defaultPostHeaders(this.rest.options,n);A.default.get(this.rest,this.basePath,t,{},n,i||h)},o}(b.default);s.default=c},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importStar(a(1)),b=f.__importDefault(a(7)),S=f.__importDefault(a(2)),I=f.__importDefault(a(20)),w=f.__importDefault(a(16));function y(){}var v=function(A){f.__extends(r,A);function r(h){var M=A.call(this)||this;return M.channel=h,M.basePath=h.basePath+"/presence",M}return r.prototype.get=function(h,M){if(S.default.logAction(S.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),M===void 0)if(typeof h=="function")M=h,h=null;else{if(this.channel.rest.options.promises)return e.promisify(this,"get",arguments);M=y}var O=this.channel.rest,p=O.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,c=this.channel.rest.http.supportsLinkHeaders?void 0:p,g=e.defaultGetHeaders(O.options,p);O.options.headers&&e.mixin(g,O.options.headers);var o=this.channel.channelOptions;new I.default(O,this.basePath,g,c,function(i,n,t){return w.default.fromResponseBody(i,o,t?void 0:p)}).get(h,M)},r.prototype.history=function(h,M){return S.default.logAction(S.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(h,M)},r.prototype._history=function(h,M){if(M===void 0)if(typeof h=="function")M=h,h=null;else{if(this.channel.rest.options.promises)return e.promisify(this,"_history",[h]);M=y}var O=this.channel.rest,p=O.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,c=this.channel.rest.http.supportsLinkHeaders?void 0:p,g=e.defaultGetHeaders(O.options,p);O.options.headers&&e.mixin(g,O.options.headers);var o=this.channel.channelOptions;new I.default(O,this.basePath+"/history",g,c,function(i,n,t){return w.default.fromResponseBody(i,o,t?void 0:p)}).get(h,M)},r}(b.default);s.default=v},function(P,s,a){(function(f){Object.defineProperty(s,"__esModule",{value:!0}),s.TransportParams=void 0;var e=a(0),b=e.__importDefault(a(10)),S=e.__importStar(a(1)),I=e.__importStar(a(52)),w=e.__importStar(a(8)),y=e.__importDefault(a(3)),v=e.__importDefault(a(7)),A=e.__importDefault(a(36)),r=e.__importDefault(a(2)),h=e.__importDefault(a(37)),M=e.__importStar(a(21)),O=e.__importStar(a(4)),p=e.__importDefault(a(18)),c=e.__importDefault(a(9)),g=e.__importDefault(a(24)),o=e.__importDefault(a(53)),i=e.__importDefault(a(26)),n=e.__importDefault(a(14)),t=function(){var z;return typeof y.default.WebStorage<"u"&&((z=y.default.WebStorage)===null||z===void 0?void 0:z.localSupported)},l=function(){var z;return typeof y.default.WebStorage<"u"&&((z=y.default.WebStorage)===null||z===void 0?void 0:z.sessionSupported)},u=b.default.Action,d=function(){},U="ably-transport-preference",L="ably-connection-recovery";function D(){var z,_;return l()&&((_=(z=y.default.WebStorage)===null||z===void 0?void 0:z.getSession)===null||_===void 0?void 0:_.call(z,L))}function E(z){var _,C;return l()&&((C=(_=y.default.WebStorage)===null||_===void 0?void 0:_.setSession)===null||C===void 0?void 0:C.call(_,L,z))}function T(){var z,_;return l()&&((_=(z=y.default.WebStorage)===null||z===void 0?void 0:z.removeSession)===null||_===void 0?void 0:_.call(z,L))}function R(z,_){return S.arrIndexOf(y.default.Defaults.transportPreferenceOrder,z.shortName)>S.arrIndexOf(y.default.Defaults.transportPreferenceOrder,_.shortName)}function j(z,_,C){var N;if(z.channel!==_.channel||(N=z.action)!==u.PRESENCE&&N!==u.MESSAGE||N!==_.action)return!1;var B=N===u.PRESENCE?"presence":"messages",H=z[B].concat(_[B]),W=c.default.getMessagesSize(H);return W>C||!S.allSame(H,"clientId")||!S.arrEvery(H,function(q){return!q.id})?!1:(z[B]=H,!0)}function G(z){try{return JSON.parse(z)}catch{return null}}var k=function(){function z(_,C,N,B){this.options=_,this.host=C,this.mode=N,this.connectionKey=B,this.format=_.useBinaryProtocol?S.Format.msgpack:S.Format.json}return z.prototype.getConnectParams=function(_){var C=_?S.copy(_):{},N=this.options;switch(this.mode){case"upgrade":C.upgrade=this.connectionKey;break;case"resume":C.resume=this.connectionKey;break;case"recover":{var B=G(N.recover);B&&(C.recover=B.connectionKey);break}}return N.clientId!==void 0&&(C.clientId=N.clientId),N.echoMessages===!1&&(C.echo="false"),this.format!==void 0&&(C.format=this.format),this.stream!==void 0&&(C.stream=this.stream),this.heartbeats!==void 0&&(C.heartbeats=this.heartbeats),C.v=w.default.protocolVersion,C.agent=(0,w.getAgentString)(this.options),N.transportParams!==void 0&&S.mixin(C,N.transportParams),C},z.prototype.toString=function(){var _="[mode="+this.mode;return this.host&&(_+=",host="+this.host),this.connectionKey&&(_+=",connectionKey="+this.connectionKey),this.format&&(_+=",format="+this.format),_+="]",_},z}();s.TransportParams=k;var J=function(z){e.__extends(_,z);function _(C,N){var B=z.call(this)||this;B.disconnectedRetryCount=0,_.initTransports(),B.realtime=C,B.options=N;var H=N.timeouts,W=H.preferenceConnectTimeout+H.realtimeRequestTimeout;if(B.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:W,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:H.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:H.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:H.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},B.state=B.states.initialized,B.errorReason=null,B.queuedMessages=new A.default,B.msgSerial=0,B.connectionDetails=void 0,B.connectionId=void 0,B.connectionKey=void 0,B.connectionStateTtl=H.connectionStateTtl,B.maxIdleInterval=null,B.transports=S.intersect(N.transports||w.default.defaultTransports,_.supportedTransports),B.baseTransport=S.intersect(w.default.baseTransportOrder,B.transports)[0],B.upgradeTransports=S.intersect(B.transports,w.default.upgradeTransports),B.transportPreference=null,B.httpHosts=w.default.getHosts(N),B.activeProtocol=null,B.proposedTransports=[],B.pendingTransports=[],B.host=null,B.lastAutoReconnectAttempt=null,B.lastActivity=null,B.forceFallbackHost=!1,B.connectCounter=0,r.default.logAction(r.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),r.default.logAction(r.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(N.transports||w.default.defaultTransports)+"]"),r.default.logAction(r.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+B.transports+"]"),r.default.logAction(r.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+B.httpHosts+"]"),!B.transports.length){var q="no requested transports available";throw r.default.logAction(r.default.LOG_ERROR,"realtime.ConnectionManager()",q),new Error(q)}var X=y.default.Config.addEventListener;return X&&(l()&&typeof N.recover=="function"&&X("beforeunload",B.persistConnection.bind(B)),N.closeOnUnload===!0&&X("beforeunload",function(){r.default.logAction(r.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),B.requestState({state:"closing"})}),X("online",function(){B.state==B.states.disconnected||B.state==B.states.suspended?(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager caught browser â€˜onlineâ€™ event","reattempting connection"),B.requestState({state:"connecting"})):B.state==B.states.connecting&&(B.pendingTransports.forEach(function(Z){Z.off()}),B.disconnectAllTransports(),B.startConnect())}),X("offline",function(){B.state==B.states.connected&&(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager caught browser â€˜offlineâ€™ event","disconnecting active transport"),B.disconnectAllTransports())})),B}return _.initTransports=function(){(0,o.default)(_),S.arrForEach(y.default.Transports,function(C){C(_)})},_.prototype.createTransportParams=function(C,N){return new k(this.options,C,N,this.connectionKey)},_.prototype.getTransportParams=function(C){var N=this,B=function(H){if(N.connectionKey){H("resume");return}if(typeof N.options.recover=="string"){H("recover");return}var W=N.options.recover,q=D();if(q&&typeof W=="function"){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),W(q,function(X){X?(N.options.recover=q.recoveryKey,H("recover")):H("clean")});return}H("clean")};B(function(H){var W=N.createTransportParams(null,H);if(H==="recover"){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+N.options.recover);var q=G(N.options.recover);q&&(N.msgSerial=q.msgSerial)}else r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+W.toString());C(W)})},_.prototype.tryATransport=function(C,N,B){var H=this;r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+N),i.default.tryConnect(_.supportedTransports[N],this,this.realtime.auth,C,function(W,q){var X=H.state;if(X==H.states.closing||X==H.states.closed||X==H.states.failed){q&&(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+X.state+" while we were attempting the transport; closing "+q),q.close()),B(!0);return}if(W){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+N+" "+W.event+", err: "+W.error.toString()),p.default.isTokenErr(W.error)&&!(H.errorReason&&p.default.isTokenErr(H.errorReason))?(H.errorReason=W.error,H.realtime.auth._forceNewToken(null,null,function(Z){if(Z){H.actOnErrorFromAuthorize(Z);return}H.tryATransport(C,N,B)})):W.event==="failed"?(H.notifyState({state:"failed",error:W.error}),B(!0)):W.event==="disconnected"&&((0,M.isRetriable)(W.error)?B(!1):(H.notifyState({state:H.states.connecting.failState,error:W.error}),B(!0)));return}r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+N+"; setting pending"),H.setTransportPending(q,C),B(null,q)})},_.prototype.setTransportPending=function(C,N){var B=this,H=N.mode;r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+C+"; mode = "+H),S.arrDeleteValue(this.proposedTransports,C),this.pendingTransports.push(C);var W=y.default.Defaults.transportPreferenceOrder[y.default.Defaults.transportPreferenceOrder.length-1];C.once("connected",function(X,Z,tt){H=="upgrade"&&B.activeProtocol?C.shortName!==W&&S.arrIn(B.getUpgradePossibilities(),W)&&B.activeProtocol?setTimeout(function(){B.scheduleTransportActivation(X,C,Z,tt)},B.options.timeouts.parallelUpgradeDelay):B.scheduleTransportActivation(X,C,Z,tt):(B.activateTransport(X,C,Z,tt),y.default.Config.nextTick(function(){B.connectImpl(N)})),H==="recover"&&B.options.recover&&(B.options.recover=null,B.unpersistConnection())});var q=this;C.on(["disconnected","closed","failed"],function(X){q.deactivateTransport(C,this.event,X)}),this.emit("transport.pending",C)},_.prototype.scheduleTransportActivation=function(C,N,B,H){var W=this,q=this.activeProtocol&&this.activeProtocol.getTransport(),X=function(){N.disconnect(),S.arrDeleteValue(W.pendingTransports,N)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+N.shortName),X();return}if(q&&!R(N,q)){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+N.shortName+" is no better than current active transport "+q.shortName+" - abandoning upgrade"),X();return}r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+N);var Z=null;if(!N.isConnected){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+N.shortName+"is no longer connected; abandoning upgrade"),X();return}if(this.state===this.states.connected)r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),this.state=this.states.synchronizing,Z=this.activeProtocol;else if(this.state!==this.states.connecting){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+N.shortName),X();return}r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+N);var tt=function(){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+N),N.send(b.default.fromValues({action:u.ACTIVATE})),W.activateTransport(C,N,B,H),W.state===W.states.synchronizing?(r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+N),W.state=W.states.connected):r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+W.state.state+", so leaving unchanged"),W.state.sendEvents&&W.sendQueuedMessages()};Z?Z.onceIdle(tt):tt()},_.prototype.activateTransport=function(C,N,B,H){var W=this;r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+N),C&&r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+C),B&&r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+B),H&&r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(H)),this.persistTransportPreference(N);var q=this.state,X=this.states.connected.state;if(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+q.state),q.state==this.states.closing.state||q.state==this.states.closed.state||q.state==this.states.failed.state)return r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),N.disconnect(),!1;if(S.arrDeleteValue(this.pendingTransports,N),!N.isConnected)return r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+N+" since it appears to no longer be connected"),!1;var Z=this.activeProtocol;this.activeProtocol=new I.default(N),this.host=N.params.host;var tt=H.connectionKey;if(tt&&this.connectionKey!=tt&&this.setConnection(B,H,!!C),this.onConnectionDetailsUpdate(H,N),y.default.Config.nextTick(function(){N.on("connected",function($,it,st){W.onConnectionDetailsUpdate(st,N),W.emit("update",new h.default(X,X,null,$))})}),q.state===this.states.connected.state?C&&(this.errorReason=this.realtime.connection.errorReason=C,this.emit("update",new h.default(X,X,null,C))):(this.notifyState({state:"connected",error:C}),this.errorReason=this.realtime.connection.errorReason=C||null),this.emit("transport.active",N),Z)if(Z.messageQueue.count()>0&&r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+Z.transport.shortName+", new one is "+N.shortName+") finishing with "+Z.messageQueue.count()+" messages still pending"),Z.transport===N){var rt="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+N.shortName+"; stack = "+new Error().stack;r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.activateTransport()",rt)}else Z.finish();return S.safeArrForEach(this.pendingTransports,function($){if($===N){var it="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+N.shortName+"; stack = "+new Error().stack;r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.activateTransport()",it),S.arrDeleteValue(W.pendingTransports,N)}else $.disconnect()}),S.safeArrForEach(this.proposedTransports,function($){$===N?(r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+N.shortName+"; stack = "+new Error().stack),S.arrDeleteValue(W.proposedTransports,N)):$.dispose()}),!0},_.prototype.deactivateTransport=function(C,N,B){var H=this.activeProtocol,W=H&&H.getTransport()===C,q=S.arrDeleteValue(this.pendingTransports,C),X=S.arrDeleteValue(this.proposedTransports,C),Z=this.noTransportsScheduledForActivation();if(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+C),r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+N+(W?"; was active":q?"; was pending":X?"; was proposed":"")+(Z?"":"; another transport is scheduled for activation")),B&&B.message&&r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+B.message),W&&(r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(H.getPendingMessages()),y.default.Config.nextTick(function(){H.clearPendingMessages()}),this.activeProtocol=this.host=null),this.emit("transport.inactive",C),W&&Z||W&&N==="failed"||N==="closed"||H===null&&q&&this.pendingTransports.length===0){if(N==="disconnected"&&B&&B.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:N,error:B,retryImmediately:!0});return}var tt=N==="failed"&&p.default.isTokenErr(B)?"disconnected":N;this.notifyState({state:tt,error:B});return}W&&N==="disconnected"&&this.state!==this.states.synchronizing&&(r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:B}))},_.prototype.noTransportsScheduledForActivation=function(){return S.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(C){return!C.isConnected})},_.prototype.setConnection=function(C,N,B){var H=this.connectionId,W=H&&H!==C,q=!H&&B;(W||q)&&(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==C&&r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=C,this.realtime.connection.key=this.connectionKey=N.connectionKey},_.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()},_.prototype.createRecoveryKey=function(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null},_.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var C=S.now()-this.lastActivity;C>this.connectionStateTtl+this.maxIdleInterval&&(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+C+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},_.prototype.persistConnection=function(){if(l()){var C=this.createRecoveryKey();C&&E({recoveryKey:C,disconnectedAt:S.now(),location:f.location,clientId:this.realtime.auth.clientId})}},_.prototype.unpersistConnection=function(){T()},_.prototype.getError=function(){return this.errorReason||this.getStateError()},_.prototype.getStateError=function(){var C,N;return(N=(C=M.default)[this.state.state])===null||N===void 0?void 0:N.call(C)},_.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},_.prototype.enactStateChange=function(C){var N=C.current==="failed"?r.default.LOG_ERROR:r.default.LOG_MAJOR;r.default.logAction(N,"Connection state",C.current+(C.reason?"; reason: "+C.reason:"")),r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+C.current+"; reason = "+(C.reason&&C.reason.message));var B=this.state=this.states[C.current];C.reason&&(this.errorReason=C.reason,this.realtime.connection.errorReason=C.reason),(B.terminal||B.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",C)},_.prototype.startTransitionTimer=function(C){var N=this;r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+C.state),this.transitionTimer&&(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){N.transitionTimer&&(N.transitionTimer=null,r.default.logAction(r.default.LOG_MINOR,"ConnectionManager "+C.state+" timer expired","requesting new state: "+C.failState),N.notifyState({state:C.failState}))},C.retryDelay)},_.prototype.cancelTransitionTimer=function(){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},_.prototype.startSuspendTimer=function(){var C=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){C.suspendTimer&&(C.suspendTimer=null,r.default.logAction(r.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),C.states.connecting.failState="suspended",C.notifyState({state:"suspended"}))},this.connectionStateTtl))},_.prototype.checkSuspendTimer=function(C){C!=="disconnected"&&C!=="suspended"&&C!=="connecting"&&this.cancelSuspendTimer()},_.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},_.prototype.startRetryTimer=function(C){var N=this;this.retryTimer=setTimeout(function(){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),N.retryTimer=null,N.requestState({state:"connecting"})},C)},_.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},_.prototype.notifyState=function(C){var N=this,B,H,W=C.state,q=W==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||C.retryImmediately||this.state===this.states.connecting&&C.error&&p.default.isTokenErr(C.error)&&!(this.errorReason&&p.default.isTokenErr(this.errorReason)));if(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+W+(q?"; will retry connection immediately":"")),W!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(C.state),(W==="suspended"||W==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var X=this.states[C.state],Z=X.retryDelay;X.state==="disconnected"&&(this.disconnectedRetryCount++,Z=S.getRetryTime(X.retryDelay,this.disconnectedRetryCount));var tt=new h.default(this.state.state,X.state,Z,C.error||((H=(B=M.default)[X.state])===null||H===void 0?void 0:H.call(B)));if(q){var rt=function(){N.state===N.states.disconnected&&(N.lastAutoReconnectAttempt=S.now(),N.requestState({state:"connecting"}))},$=this.lastAutoReconnectAttempt&&S.now()-this.lastAutoReconnectAttempt+1;$&&$<1e3?(r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+$+"ms ago, waiting another "+(1e3-$)+"ms before trying again"),setTimeout(rt,1e3-$)):y.default.Config.nextTick(rt)}else(W==="disconnected"||W==="suspended")&&this.startRetryTimer(Z);(W==="disconnected"&&!q||W==="suspended"||X.terminal)&&y.default.Config.nextTick(function(){N.disconnectAllTransports()}),W=="connected"&&!this.activeProtocol&&r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(tt),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(W,tt.reason),this.failQueuedMessages(tt.reason))}},_.prototype.requestState=function(C){var N=this,B,H,W=C.state;if(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+W+"; current state: "+this.state.state),W!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(W),!(W=="connecting"&&this.state.state=="connected")&&!(W=="closing"&&this.state.state=="closed"))){var q=this.states[W],X=new h.default(this.state.state,q.state,null,C.error||((H=(B=M.default)[q.state])===null||H===void 0?void 0:H.call(B)));this.enactStateChange(X),W=="connecting"&&y.default.Config.nextTick(function(){N.startConnect()}),W=="closing"&&this.closeImpl()}},_.prototype.startConnect=function(){var C=this;if(this.state!==this.states.connecting){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var N=this.realtime.auth,B=++this.connectCounter,H=function(){C.checkConnectionStateFreshness(),C.getTransportParams(function(q){if(q.mode==="recover"&&q.options.recover){var X=G(q.options.recover);X&&C.realtime.channels.recoverChannels(X.channelSerials)}B===C.connectCounter&&C.connectImpl(q,B)})};if(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),N.method==="basic")H();else{var W=function(q){B===C.connectCounter&&(q?C.actOnErrorFromAuthorize(q):H())};this.errorReason&&p.default.isTokenErr(this.errorReason)?N._forceNewToken(null,null,W):N._ensureValidAuthCredentials(!1,W)}},_.prototype.connectImpl=function(C,N){var B=this.state.state;B!==this.states.connecting.state&&B!==this.states.connected.state?r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+B):this.pendingTransports.length?r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):B==this.states.connected.state?this.upgradeIfNeeded(C):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(C,N):this.connectBase(C,N)},_.prototype.connectPreference=function(C,N){var B=this,H=this.getTransportPreference(),W=!1;S.arrIn(this.transports,H)||(this.unpersistTransportPreference(),this.connectImpl(C,N)),r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+H);var q=setTimeout(function(){W=!0,B.state.state!==B.states.connected.state&&(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+H+" failed; clearing preference and trying from scratch"),B.disconnectAllTransports(),B.unpersistTransportPreference()),B.connectImpl(C,N)},this.options.timeouts.preferenceConnectTimeout);C.host=this.httpHosts[0],this.tryATransport(C,H,function(X,Z){clearTimeout(q),W&&Z?(Z.off(),Z.disconnect(),S.arrDeleteValue(B.pendingTransports,Z)):!Z&&!X&&(B.unpersistTransportPreference(),B.connectImpl(C,N))})},_.prototype.connectBase=function(C,N){var B=this,H=function(tt){B.notifyState({state:B.states.connecting.failState,error:tt})},W=this.httpHosts.slice(),q=function(tt,rt){N===B.connectCounter&&!rt&&!tt&&Z()};r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var X=W.shift();if(!X){H(new O.default("Unable to connect (no available host)",80003,404));return}C.host=X;var Z=function(){if(!W.length){H(new O.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!B.realtime.http.checkConnectivity){H(new O.PartialErrorInfo("Internal error: Http.checkConnectivity not set",null,500));return}B.realtime.http.checkConnectivity(function(tt,rt){if(N===B.connectCounter){if(tt){H(tt);return}if(!rt){H(new O.default("Unable to connect (network unreachable)",80003,404));return}C.host=S.arrPopRandomElement(W),B.tryATransport(C,B.baseTransport,q)}})};if(this.forceFallbackHost&&W.length){this.forceFallbackHost=!1,Z();return}this.tryATransport(C,this.baseTransport,q)},_.prototype.getUpgradePossibilities=function(){var C=this.activeProtocol.getTransport().shortName,N=S.arrIndexOf(this.upgradeTransports,C);return this.upgradeTransports.slice(N+1)},_.prototype.upgradeIfNeeded=function(C){var N=this,B=this.getUpgradePossibilities();r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+y.default.Config.inspect(B)),B.length&&S.arrForEach(B,function(H){var W=N.createTransportParams(C.host,"upgrade");N.tryATransport(W,H,d)})},_.prototype.closeImpl=function(){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),S.safeArrForEach(this.pendingTransports,function(C){r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+C),C&&C.close()}),S.safeArrForEach(this.proposedTransports,function(C){r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+C),C&&C.dispose()}),this.activeProtocol&&(r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},_.prototype.onAuthUpdated=function(C,N){var B=this,H;switch(this.state.state){case"connected":{if(r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var W=this.activeProtocol.getTransport().params;y.default.Config.nextTick(function(){B.state.state==="connected"&&B.upgradeIfNeeded(W)})}var q=(H=this.activeProtocol)===null||H===void 0?void 0:H.getTransport();q&&q.onAuthUpdated&&q.onAuthUpdated(C);var X=b.default.fromValues({action:u.AUTH,auth:{accessToken:C.token}});this.send(X);var Z=function(){B.off(tt),N(null,C)},tt=function($){$.current==="failed"&&(B.off(Z),B.off(tt),N($.reason||B.getStateError()))};this.once("connectiondetails",Z),this.on("connectionstate",tt);break}case"connecting":r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var rt=function($){switch($.current){case"connected":B.off(rt),N(null,C);break;case"failed":case"closed":case"suspended":B.off(rt),N($.reason||B.getStateError());break}};this.on("connectionstate",rt),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},_.prototype.disconnectAllTransports=function(C){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(C?" except the active transport":"")),this.connectCounter++,S.safeArrForEach(this.pendingTransports,function(N){r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+N),N&&N.disconnect()}),this.pendingTransports=[],S.safeArrForEach(this.proposedTransports,function(N){r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+N),N&&N.dispose()}),this.proposedTransports=[],this.activeProtocol&&!C&&(r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},_.prototype.send=function(C,N,B){B=B||d;var H=this.state;if(H.sendEvents){r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new I.PendingMessage(C,B));return}var W=N&&H.queueEvents||H.forceQueueEvents;if(!W){var q="rejecting event, queueEvent was "+N+", state was "+H.state;r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.send()",q),B(this.errorReason||new O.default(q,9e4,400));return}r.default.shouldLog(r.default.LOG_MICRO)&&r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+b.default.stringify(C)),this.queue(C,B)},_.prototype.sendImpl=function(C){var N=C.message;C.ackRequired&&!C.sendAttempted&&(N.msgSerial=this.msgSerial++);try{this.activeProtocol.send(C)}catch(B){r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+B.stack)}},_.prototype.queue=function(C,N){r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var B=this.queuedMessages.last(),H=this.options.maxMessageSize;B&&!B.sendAttempted&&j(B.message,C,H)?(B.merged||(B.callback=g.default.create([B.callback]),B.merged=!0),B.callback.push(N)):this.queuedMessages.push(new I.PendingMessage(C,N))},_.prototype.sendQueuedMessages=function(){r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var C;C=this.queuedMessages.shift();)this.sendImpl(C)},_.prototype.queuePendingMessages=function(C){C&&C.length&&(r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+C.length+" pending messages"),this.queuedMessages.prepend(C))},_.prototype.failQueuedMessages=function(C){var N=this.queuedMessages.count();N>0&&(r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+N+" queued messages, err = "+S.inspectError(C)),this.queuedMessages.completeAllMessages(C))},_.prototype.onChannelMessage=function(C,N){var B=this.activeProtocol&&N===this.activeProtocol.getTransport(),H=S.arrIn(this.pendingTransports,N)&&this.state==this.states.synchronizing;B||H?this.realtime.channels.onChannelMessage(C):S.arrIndexOf([u.ACK,u.NACK,u.ERROR],C.action)>-1?this.realtime.channels.onChannelMessage(C):r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(C)+"on defunct transport; discarding")},_.prototype.ping=function(C,N){var B=this;if(C){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+C);var H=function(){C.off("heartbeat",X),N(new O.default("Timeout waiting for heartbeat response",5e4,500))},W=S.now(),q=S.cheapRandStr(),X=function(it){if(it===q){C.off("heartbeat",X),clearTimeout(Z);var st=S.now()-W;N(null,st)}},Z=setTimeout(H,this.options.timeouts.realtimeRequestTimeout);C.on("heartbeat",X),C.ping(q);return}if(this.state.state!=="connected"){N(new O.default("Unable to ping service; not connected",4e4,400));return}var tt=!1,rt=function(it,st){B.off("transport.active",$),tt||(tt=!0,N(it,st))},$=function(){tt||(tt=!0,y.default.Config.nextTick(function(){B.ping(null,N)}))};this.on("transport.active",$),this.ping(this.activeProtocol.getTransport(),rt)},_.prototype.abort=function(C){this.activeProtocol.getTransport().fail(C)},_.prototype.registerProposedTransport=function(C){this.proposedTransports.push(C)},_.prototype.getTransportPreference=function(){var C,N;return this.transportPreference||t()&&((N=(C=y.default.WebStorage)===null||C===void 0?void 0:C.get)===null||N===void 0?void 0:N.call(C,U))},_.prototype.persistTransportPreference=function(C){var N,B;S.arrIn(w.default.upgradeTransports,C.shortName)&&(this.transportPreference=C.shortName,t()&&((B=(N=y.default.WebStorage)===null||N===void 0?void 0:N.set)===null||B===void 0||B.call(N,U,C.shortName)))},_.prototype.unpersistTransportPreference=function(){var C,N;this.transportPreference=null,t()&&((N=(C=y.default.WebStorage)===null||C===void 0?void 0:C.remove)===null||N===void 0||N.call(C,U))},_.prototype.actOnErrorFromAuthorize=function(C){if(C.code===40171)this.notifyState({state:"failed",error:C});else if(C.code===40102)this.notifyState({state:"failed",error:C});else if(C.statusCode===n.default.Forbidden){var N="Client configured authentication provider returned 403; failing the connection";r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",N),this.notifyState({state:"failed",error:new O.default(N,80019,403,C)})}else{var N="Client configured authentication provider request failed";r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",N),this.notifyState({state:this.state.failState,error:new O.default(N,80019,401,C)})}},_.prototype.onConnectionDetailsUpdate=function(C,N){if(C){this.connectionDetails=C,C.maxMessageSize&&(this.options.maxMessageSize=C.maxMessageSize);var B=C.clientId;if(B){var H=this.realtime.auth._uncheckedSetClientId(B);if(H){r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",H.message),N.fail(H);return}}var W=C.connectionStateTtl;W&&(this.connectionStateTtl=W),this.maxIdleInterval=C.maxIdleInterval,this.emit("connectiondetails",C)}},_.supportedTransports={},_}(v.default);s.default=J}).call(this,a(13))},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importDefault(a(7)),b=f.__importDefault(a(2)),S=function(I){f.__extends(w,I);function w(){var y=I.call(this)||this;return y.messages=[],y}return w.prototype.count=function(){return this.messages.length},w.prototype.push=function(y){this.messages.push(y)},w.prototype.shift=function(){return this.messages.shift()},w.prototype.last=function(){return this.messages[this.messages.length-1]},w.prototype.copyAll=function(){return this.messages.slice()},w.prototype.append=function(y){this.messages.push.apply(this.messages,y)},w.prototype.prepend=function(y){this.messages.unshift.apply(this.messages,y)},w.prototype.completeMessages=function(y,v,A){b.default.logAction(b.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+y+"; count = "+v),A=A||null;var r=this.messages;if(r.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var h=r[0];if(h){var M=h.message.msgSerial,O=y+v;if(O>M)for(var p=r.splice(0,O-M),c=0,g=p;c<g.length;c++){var o=g[c];o.callback(A)}r.length==0&&this.emit("idle")}},w.prototype.completeAllMessages=function(y){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,y)},w.prototype.resetSendAttempted=function(){for(var y=0,v=this.messages;y<v.length;y++){var A=v[y];A.sendAttempted=!1}},w.prototype.clear=function(){b.default.logAction(b.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},w}(e.default);s.default=S},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=function(){function e(b,S,I,w){this.previous=b,this.current=S,I&&(this.retryIn=I),w&&(this.reason=w)}return e}();s.default=f},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importDefault(a(10)),b=f.__importDefault(a(7)),S=f.__importStar(a(1)),I=f.__importDefault(a(33)),w=f.__importDefault(a(2)),y=f.__importDefault(a(54)),v=f.__importDefault(a(9)),A=f.__importDefault(a(39)),r=f.__importStar(a(4)),h=f.__importDefault(a(16)),M=f.__importDefault(a(21)),O=e.default.Action,p=function(){};function c(i){if(i&&"params"in i&&!S.isObject(i.params))return new r.default("options.params must be an object",4e4,400);if(i&&"modes"in i){if(!S.isArray(i.modes))return new r.default("options.modes must be an array",4e4,400);for(var n=0;n<i.modes.length;n++){var t=i.modes[n];if(!t||typeof t!="string"||!S.arrIn(e.default.channelModes,String.prototype.toUpperCase.call(t)))return new r.default("Invalid channel mode: "+t,4e4,400)}}}var g=function(i){f.__extends(n,i);function n(t,l,u){var d=i.call(this,t,l,u)||this;return d.retryCount=0,d.history=function(U,L){if(w.default.logAction(w.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),L===void 0)if(typeof U=="function")L=U,U=null;else{if(this.rest.options.promises)return S.promisify(this,"history",arguments);L=p}if(U&&U.untilAttach){if(this.state!=="attached"){L(new r.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){L(new r.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete U.untilAttach,U.from_serial=this.properties.attachSerial}I.default.prototype._history.call(this,U,L)},d.whenState=function(U,L){return b.default.prototype.whenState.call(d,U,d.state,L)},w.default.logAction(w.default.LOG_MINOR,"RealtimeChannel()","started; name = "+l),d.realtime=t,d.presence=new y.default(d),d.connectionManager=t.connection.connectionManager,d.state="initialized",d.subscriptions=new b.default,d.syncChannelSerial=void 0,d.properties={attachSerial:void 0,channelSerial:void 0},d.setOptions(u),d.errorReason=null,d._requestedFlags=null,d._mode=null,d._attachResume=!1,d._decodingContext={channelOptions:d.channelOptions,plugins:t.options.plugins||{},baseEncodedPreviousPayload:void 0},d._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},d._allChannelChanges=new b.default,d}return n.prototype.invalidStateError=function(){return new r.default("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)},n.processListenerArgs=function(t){return t=Array.prototype.slice.call(t),typeof t[0]=="function"&&t.unshift(null),t[t.length-1]==null&&t.pop(),t},n.prototype.setOptions=function(t,l){var u=this.channelOptions;if(!l&&this.rest.options.promises)return S.promisify(this,"setOptions",arguments);var d=l||function(L){L&&w.default.logAction(w.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+L.toString())},U=c(t);if(U){d(U);return}I.default.prototype.setOptions.call(this,t),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(t,u)?(this.attachImpl(),this._allChannelChanges.once(["attached","update","detached","failed"],function(L){switch(this.event){case"update":case"attached":d==null||d(null);return;default:d==null||d(L.reason);return}})):d()},n.prototype._shouldReattachToSetOptions=function(t,l){if(!(this.state==="attached"||this.state==="attaching"))return!1;if(t!=null&&t.params){var u=o(t.params),d=o(l.params);if(Object.keys(u).length!==Object.keys(d).length||!S.shallowEquals(d,u))return!0}return!!(t!=null&&t.modes&&(!l.modes||!S.arrEquals(t.modes,l.modes)))},n.prototype.publish=function(){for(var t=this,l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];var d=l[0],U=l.length,L=l[U-1];if(typeof L!="function"){if(this.realtime.options.promises)return S.promisify(this,"publish",arguments);L=p,++U}if(!this.connectionManager.activeState()){L(this.connectionManager.getError());return}if(U==2)if(S.isObject(d))d=[v.default.fromValues(d)];else if(S.isArray(d))d=v.default.fromValuesArray(d);else throw new r.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else d=[v.default.fromValues({name:l[0],data:l[1]})];var D=this.realtime.options.maxMessageSize;v.default.encodeArray(d,this.channelOptions,function(E){if(E){L(E);return}var T=v.default.getMessagesSize(d);if(T>D){L(new r.default("Maximum size of messages that can be published at once exceeded ( was "+T+" bytes; limit is "+D+" bytes)",40009,400));return}t.__publish(d,L)})},n.prototype.__publish=function(t,l){w.default.logAction(w.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+t.length);var u=this.state;switch(u){case"failed":case"suspended":l(r.default.fromValues(this.invalidStateError()));break;default:{w.default.logAction(w.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+u);var d=new e.default;d.action=O.MESSAGE,d.channel=this.name,d.messages=t,this.sendMessage(d,l);break}}},n.prototype.onEvent=function(t){w.default.logAction(w.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var l=this.subscriptions,u=0;u<t.length;u++){var d=t[u];l.emit(d.name,d)}},n.prototype.attach=function(t,l){var u;if(typeof t=="function"?(l=t,u=null):u=t,!l){if(this.realtime.options.promises)return S.promisify(this,"attach",arguments);l=function(d){d&&w.default.logAction(w.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+d.toString())}}if(u)w.default.deprecated("The ability to pass an array of channel mode flags as the first argument of `RealtimeChannel.attach()`","To set channel mode flags, populate the `modes` property of the channel options object that you pass to `Channels.get()` or `RealtimeChannel.setOptions()`."),this._requestedFlags=u;else if(this.state==="attached"){l(null,null);return}this._attach(!1,null,l)},n.prototype._attach=function(t,l,u){u||(u=function(U){U&&w.default.logAction(w.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+U.toString())});var d=this.connectionManager;if(!d.activeState()){u(d.getError());return}(this.state!=="attaching"||t)&&this.requestState("attaching",l),this.once(function(U){switch(this.event){case"attached":u==null||u(null,U);break;case"detached":case"suspended":case"failed":u==null||u(U.reason||d.getError()||new r.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":u==null||u(new r.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},n.prototype.attachImpl=function(){w.default.logAction(w.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");var t=e.default.fromValues({action:O.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this._requestedFlags?t.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&t.encodeModesToFlags(S.allToUpperCase(this.channelOptions.modes)),this._attachResume&&t.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(t.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(t,p)},n.prototype.detach=function(t){if(!t){if(this.realtime.options.promises)return S.promisify(this,"detach",arguments);t=p}var l=this.connectionManager;if(!l.activeState()){t(l.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),t();break;case"detached":t();break;case"failed":t(new r.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(u){switch(this.event){case"detached":t();break;case"attached":case"suspended":case"failed":t(u.reason||l.getError()||new r.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":t(new r.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},n.prototype.detachImpl=function(t){w.default.logAction(w.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");var l=e.default.fromValues({action:O.DETACH,channel:this.name});this.sendMessage(l,t||p)},n.prototype.subscribe=function(){for(var t=[],l=0;l<arguments.length;l++)t[l]=arguments[l];var u=n.processListenerArgs(t),d=u[0],U=u[1],L=u[2];if(!L&&this.realtime.options.promises)return S.promisify(this,"subscribe",[d,U]);if(this.state==="failed"){L==null||L(r.default.fromValues(this.invalidStateError()));return}return d&&typeof d=="object"&&!Array.isArray(d)?this._subscribeFilter(d,U):this.subscriptions.on(d,U),this.attach(L||p)},n.prototype._subscribeFilter=function(t,l){var u=function(d){var U,L,D,E,T,R,j={name:d.name,refTimeserial:(L=(U=d.extras)===null||U===void 0?void 0:U.ref)===null||L===void 0?void 0:L.timeserial,refType:(E=(D=d.extras)===null||D===void 0?void 0:D.ref)===null||E===void 0?void 0:E.type,isRef:!!(!((R=(T=d.extras)===null||T===void 0?void 0:T.ref)===null||R===void 0)&&R.timeserial),clientId:d.clientId};Object.entries(t).find(function(G){var k=G[0],J=G[1];return J!==void 0?j[k]!==J:!1})||l(d)};this._addFilteredSubscription(t,l,u),this.subscriptions.on(u)},n.prototype._addFilteredSubscription=function(t,l,u){var d;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(l)){var U=this.filteredSubscriptions.get(l);U.set(t,((d=U==null?void 0:U.get(t))===null||d===void 0?void 0:d.concat(u))||[u])}else this.filteredSubscriptions.set(l,new Map([[t,[u]]]))},n.prototype._getAndDeleteFilteredSubscriptions=function(t,l){var u=this;if(!this.filteredSubscriptions)return[];if(!l&&t)return Array.from(this.filteredSubscriptions.entries()).map(function(D){var E,T=D[0],R=D[1],j=R.get(t);return R.delete(t),R.size===0&&((E=u.filteredSubscriptions)===null||E===void 0||E.delete(T)),j}).reduce(function(D,E){var T;return E?(T=D).concat.apply(T,E):D},[]);if(!l||!this.filteredSubscriptions.has(l))return[];var d=this.filteredSubscriptions.get(l);if(!t){var U=Array.from(d.values()).reduce(function(D,E){return D.concat.apply(D,E)},[]);return this.filteredSubscriptions.delete(l),U}var L=d.get(t);return d.delete(t),L||[]},n.prototype.unsubscribe=function(){for(var t=this,l,u=[],d=0;d<arguments.length;d++)u[d]=arguments[d];var U=n.processListenerArgs(u),L=U[0],D=U[1];if(typeof L=="object"&&!D||!((l=this.filteredSubscriptions)===null||l===void 0)&&l.has(D)){this._getAndDeleteFilteredSubscriptions(L,D).forEach(function(E){return t.subscriptions.off(E)});return}this.subscriptions.off(L,D)},n.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new r.PartialErrorInfo("Unable to sync to channel; not attached",4e4)}var t=this.connectionManager;if(!t.activeState())throw t.getError();var l=e.default.fromValues({action:O.SYNC,channel:this.name});this.syncChannelSerial&&(l.channelSerial=this.syncChannelSerial),t.send(l)},n.prototype.sendMessage=function(t,l){this.connectionManager.send(t,this.realtime.options.queueMessages,l)},n.prototype.sendPresence=function(t,l){var u=e.default.fromValues({action:O.PRESENCE,channel:this.name,presence:S.isArray(t)?h.default.fromValuesArray(t):[h.default.fromValues(t)]});this.sendMessage(u,l)},n.prototype.onMessage=function(t){(t.action===O.ATTACHED||t.action===O.MESSAGE||t.action===O.PRESENCE)&&this.setChannelSerial(t.channelSerial);var l,u=!1;switch(t.action){case O.ATTACHED:{this.properties.attachSerial=t.channelSerial,this._mode=t.getMode(),this.params=t.params||{};var d=t.decodeModesFromFlags();this.modes=d&&S.allToLowerCase(d)||void 0;var U=t.hasFlag("RESUMED"),L=t.hasFlag("HAS_PRESENCE"),D=t.hasFlag("HAS_BACKLOG");if(this.state==="attached"){U||this.presence.onAttached(L);var E=new A.default(this.state,this.state,U,D,t.error);this._allChannelChanges.emit("update",E),(!U||this.channelOptions.updateOnAttached)&&this.emit("update",E)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",t.error,U,L,D);break}case O.DETACHED:{var T=t.error?r.default.fromValues(t.error):new r.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",T):this.state==="attaching"?this.notifyState("suspended",T):this.requestState("attaching",T);break}case O.SYNC:if(u=!0,l=this.syncChannelSerial=t.channelSerial,!t.presence)break;case O.PRESENCE:{for(var R=t.presence,j=t.id,G=t.connectionId,k=t.timestamp,J=this.channelOptions,z=void 0,_=0;_<R.length;_++)try{z=R[_],h.default.decode(z,J),z.connectionId||(z.connectionId=G),z.timestamp||(z.timestamp=k),z.id||(z.id=j+":"+_)}catch(q){w.default.logAction(w.default.LOG_ERROR,"RealtimeChannel.onMessage()",q.toString())}this.presence.setPresence(R,u,l);break}case O.MESSAGE:{if(this.state!=="attached"){w.default.logAction(w.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+t.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var C=t.messages,N=C[0],B=C[C.length-1],j=t.id,G=t.connectionId,k=t.timestamp;if(N.extras&&N.extras.delta&&N.extras.delta.from!==this._lastPayload.messageId){var H='Delta message decode failure - previous message not available for message "'+t.id+'" on this channel "'+this.name+'".';w.default.logAction(w.default.LOG_ERROR,"RealtimeChannel.onMessage()",H),this._startDecodeFailureRecovery(new r.default(H,40018,400));break}for(var _=0;_<C.length;_++){var H=C[_];try{v.default.decode(H,this._decodingContext)}catch($){switch(w.default.logAction(w.default.LOG_ERROR,"RealtimeChannel.onMessage()",$.toString()),$.code){case 40018:this._startDecodeFailureRecovery($);return;case 40019:case 40021:this.notifyState("failed",$);return}}H.connectionId||(H.connectionId=G),H.timestamp||(H.timestamp=k),H.id||(H.id=j+":"+_)}this._lastPayload.messageId=B.id,this._lastPayload.protocolMessageChannelSerial=t.channelSerial,this.onEvent(C);break}case O.ERROR:{var W=t.error;W&&W.code==80016?this.checkPendingState():this.notifyState("failed",r.default.fromValues(W));break}default:w.default.logAction(w.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+t.action+")"),this.connectionManager.abort(M.default.unknownChannelErr())}},n.prototype._startDecodeFailureRecovery=function(t){var l=this;this._lastPayload.decodeFailureRecoveryInProgress||(w.default.logAction(w.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,t,function(){l._lastPayload.decodeFailureRecoveryInProgress=!1}))},n.prototype.onAttached=function(){w.default.logAction(w.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},n.prototype.notifyState=function(t,l,u,d,U){if(w.default.logAction(w.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+t),this.clearStateTimer(),S.arrIn(["detached","suspended","failed"],t)&&(this.properties.channelSerial=null),t!==this.state){this.presence.actOnChannelState(t,d,l),t==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),l&&(this.errorReason=l);var L=new A.default(this.state,t,u,U,l),D=t==="failed"?w.default.LOG_ERROR:w.default.LOG_MAJOR;w.default.logAction(D,'Channel state for channel "'+this.name+'"',t+(l?"; reason: "+l:"")),t!=="attaching"&&t!=="suspended"&&(this.retryCount=0),t==="attached"&&this.onAttached(),t==="attached"?this._attachResume=!0:(t==="detaching"||t==="failed")&&(this._attachResume=!1),this.state=t,this._allChannelChanges.emit(t,L),this.emit(t,L)}},n.prototype.requestState=function(t,l){w.default.logAction(w.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+t),this.notifyState(t,l),this.checkPendingState()},n.prototype.checkPendingState=function(){var t=this.connectionManager.state;if(!(t.sendEvents||t.forceQueueEvents)){w.default.logAction(w.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(w.default.logAction(w.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break}},n.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var t=new r.default("Channel attach timed out",90007,408);this.notifyState("suspended",t);break}case"detaching":{var t=new r.default("Channel detach timed out",90007,408);this.notifyState("attached",t);break}default:this.checkPendingState();break}},n.prototype.startStateTimerIfNotRunning=function(){var t=this;this.stateTimer||(this.stateTimer=setTimeout(function(){w.default.logAction(w.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),t.stateTimer=null,t.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},n.prototype.clearStateTimer=function(){var t=this.stateTimer;t&&(clearTimeout(t),this.stateTimer=null)},n.prototype.startRetryTimer=function(){var t=this;if(!this.retryTimer){this.retryCount++;var l=S.getRetryTime(this.realtime.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(function(){t.state==="suspended"&&t.connectionManager.state.sendEvents&&(t.retryTimer=null,w.default.logAction(w.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),t.requestState("attaching"))},l)}},n.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},n.prototype.getReleaseErr=function(){var t=this.state;return t==="initialized"||t==="detached"||t==="failed"?null:new r.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+t,90001,400)},n.prototype.setChannelSerial=function(t){w.default.logAction(w.default.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+t+"; previous = "+this.properties.channelSerial),t&&(this.properties.channelSerial=t)},n}(I.default);function o(i){var n=i||{};n.agent;var t=f.__rest(n,["agent"]);return t}s.default=g},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=function(){function e(b,S,I,w,y){this.previous=b,this.current=S,S==="attached"&&(this.resumed=I,this.hasBacklog=w),y&&(this.reason=y)}return e}();s.default=f},function(P,s,a){(function(f,e){P.exports=e(a(6))})(this,function(f){return function(){var e=f,b=e.lib,S=b.WordArray,I=b.Hasher,w=e.algo,y=[],v=w.SHA1=I.extend({_doReset:function(){this._hash=new S.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(A,r){for(var h=this._hash.words,M=h[0],O=h[1],p=h[2],c=h[3],g=h[4],o=0;o<80;o++){if(o<16)y[o]=A[r+o]|0;else{var i=y[o-3]^y[o-8]^y[o-14]^y[o-16];y[o]=i<<1|i>>>31}var n=(M<<5|M>>>27)+g+y[o];o<20?n+=(O&p|~O&c)+1518500249:o<40?n+=(O^p^c)+1859775393:o<60?n+=(O&p|O&c|p&c)-1894007588:n+=(O^p^c)-899497514,g=c,c=p,p=O<<30|O>>>2,O=M,M=n}h[0]=h[0]+M|0,h[1]=h[1]+O|0,h[2]=h[2]+p|0,h[3]=h[3]+c|0,h[4]=h[4]+g|0},_doFinalize:function(){var A=this._data,r=A.words,h=this._nDataBytes*8,M=A.sigBytes*8;return r[M>>>5]|=128<<24-M%32,r[(M+64>>>9<<4)+14]=Math.floor(h/4294967296),r[(M+64>>>9<<4)+15]=h,A.sigBytes=r.length*4,this._process(),this._hash},clone:function(){var A=I.clone.call(this);return A._hash=this._hash.clone(),A}});e.SHA1=I._createHelper(v),e.HmacSHA1=I._createHmacHelper(v)}(),f.SHA1})},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});function f(o){if(o===void 0)return"undefined";var i,n;if(o instanceof ArrayBuffer?(n="ArrayBuffer",i=new DataView(o)):o instanceof DataView&&(n="DataView",i=o),!i)return JSON.stringify(o);for(var t=[],l=0;l<o.byteLength;l++){if(l>20){t.push("...");break}var u=i.getUint8(l).toString(16);u.length===1&&(u="0"+u),t.push(u)}return"<"+n+" "+t.join(" ")+">"}function e(o,i,n){for(var t=0,l=n.length;t<l;t++){var u=n.charCodeAt(t);if(u<128){o.setUint8(i++,u>>>0&127|0);continue}if(u<2048){o.setUint8(i++,u>>>6&31|192),o.setUint8(i++,u>>>0&63|128);continue}if(u<65536){o.setUint8(i++,u>>>12&15|224),o.setUint8(i++,u>>>6&63|128),o.setUint8(i++,u>>>0&63|128);continue}if(u<1114112){o.setUint8(i++,u>>>18&7|240),o.setUint8(i++,u>>>12&63|128),o.setUint8(i++,u>>>6&63|128),o.setUint8(i++,u>>>0&63|128);continue}throw new Error("bad codepoint "+u)}}function b(o,i,n){for(var t="",l=i,u=i+n;l<u;l++){var d=o.getUint8(l);if(!(d&128)){t+=String.fromCharCode(d);continue}if((d&224)===192){t+=String.fromCharCode((d&15)<<6|o.getUint8(++l)&63);continue}if((d&240)===224){t+=String.fromCharCode((d&15)<<12|(o.getUint8(++l)&63)<<6|(o.getUint8(++l)&63)<<0);continue}if((d&248)===240){t+=String.fromCharCode((d&7)<<18|(o.getUint8(++l)&63)<<12|(o.getUint8(++l)&63)<<6|(o.getUint8(++l)&63)<<0);continue}throw new Error("Invalid byte "+d.toString(16))}return t}function S(o){for(var i=0,n=0,t=o.length;n<t;n++){var l=o.charCodeAt(n);if(l<128){i+=1;continue}if(l<2048){i+=2;continue}if(l<65536){i+=3;continue}if(l<1114112){i+=4;continue}throw new Error("bad codepoint "+l)}return i}function I(o,i){var n=g(o,i);if(n!==0){var t=new ArrayBuffer(n),l=new DataView(t);return c(o,l,0,i),t}}var w=65536*65536,y=1/w;function v(o,i){return i=i||0,o.getInt32(i)*w+o.getUint32(i+4)}function A(o,i){return i=i||0,o.getUint32(i)*w+o.getUint32(i+4)}function r(o,i,n){n<9223372036854776e3?(o.setInt32(i,Math.floor(n*y)),o.setInt32(i+4,n&-1)):(o.setUint32(i,2147483647),o.setUint32(i+4,2147483647))}function h(o,i,n){n<18446744073709552e3?(o.setUint32(i,Math.floor(n*y)),o.setInt32(i+4,n&-1)):(o.setUint32(i,4294967295),o.setUint32(i+4,4294967295))}var M=function(){function o(i,n){var t=this;this.map=function(l){for(var u={},d=0;d<l;d++){var U=t.parse();u[U]=t.parse()}return u},this.bin=function(l){var u=new ArrayBuffer(l);return new Uint8Array(u).set(new Uint8Array(t.view.buffer,t.offset,l),0),t.offset+=l,u},this.buf=this.bin,this.str=function(l){var u=b(t.view,t.offset,l);return t.offset+=l,u},this.array=function(l){for(var u=new Array(l),d=0;d<l;d++)u[d]=t.parse();return u},this.ext=function(l){return t.offset+=l,{type:t.view.getInt8(t.offset),data:t.buf(l)}},this.parse=function(){var l=t.view.getUint8(t.offset),u,d;if(!(l&128))return t.offset++,l;if((l&240)===128)return d=l&15,t.offset++,t.map(d);if((l&240)===144)return d=l&15,t.offset++,t.array(d);if((l&224)===160)return d=l&31,t.offset++,t.str(d);if((l&224)===224)return u=t.view.getInt8(t.offset),t.offset++,u;switch(l){case 192:return t.offset++,null;case 193:t.offset++;return;case 194:return t.offset++,!1;case 195:return t.offset++,!0;case 196:return d=t.view.getUint8(t.offset+1),t.offset+=2,t.bin(d);case 197:return d=t.view.getUint16(t.offset+1),t.offset+=3,t.bin(d);case 198:return d=t.view.getUint32(t.offset+1),t.offset+=5,t.bin(d);case 199:return d=t.view.getUint8(t.offset+1),t.offset+=2,t.ext(d);case 200:return d=t.view.getUint16(t.offset+1),t.offset+=3,t.ext(d);case 201:return d=t.view.getUint32(t.offset+1),t.offset+=5,t.ext(d);case 202:return u=t.view.getFloat32(t.offset+1),t.offset+=5,u;case 203:return u=t.view.getFloat64(t.offset+1),t.offset+=9,u;case 204:return u=t.view.getUint8(t.offset+1),t.offset+=2,u;case 205:return u=t.view.getUint16(t.offset+1),t.offset+=3,u;case 206:return u=t.view.getUint32(t.offset+1),t.offset+=5,u;case 207:return u=A(t.view,t.offset+1),t.offset+=9,u;case 208:return u=t.view.getInt8(t.offset+1),t.offset+=2,u;case 209:return u=t.view.getInt16(t.offset+1),t.offset+=3,u;case 210:return u=t.view.getInt32(t.offset+1),t.offset+=5,u;case 211:return u=v(t.view,t.offset+1),t.offset+=9,u;case 212:return d=1,t.offset++,t.ext(d);case 213:return d=2,t.offset++,t.ext(d);case 214:return d=4,t.offset++,t.ext(d);case 215:return d=8,t.offset++,t.ext(d);case 216:return d=16,t.offset++,t.ext(d);case 217:return d=t.view.getUint8(t.offset+1),t.offset+=2,t.str(d);case 218:return d=t.view.getUint16(t.offset+1),t.offset+=3,t.str(d);case 219:return d=t.view.getUint32(t.offset+1),t.offset+=5,t.str(d);case 220:return d=t.view.getUint16(t.offset+1),t.offset+=3,t.array(d);case 221:return d=t.view.getUint32(t.offset+1),t.offset+=5,t.array(d);case 222:return d=t.view.getUint16(t.offset+1),t.offset+=3,t.map(d);case 223:return d=t.view.getUint32(t.offset+1),t.offset+=5,t.map(d)}throw new Error("Unknown type 0x"+l.toString(16))},this.offset=n||0,this.view=i}return o}();function O(o){var i=new DataView(o),n=new M(i),t=n.parse();if(n.offset!==o.byteLength)throw new Error(o.byteLength-n.offset+" trailing bytes");return t}function p(o,i){return Object.keys(o).filter(function(n){var t=o[n],l=typeof t;return(!i||t!=null)&&(l!=="function"||!!t.toJSON)})}function c(o,i,n,t){var l=typeof o;if(typeof o=="string"){var u=S(o);if(u<32)return i.setUint8(n,u|160),e(i,n+1,o),1+u;if(u<256)return i.setUint8(n,217),i.setUint8(n+1,u),e(i,n+2,o),2+u;if(u<65536)return i.setUint8(n,218),i.setUint16(n+1,u),e(i,n+3,o),3+u;if(u<4294967296)return i.setUint8(n,219),i.setUint32(n+1,u),e(i,n+5,o),5+u}if(ArrayBuffer.isView&&ArrayBuffer.isView(o)&&(o=o.buffer),o instanceof ArrayBuffer){var d=o.byteLength;if(d<256)return i.setUint8(n,196),i.setUint8(n+1,d),new Uint8Array(i.buffer).set(new Uint8Array(o),n+2),2+d;if(d<65536)return i.setUint8(n,197),i.setUint16(n+1,d),new Uint8Array(i.buffer).set(new Uint8Array(o),n+3),3+d;if(d<4294967296)return i.setUint8(n,198),i.setUint32(n+1,d),new Uint8Array(i.buffer).set(new Uint8Array(o),n+5),5+d}if(typeof o=="number"){if(Math.floor(o)!==o)return i.setUint8(n,203),i.setFloat64(n+1,o),9;if(o>=0){if(o<128)return i.setUint8(n,o),1;if(o<256)return i.setUint8(n,204),i.setUint8(n+1,o),2;if(o<65536)return i.setUint8(n,205),i.setUint16(n+1,o),3;if(o<4294967296)return i.setUint8(n,206),i.setUint32(n+1,o),5;if(o<18446744073709552e3)return i.setUint8(n,207),h(i,n+1,o),9;throw new Error("Number too big 0x"+o.toString(16))}if(o>=-32)return i.setInt8(n,o),1;if(o>=-128)return i.setUint8(n,208),i.setInt8(n+1,o),2;if(o>=-32768)return i.setUint8(n,209),i.setInt16(n+1,o),3;if(o>=-2147483648)return i.setUint8(n,210),i.setInt32(n+1,o),5;if(o>=-9223372036854776e3)return i.setUint8(n,211),r(i,n+1,o),9;throw new Error("Number too small -0x"+(-o).toString(16).substr(1))}if(l==="undefined")return t?0:(i.setUint8(n,212),i.setUint8(n+1,0),i.setUint8(n+2,0),3);if(o===null)return t?0:(i.setUint8(n,192),1);if(l==="boolean")return i.setUint8(n,o?195:194),1;if(typeof o.toJSON=="function")return c(o.toJSON(),i,n,t);if(l==="object"){var U,L=0,D=void 0,E=Array.isArray(o);if(E?U=o.length:(D=p(o,t),U=D.length),U<16?(i.setUint8(n,U|(E?144:128)),L=1):U<65536?(i.setUint8(n,E?220:222),i.setUint16(n+1,U),L=3):U<4294967296&&(i.setUint8(n,E?221:223),i.setUint32(n+1,U),L=5),E)for(var T=0;T<U;T++)L+=c(o[T],i,n+L,t);else if(D)for(var T=0;T<U;T++){var R=D[T];L+=c(R,i,n+L),L+=c(o[R],i,n+L,t)}return L}if(l==="function")return 0;throw new Error("Unknown type "+l)}function g(o,i){var n=typeof o;if(n==="string"){var t=S(o);if(t<32)return 1+t;if(t<256)return 2+t;if(t<65536)return 3+t;if(t<4294967296)return 5+t}if(ArrayBuffer.isView&&ArrayBuffer.isView(o)&&(o=o.buffer),o instanceof ArrayBuffer){var l=o.byteLength;if(l<256)return 2+l;if(l<65536)return 3+l;if(l<4294967296)return 5+l}if(typeof o=="number"){if(Math.floor(o)!==o)return 9;if(o>=0){if(o<128)return 1;if(o<256)return 2;if(o<65536)return 3;if(o<4294967296)return 5;if(o<18446744073709552e3)return 9;throw new Error("Number too big 0x"+o.toString(16))}if(o>=-32)return 1;if(o>=-128)return 2;if(o>=-32768)return 3;if(o>=-2147483648)return 5;if(o>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+o.toString(16).substr(1))}if(n==="boolean")return 1;if(o===null)return i?0:1;if(o===void 0)return i?0:3;if(typeof o.toJSON=="function")return g(o.toJSON(),i);if(n==="object"){var u,d=0;if(Array.isArray(o)){u=o.length;for(var U=0;U<u;U++)d+=g(o[U],i)}else{var L=p(o,i);u=L.length;for(var U=0;U<u;U++){var D=L[U];d+=g(D)+g(o[D],i)}}if(u<16)return 1+d;if(u<65536)return 3+d;if(u<4294967296)return 5+d;throw new Error("Array or object too long 0x"+u.toString(16))}if(n==="function")return 0;throw new Error("Unknown type "+n)}s.default={encode:I,decode:O,inspect:f,utf8Write:e,utf8Read:b,utf8ByteCount:S}},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importDefault(a(30)),b=f.__importDefault(a(50)),S=f.__importDefault(a(3)),I=f.__importDefault(a(4)),w=f.__importDefault(a(55)),y=f.__importDefault(a(57)),v=f.__importDefault(a(62)),A=f.__importDefault(a(64)),r=f.__importDefault(a(68)),h=f.__importDefault(a(2)),M=a(8),O=f.__importDefault(a(65)),p=f.__importDefault(a(66)),c=f.__importDefault(a(41)),g=(0,y.default)(A.default,w.default);S.default.Crypto=g,S.default.BufferUtils=w.default,S.default.Http=v.default,S.default.Config=A.default,S.default.Transports=r.default,S.default.WebStorage=O.default,e.default.Crypto=g,b.default.Crypto=g,h.default.initLogHandlers(),S.default.Defaults=(0,M.getDefaults)(p.default),S.default.Config.agent&&(S.default.Defaults.agent+=" "+S.default.Config.agent),S.default.Config.noUpgrade&&(S.default.Defaults.upgradeTransports=[]),s.default={ErrorInfo:I.default,Rest:e.default,Realtime:b.default,msgpack:c.default}},function(P){P.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.50","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**","src/**","react/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.5","ws":"^8.14.2"},"peerDependencies":{"react":">=16.8.0","react-dom":">=16.8.0"},"peerDependenciesMeta":{"react":{"optional":true},"react-dom":{"optional":true}},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@arethetypeswrong/cli":"^0.13.1","@babel/preset-env":"^7.23.6","@testing-library/react":"^13.3.0","@types/crypto-js":"^4.0.1","@types/jmespath":"^0.15.2","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","@vitejs/plugin-react":"^1.3.2","async":"ably-forks/async#requirejs","aws-sdk":"^2.1413.0","babel-loader":"^8.3.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"^2.8.5","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-import":"^2.28.0","eslint-plugin-jsdoc":"^40.0.0","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.6.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","jmespath":"^0.16.0","jsdom":"^20.0.0","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","mocha-junit-reporter":"^2.2.1","null-loader":"^4.0.1","playwright":"^1.39.0","prettier":"^2.5.1","react":">=18.1.0","react-dom":">=18.1.0","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^4.0.1","tslib":"^2.3.1","typedoc":"^0.23.8","typescript":"^4.6.4","vite":"^4.4.9","vitest":"^0.18.0","webpack":"^4.44.2","webpack-cli":"^4.2.0","webpack-node-externals":"^3.0.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"build"},"main":"ably"},"scripts":{"start:react":"npx vite serve","grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:node:skip-build":"grunt mocha","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","test:react":"vitest run","concat":"grunt concat","build":"grunt build:all && npm run build:react","build:node":"grunt build:node","build:browser":"grunt build:browser","build:react":"npm run build:react:mjs && npm run build:react:cjs && cp src/platform/react-hooks/res/package.react.json react/package.json","build:react:mjs":"tsc --project src/platform/react-hooks/tsconfig.mjs.json && cp src/platform/react-hooks/res/package.mjs.json react/mjs/package.json","build:react:cjs":"tsc --project src/platform/react-hooks/tsconfig.cjs.json && cp src/platform/react-hooks/res/package.cjs.json react/cjs/package.json","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js docs/chrome-mv3.md","format:check":"prettier --check --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js","docs":"typedoc --entryPoints ably.d.ts --out docs/generated/default --readme docs/landing-pages/default.md && typedoc --entryPoints promises.d.ts --out docs/generated/promises --name \\"ably (Promise-based)\\" --readme docs/landing-pages/promises.md && cp docs/landing-pages/choose-library.html docs/generated/index.html"}}')},function(P,s){},function(P,s,a){(function(f,e){P.exports=e(a(6),a(32),a(25))})(this,function(f){return f.HmacSHA256})},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importStar(a(1)),b=f.__importDefault(a(47)),S=f.__importDefault(a(15)),I=f.__importDefault(a(20)),w=f.__importDefault(a(4)),y=f.__importDefault(a(48)),v=function(){},A=function(){function O(p){this.rest=p,this.admin=new r(p)}return O}(),r=function(){function O(p){this.rest=p,this.deviceRegistrations=new h(p),this.channelSubscriptions=new M(p)}return O.prototype.publish=function(p,c,g){var o=this.rest,i=o.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,n=e.defaultPostHeaders(o.options,i),t={},l=e.mixin({recipient:p},c);if(typeof g!="function"){if(this.rest.options.promises)return e.promisify(this,"publish",arguments);g=v}o.options.headers&&e.mixin(n,o.options.headers),o.options.pushFullWait&&e.mixin(t,{fullWait:"true"});var u=e.encodeBody(l,i);S.default.post(o,"/push/publish",u,n,t,null,function(d){return g(d)})},O}(),h=function(){function O(p){this.rest=p}return O.prototype.save=function(p,c){var g=this.rest,o=b.default.fromValues(p),i=g.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,n=e.defaultPostHeaders(g.options,i),t={};if(typeof c!="function"){if(this.rest.options.promises)return e.promisify(this,"save",arguments);c=v}g.options.headers&&e.mixin(n,g.options.headers),g.options.pushFullWait&&e.mixin(t,{fullWait:"true"});var l=e.encodeBody(o,i);S.default.put(g,"/push/deviceRegistrations/"+encodeURIComponent(p.id),l,n,t,null,function(u,d,U,L){c(u,u?void 0:b.default.fromResponseBody(d,L?void 0:i))})},O.prototype.get=function(p,c){var g=this.rest,o=g.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,i=e.defaultGetHeaders(g.options,o),n=p.id||p;if(typeof c!="function"){if(this.rest.options.promises)return e.promisify(this,"get",arguments);c=v}if(typeof n!="string"||!n.length){c(new w.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}g.options.headers&&e.mixin(i,g.options.headers),S.default.get(g,"/push/deviceRegistrations/"+encodeURIComponent(n),i,{},null,function(t,l,u,d){c(t,t?void 0:b.default.fromResponseBody(l,d?void 0:o))})},O.prototype.list=function(p,c){var g=this.rest,o=g.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,i=this.rest.http.supportsLinkHeaders?void 0:o,n=e.defaultGetHeaders(g.options,o);if(typeof c!="function"){if(this.rest.options.promises)return e.promisify(this,"list",arguments);c=v}g.options.headers&&e.mixin(n,g.options.headers),new I.default(g,"/push/deviceRegistrations",n,i,function(t,l,u){return b.default.fromResponseBody(t,u?void 0:o)}).get(p,c)},O.prototype.remove=function(p,c){var g=this.rest,o=g.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,i=e.defaultGetHeaders(g.options,o),n={},t=p.id||p;if(typeof c!="function"){if(this.rest.options.promises)return e.promisify(this,"remove",arguments);c=v}if(typeof t!="string"||!t.length){c(new w.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}g.options.headers&&e.mixin(i,g.options.headers),g.options.pushFullWait&&e.mixin(n,{fullWait:"true"}),S.default.delete(g,"/push/deviceRegistrations/"+encodeURIComponent(t),i,n,null,function(l){return c(l)})},O.prototype.removeWhere=function(p,c){var g=this.rest,o=g.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,i=e.defaultGetHeaders(g.options,o);if(typeof c!="function"){if(this.rest.options.promises)return e.promisify(this,"removeWhere",arguments);c=v}g.options.headers&&e.mixin(i,g.options.headers),g.options.pushFullWait&&e.mixin(p,{fullWait:"true"}),S.default.delete(g,"/push/deviceRegistrations",i,p,null,function(n){return c(n)})},O}(),M=function(){function O(p){this.remove=O.prototype.removeWhere,this.rest=p}return O.prototype.save=function(p,c){var g=this.rest,o=y.default.fromValues(p),i=g.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,n=e.defaultPostHeaders(g.options,i),t={};if(typeof c!="function"){if(this.rest.options.promises)return e.promisify(this,"save",arguments);c=v}g.options.headers&&e.mixin(n,g.options.headers),g.options.pushFullWait&&e.mixin(t,{fullWait:"true"});var l=e.encodeBody(o,i);S.default.post(g,"/push/channelSubscriptions",l,n,t,null,function(u,d,U,L){c(u,!u&&y.default.fromResponseBody(d,L?void 0:i))})},O.prototype.list=function(p,c){var g=this.rest,o=g.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,i=this.rest.http.supportsLinkHeaders?void 0:o,n=e.defaultGetHeaders(g.options,o);if(typeof c!="function"){if(this.rest.options.promises)return e.promisify(this,"list",arguments);c=v}g.options.headers&&e.mixin(n,g.options.headers),new I.default(g,"/push/channelSubscriptions",n,i,function(t,l,u){return y.default.fromResponseBody(t,u?void 0:o)}).get(p,c)},O.prototype.removeWhere=function(p,c){var g=this.rest,o=g.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,i=e.defaultGetHeaders(g.options,o);if(typeof c!="function"){if(this.rest.options.promises)return e.promisify(this,"removeWhere",arguments);c=v}g.options.headers&&e.mixin(i,g.options.headers),g.options.pushFullWait&&e.mixin(p,{fullWait:"true"}),S.default.delete(g,"/push/channelSubscriptions",i,p,null,function(n){return c(n)})},O.prototype.listChannels=function(p,c){var g=this.rest,o=g.options.useBinaryProtocol?e.Format.msgpack:e.Format.json,i=this.rest.http.supportsLinkHeaders?void 0:o,n=e.defaultGetHeaders(g.options,o);if(typeof c!="function"){if(this.rest.options.promises)return e.promisify(this,"listChannels",arguments);c=v}g.options.headers&&e.mixin(n,g.options.headers),g.options.pushFullWait&&e.mixin(p,{fullWait:"true"}),new I.default(g,"/push/channels",n,i,function(t,l,u){for(var d=!u&&o?e.decodeBody(t,o):t,U=0;U<d.length;U++)d[U]=String(d[U]);return d}).get(p,c)},O}();s.default=A},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importStar(a(1)),b=f.__importDefault(a(4)),S;(function(y){y.Phone="phone",y.Tablet="tablet",y.Desktop="desktop",y.TV="tv",y.Watch="watch",y.Car="car",y.Embedded="embedded",y.Other="other"})(S||(S={}));var I;(function(y){y.Android="android",y.IOS="ios",y.Browser="browser"})(I||(I={}));var w=function(){function y(){}return y.prototype.toJSON=function(){var v,A,r;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(v=this.push)===null||v===void 0?void 0:v.recipient,state:(A=this.push)===null||A===void 0?void 0:A.state,error:(r=this.push)===null||r===void 0?void 0:r.error}}},y.prototype.toString=function(){var v,A,r,h,M="[DeviceDetails";return this.id&&(M+="; id="+this.id),this.platform&&(M+="; platform="+this.platform),this.formFactor&&(M+="; formFactor="+this.formFactor),this.clientId&&(M+="; clientId="+this.clientId),this.metadata&&(M+="; metadata="+this.metadata),this.deviceIdentityToken&&(M+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((v=this.push)===null||v===void 0)&&v.recipient&&(M+="; push.recipient="+JSON.stringify(this.push.recipient)),!((A=this.push)===null||A===void 0)&&A.state&&(M+="; push.state="+this.push.state),!((r=this.push)===null||r===void 0)&&r.error&&(M+="; push.error="+JSON.stringify(this.push.error)),!((h=this.push)===null||h===void 0)&&h.metadata&&(M+="; push.metadata="+this.push.metadata),M+="]",M},y.fromResponseBody=function(v,A){return A&&(v=e.decodeBody(v,A)),e.isArray(v)?y.fromValuesArray(v):y.fromValues(v)},y.fromValues=function(v){return v.error=v.error&&b.default.fromValues(v.error),Object.assign(new y,v)},y.fromValuesArray=function(v){for(var A=v.length,r=new Array(A),h=0;h<A;h++)r[h]=y.fromValues(v[h]);return r},y.toRequestBody=e.encodeBody,y}();s.default=w},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importStar(a(1)),b=function(){function S(){}return S.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},S.prototype.toString=function(){var I="[PushChannelSubscription";return this.channel&&(I+="; channel="+this.channel),this.deviceId&&(I+="; deviceId="+this.deviceId),this.clientId&&(I+="; clientId="+this.clientId),I+="]",I},S.fromResponseBody=function(I,w){return w&&(I=e.decodeBody(I,w)),e.isArray(I)?S.fromValuesArray(I):S.fromValues(I)},S.fromValues=function(I){return Object.assign(new S,I)},S.fromValuesArray=function(I){for(var w=I.length,y=new Array(w),v=0;v<w;v++)y[v]=S.fromValues(I[v]);return y},S.toRequestBody=e.encodeBody,S}();s.default=b},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importStar(a(1)),b=function(){function g(o){this.count=o&&o.count||0,this.data=o&&o.data||0,this.uncompressedData=o&&o.uncompressedData||0,this.failed=o&&o.failed||0,this.refused=o&&o.refused||0}return g}(),S=function(g){f.__extends(o,g);function o(i){var n=g.call(this,i)||this;return i&&i.category&&(n.category={},e.forInOwnNonNullProperties(i.category,function(t){n.category[t]=new b(i.category[t])})),n}return o}(b),I=function(){function g(o){this.peak=o&&o.peak||0,this.min=o&&o.min||0,this.mean=o&&o.mean||0,this.opened=o&&o.opened||0,this.refused=o&&o.refused||0}return g}(),w=function(){function g(o){this.succeeded=o&&o.succeeded||0,this.failed=o&&o.failed||0,this.refused=o&&o.refused||0}return g}(),y=function(){function g(o){this.plain=new I(o&&o.plain),this.tls=new I(o&&o.tls),this.all=new I(o&&o.all)}return g}(),v=function(){function g(o){this.messages=new S(o&&o.messages),this.presence=new S(o&&o.presence),this.all=new S(o&&o.all)}return g}(),A=function(){function g(o){this.realtime=new v(o&&o.realtime),this.rest=new v(o&&o.rest),this.webhook=new v(o&&o.webhook),this.sharedQueue=new v(o&&o.sharedQueue),this.externalQueue=new v(o&&o.externalQueue),this.httpEvent=new v(o&&o.httpEvent),this.push=new v(o&&o.push),this.all=new v(o&&o.all)}return g}(),r=function(){function g(o){this.all=new v(o&&o.all),this.inbound=new A(o&&o.inbound),this.outbound=new A(o&&o.outbound)}return g}(),h=function(){function g(o){this.all=new v(o&&o.all),this.producerPaid=new r(o&&o.producerPaid),this.consumerPaid=new r(o&&o.consumerPaid)}return g}(),M=function(){function g(o){this.messages=o&&o.messages||0;var i=o&&o.notifications;this.notifications={invalid:i&&i.invalid||0,attempted:i&&i.attempted||0,successful:i&&i.successful||0,failed:i&&i.failed||0},this.directPublishes=o&&o.directPublishes||0}return g}(),O=function(){function g(o){this.succeeded=o&&o.succeeded||0,this.skipped=o&&o.skipped||0,this.failed=o&&o.failed||0}return g}(),p=function(){function g(o){var i=this;this.delta=void 0,o&&o.delta&&(this.delta={},e.forInOwnNonNullProperties(o.delta,function(n){i.delta[n]=new O(o.delta[n])}))}return g}(),c=function(g){f.__extends(o,g);function o(i){var n=g.call(this,i)||this;return n.persisted=new v(i&&i.persisted),n.connections=new y(i&&i.connections),n.channels=new I(i&&i.channels),n.apiRequests=new w(i&&i.apiRequests),n.tokenRequests=new w(i&&i.tokenRequests),n.xchgProducer=new h(i&&i.xchgProducer),n.xchgConsumer=new h(i&&i.xchgConsumer),n.push=new M(i&&i.pushStats),n.processed=new p(i&&i.processed),n.inProgress=i&&i.inProgress||void 0,n.unit=i&&i.unit||void 0,n.intervalId=i&&i.intervalId||void 0,n}return o.fromValues=function(i){return new o(i)},o}(r);s.default=c},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importStar(a(1)),b=f.__importDefault(a(30)),S=f.__importDefault(a(7)),I=f.__importDefault(a(2)),w=f.__importDefault(a(51)),y=f.__importDefault(a(38)),v=f.__importDefault(a(8)),A=f.__importDefault(a(4)),r=f.__importDefault(a(10)),h=f.__importDefault(a(35)),M=f.__importDefault(a(3)),O=f.__importDefault(a(9)),p=function(g){f.__extends(o,g);function o(i){var n=g.call(this,i)||this;return I.default.logAction(I.default.LOG_MINOR,"Realtime()",""),n.connection=new w.default(n,n.options),n.channels=new c(n),i.autoConnect!==!1&&n.connect(),n}return o.prototype.connect=function(){I.default.logAction(I.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},o.prototype.close=function(){I.default.logAction(I.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},o.Promise=function(i){return i=v.default.objectifyOptions(i),i.promises=!0,new o(i)},o.Callbacks=o,o.Utils=e,o.ConnectionManager=h.default,o.Platform=M.default,o.ProtocolMessage=r.default,o.Message=O.default,o}(b.default),c=function(g){f.__extends(o,g);function o(i){var n=g.call(this)||this;return n.realtime=i,n.all=Object.create(null),i.connection.connectionManager.on("transport.active",function(){n.onTransportActive()}),n}return o.prototype.channelSerials=function(){for(var i={},n=0,t=e.keysArray(this.all,!0);n<t.length;n++){var l=t[n],u=this.all[l];u.properties.channelSerial&&(i[l]=u.properties.channelSerial)}return i},o.prototype.recoverChannels=function(i){for(var n=0,t=e.keysArray(i,!0);n<t.length;n++){var l=t[n],u=this.get(l);u.properties.channelSerial=i[l]}},o.prototype.onChannelMessage=function(i){var n=i.channel;if(n===void 0){I.default.logAction(I.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+i.action);return}var t=this.all[n];if(!t){I.default.logAction(I.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+n);return}t.onMessage(i)},o.prototype.onTransportActive=function(){for(var i in this.all){var n=this.all[i];n.state==="attaching"||n.state==="detaching"?n.checkPendingState():n.state==="suspended"?n._attach(!1,null):n.state==="attached"&&n.requestState("attaching")}},o.prototype.propogateConnectionInterruption=function(i,n){var t={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},l=["attaching","attached","detaching","suspended"],u=t[i];for(var d in this.all){var U=this.all[d];e.arrIn(l,U.state)&&U.notifyState(u,n)}},o.prototype.get=function(i,n){i=String(i);var t=this.all[i];if(!t)t=this.all[i]=new y.default(this.realtime,i,n);else if(n){if(t._shouldReattachToSetOptions(n,t.channelOptions))throw new A.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);t.setOptions(n)}return t},o.prototype.getDerived=function(i,n,t){if(n.filter){var l=e.toBase64(n.filter),u=e.matchDerivedChannel(i);i="[filter=".concat(l).concat(u.qualifierParam,"]").concat(u.channelName)}return this.get(i,t)},o.prototype.release=function(i){i=String(i);var n=this.all[i];if(n){var t=n.getReleaseErr();if(t)throw t;delete this.all[i]}},o}(S.default);s.default=p},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importStar(a(1)),b=f.__importDefault(a(7)),S=f.__importDefault(a(35)),I=f.__importDefault(a(2)),w=f.__importDefault(a(37)),y=f.__importDefault(a(3));function v(){}var A=function(r){f.__extends(h,r);function h(M,O){var p=r.call(this)||this;return p.whenState=function(c,g){return b.default.prototype.whenState.call(p,c,p.state,g,new w.default(void 0,c))},p.ably=M,p.connectionManager=new S.default(M,O),p.state=p.connectionManager.state.state,p.key=void 0,p.id=void 0,p.errorReason=null,p.connectionManager.on("connectionstate",function(c){var g=p.state=c.current;y.default.Config.nextTick(function(){p.emit(g,c)})}),p.connectionManager.on("update",function(c){y.default.Config.nextTick(function(){p.emit("update",c)})}),p}return h.prototype.connect=function(){I.default.logAction(I.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},h.prototype.ping=function(M){if(I.default.logAction(I.default.LOG_MINOR,"Connection.ping()",""),!M){if(this.ably.options.promises)return e.promisify(this,"ping",arguments);M=v}this.connectionManager.ping(null,M)},h.prototype.close=function(){I.default.logAction(I.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},Object.defineProperty(h.prototype,"recoveryKey",{get:function(){return this.createRecoveryKey()},enumerable:!1,configurable:!0}),h.prototype.createRecoveryKey=function(){return this.connectionManager.createRecoveryKey()},h}(b.default);s.default=A},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0}),s.PendingMessage=void 0;var f=a(0),e=f.__importDefault(a(10)),b=f.__importStar(a(1)),S=f.__importDefault(a(7)),I=f.__importDefault(a(2)),w=f.__importDefault(a(36)),y=f.__importDefault(a(4)),v=e.default.Action,A=function(){function h(M,O){this.message=M,this.callback=O,this.merged=!1;var p=M.action;this.sendAttempted=!1,this.ackRequired=p==v.MESSAGE||p==v.PRESENCE}return h}();s.PendingMessage=A;var r=function(h){f.__extends(M,h);function M(O){var p=h.call(this)||this;return p.transport=O,p.messageQueue=new w.default,O.on("ack",function(c,g){p.onAck(c,g)}),O.on("nack",function(c,g,o){p.onNack(c,g,o)}),p}return M.prototype.onAck=function(O,p){I.default.logAction(I.default.LOG_MICRO,"Protocol.onAck()","serial = "+O+"; count = "+p),this.messageQueue.completeMessages(O,p)},M.prototype.onNack=function(O,p,c){I.default.logAction(I.default.LOG_ERROR,"Protocol.onNack()","serial = "+O+"; count = "+p+"; err = "+b.inspectError(c)),c||(c=new y.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(O,p,c)},M.prototype.onceIdle=function(O){var p=this.messageQueue;if(p.count()===0){O();return}p.once("idle",O)},M.prototype.send=function(O){O.ackRequired&&this.messageQueue.push(O),I.default.shouldLog(I.default.LOG_MICRO)&&I.default.logAction(I.default.LOG_MICRO,"Protocol.send()","sending msg; "+e.default.stringify(O.message)),O.sendAttempted=!0,this.transport.send(O.message)},M.prototype.getTransport=function(){return this.transport},M.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},M.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},M.prototype.finish=function(){var O=this.transport;this.onceIdle(function(){O.disconnect()})},M}(S.default);s.default=r},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importDefault(a(3)),b=f.__importStar(a(1)),S=f.__importDefault(a(26)),I=f.__importDefault(a(8)),w=f.__importDefault(a(2)),y=f.__importDefault(a(10)),v=f.__importDefault(a(4)),A="web_socket";function r(O){return!!O.on}var h=function(O){f.__extends(p,O);function p(c,g,o){var i=O.call(this,c,g,o)||this;return i.shortName=A,o.heartbeats=e.default.Config.useProtocolHeartbeats,i.wsHost=I.default.getHost(o.options,o.host,!0),i}return p.isAvailable=function(){return!!e.default.Config.WebSocket},p.prototype.createWebSocket=function(c,g){return this.uri=c+b.toQueryString(g),new e.default.Config.WebSocket(this.uri)},p.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},p.prototype.connect=function(){w.default.logAction(w.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),S.default.prototype.connect.call(this);var c=this,g=this.params,o=g.options,i=o.tls?"wss://":"ws://",n=i+this.wsHost+":"+I.default.getPort(o)+"/";w.default.logAction(w.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+n),this.auth.getAuthParams(function(t,l){if(!c.isDisposed){var u="";for(var d in l)u+=" "+d+": "+l[d]+";";if(w.default.logAction(w.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+u+" err: "+t),t){c.disconnect(t);return}var U=g.getConnectParams(l);try{var L=c.wsConnection=c.createWebSocket(n,U);L.binaryType=e.default.Config.binaryType,L.onopen=function(){c.onWsOpen()},L.onclose=function(D){c.onWsClose(D)},L.onmessage=function(D){c.onWsData(D.data)},L.onerror=function(D){c.onWsError(D)},r(L)&&L.on("ping",function(){c.onActivity()})}catch(D){w.default.logAction(w.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(D.stack||D.message)),c.disconnect(D)}}})},p.prototype.send=function(c){var g=this.wsConnection;if(!g){w.default.logAction(w.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{g.send(y.default.serialize(c,this.params.format))}catch(i){var o="Exception from ws connection when trying to send: "+b.inspectError(i);w.default.logAction(w.default.LOG_ERROR,"WebSocketTransport.send()",o),this.finish("disconnected",new v.default(o,5e4,500))}},p.prototype.onWsData=function(c){w.default.logAction(w.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+c.length+"; type = "+typeof c);try{this.onProtocolMessage(y.default.deserialize(c,this.format))}catch(g){w.default.logAction(w.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+g.stack)}},p.prototype.onWsOpen=function(){w.default.logAction(w.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},p.prototype.onWsClose=function(c){var g,o;if(typeof c=="object"?(o=c.code,g=c.wasClean||o===1e3):(o=c,g=o==1e3),delete this.wsConnection,g){w.default.logAction(w.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var i=new v.default("Websocket closed",80003,400);this.finish("disconnected",i)}else{var n="Unclean disconnection of WebSocket ; code = "+o,i=new v.default(n,80003,400);w.default.logAction(w.default.LOG_MINOR,"WebSocketTransport.onWsClose()",n),this.finish("disconnected",i)}this.emit("disposed")},p.prototype.onWsError=function(c){var g=this;w.default.logAction(w.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+c.message),e.default.Config.nextTick(function(){g.disconnect(Error(c.message))})},p.prototype.dispose=function(){w.default.logAction(w.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var c=this.wsConnection;c&&(c.onmessage=function(){},delete this.wsConnection,e.default.Config.nextTick(function(){if(w.default.logAction(w.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!c)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");c.close()}))},p}(S.default);function M(O){return h.isAvailable()&&(O.supportedTransports[A]=h),h}s.default=M},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importStar(a(1)),b=f.__importDefault(a(34)),S=f.__importDefault(a(7)),I=f.__importDefault(a(2)),w=f.__importDefault(a(16)),y=f.__importStar(a(4)),v=f.__importDefault(a(38)),A=f.__importDefault(a(24)),r=f.__importDefault(a(39)),h=function(){};function M(i){return i.channel.realtime.auth.clientId}function O(i){var n=i.channel.realtime,t=n.auth.clientId;return(!t||t==="*")&&n.connection.state==="connected"}function p(i,n,t){switch(i.state){case"attached":case"suspended":t();break;case"initialized":case"detached":case"detaching":case"attaching":i.attach(function(l){l?n(l):t()});break;default:n(y.default.fromValues(i.invalidStateError()))}}function c(i,n){if(i.isSynthesized()||n.isSynthesized())return i.timestamp>=n.timestamp;var t=i.parseId(),l=n.parseId();return t.msgSerial===l.msgSerial?t.index>l.index:t.msgSerial>l.msgSerial}var g=function(i){f.__extends(n,i);function n(t){var l=i.call(this,t)||this;return l.channel=t,l.syncComplete=!1,l.members=new o(l,function(u){return u.clientId+":"+u.connectionId}),l._myMembers=new o(l,function(u){return u.clientId}),l.subscriptions=new S.default,l.pendingPresence=[],l}return n.prototype.enter=function(t,l){if(O(this))throw new y.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,t,"enter",l)},n.prototype.update=function(t,l){if(O(this))throw new y.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,t,"update",l)},n.prototype.enterClient=function(t,l,u){return this._enterOrUpdateClient(void 0,t,l,"enter",u)},n.prototype.updateClient=function(t,l,u){return this._enterOrUpdateClient(void 0,t,l,"update",u)},n.prototype._enterOrUpdateClient=function(t,l,u,d,U){var L=this;if(!U)if(typeof u=="function")U=u,u=null;else{if(this.channel.realtime.options.promises)return e.promisify(this,"_enterOrUpdateClient",[t,l,u,d]);U=h}var D=this.channel;if(!D.connectionManager.activeState()){U(D.connectionManager.getError());return}I.default.logAction(I.default.LOG_MICRO,"RealtimePresence."+d+"Client()","channel = "+D.name+", id = "+t+", client = "+(l||"(implicit) "+M(this)));var E=w.default.fromData(u);E.action=d,t&&(E.id=t),l&&(E.clientId=l),w.default.encode(E,D.channelOptions,function(T){if(T){U(T);return}switch(D.state){case"attached":D.sendPresence(E,U);break;case"initialized":case"detached":D.attach();case"attaching":L.pendingPresence.push({presence:E,callback:U});break;default:T=new y.PartialErrorInfo("Unable to "+d+" presence channel while in "+D.state+" state",90001),T.code=90001,U(T)}})},n.prototype.leave=function(t,l){if(O(this))throw new y.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,t,l)},n.prototype.leaveClient=function(t,l,u){if(!u)if(typeof l=="function")u=l,l=null;else{if(this.channel.realtime.options.promises)return e.promisify(this,"leaveClient",[t,l]);u=h}var d=this.channel;if(!d.connectionManager.activeState()){u==null||u(d.connectionManager.getError());return}I.default.logAction(I.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+t);var U=w.default.fromData(l);switch(U.action="leave",t&&(U.clientId=t),d.state){case"attached":d.sendPresence(U,u);break;case"attaching":this.pendingPresence.push({presence:U,callback:u});break;case"initialized":case"failed":{var L=new y.PartialErrorInfo("Unable to leave presence channel (incompatible state)",90001);u==null||u(L);break}default:u==null||u(d.invalidStateError())}},n.prototype.get=function(t,l){var u=this,d=Array.prototype.slice.call(arguments);d.length==1&&typeof d[0]=="function"&&d.unshift(null),t=d[0],l=d[1];var U=!t||("waitForSync"in t?t.waitForSync:!0);if(!l){if(this.channel.realtime.options.promises)return e.promisify(this,"get",d);l=h}function L(D){l(null,t?D.list(t):D.values())}if(this.channel.state==="suspended"){U?l(y.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):L(this.members);return}p(this.channel,l,function(){var D=u.members;U?D.waitSync(function(){L(D)}):L(D)})},n.prototype.history=function(t,l){if(I.default.logAction(I.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),l===void 0)if(typeof t=="function")l=t,t=null;else{if(this.channel.realtime.options.promises)return e.promisify(this,"history",arguments);l=h}t&&t.untilAttach&&(this.channel.state==="attached"?(delete t.untilAttach,t.from_serial=this.channel.properties.attachSerial):l(new y.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),b.default.prototype._history.call(this,t,l)},n.prototype.setPresence=function(t,l,u){I.default.logAction(I.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+t.length+" participants; syncChannelSerial = "+u);var d,U,L=this.members,D=this._myMembers,E=[],T=this.channel.connectionManager.connectionId;l&&(this.members.startSync(),u&&(U=u.match(/^[\w-]+:(.*)$/))&&(d=U[1]));for(var R=0;R<t.length;R++){var j=w.default.fromValues(t[R]);switch(j.action){case"leave":L.remove(j)&&E.push(j),j.connectionId===T&&!j.isSynthesized()&&D.remove(j);break;case"enter":case"present":case"update":L.put(j)&&E.push(j),j.connectionId===T&&D.put(j);break}}l&&!d&&(L.endSync(),this.channel.syncChannelSerial=null);for(var R=0;R<E.length;R++){var j=E[R];this.subscriptions.emit(j.action,j)}},n.prototype.onAttached=function(t){I.default.logAction(I.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+t),t?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();var l=this.pendingPresence,u=l.length;if(u){this.pendingPresence=[];var d=[],U=A.default.create();I.default.logAction(I.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+u+" queued presence messages");for(var L=0;L<u;L++){var D=l[L];d.push(D.presence),U.push(D.callback)}this.channel.sendPresence(d,U)}},n.prototype.actOnChannelState=function(t,l,u){switch(t){case"attached":this.onAttached(l);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(u);break}},n.prototype.failPendingPresence=function(t){if(this.pendingPresence.length){I.default.logAction(I.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+e.inspectError(t));for(var l=0;l<this.pendingPresence.length;l++)try{this.pendingPresence[l].callback(t)}catch{}this.pendingPresence=[]}},n.prototype._clearMyMembers=function(){this._myMembers.clear()},n.prototype._ensureMyMembersPresent=function(){var t=this,l=this._myMembers,u=function(L){if(L){var D="Presence auto-re-enter failed: "+L.toString(),E=new y.default(D,91004,400);I.default.logAction(I.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",D);var T=new r.default(t.channel.state,t.channel.state,!0,!1,E);t.channel.emit("update",T)}};for(var d in l.map){var U=l.map[d];I.default.logAction(I.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+U.clientId+'" into the presence set'),this._enterOrUpdateClient(U.id,U.clientId,U.data,"enter",u)}},n.prototype._synthesizeLeaves=function(t){var l=this.subscriptions;e.arrForEach(t,function(u){var d=w.default.fromValues({action:"leave",connectionId:u.connectionId,clientId:u.clientId,data:u.data,encoding:u.encoding,timestamp:e.now()});l.emit("leave",d)})},n.prototype.on=function(){for(var t=[],l=0;l<arguments.length;l++)t[l]=arguments[l];I.default.renamedMethod("RealtimePresence","on","subscribe"),this.subscribe.apply(this,t)},n.prototype.off=function(){for(var t=[],l=0;l<arguments.length;l++)t[l]=arguments[l];I.default.renamedMethod("RealtimePresence","off","unsubscribe"),this.unsubscribe.apply(this,t)},n.prototype.subscribe=function(){for(var t=[],l=0;l<arguments.length;l++)t[l]=arguments[l];var u=v.default.processListenerArgs(t),d=u[0],U=u[1],L=u[2],D=this.channel;if(!L){if(this.channel.realtime.options.promises)return e.promisify(this,"subscribe",[d,U]);L=h}if(D.state==="failed"){L(y.default.fromValues(D.invalidStateError()));return}this.subscriptions.on(d,U),D.attach(L)},n.prototype.unsubscribe=function(){for(var t=[],l=0;l<arguments.length;l++)t[l]=arguments[l];var u=v.default.processListenerArgs(t),d=u[0],U=u[1];this.subscriptions.off(d,U)},n}(b.default),o=function(i){f.__extends(n,i);function n(t,l){var u=i.call(this)||this;return u.presence=t,u.map=Object.create(null),u.syncInProgress=!1,u.residualMembers=null,u.memberKey=l,u}return n.prototype.get=function(t){return this.map[t]},n.prototype.getClient=function(t){var l=this.map,u=[];for(var d in l){var U=l[d];U.clientId==t&&U.action!="absent"&&u.push(U)}return u},n.prototype.list=function(t){var l=this.map,u=t&&t.clientId,d=t&&t.connectionId,U=[];for(var L in l){var D=l[L];D.action!=="absent"&&(u&&u!=D.clientId||d&&d!=D.connectionId||U.push(D))}return U},n.prototype.put=function(t){(t.action==="enter"||t.action==="update")&&(t=w.default.fromValues(t),t.action="present");var l=this.map,u=this.memberKey(t);this.residualMembers&&delete this.residualMembers[u];var d=l[u];return d&&!c(t,d)?!1:(l[u]=t,!0)},n.prototype.values=function(){var t=this.map,l=[];for(var u in t){var d=t[u];d.action!="absent"&&l.push(d)}return l},n.prototype.remove=function(t){var l=this.map,u=this.memberKey(t),d=l[u];return d&&!c(t,d)?!1:(this.syncInProgress?(t=w.default.fromValues(t),t.action="absent",l[u]=t):delete l[u],!0)},n.prototype.startSync=function(){var t=this.map,l=this.syncInProgress;I.default.logAction(I.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+l),this.syncInProgress||(this.residualMembers=e.copy(t),this.setInProgress(!0))},n.prototype.endSync=function(){var t=this.map,l=this.syncInProgress;if(I.default.logAction(I.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+l),l){for(var u in t){var d=t[u];d.action==="absent"&&delete t[u]}this.presence._synthesizeLeaves(e.valuesArray(this.residualMembers));for(var u in this.residualMembers)delete t[u];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},n.prototype.waitSync=function(t){var l=this.syncInProgress;if(I.default.logAction(I.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+l),!l){t();return}this.once("sync",t)},n.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},n.prototype.setInProgress=function(t){I.default.logAction(I.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+t),this.syncInProgress=t,this.presence.syncComplete=!t},n}(S.default);s.default=g},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=a(56),b=a(31),S=a(11),I=f.__importDefault(a(5)),w=f.__importDefault(a(3)),y=function(){function v(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return v.prototype.isWordArray=function(A){return A!=null&&A.sigBytes!==void 0},v.prototype.isArrayBuffer=function(A){return A!=null&&A.constructor===ArrayBuffer},v.prototype.isTypedArray=function(A){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(A)},v.prototype.uint8ViewToBase64=function(A){for(var r="",h=this.base64CharSet,M=A.byteLength,O=M%3,p=M-O,c,g,o,i,n,t=0;t<p;t=t+3)n=A[t]<<16|A[t+1]<<8|A[t+2],c=(n&16515072)>>18,g=(n&258048)>>12,o=(n&4032)>>6,i=n&63,r+=h[c]+h[g]+h[o]+h[i];return O==1?(n=A[p],c=(n&252)>>2,g=(n&3)<<4,r+=h[c]+h[g]+"=="):O==2&&(n=A[p]<<8|A[p+1],c=(n&64512)>>10,g=(n&1008)>>4,o=(n&15)<<2,r+=h[c]+h[g]+h[o]+"="),r},v.prototype.base64ToArrayBuffer=function(A){for(var r=atob==null?void 0:atob(A),h=r.length,M=new Uint8Array(h),O=0;O<h;O++){var p=r.charCodeAt(O);M[O]=p}return M.buffer},v.prototype.isBuffer=function(A){return this.isArrayBuffer(A)||this.isWordArray(A)||this.isTypedArray(A)},v.prototype.toBuffer=function(A){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(A))return new Uint8Array(A);if(this.isTypedArray(A))return new Uint8Array(A.buffer);if(this.isWordArray(A)){for(var r=new ArrayBuffer(A.sigBytes),h=new Uint8Array(r),M=0;M<A.sigBytes;M++)h[M]=A.words[M>>>2]>>>24-M%4*8&255;return h}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},v.prototype.toArrayBuffer=function(A){return this.isArrayBuffer(A)?A:this.toBuffer(A).buffer},v.prototype.toWordArray=function(A){return this.isTypedArray(A)&&(A=A.buffer),this.isWordArray(A)?A:I.default.create(A)},v.prototype.base64Encode=function(A){return this.isWordArray(A)?(0,S.stringify)(A):this.uint8ViewToBase64(this.toBuffer(A))},v.prototype.base64Decode=function(A){return ArrayBuffer&&w.default.Config.atob?this.base64ToArrayBuffer(A):(0,S.parse)(A)},v.prototype.hexEncode=function(A){return(0,e.stringify)(this.toWordArray(A))},v.prototype.hexDecode=function(A){var r=(0,e.parse)(A);return ArrayBuffer?this.toArrayBuffer(r):r},v.prototype.utf8Encode=function(A){return w.default.Config.TextEncoder?new w.default.Config.TextEncoder().encode(A).buffer:(0,b.parse)(A)},v.prototype.utf8Decode=function(A){if(!this.isBuffer(A))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(A)?new TextDecoder().decode(A):(A=this.toWordArray(A),(0,b.stringify)(A))},v.prototype.bufferCompare=function(A,r){if(!A)return-1;if(!r)return 1;var h=this.toWordArray(A),M=this.toWordArray(r);h.clamp(),M.clamp();var O=h.sigBytes-M.sigBytes;if(O!=0)return O;for(var p=h.words,c=M.words,g=0;g<p.length;g++)if(O=p[g]-c[g],O!=0)return O;return 0},v.prototype.byteLength=function(A){return this.isArrayBuffer(A)||this.isTypedArray(A)?A.byteLength:this.isWordArray(A)?A.sigBytes:-1},v.prototype.typedArrayToBuffer=function(A){return A.buffer},v}();s.default=new y},function(P,s,a){(function(f,e){P.exports=e(a(6))})(this,function(f){return f.enc.Hex})},function(P,s,a){a.r(s);var f=a(5),e=a.n(f),b=a(11),S=a(23),I=a.n(S),w=a(2),y=a.n(w),v=a(4),A=a.n(v),r=function(h,M){var O="aes",p=256,c="cbc",g=16,o=4,i=4294967296,n=2147483648,t;if(h.getRandomWordArray)t=h.getRandomWordArray;else if(typeof Uint32Array<"u"&&h.getRandomValues){var l=new Uint32Array(o);t=function(R,j){var G=R/4,k=G==o?l:new Uint32Array(G);h.getRandomValues(k,function(J){typeof j<"u"&&j(J,M.toWordArray(k))})}}else t=function(R,j){y.a.logAction(y.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var G=R/4,k=new Array(G),J=0;J<G;J++)k[J]=Math.floor(Math.random()*i)-n;j(null,e.a.create(k))};function u(R){return R+g&-g}function d(R){if(R.algorithm==="aes"&&R.mode==="cbc"){if(R.keyLength===128||R.keyLength===256)return;throw new Error("Unsupported key length "+R.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function U(R){return R.replace("_","/").replace("-","+")}var L=[e.a.create([269488144,269488144,269488144,269488144],16),e.a.create([16777216],1),e.a.create([33685504],2),e.a.create([50529024],3),e.a.create([67372036],4),e.a.create([84215045,83886080],5),e.a.create([101058054,101056512],6),e.a.create([117901063,117901056],7),e.a.create([134744072,134744072],8),e.a.create([151587081,151587081,150994944],9),e.a.create([168430090,168430090,168427520],10),e.a.create([185273099,185273099,185273088],11),e.a.create([202116108,202116108,202116108],12),e.a.create([218959117,218959117,218959117,218103808],13),e.a.create([235802126,235802126,235802126,235798528],14),e.a.create([252645135,252645135,252645135,252645135],15),e.a.create([269488144,269488144,269488144,269488144],16)];function D(){}function E(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}D.CipherParams=E,D.getDefaultParams=function(R){var j;if(typeof R=="function"||typeof R=="string"){if(y.a.deprecated("The ability to pass a callback to `Crypto.getDefaultParams()`","This method now directly returns its result, instead of returning it asynchronously via a callback. Please update your code so that it uses the return value of this method instead of passing a callback."),typeof R=="function")y.a.deprecated("The ability to call `Crypto.getDefaultParams()` without specifying an encryption key","Please update your code so that it instead passes an object whose `key` property contains an encryption key. That is, replace `Crypto.getDefaultParams()` with `Crypto.getDefaultParams({ key })`, where `key` is an encryption key that you have generated (for example from the `Crypto.generateRandomKey()` method)."),D.generateRandomKey(function(k){R(null,D.getDefaultParams({key:k}))});else if(typeof arguments[1]=="function")y.a.deprecated("The ability to pass the encryption key as the first argument of `Crypto.getDefaultParams()`","Please update your code so that it instead passes an object whose `key` property contains the key. That is, replace `Crypto.getDefaultParams(key)` with `Crypto.getDefaultParams({ key })`."),arguments[1](null,D.getDefaultParams({key:R}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!R.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof R.key=="string"?j=Object(b.parse)(U(R.key)):j=M.toWordArray(R.key);var G=new E;if(G.key=j,G.algorithm=R.algorithm||O,G.keyLength=j.words.length*(4*8),G.mode=R.mode||c,R.keyLength&&R.keyLength!==G.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+R.keyLength+" was specified, but the key actually has length "+G.keyLength);return d(G),G},D.generateRandomKey=function(R,j){arguments.length==1&&typeof R=="function"&&(j=R,R=void 0),t((R||p)/8,function(G,k){j!==void 0&&j(G?A.a.fromValues(G):null,k)})},D.getCipher=function(R){var j=R instanceof E?R:D.getDefaultParams(R);return{cipherParams:j,cipher:new T(j,o,R.iv)}};function T(R,j,G){this.algorithm=R.algorithm+"-"+String(R.keyLength)+"-"+R.mode,this.cjsAlgorithm=R.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=M.toWordArray(R.key),G&&(this.iv=M.toWordArray(G).clone()),this.blockLengthWords=j}return T.prototype.encrypt=function(R,j){y.a.logAction(y.a.LOG_MICRO,"CBCCipher.encrypt()",""),R=M.toWordArray(R);var G=R.sigBytes,k=u(G),J=this,z=function(){J.getIv(function(_,C){if(_){j(_);return}var N=J.encryptCipher.process(R.concat(L[k-G])),B=C.concat(N);j(null,B)})};this.encryptCipher?z():this.iv?(this.encryptCipher=I.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),z()):t(g,function(_,C){if(_){j(_);return}J.encryptCipher=I.a.algo[J.cjsAlgorithm].createEncryptor(J.key,{iv:C}),J.iv=C,z()})},T.prototype.decrypt=function(R){y.a.logAction(y.a.LOG_MICRO,"CBCCipher.decrypt()",""),R=M.toWordArray(R);var j=this.blockLengthWords,G=R.words,k=e.a.create(G.slice(0,j)),J=e.a.create(G.slice(j)),z=I.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:k}),_=z.process(J),C=z.finalize();return z.reset(),C&&C.sigBytes&&_.concat(C),_},T.prototype.getIv=function(R){if(this.iv){var j=this.iv;this.iv=null,R(null,j);return}var G=this;t(g,function(k,J){if(k){R(k);return}R(null,G.encryptCipher.process(J))})},D};s.default=r},function(P,s,a){(function(f,e){P.exports=e(a(6))})(this,function(f){return function(){var e=f,b=e.lib,S=b.WordArray,I=e.enc;I.Utf16=I.Utf16BE={stringify:function(y){for(var v=y.words,A=y.sigBytes,r=[],h=0;h<A;h+=2){var M=v[h>>>2]>>>16-h%4*8&65535;r.push(String.fromCharCode(M))}return r.join("")},parse:function(y){for(var v=y.length,A=[],r=0;r<v;r++)A[r>>>1]|=y.charCodeAt(r)<<16-r%2*16;return S.create(A,v*2)}},I.Utf16LE={stringify:function(y){for(var v=y.words,A=y.sigBytes,r=[],h=0;h<A;h+=2){var M=w(v[h>>>2]>>>16-h%4*8&65535);r.push(String.fromCharCode(M))}return r.join("")},parse:function(y){for(var v=y.length,A=[],r=0;r<v;r++)A[r>>>1]|=w(y.charCodeAt(r)<<16-r%2*16);return S.create(A,v*2)}};function w(y){return y<<8&4278255360|y>>>8&16711935}}(),f.enc.Utf16})},function(P,s,a){(function(f,e){P.exports=e(a(6),a(28))})(this,function(f){return function(e){var b=f,S=b.lib,I=S.CipherParams,w=b.enc,y=w.Hex,v=b.format;v.Hex={stringify:function(A){return A.ciphertext.toString(y)},parse:function(A){var r=y.parse(A);return I.create({ciphertext:r})}}}(),f.format.Hex})},function(P,s,a){(function(f,e){P.exports=e(a(6),a(11),a(61),a(27),a(28))})(this,function(f){return function(){var e=f,b=e.lib,S=b.BlockCipher,I=e.algo,w=[],y=[],v=[],A=[],r=[],h=[],M=[],O=[],p=[],c=[];(function(){for(var i=[],n=0;n<256;n++)n<128?i[n]=n<<1:i[n]=n<<1^283;for(var t=0,l=0,n=0;n<256;n++){var u=l^l<<1^l<<2^l<<3^l<<4;u=u>>>8^u&255^99,w[t]=u,y[u]=t;var d=i[t],U=i[d],L=i[U],D=i[u]*257^u*16843008;v[t]=D<<24|D>>>8,A[t]=D<<16|D>>>16,r[t]=D<<8|D>>>24,h[t]=D;var D=L*16843009^U*65537^d*257^t*16843008;M[u]=D<<24|D>>>8,O[u]=D<<16|D>>>16,p[u]=D<<8|D>>>24,c[u]=D,t?(t=d^i[i[i[L^d]]],l^=i[i[l]]):t=l=1}})();var g=[0,1,2,4,8,16,32,64,128,27,54],o=I.AES=S.extend({_doReset:function(){var i;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var n=this._keyPriorReset=this._key,t=n.words,l=n.sigBytes/4,u=this._nRounds=l+6,d=(u+1)*4,U=this._keySchedule=[],L=0;L<d;L++)L<l?U[L]=t[L]:(i=U[L-1],L%l?l>6&&L%l==4&&(i=w[i>>>24]<<24|w[i>>>16&255]<<16|w[i>>>8&255]<<8|w[i&255]):(i=i<<8|i>>>24,i=w[i>>>24]<<24|w[i>>>16&255]<<16|w[i>>>8&255]<<8|w[i&255],i^=g[L/l|0]<<24),U[L]=U[L-l]^i);for(var D=this._invKeySchedule=[],E=0;E<d;E++){var L=d-E;if(E%4)var i=U[L];else var i=U[L-4];E<4||L<=4?D[E]=i:D[E]=M[w[i>>>24]]^O[w[i>>>16&255]]^p[w[i>>>8&255]]^c[w[i&255]]}}},encryptBlock:function(i,n){this._doCryptBlock(i,n,this._keySchedule,v,A,r,h,w)},decryptBlock:function(i,n){var t=i[n+1];i[n+1]=i[n+3],i[n+3]=t,this._doCryptBlock(i,n,this._invKeySchedule,M,O,p,c,y);var t=i[n+1];i[n+1]=i[n+3],i[n+3]=t},_doCryptBlock:function(i,n,t,l,u,d,U,L){for(var D=this._nRounds,E=i[n]^t[0],T=i[n+1]^t[1],R=i[n+2]^t[2],j=i[n+3]^t[3],G=4,k=1;k<D;k++){var J=l[E>>>24]^u[T>>>16&255]^d[R>>>8&255]^U[j&255]^t[G++],z=l[T>>>24]^u[R>>>16&255]^d[j>>>8&255]^U[E&255]^t[G++],_=l[R>>>24]^u[j>>>16&255]^d[E>>>8&255]^U[T&255]^t[G++],C=l[j>>>24]^u[E>>>16&255]^d[T>>>8&255]^U[R&255]^t[G++];E=J,T=z,R=_,j=C}var J=(L[E>>>24]<<24|L[T>>>16&255]<<16|L[R>>>8&255]<<8|L[j&255])^t[G++],z=(L[T>>>24]<<24|L[R>>>16&255]<<16|L[j>>>8&255]<<8|L[E&255])^t[G++],_=(L[R>>>24]<<24|L[j>>>16&255]<<16|L[E>>>8&255]<<8|L[T&255])^t[G++],C=(L[j>>>24]<<24|L[E>>>16&255]<<16|L[T>>>8&255]<<8|L[R&255])^t[G++];i[n]=J,i[n+1]=z,i[n+2]=_,i[n+3]=C},keySize:256/32});e.AES=S._createHelper(o)}(),f.AES})},function(P,s,a){(function(f,e){P.exports=e(a(6))})(this,function(f){return function(e){var b=f,S=b.lib,I=S.WordArray,w=S.Hasher,y=b.algo,v=[];(function(){for(var p=0;p<64;p++)v[p]=e.abs(e.sin(p+1))*4294967296|0})();var A=y.MD5=w.extend({_doReset:function(){this._hash=new I.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(p,c){for(var g=0;g<16;g++){var o=c+g,i=p[o];p[o]=(i<<8|i>>>24)&16711935|(i<<24|i>>>8)&4278255360}var n=this._hash.words,t=p[c+0],l=p[c+1],u=p[c+2],d=p[c+3],U=p[c+4],L=p[c+5],D=p[c+6],E=p[c+7],T=p[c+8],R=p[c+9],j=p[c+10],G=p[c+11],k=p[c+12],J=p[c+13],z=p[c+14],_=p[c+15],C=n[0],N=n[1],B=n[2],H=n[3];C=r(C,N,B,H,t,7,v[0]),H=r(H,C,N,B,l,12,v[1]),B=r(B,H,C,N,u,17,v[2]),N=r(N,B,H,C,d,22,v[3]),C=r(C,N,B,H,U,7,v[4]),H=r(H,C,N,B,L,12,v[5]),B=r(B,H,C,N,D,17,v[6]),N=r(N,B,H,C,E,22,v[7]),C=r(C,N,B,H,T,7,v[8]),H=r(H,C,N,B,R,12,v[9]),B=r(B,H,C,N,j,17,v[10]),N=r(N,B,H,C,G,22,v[11]),C=r(C,N,B,H,k,7,v[12]),H=r(H,C,N,B,J,12,v[13]),B=r(B,H,C,N,z,17,v[14]),N=r(N,B,H,C,_,22,v[15]),C=h(C,N,B,H,l,5,v[16]),H=h(H,C,N,B,D,9,v[17]),B=h(B,H,C,N,G,14,v[18]),N=h(N,B,H,C,t,20,v[19]),C=h(C,N,B,H,L,5,v[20]),H=h(H,C,N,B,j,9,v[21]),B=h(B,H,C,N,_,14,v[22]),N=h(N,B,H,C,U,20,v[23]),C=h(C,N,B,H,R,5,v[24]),H=h(H,C,N,B,z,9,v[25]),B=h(B,H,C,N,d,14,v[26]),N=h(N,B,H,C,T,20,v[27]),C=h(C,N,B,H,J,5,v[28]),H=h(H,C,N,B,u,9,v[29]),B=h(B,H,C,N,E,14,v[30]),N=h(N,B,H,C,k,20,v[31]),C=M(C,N,B,H,L,4,v[32]),H=M(H,C,N,B,T,11,v[33]),B=M(B,H,C,N,G,16,v[34]),N=M(N,B,H,C,z,23,v[35]),C=M(C,N,B,H,l,4,v[36]),H=M(H,C,N,B,U,11,v[37]),B=M(B,H,C,N,E,16,v[38]),N=M(N,B,H,C,j,23,v[39]),C=M(C,N,B,H,J,4,v[40]),H=M(H,C,N,B,t,11,v[41]),B=M(B,H,C,N,d,16,v[42]),N=M(N,B,H,C,D,23,v[43]),C=M(C,N,B,H,R,4,v[44]),H=M(H,C,N,B,k,11,v[45]),B=M(B,H,C,N,_,16,v[46]),N=M(N,B,H,C,u,23,v[47]),C=O(C,N,B,H,t,6,v[48]),H=O(H,C,N,B,E,10,v[49]),B=O(B,H,C,N,z,15,v[50]),N=O(N,B,H,C,L,21,v[51]),C=O(C,N,B,H,k,6,v[52]),H=O(H,C,N,B,d,10,v[53]),B=O(B,H,C,N,j,15,v[54]),N=O(N,B,H,C,l,21,v[55]),C=O(C,N,B,H,T,6,v[56]),H=O(H,C,N,B,_,10,v[57]),B=O(B,H,C,N,D,15,v[58]),N=O(N,B,H,C,J,21,v[59]),C=O(C,N,B,H,U,6,v[60]),H=O(H,C,N,B,G,10,v[61]),B=O(B,H,C,N,u,15,v[62]),N=O(N,B,H,C,R,21,v[63]),n[0]=n[0]+C|0,n[1]=n[1]+N|0,n[2]=n[2]+B|0,n[3]=n[3]+H|0},_doFinalize:function(){var p=this._data,c=p.words,g=this._nDataBytes*8,o=p.sigBytes*8;c[o>>>5]|=128<<24-o%32;var i=e.floor(g/4294967296),n=g;c[(o+64>>>9<<4)+15]=(i<<8|i>>>24)&16711935|(i<<24|i>>>8)&4278255360,c[(o+64>>>9<<4)+14]=(n<<8|n>>>24)&16711935|(n<<24|n>>>8)&4278255360,p.sigBytes=(c.length+1)*4,this._process();for(var t=this._hash,l=t.words,u=0;u<4;u++){var d=l[u];l[u]=(d<<8|d>>>24)&16711935|(d<<24|d>>>8)&4278255360}return t},clone:function(){var p=w.clone.call(this);return p._hash=this._hash.clone(),p}});function r(p,c,g,o,i,n,t){var l=p+(c&g|~c&o)+i+t;return(l<<n|l>>>32-n)+c}function h(p,c,g,o,i,n,t){var l=p+(c&o|g&~o)+i+t;return(l<<n|l>>>32-n)+c}function M(p,c,g,o,i,n,t){var l=p+(c^g^o)+i+t;return(l<<n|l>>>32-n)+c}function O(p,c,g,o,i,n,t){var l=p+(g^(c|~o))+i+t;return(l<<n|l>>>32-n)+c}b.MD5=w._createHelper(A),b.HmacMD5=w._createHmacHelper(A)}(Math),f.MD5})},function(P,s,a){var f;Object.defineProperty(s,"__esModule",{value:!0});var e=a(0),b=e.__importDefault(a(3)),S=e.__importStar(a(1)),I=e.__importDefault(a(8)),w=a(4),y=e.__importDefault(a(19)),v=e.__importDefault(a(17)),A=e.__importDefault(a(22)),r=e.__importDefault(a(2)),h=a(29),M=e.__importDefault(a(63)),O=a(14);function p(o){var i=o.statusCode;return i===408&&!o.code||i===400&&!o.code||i>=500&&i<=504}function c(o){var i=o.connection,n=i&&i.connectionManager.host;return n?[n].concat(I.default.getFallbackHosts(o.options)):I.default.getHosts(o.options)}var g=(f=function(){function o(i){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=c,this.options=i||{};var n=this.options.connectivityCheckUrl||I.default.connectivityCheckUrl,t=this.options.connectivityCheckParams,l=!this.options.connectivityCheckUrl;b.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(u,d,U,L,D,E,T){var R=v.default.createRequest(U,L,D,E,A.default.REQ_SEND,d&&d.options.timeouts,u);return R.once("complete",T),R.exec(),R},this.options.disableConnectivityCheck?this.checkConnectivity=function(u){u(null,!0)}:this.checkConnectivity=function(u){r.default.logAction(r.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+n),this.doUri(y.default.Get,null,n,null,null,t,function(d,U,L,D,E){var T=!1;l?T=!d&&(U==null?void 0:U.replace(/\n/,""))=="yes":T=!d&&(0,O.isSuccessCode)(E),r.default.logAction(r.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+T),u(null,T)})}):b.default.Config.jsonpSupported?(this.Request=function(u,d,U,L,D,E,T){var R=(0,h.createRequest)(U,L,D,E,A.default.REQ_SEND,d&&d.options.timeouts,u);return R.once("complete",T),b.default.Config.nextTick(function(){R.exec()}),R},this.options.disableConnectivityCheck?this.checkConnectivity=function(u){u(null,!0)}:this.checkConnectivity=function(u){var d=this,U=I.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(u);return}this.checksInProgress=[u],r.default.logAction(r.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+U);var L=new h.Request("isTheInternetUp",U,null,null,null,A.default.REQ_SEND,I.default.TIMEOUTS);L.once("complete",function(D,E){var T=!D&&E;r.default.logAction(r.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+T);for(var R=0;R<d.checksInProgress.length;R++)d.checksInProgress[R](null,T);d.checksInProgress=null}),b.default.Config.nextTick(function(){L.exec()})}):b.default.Config.fetchSupported?(this.supportsAuthHeaders=!0,this.Request=M.default,this.checkConnectivity=function(u){r.default.logAction(r.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+n),this.doUri(y.default.Get,null,n,null,null,null,function(d,U){var L=!d&&(U==null?void 0:U.replace(/\n/,""))=="yes";r.default.logAction(r.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+L),u(null,L)})}):this.Request=function(u,d,U,L,D,E,T){T(new w.PartialErrorInfo("no supported HTTP transports available",null,400),null)}}return o.prototype.do=function(i,n,t,l,u,d,U){var L=this,D=typeof t=="function"?t:function(j){return n.baseUri(j)+t},E=n._currentFallback;if(E)if(E.validUntil>S.now()){if(!this.Request){U==null||U(new w.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(i,n,D(E.host),l,d,u,function(j){for(var G=[],k=1;k<arguments.length;k++)G[k-1]=arguments[k];if(j&&p(j)){n._currentFallback=null,L.do(i,n,t,l,u,d,U);return}U==null||U.apply(void 0,e.__spreadArray([j],G,!1))});return}else n._currentFallback=null;var T=c(n);if(T.length===1){this.doUri(i,n,D(T[0]),l,u,d,U);return}var R=function(j,G){var k=j.shift();L.doUri(i,n,D(k),l,u,d,function(J){for(var z=[],_=1;_<arguments.length;_++)z[_-1]=arguments[_];if(J&&p(J)&&j.length){R(j,!0);return}G&&(n._currentFallback={host:k,validUntil:S.now()+n.options.timeouts.fallbackRetryTimeout}),U==null||U.apply(void 0,e.__spreadArray([J],z,!1))})};R(T)},o.prototype.doUri=function(i,n,t,l,u,d,U){if(!this.Request){U(new w.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(i,n,t,l,d,u,U)},o}(),f.methods=[y.default.Get,y.default.Delete,y.default.Post,y.default.Put,y.default.Patch],f.methodsWithoutBody=[y.default.Get,y.default.Delete],f.methodsWithBody=[y.default.Post,y.default.Put,y.default.Patch],f);s.default=g},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importStar(a(4)),b=f.__importDefault(a(3)),S=f.__importDefault(a(8)),I=f.__importStar(a(1)),w=a(1);function y(r,h){return!!h.get("x-ably-errorcode")}function v(r,h){if(y(r,h))return r.error&&e.default.fromValues(r.error)}function A(r,h,M,O,p,c,g){var o=new Headers(O||{}),i=r?r.toUpperCase():I.isEmptyArg(c)?"GET":"POST",n=new AbortController,t=setTimeout(function(){n.abort(),g(new e.PartialErrorInfo("Request timed out",null,408))},h?h.options.timeouts.httpRequestTimeout:S.default.TIMEOUTS.httpRequestTimeout),l={method:i,headers:o,body:c};b.default.Config.isWebworker||(l.credentials=o.has("authorization")?"include":"same-origin"),(0,w.getGlobalObject)().fetch(M+"?"+new URLSearchParams(p||{}),l).then(function(u){clearTimeout(t);var d=u.headers.get("Content-Type"),U;d&&d.indexOf("application/x-msgpack")>-1?U=u.arrayBuffer():d&&d.indexOf("application/json")>-1?U=u.json():U=u.text(),U.then(function(L){var D=!!d&&d.indexOf("application/x-msgpack")===-1;if(u.ok)g(null,L,u.headers,D,u.status);else{var E=v(L,u.headers)||new e.PartialErrorInfo("Error response received from server: "+u.status+" body was: "+b.default.Config.inspect(L),null,u.status);g(E,L,u.headers,D,u.status)}})}).catch(function(u){clearTimeout(t),g(u)})}s.default=A},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importDefault(a(41)),b=f.__importStar(a(1)),S=b.getGlobalObject();typeof Window>"u"&&typeof WorkerGlobalScope>"u"&&console.log("Warning: this distribution of Ably is intended for browsers. On nodejs, please use the 'ably' package on npm");function I(){var A=S.location;return!S.WebSocket||!A||!A.origin||A.origin.indexOf("http")>-1}var w=S.navigator&&S.navigator.userAgent.toString(),y=S.location&&S.location.href,v={agent:"browser",logTimestamps:!0,userAgent:w,currentUrl:y,noUpgrade:w&&!!w.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:S.WebSocket,fetchSupported:!!S.fetch,xhrSupported:S.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document<"u",allowComet:I(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:e.default,supportsBinary:!!S.TextDecoder,preferBinary:!1,ArrayBuffer:S.ArrayBuffer,atob:S.atob,nextTick:typeof S.setImmediate<"u"?S.setImmediate.bind(S):function(A){setTimeout(A,0)},addEventListener:S.addEventListener,inspect:JSON.stringify,stringByteSize:function(A){return S.TextDecoder&&new S.TextEncoder().encode(A).length||A.length},TextEncoder:S.TextEncoder,TextDecoder:S.TextDecoder,Promise:S.Promise,getRandomValues:function(A){if(A!==void 0)return function(r,h){A.getRandomValues(r),h&&h(null)}}(S.crypto||msCrypto)};s.default=v},function(P,s,a){(function(f){Object.defineProperty(s,"__esModule",{value:!0});var e=a(0),b=e.__importStar(a(1)),S="ablyjs-storage-test",I=function(){function w(){try{f.sessionStorage.setItem(S,S),f.sessionStorage.removeItem(S),this.sessionSupported=!0}catch{this.sessionSupported=!1}try{f.localStorage.setItem(S,S),f.localStorage.removeItem(S),this.localSupported=!0}catch{this.localSupported=!1}}return w.prototype.get=function(y){return this._get(y,!1)},w.prototype.getSession=function(y){return this._get(y,!0)},w.prototype.remove=function(y){return this._remove(y,!1)},w.prototype.removeSession=function(y){return this._remove(y,!0)},w.prototype.set=function(y,v,A){return this._set(y,v,A,!1)},w.prototype.setSession=function(y,v,A){return this._set(y,v,A,!0)},w.prototype._set=function(y,v,A,r){var h={value:v};return A&&(h.expires=b.now()+A),this.storageInterface(r).setItem(y,JSON.stringify(h))},w.prototype._get=function(y,v){if(v&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!v&&!this.localSupported)throw new Error("Local Storage not supported");var A=this.storageInterface(v).getItem(y);if(!A)return null;var r=JSON.parse(A);return r.expires&&r.expires<b.now()?(this.storageInterface(v).removeItem(y),null):r.value},w.prototype._remove=function(y,v){return this.storageInterface(v).removeItem(y)},w.prototype.storageInterface=function(y){return y?f.sessionStorage:f.localStorage},w}();s.default=new I}).call(this,a(13))},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f=a(0),e=f.__importDefault(a(67)),b={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[e.default.XhrPolling,e.default.XhrStreaming,e.default.JsonP,e.default.WebSocket],baseTransportOrder:[e.default.XhrPolling,e.default.XhrStreaming,e.default.JsonP,e.default.WebSocket],transportPreferenceOrder:[e.default.JsonP,e.default.XhrPolling,e.default.XhrStreaming,e.default.WebSocket],upgradeTransports:[e.default.XhrStreaming,e.default.WebSocket]};s.default=b},function(P,s,a){Object.defineProperty(s,"__esModule",{value:!0});var f;(function(e){e.WebSocket="web_socket",e.Comet="comet",e.XhrStreaming="xhr_streaming",e.XhrPolling="xhr_polling",e.JsonP="jsonp"})(f||(f={})),s.default=f},function(P,s,a){a.r(s);var f=a(29),e=a.n(f),b=a(1),S=a(3),I=a.n(S),w=a(12),y=a.n(w),v=a(17),A=a.n(v),r=function(p){var c="xhr_polling";function g(o,i,n){n.stream=!1,y.a.call(this,o,i,n),this.shortName=c}return b.inherits(g,y.a),g.isAvailable=function(){return I.a.Config.xhrSupported&&I.a.Config.allowComet},g.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},g.prototype.createRequest=function(o,i,n,t,l){return A.a.createRequest(o,i,n,t,l,this.timeouts)},typeof p<"u"&&g.isAvailable()&&(p.supportedTransports[c]=g),g},h=r,M=function(p){var c="xhr_streaming";function g(o,i,n){y.a.call(this,o,i,n),this.shortName=c}return b.inherits(g,y.a),g.isAvailable=function(){return I.a.Config.xhrSupported&&I.a.Config.streamingSupported&&I.a.Config.allowComet},g.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},g.prototype.createRequest=function(o,i,n,t,l){return A.a.createRequest(o,i,n,t,l,this.timeouts)},typeof p<"u"&&g.isAvailable()&&(p.supportedTransports[c]=g),g},O=M;s.default=[e.a,h,O]}]).default})})(Kn);window.axios=ot;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";
