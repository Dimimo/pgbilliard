function An(f,u){for(var l=0;l<u.length;l++){const e=u[l];if(typeof e!="string"&&!Array.isArray(e)){for(const t in e)if(t!=="default"&&!(t in f)){const i=Object.getOwnPropertyDescriptor(e,t);i&&Object.defineProperty(f,t,i.get?i:{enumerable:!0,get:()=>e[t]})}}}return Object.freeze(Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}))}function Wt(f,u){return function(){return f.apply(u,arguments)}}const{toString:En}=Object.prototype,{getPrototypeOf:yt}=Object,ze=(f=>u=>{const l=En.call(u);return f[l]||(f[l]=l.slice(8,-1).toLowerCase())})(Object.create(null)),Ce=f=>(f=f.toLowerCase(),u=>ze(u)===f),qe=f=>u=>typeof u===f,{isArray:we}=Array,xe=qe("undefined");function Tn(f){return f!==null&&!xe(f)&&f.constructor!==null&&!xe(f.constructor)&&ge(f.constructor.isBuffer)&&f.constructor.isBuffer(f)}const Vt=Ce("ArrayBuffer");function wn(f){let u;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?u=ArrayBuffer.isView(f):u=f&&f.buffer&&Vt(f.buffer),u}const In=qe("string"),ge=qe("function"),zt=qe("number"),Ke=f=>f!==null&&typeof f=="object",Pn=f=>f===!0||f===!1,Be=f=>{if(ze(f)!=="object")return!1;const u=yt(f);return(u===null||u===Object.prototype||Object.getPrototypeOf(u)===null)&&!(Symbol.toStringTag in f)&&!(Symbol.iterator in f)},Mn=Ce("Date"),xn=Ce("File"),Ln=Ce("Blob"),Dn=Ce("FileList"),Nn=f=>Ke(f)&&ge(f.pipe),Un=f=>{let u;return f&&(typeof FormData=="function"&&f instanceof FormData||ge(f.append)&&((u=ze(f))==="formdata"||u==="object"&&ge(f.toString)&&f.toString()==="[object FormData]"))},kn=Ce("URLSearchParams"),[Bn,jn,Hn,Fn]=["ReadableStream","Request","Response","Headers"].map(Ce),Gn=f=>f.trim?f.trim():f.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function De(f,u,{allOwnKeys:l=!1}={}){if(f===null||typeof f>"u")return;let e,t;if(typeof f!="object"&&(f=[f]),we(f))for(e=0,t=f.length;e<t;e++)u.call(null,f[e],e,f);else{const i=l?Object.getOwnPropertyNames(f):Object.keys(f),r=i.length;let A;for(e=0;e<r;e++)A=i[e],u.call(null,f[A],A,f)}}function qt(f,u){u=u.toLowerCase();const l=Object.keys(f);let e=l.length,t;for(;e-- >0;)if(t=l[e],u===t.toLowerCase())return t;return null}const Se=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Kt=f=>!xe(f)&&f!==Se;function lt(){const{caseless:f}=Kt(this)&&this||{},u={},l=(e,t)=>{const i=f&&qt(u,t)||t;Be(u[i])&&Be(e)?u[i]=lt(u[i],e):Be(e)?u[i]=lt({},e):we(e)?u[i]=e.slice():u[i]=e};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&De(arguments[e],l);return u}const _n=(f,u,l,{allOwnKeys:e}={})=>(De(u,(t,i)=>{l&&ge(t)?f[i]=Wt(t,l):f[i]=t},{allOwnKeys:e}),f),Wn=f=>(f.charCodeAt(0)===65279&&(f=f.slice(1)),f),Vn=(f,u,l,e)=>{f.prototype=Object.create(u.prototype,e),f.prototype.constructor=f,Object.defineProperty(f,"super",{value:u.prototype}),l&&Object.assign(f.prototype,l)},zn=(f,u,l,e)=>{let t,i,r;const A={};if(u=u||{},f==null)return u;do{for(t=Object.getOwnPropertyNames(f),i=t.length;i-- >0;)r=t[i],(!e||e(r,f,u))&&!A[r]&&(u[r]=f[r],A[r]=!0);f=l!==!1&&yt(f)}while(f&&(!l||l(f,u))&&f!==Object.prototype);return u},qn=(f,u,l)=>{f=String(f),(l===void 0||l>f.length)&&(l=f.length),l-=u.length;const e=f.indexOf(u,l);return e!==-1&&e===l},Kn=f=>{if(!f)return null;if(we(f))return f;let u=f.length;if(!zt(u))return null;const l=new Array(u);for(;u-- >0;)l[u]=f[u];return l},Jn=(f=>u=>f&&u instanceof f)(typeof Uint8Array<"u"&&yt(Uint8Array)),Qn=(f,u)=>{const e=(f&&f[Symbol.iterator]).call(f);let t;for(;(t=e.next())&&!t.done;){const i=t.value;u.call(f,i[0],i[1])}},Xn=(f,u)=>{let l;const e=[];for(;(l=f.exec(u))!==null;)e.push(l);return e},$n=Ce("HTMLFormElement"),Yn=f=>f.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(l,e,t){return e.toUpperCase()+t}),At=(({hasOwnProperty:f})=>(u,l)=>f.call(u,l))(Object.prototype),Zn=Ce("RegExp"),Jt=(f,u)=>{const l=Object.getOwnPropertyDescriptors(f),e={};De(l,(t,i)=>{let r;(r=u(t,i,f))!==!1&&(e[i]=r||t)}),Object.defineProperties(f,e)},er=f=>{Jt(f,(u,l)=>{if(ge(f)&&["arguments","caller","callee"].indexOf(l)!==-1)return!1;const e=f[l];if(ge(e)){if(u.enumerable=!1,"writable"in u){u.writable=!1;return}u.set||(u.set=()=>{throw Error("Can not rewrite read-only method '"+l+"'")})}})},tr=(f,u)=>{const l={},e=t=>{t.forEach(i=>{l[i]=!0})};return we(f)?e(f):e(String(f).split(u)),l},nr=()=>{},rr=(f,u)=>f!=null&&Number.isFinite(f=+f)?f:u,rt="abcdefghijklmnopqrstuvwxyz",Et="0123456789",Qt={DIGIT:Et,ALPHA:rt,ALPHA_DIGIT:rt+rt.toUpperCase()+Et},ir=(f=16,u=Qt.ALPHA_DIGIT)=>{let l="";const{length:e}=u;for(;f--;)l+=u[Math.random()*e|0];return l};function or(f){return!!(f&&ge(f.append)&&f[Symbol.toStringTag]==="FormData"&&f[Symbol.iterator])}const sr=f=>{const u=new Array(10),l=(e,t)=>{if(Ke(e)){if(u.indexOf(e)>=0)return;if(!("toJSON"in e)){u[t]=e;const i=we(e)?[]:{};return De(e,(r,A)=>{const y=l(r,t+1);!xe(y)&&(i[A]=y)}),u[t]=void 0,i}}return e};return l(f,0)},ar=Ce("AsyncFunction"),ur=f=>f&&(Ke(f)||ge(f))&&ge(f.then)&&ge(f.catch),Xt=((f,u)=>f?setImmediate:u?((l,e)=>(Se.addEventListener("message",({source:t,data:i})=>{t===Se&&i===l&&e.length&&e.shift()()},!1),t=>{e.push(t),Se.postMessage(l,"*")}))(`axios@${Math.random()}`,[]):l=>setTimeout(l))(typeof setImmediate=="function",ge(Se.postMessage)),cr=typeof queueMicrotask<"u"?queueMicrotask.bind(Se):typeof process<"u"&&process.nextTick||Xt,q={isArray:we,isArrayBuffer:Vt,isBuffer:Tn,isFormData:Un,isArrayBufferView:wn,isString:In,isNumber:zt,isBoolean:Pn,isObject:Ke,isPlainObject:Be,isReadableStream:Bn,isRequest:jn,isResponse:Hn,isHeaders:Fn,isUndefined:xe,isDate:Mn,isFile:xn,isBlob:Ln,isRegExp:Zn,isFunction:ge,isStream:Nn,isURLSearchParams:kn,isTypedArray:Jn,isFileList:Dn,forEach:De,merge:lt,extend:_n,trim:Gn,stripBOM:Wn,inherits:Vn,toFlatObject:zn,kindOf:ze,kindOfTest:Ce,endsWith:qn,toArray:Kn,forEachEntry:Qn,matchAll:Xn,isHTMLForm:$n,hasOwnProperty:At,hasOwnProp:At,reduceDescriptors:Jt,freezeMethods:er,toObjectSet:tr,toCamelCase:Yn,noop:nr,toFiniteNumber:rr,findKey:qt,global:Se,isContextDefined:Kt,ALPHABET:Qt,generateString:ir,isSpecCompliantForm:or,toJSONObject:sr,isAsyncFn:ar,isThenable:ur,setImmediate:Xt,asap:cr};function te(f,u,l,e,t){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=f,this.name="AxiosError",u&&(this.code=u),l&&(this.config=l),e&&(this.request=e),t&&(this.response=t,this.status=t.status?t.status:null)}q.inherits(te,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:q.toJSONObject(this.config),code:this.code,status:this.status}}});const $t=te.prototype,Yt={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(f=>{Yt[f]={value:f}});Object.defineProperties(te,Yt);Object.defineProperty($t,"isAxiosError",{value:!0});te.from=(f,u,l,e,t,i)=>{const r=Object.create($t);return q.toFlatObject(f,r,function(y){return y!==Error.prototype},A=>A!=="isAxiosError"),te.call(r,f.message,u,l,e,t),r.cause=f,r.name=f.name,i&&Object.assign(r,i),r};const lr=null;function ft(f){return q.isPlainObject(f)||q.isArray(f)}function Zt(f){return q.endsWith(f,"[]")?f.slice(0,-2):f}function Tt(f,u,l){return f?f.concat(u).map(function(t,i){return t=Zt(t),!l&&i?"["+t+"]":t}).join(l?".":""):u}function fr(f){return q.isArray(f)&&!f.some(ft)}const dr=q.toFlatObject(q,{},null,function(u){return/^is[A-Z]/.test(u)});function Je(f,u,l){if(!q.isObject(f))throw new TypeError("target must be an object");u=u||new FormData,l=q.toFlatObject(l,{metaTokens:!0,dots:!1,indexes:!1},!1,function(O,E){return!q.isUndefined(E[O])});const e=l.metaTokens,t=l.visitor||T,i=l.dots,r=l.indexes,y=(l.Blob||typeof Blob<"u"&&Blob)&&q.isSpecCompliantForm(u);if(!q.isFunction(t))throw new TypeError("visitor must be a function");function b(o){if(o===null)return"";if(q.isDate(o))return o.toISOString();if(!y&&q.isBlob(o))throw new te("Blob is not supported. Use a Buffer instead.");return q.isArrayBuffer(o)||q.isTypedArray(o)?y&&typeof Blob=="function"?new Blob([o]):Buffer.from(o):o}function T(o,O,E){let w=o;if(o&&!E&&typeof o=="object"){if(q.endsWith(O,"{}"))O=e?O:O.slice(0,-2),o=JSON.stringify(o);else if(q.isArray(o)&&fr(o)||(q.isFileList(o)||q.endsWith(O,"[]"))&&(w=q.toArray(o)))return O=Zt(O),w.forEach(function(p,R){!(q.isUndefined(p)||p===null)&&u.append(r===!0?Tt([O],R,i):r===null?O:O+"[]",b(p))}),!1}return ft(o)?!0:(u.append(Tt(E,O,i),b(o)),!1)}const I=[],S=Object.assign(dr,{defaultVisitor:T,convertValue:b,isVisitable:ft});function M(o,O){if(!q.isUndefined(o)){if(I.indexOf(o)!==-1)throw Error("Circular reference detected in "+O.join("."));I.push(o),q.forEach(o,function(w,C){(!(q.isUndefined(w)||w===null)&&t.call(u,w,q.isString(C)?C.trim():C,O,S))===!0&&M(w,O?O.concat(C):[C])}),I.pop()}}if(!q.isObject(f))throw new TypeError("data must be an object");return M(f),u}function wt(f){const u={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(f).replace(/[!'()~]|%20|%00/g,function(e){return u[e]})}function Ct(f,u){this._pairs=[],f&&Je(f,this,u)}const en=Ct.prototype;en.append=function(u,l){this._pairs.push([u,l])};en.toString=function(u){const l=u?function(e){return u.call(this,e,wt)}:wt;return this._pairs.map(function(t){return l(t[0])+"="+l(t[1])},"").join("&")};function hr(f){return encodeURIComponent(f).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function tn(f,u,l){if(!u)return f;const e=l&&l.encode||hr;q.isFunction(l)&&(l={serialize:l});const t=l&&l.serialize;let i;if(t?i=t(u,l):i=q.isURLSearchParams(u)?u.toString():new Ct(u,l).toString(e),i){const r=f.indexOf("#");r!==-1&&(f=f.slice(0,r)),f+=(f.indexOf("?")===-1?"?":"&")+i}return f}class It{constructor(){this.handlers=[]}use(u,l,e){return this.handlers.push({fulfilled:u,rejected:l,synchronous:e?e.synchronous:!1,runWhen:e?e.runWhen:null}),this.handlers.length-1}eject(u){this.handlers[u]&&(this.handlers[u]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(u){q.forEach(this.handlers,function(e){e!==null&&u(e)})}}const nn={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},pr=typeof URLSearchParams<"u"?URLSearchParams:Ct,vr=typeof FormData<"u"?FormData:null,gr=typeof Blob<"u"?Blob:null,mr={isBrowser:!0,classes:{URLSearchParams:pr,FormData:vr,Blob:gr},protocols:["http","https","file","blob","url","data"]},Ot=typeof window<"u"&&typeof document<"u",dt=typeof navigator=="object"&&navigator||void 0,yr=Ot&&(!dt||["ReactNative","NativeScript","NS"].indexOf(dt.product)<0),Cr=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Or=Ot&&window.location.href||"http://localhost",br=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ot,hasStandardBrowserEnv:yr,hasStandardBrowserWebWorkerEnv:Cr,navigator:dt,origin:Or},Symbol.toStringTag,{value:"Module"})),de={...br,...mr};function Rr(f,u){return Je(f,new de.classes.URLSearchParams,Object.assign({visitor:function(l,e,t,i){return de.isNode&&q.isBuffer(l)?(this.append(e,l.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},u))}function Sr(f){return q.matchAll(/\w+|\[(\w*)]/g,f).map(u=>u[0]==="[]"?"":u[1]||u[0])}function Ar(f){const u={},l=Object.keys(f);let e;const t=l.length;let i;for(e=0;e<t;e++)i=l[e],u[i]=f[i];return u}function rn(f){function u(l,e,t,i){let r=l[i++];if(r==="__proto__")return!0;const A=Number.isFinite(+r),y=i>=l.length;return r=!r&&q.isArray(t)?t.length:r,y?(q.hasOwnProp(t,r)?t[r]=[t[r],e]:t[r]=e,!A):((!t[r]||!q.isObject(t[r]))&&(t[r]=[]),u(l,e,t[r],i)&&q.isArray(t[r])&&(t[r]=Ar(t[r])),!A)}if(q.isFormData(f)&&q.isFunction(f.entries)){const l={};return q.forEachEntry(f,(e,t)=>{u(Sr(e),t,l,0)}),l}return null}function Er(f,u,l){if(q.isString(f))try{return(u||JSON.parse)(f),q.trim(f)}catch(e){if(e.name!=="SyntaxError")throw e}return(0,JSON.stringify)(f)}const Ne={transitional:nn,adapter:["xhr","http","fetch"],transformRequest:[function(u,l){const e=l.getContentType()||"",t=e.indexOf("application/json")>-1,i=q.isObject(u);if(i&&q.isHTMLForm(u)&&(u=new FormData(u)),q.isFormData(u))return t?JSON.stringify(rn(u)):u;if(q.isArrayBuffer(u)||q.isBuffer(u)||q.isStream(u)||q.isFile(u)||q.isBlob(u)||q.isReadableStream(u))return u;if(q.isArrayBufferView(u))return u.buffer;if(q.isURLSearchParams(u))return l.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),u.toString();let A;if(i){if(e.indexOf("application/x-www-form-urlencoded")>-1)return Rr(u,this.formSerializer).toString();if((A=q.isFileList(u))||e.indexOf("multipart/form-data")>-1){const y=this.env&&this.env.FormData;return Je(A?{"files[]":u}:u,y&&new y,this.formSerializer)}}return i||t?(l.setContentType("application/json",!1),Er(u)):u}],transformResponse:[function(u){const l=this.transitional||Ne.transitional,e=l&&l.forcedJSONParsing,t=this.responseType==="json";if(q.isResponse(u)||q.isReadableStream(u))return u;if(u&&q.isString(u)&&(e&&!this.responseType||t)){const r=!(l&&l.silentJSONParsing)&&t;try{return JSON.parse(u)}catch(A){if(r)throw A.name==="SyntaxError"?te.from(A,te.ERR_BAD_RESPONSE,this,null,this.response):A}}return u}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:de.classes.FormData,Blob:de.classes.Blob},validateStatus:function(u){return u>=200&&u<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};q.forEach(["delete","get","head","post","put","patch"],f=>{Ne.headers[f]={}});const Tr=q.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),wr=f=>{const u={};let l,e,t;return f&&f.split(`
`).forEach(function(r){t=r.indexOf(":"),l=r.substring(0,t).trim().toLowerCase(),e=r.substring(t+1).trim(),!(!l||u[l]&&Tr[l])&&(l==="set-cookie"?u[l]?u[l].push(e):u[l]=[e]:u[l]=u[l]?u[l]+", "+e:e)}),u},Pt=Symbol("internals");function Me(f){return f&&String(f).trim().toLowerCase()}function je(f){return f===!1||f==null?f:q.isArray(f)?f.map(je):String(f)}function Ir(f){const u=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let e;for(;e=l.exec(f);)u[e[1]]=e[2];return u}const Pr=f=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(f.trim());function it(f,u,l,e,t){if(q.isFunction(e))return e.call(this,u,l);if(t&&(u=l),!!q.isString(u)){if(q.isString(e))return u.indexOf(e)!==-1;if(q.isRegExp(e))return e.test(u)}}function Mr(f){return f.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(u,l,e)=>l.toUpperCase()+e)}function xr(f,u){const l=q.toCamelCase(" "+u);["get","set","has"].forEach(e=>{Object.defineProperty(f,e+l,{value:function(t,i,r){return this[e].call(this,u,t,i,r)},configurable:!0})})}class ve{constructor(u){u&&this.set(u)}set(u,l,e){const t=this;function i(A,y,b){const T=Me(y);if(!T)throw new Error("header name must be a non-empty string");const I=q.findKey(t,T);(!I||t[I]===void 0||b===!0||b===void 0&&t[I]!==!1)&&(t[I||y]=je(A))}const r=(A,y)=>q.forEach(A,(b,T)=>i(b,T,y));if(q.isPlainObject(u)||u instanceof this.constructor)r(u,l);else if(q.isString(u)&&(u=u.trim())&&!Pr(u))r(wr(u),l);else if(q.isHeaders(u))for(const[A,y]of u.entries())i(y,A,e);else u!=null&&i(l,u,e);return this}get(u,l){if(u=Me(u),u){const e=q.findKey(this,u);if(e){const t=this[e];if(!l)return t;if(l===!0)return Ir(t);if(q.isFunction(l))return l.call(this,t,e);if(q.isRegExp(l))return l.exec(t);throw new TypeError("parser must be boolean|regexp|function")}}}has(u,l){if(u=Me(u),u){const e=q.findKey(this,u);return!!(e&&this[e]!==void 0&&(!l||it(this,this[e],e,l)))}return!1}delete(u,l){const e=this;let t=!1;function i(r){if(r=Me(r),r){const A=q.findKey(e,r);A&&(!l||it(e,e[A],A,l))&&(delete e[A],t=!0)}}return q.isArray(u)?u.forEach(i):i(u),t}clear(u){const l=Object.keys(this);let e=l.length,t=!1;for(;e--;){const i=l[e];(!u||it(this,this[i],i,u,!0))&&(delete this[i],t=!0)}return t}normalize(u){const l=this,e={};return q.forEach(this,(t,i)=>{const r=q.findKey(e,i);if(r){l[r]=je(t),delete l[i];return}const A=u?Mr(i):String(i).trim();A!==i&&delete l[i],l[A]=je(t),e[A]=!0}),this}concat(...u){return this.constructor.concat(this,...u)}toJSON(u){const l=Object.create(null);return q.forEach(this,(e,t)=>{e!=null&&e!==!1&&(l[t]=u&&q.isArray(e)?e.join(", "):e)}),l}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([u,l])=>u+": "+l).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(u){return u instanceof this?u:new this(u)}static concat(u,...l){const e=new this(u);return l.forEach(t=>e.set(t)),e}static accessor(u){const e=(this[Pt]=this[Pt]={accessors:{}}).accessors,t=this.prototype;function i(r){const A=Me(r);e[A]||(xr(t,r),e[A]=!0)}return q.isArray(u)?u.forEach(i):i(u),this}}ve.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);q.reduceDescriptors(ve.prototype,({value:f},u)=>{let l=u[0].toUpperCase()+u.slice(1);return{get:()=>f,set(e){this[l]=e}}});q.freezeMethods(ve);function ot(f,u){const l=this||Ne,e=u||l,t=ve.from(e.headers);let i=e.data;return q.forEach(f,function(A){i=A.call(l,i,t.normalize(),u?u.status:void 0)}),t.normalize(),i}function on(f){return!!(f&&f.__CANCEL__)}function Ie(f,u,l){te.call(this,f??"canceled",te.ERR_CANCELED,u,l),this.name="CanceledError"}q.inherits(Ie,te,{__CANCEL__:!0});function sn(f,u,l){const e=l.config.validateStatus;!l.status||!e||e(l.status)?f(l):u(new te("Request failed with status code "+l.status,[te.ERR_BAD_REQUEST,te.ERR_BAD_RESPONSE][Math.floor(l.status/100)-4],l.config,l.request,l))}function Lr(f){const u=/^([-+\w]{1,25})(:?\/\/|:)/.exec(f);return u&&u[1]||""}function Dr(f,u){f=f||10;const l=new Array(f),e=new Array(f);let t=0,i=0,r;return u=u!==void 0?u:1e3,function(y){const b=Date.now(),T=e[i];r||(r=b),l[t]=y,e[t]=b;let I=i,S=0;for(;I!==t;)S+=l[I++],I=I%f;if(t=(t+1)%f,t===i&&(i=(i+1)%f),b-r<u)return;const M=T&&b-T;return M?Math.round(S*1e3/M):void 0}}function Nr(f,u){let l=0,e=1e3/u,t,i;const r=(b,T=Date.now())=>{l=T,t=null,i&&(clearTimeout(i),i=null),f.apply(null,b)};return[(...b)=>{const T=Date.now(),I=T-l;I>=e?r(b,T):(t=b,i||(i=setTimeout(()=>{i=null,r(t)},e-I)))},()=>t&&r(t)]}const Fe=(f,u,l=3)=>{let e=0;const t=Dr(50,250);return Nr(i=>{const r=i.loaded,A=i.lengthComputable?i.total:void 0,y=r-e,b=t(y),T=r<=A;e=r;const I={loaded:r,total:A,progress:A?r/A:void 0,bytes:y,rate:b||void 0,estimated:b&&A&&T?(A-r)/b:void 0,event:i,lengthComputable:A!=null,[u?"download":"upload"]:!0};f(I)},l)},Mt=(f,u)=>{const l=f!=null;return[e=>u[0]({lengthComputable:l,total:f,loaded:e}),u[1]]},xt=f=>(...u)=>q.asap(()=>f(...u)),Ur=de.hasStandardBrowserEnv?((f,u)=>l=>(l=new URL(l,de.origin),f.protocol===l.protocol&&f.host===l.host&&(u||f.port===l.port)))(new URL(de.origin),de.navigator&&/(msie|trident)/i.test(de.navigator.userAgent)):()=>!0,kr=de.hasStandardBrowserEnv?{write(f,u,l,e,t,i){const r=[f+"="+encodeURIComponent(u)];q.isNumber(l)&&r.push("expires="+new Date(l).toGMTString()),q.isString(e)&&r.push("path="+e),q.isString(t)&&r.push("domain="+t),i===!0&&r.push("secure"),document.cookie=r.join("; ")},read(f){const u=document.cookie.match(new RegExp("(^|;\\s*)("+f+")=([^;]*)"));return u?decodeURIComponent(u[3]):null},remove(f){this.write(f,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Br(f){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(f)}function jr(f,u){return u?f.replace(/\/?\/$/,"")+"/"+u.replace(/^\/+/,""):f}function an(f,u){return f&&!Br(u)?jr(f,u):u}const Lt=f=>f instanceof ve?{...f}:f;function Ee(f,u){u=u||{};const l={};function e(b,T,I,S){return q.isPlainObject(b)&&q.isPlainObject(T)?q.merge.call({caseless:S},b,T):q.isPlainObject(T)?q.merge({},T):q.isArray(T)?T.slice():T}function t(b,T,I,S){if(q.isUndefined(T)){if(!q.isUndefined(b))return e(void 0,b,I,S)}else return e(b,T,I,S)}function i(b,T){if(!q.isUndefined(T))return e(void 0,T)}function r(b,T){if(q.isUndefined(T)){if(!q.isUndefined(b))return e(void 0,b)}else return e(void 0,T)}function A(b,T,I){if(I in u)return e(b,T);if(I in f)return e(void 0,b)}const y={url:i,method:i,data:i,baseURL:r,transformRequest:r,transformResponse:r,paramsSerializer:r,timeout:r,timeoutMessage:r,withCredentials:r,withXSRFToken:r,adapter:r,responseType:r,xsrfCookieName:r,xsrfHeaderName:r,onUploadProgress:r,onDownloadProgress:r,decompress:r,maxContentLength:r,maxBodyLength:r,beforeRedirect:r,transport:r,httpAgent:r,httpsAgent:r,cancelToken:r,socketPath:r,responseEncoding:r,validateStatus:A,headers:(b,T,I)=>t(Lt(b),Lt(T),I,!0)};return q.forEach(Object.keys(Object.assign({},f,u)),function(T){const I=y[T]||t,S=I(f[T],u[T],T);q.isUndefined(S)&&I!==A||(l[T]=S)}),l}const un=f=>{const u=Ee({},f);let{data:l,withXSRFToken:e,xsrfHeaderName:t,xsrfCookieName:i,headers:r,auth:A}=u;u.headers=r=ve.from(r),u.url=tn(an(u.baseURL,u.url),f.params,f.paramsSerializer),A&&r.set("Authorization","Basic "+btoa((A.username||"")+":"+(A.password?unescape(encodeURIComponent(A.password)):"")));let y;if(q.isFormData(l)){if(de.hasStandardBrowserEnv||de.hasStandardBrowserWebWorkerEnv)r.setContentType(void 0);else if((y=r.getContentType())!==!1){const[b,...T]=y?y.split(";").map(I=>I.trim()).filter(Boolean):[];r.setContentType([b||"multipart/form-data",...T].join("; "))}}if(de.hasStandardBrowserEnv&&(e&&q.isFunction(e)&&(e=e(u)),e||e!==!1&&Ur(u.url))){const b=t&&i&&kr.read(i);b&&r.set(t,b)}return u},Hr=typeof XMLHttpRequest<"u",Fr=Hr&&function(f){return new Promise(function(l,e){const t=un(f);let i=t.data;const r=ve.from(t.headers).normalize();let{responseType:A,onUploadProgress:y,onDownloadProgress:b}=t,T,I,S,M,o;function O(){M&&M(),o&&o(),t.cancelToken&&t.cancelToken.unsubscribe(T),t.signal&&t.signal.removeEventListener("abort",T)}let E=new XMLHttpRequest;E.open(t.method.toUpperCase(),t.url,!0),E.timeout=t.timeout;function w(){if(!E)return;const p=ve.from("getAllResponseHeaders"in E&&E.getAllResponseHeaders()),c={data:!A||A==="text"||A==="json"?E.responseText:E.response,status:E.status,statusText:E.statusText,headers:p,config:f,request:E};sn(function(s){l(s),O()},function(s){e(s),O()},c),E=null}"onloadend"in E?E.onloadend=w:E.onreadystatechange=function(){!E||E.readyState!==4||E.status===0&&!(E.responseURL&&E.responseURL.indexOf("file:")===0)||setTimeout(w)},E.onabort=function(){E&&(e(new te("Request aborted",te.ECONNABORTED,f,E)),E=null)},E.onerror=function(){e(new te("Network Error",te.ERR_NETWORK,f,E)),E=null},E.ontimeout=function(){let R=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const c=t.transitional||nn;t.timeoutErrorMessage&&(R=t.timeoutErrorMessage),e(new te(R,c.clarifyTimeoutError?te.ETIMEDOUT:te.ECONNABORTED,f,E)),E=null},i===void 0&&r.setContentType(null),"setRequestHeader"in E&&q.forEach(r.toJSON(),function(R,c){E.setRequestHeader(c,R)}),q.isUndefined(t.withCredentials)||(E.withCredentials=!!t.withCredentials),A&&A!=="json"&&(E.responseType=t.responseType),b&&([S,o]=Fe(b,!0),E.addEventListener("progress",S)),y&&E.upload&&([I,M]=Fe(y),E.upload.addEventListener("progress",I),E.upload.addEventListener("loadend",M)),(t.cancelToken||t.signal)&&(T=p=>{E&&(e(!p||p.type?new Ie(null,f,E):p),E.abort(),E=null)},t.cancelToken&&t.cancelToken.subscribe(T),t.signal&&(t.signal.aborted?T():t.signal.addEventListener("abort",T)));const C=Lr(t.url);if(C&&de.protocols.indexOf(C)===-1){e(new te("Unsupported protocol "+C+":",te.ERR_BAD_REQUEST,f));return}E.send(i||null)})},Gr=(f,u)=>{const{length:l}=f=f?f.filter(Boolean):[];if(u||l){let e=new AbortController,t;const i=function(b){if(!t){t=!0,A();const T=b instanceof Error?b:this.reason;e.abort(T instanceof te?T:new Ie(T instanceof Error?T.message:T))}};let r=u&&setTimeout(()=>{r=null,i(new te(`timeout ${u} of ms exceeded`,te.ETIMEDOUT))},u);const A=()=>{f&&(r&&clearTimeout(r),r=null,f.forEach(b=>{b.unsubscribe?b.unsubscribe(i):b.removeEventListener("abort",i)}),f=null)};f.forEach(b=>b.addEventListener("abort",i));const{signal:y}=e;return y.unsubscribe=()=>q.asap(A),y}},_r=function*(f,u){let l=f.byteLength;if(l<u){yield f;return}let e=0,t;for(;e<l;)t=e+u,yield f.slice(e,t),e=t},Wr=async function*(f,u){for await(const l of Vr(f))yield*_r(l,u)},Vr=async function*(f){if(f[Symbol.asyncIterator]){yield*f;return}const u=f.getReader();try{for(;;){const{done:l,value:e}=await u.read();if(l)break;yield e}}finally{await u.cancel()}},Dt=(f,u,l,e)=>{const t=Wr(f,u);let i=0,r,A=y=>{r||(r=!0,e&&e(y))};return new ReadableStream({async pull(y){try{const{done:b,value:T}=await t.next();if(b){A(),y.close();return}let I=T.byteLength;if(l){let S=i+=I;l(S)}y.enqueue(new Uint8Array(T))}catch(b){throw A(b),b}},cancel(y){return A(y),t.return()}},{highWaterMark:2})},Qe=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",cn=Qe&&typeof ReadableStream=="function",zr=Qe&&(typeof TextEncoder=="function"?(f=>u=>f.encode(u))(new TextEncoder):async f=>new Uint8Array(await new Response(f).arrayBuffer())),ln=(f,...u)=>{try{return!!f(...u)}catch{return!1}},qr=cn&&ln(()=>{let f=!1;const u=new Request(de.origin,{body:new ReadableStream,method:"POST",get duplex(){return f=!0,"half"}}).headers.has("Content-Type");return f&&!u}),Nt=64*1024,ht=cn&&ln(()=>q.isReadableStream(new Response("").body)),Ge={stream:ht&&(f=>f.body)};Qe&&(f=>{["text","arrayBuffer","blob","formData","stream"].forEach(u=>{!Ge[u]&&(Ge[u]=q.isFunction(f[u])?l=>l[u]():(l,e)=>{throw new te(`Response type '${u}' is not supported`,te.ERR_NOT_SUPPORT,e)})})})(new Response);const Kr=async f=>{if(f==null)return 0;if(q.isBlob(f))return f.size;if(q.isSpecCompliantForm(f))return(await new Request(de.origin,{method:"POST",body:f}).arrayBuffer()).byteLength;if(q.isArrayBufferView(f)||q.isArrayBuffer(f))return f.byteLength;if(q.isURLSearchParams(f)&&(f=f+""),q.isString(f))return(await zr(f)).byteLength},Jr=async(f,u)=>{const l=q.toFiniteNumber(f.getContentLength());return l??Kr(u)},Qr=Qe&&(async f=>{let{url:u,method:l,data:e,signal:t,cancelToken:i,timeout:r,onDownloadProgress:A,onUploadProgress:y,responseType:b,headers:T,withCredentials:I="same-origin",fetchOptions:S}=un(f);b=b?(b+"").toLowerCase():"text";let M=Gr([t,i&&i.toAbortSignal()],r),o;const O=M&&M.unsubscribe&&(()=>{M.unsubscribe()});let E;try{if(y&&qr&&l!=="get"&&l!=="head"&&(E=await Jr(T,e))!==0){let c=new Request(u,{method:"POST",body:e,duplex:"half"}),a;if(q.isFormData(e)&&(a=c.headers.get("content-type"))&&T.setContentType(a),c.body){const[s,n]=Mt(E,Fe(xt(y)));e=Dt(c.body,Nt,s,n)}}q.isString(I)||(I=I?"include":"omit");const w="credentials"in Request.prototype;o=new Request(u,{...S,signal:M,method:l.toUpperCase(),headers:T.normalize().toJSON(),body:e,duplex:"half",credentials:w?I:void 0});let C=await fetch(o);const p=ht&&(b==="stream"||b==="response");if(ht&&(A||p&&O)){const c={};["status","statusText","headers"].forEach(h=>{c[h]=C[h]});const a=q.toFiniteNumber(C.headers.get("content-length")),[s,n]=A&&Mt(a,Fe(xt(A),!0))||[];C=new Response(Dt(C.body,Nt,s,()=>{n&&n(),O&&O()}),c)}b=b||"text";let R=await Ge[q.findKey(Ge,b)||"text"](C,f);return!p&&O&&O(),await new Promise((c,a)=>{sn(c,a,{data:R,headers:ve.from(C.headers),status:C.status,statusText:C.statusText,config:f,request:o})})}catch(w){throw O&&O(),w&&w.name==="TypeError"&&/fetch/i.test(w.message)?Object.assign(new te("Network Error",te.ERR_NETWORK,f,o),{cause:w.cause||w}):te.from(w,w&&w.code,f,o)}}),pt={http:lr,xhr:Fr,fetch:Qr};q.forEach(pt,(f,u)=>{if(f){try{Object.defineProperty(f,"name",{value:u})}catch{}Object.defineProperty(f,"adapterName",{value:u})}});const Ut=f=>`- ${f}`,Xr=f=>q.isFunction(f)||f===null||f===!1,fn={getAdapter:f=>{f=q.isArray(f)?f:[f];const{length:u}=f;let l,e;const t={};for(let i=0;i<u;i++){l=f[i];let r;if(e=l,!Xr(l)&&(e=pt[(r=String(l)).toLowerCase()],e===void 0))throw new te(`Unknown adapter '${r}'`);if(e)break;t[r||"#"+i]=e}if(!e){const i=Object.entries(t).map(([A,y])=>`adapter ${A} `+(y===!1?"is not supported by the environment":"is not available in the build"));let r=u?i.length>1?`since :
`+i.map(Ut).join(`
`):" "+Ut(i[0]):"as no adapter specified";throw new te("There is no suitable adapter to dispatch the request "+r,"ERR_NOT_SUPPORT")}return e},adapters:pt};function st(f){if(f.cancelToken&&f.cancelToken.throwIfRequested(),f.signal&&f.signal.aborted)throw new Ie(null,f)}function kt(f){return st(f),f.headers=ve.from(f.headers),f.data=ot.call(f,f.transformRequest),["post","put","patch"].indexOf(f.method)!==-1&&f.headers.setContentType("application/x-www-form-urlencoded",!1),fn.getAdapter(f.adapter||Ne.adapter)(f).then(function(e){return st(f),e.data=ot.call(f,f.transformResponse,e),e.headers=ve.from(e.headers),e},function(e){return on(e)||(st(f),e&&e.response&&(e.response.data=ot.call(f,f.transformResponse,e.response),e.response.headers=ve.from(e.response.headers))),Promise.reject(e)})}const dn="1.7.9",Xe={};["object","boolean","number","function","string","symbol"].forEach((f,u)=>{Xe[f]=function(e){return typeof e===f||"a"+(u<1?"n ":" ")+f}});const Bt={};Xe.transitional=function(u,l,e){function t(i,r){return"[Axios v"+dn+"] Transitional option '"+i+"'"+r+(e?". "+e:"")}return(i,r,A)=>{if(u===!1)throw new te(t(r," has been removed"+(l?" in "+l:"")),te.ERR_DEPRECATED);return l&&!Bt[r]&&(Bt[r]=!0,console.warn(t(r," has been deprecated since v"+l+" and will be removed in the near future"))),u?u(i,r,A):!0}};Xe.spelling=function(u){return(l,e)=>(console.warn(`${e} is likely a misspelling of ${u}`),!0)};function $r(f,u,l){if(typeof f!="object")throw new te("options must be an object",te.ERR_BAD_OPTION_VALUE);const e=Object.keys(f);let t=e.length;for(;t-- >0;){const i=e[t],r=u[i];if(r){const A=f[i],y=A===void 0||r(A,i,f);if(y!==!0)throw new te("option "+i+" must be "+y,te.ERR_BAD_OPTION_VALUE);continue}if(l!==!0)throw new te("Unknown option "+i,te.ERR_BAD_OPTION)}}const He={assertOptions:$r,validators:Xe},Oe=He.validators;class Ae{constructor(u){this.defaults=u,this.interceptors={request:new It,response:new It}}async request(u,l){try{return await this._request(u,l)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=new Error;const i=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?i&&!String(e.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(e.stack+=`
`+i):e.stack=i}catch{}}throw e}}_request(u,l){typeof u=="string"?(l=l||{},l.url=u):l=u||{},l=Ee(this.defaults,l);const{transitional:e,paramsSerializer:t,headers:i}=l;e!==void 0&&He.assertOptions(e,{silentJSONParsing:Oe.transitional(Oe.boolean),forcedJSONParsing:Oe.transitional(Oe.boolean),clarifyTimeoutError:Oe.transitional(Oe.boolean)},!1),t!=null&&(q.isFunction(t)?l.paramsSerializer={serialize:t}:He.assertOptions(t,{encode:Oe.function,serialize:Oe.function},!0)),He.assertOptions(l,{baseUrl:Oe.spelling("baseURL"),withXsrfToken:Oe.spelling("withXSRFToken")},!0),l.method=(l.method||this.defaults.method||"get").toLowerCase();let r=i&&q.merge(i.common,i[l.method]);i&&q.forEach(["delete","get","head","post","put","patch","common"],o=>{delete i[o]}),l.headers=ve.concat(r,i);const A=[];let y=!0;this.interceptors.request.forEach(function(O){typeof O.runWhen=="function"&&O.runWhen(l)===!1||(y=y&&O.synchronous,A.unshift(O.fulfilled,O.rejected))});const b=[];this.interceptors.response.forEach(function(O){b.push(O.fulfilled,O.rejected)});let T,I=0,S;if(!y){const o=[kt.bind(this),void 0];for(o.unshift.apply(o,A),o.push.apply(o,b),S=o.length,T=Promise.resolve(l);I<S;)T=T.then(o[I++],o[I++]);return T}S=A.length;let M=l;for(I=0;I<S;){const o=A[I++],O=A[I++];try{M=o(M)}catch(E){O.call(this,E);break}}try{T=kt.call(this,M)}catch(o){return Promise.reject(o)}for(I=0,S=b.length;I<S;)T=T.then(b[I++],b[I++]);return T}getUri(u){u=Ee(this.defaults,u);const l=an(u.baseURL,u.url);return tn(l,u.params,u.paramsSerializer)}}q.forEach(["delete","get","head","options"],function(u){Ae.prototype[u]=function(l,e){return this.request(Ee(e||{},{method:u,url:l,data:(e||{}).data}))}});q.forEach(["post","put","patch"],function(u){function l(e){return function(i,r,A){return this.request(Ee(A||{},{method:u,headers:e?{"Content-Type":"multipart/form-data"}:{},url:i,data:r}))}}Ae.prototype[u]=l(),Ae.prototype[u+"Form"]=l(!0)});class bt{constructor(u){if(typeof u!="function")throw new TypeError("executor must be a function.");let l;this.promise=new Promise(function(i){l=i});const e=this;this.promise.then(t=>{if(!e._listeners)return;let i=e._listeners.length;for(;i-- >0;)e._listeners[i](t);e._listeners=null}),this.promise.then=t=>{let i;const r=new Promise(A=>{e.subscribe(A),i=A}).then(t);return r.cancel=function(){e.unsubscribe(i)},r},u(function(i,r,A){e.reason||(e.reason=new Ie(i,r,A),l(e.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(u){if(this.reason){u(this.reason);return}this._listeners?this._listeners.push(u):this._listeners=[u]}unsubscribe(u){if(!this._listeners)return;const l=this._listeners.indexOf(u);l!==-1&&this._listeners.splice(l,1)}toAbortSignal(){const u=new AbortController,l=e=>{u.abort(e)};return this.subscribe(l),u.signal.unsubscribe=()=>this.unsubscribe(l),u.signal}static source(){let u;return{token:new bt(function(t){u=t}),cancel:u}}}function Yr(f){return function(l){return f.apply(null,l)}}function Zr(f){return q.isObject(f)&&f.isAxiosError===!0}const vt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(vt).forEach(([f,u])=>{vt[u]=f});function hn(f){const u=new Ae(f),l=Wt(Ae.prototype.request,u);return q.extend(l,Ae.prototype,u,{allOwnKeys:!0}),q.extend(l,u,null,{allOwnKeys:!0}),l.create=function(t){return hn(Ee(f,t))},l}const ae=hn(Ne);ae.Axios=Ae;ae.CanceledError=Ie;ae.CancelToken=bt;ae.isCancel=on;ae.VERSION=dn;ae.toFormData=Je;ae.AxiosError=te;ae.Cancel=ae.CanceledError;ae.all=function(u){return Promise.all(u)};ae.spread=Yr;ae.isAxiosError=Zr;ae.mergeConfig=Ee;ae.AxiosHeaders=ve;ae.formToJSON=f=>rn(q.isHTMLForm(f)?new FormData(f):f);ae.getAdapter=fn.getAdapter;ae.HttpStatusCode=vt;ae.default=ae;function ei(f){if(f===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f}function le(f,u,l){return u=Te(u),ni(f,pn()?Reflect.construct(u,l||[],Te(f).constructor):u.apply(f,l))}function oe(f,u){if(!(f instanceof u))throw new TypeError("Cannot call a class as a function")}function ti(f,u){for(var l=0;l<u.length;l++){var e=u[l];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(f,si(e.key),e)}}function se(f,u,l){return u&&ti(f.prototype,u),Object.defineProperty(f,"prototype",{writable:!1}),f}function me(){return me=Object.assign?Object.assign.bind():function(f){for(var u=1;u<arguments.length;u++){var l=arguments[u];for(var e in l)({}).hasOwnProperty.call(l,e)&&(f[e]=l[e])}return f},me.apply(null,arguments)}function gt(){return gt=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(f,u,l){var e=ri(f,u);if(e){var t=Object.getOwnPropertyDescriptor(e,u);return t.get?t.get.call(arguments.length<3?f:l):t.value}},gt.apply(null,arguments)}function Te(f){return Te=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},Te(f)}function fe(f,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");f.prototype=Object.create(u&&u.prototype,{constructor:{value:f,writable:!0,configurable:!0}}),Object.defineProperty(f,"prototype",{writable:!1}),u&&mt(f,u)}function pn(){try{var f=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(pn=function(){return!!f})()}function ni(f,u){if(u&&(typeof u=="object"||typeof u=="function"))return u;if(u!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ei(f)}function Re(){Re=function(){return u};var f,u={},l=Object.prototype,e=l.hasOwnProperty,t=Object.defineProperty||function(m,g,k){m[g]=k.value},i=typeof Symbol=="function"?Symbol:{},r=i.iterator||"@@iterator",A=i.asyncIterator||"@@asyncIterator",y=i.toStringTag||"@@toStringTag";function b(m,g,k){return Object.defineProperty(m,g,{value:k,enumerable:!0,configurable:!0,writable:!0}),m[g]}try{b({},"")}catch{b=function(g,k,j){return g[k]=j}}function T(m,g,k,j){var F=g&&g.prototype instanceof w?g:w,V=Object.create(F.prototype),z=new L(j||[]);return t(V,"_invoke",{value:d(m,k,z)}),V}function I(m,g,k){try{return{type:"normal",arg:m.call(g,k)}}catch(j){return{type:"throw",arg:j}}}u.wrap=T;var S="suspendedStart",M="suspendedYield",o="executing",O="completed",E={};function w(){}function C(){}function p(){}var R={};b(R,r,function(){return this});var c=Object.getPrototypeOf,a=c&&c(c(x([])));a&&a!==l&&e.call(a,r)&&(R=a);var s=p.prototype=w.prototype=Object.create(R);function n(m){["next","throw","return"].forEach(function(g){b(m,g,function(k){return this._invoke(g,k)})})}function h(m,g){function k(F,V,z,_){var P=I(m[F],m,V);if(P.type!=="throw"){var U=P.arg,B=U.value;return B&&typeof B=="object"&&e.call(B,"__await")?g.resolve(B.__await).then(function(H){k("next",H,z,_)},function(H){k("throw",H,z,_)}):g.resolve(B).then(function(H){U.value=H,z(U)},function(H){return k("throw",H,z,_)})}_(P.arg)}var j;t(this,"_invoke",{value:function(F,V){function z(){return new g(function(_,P){k(F,V,_,P)})}return j=j?j.then(z,z):z()}})}function d(m,g,k){var j=S;return function(F,V){if(j===o)throw Error("Generator is already running");if(j===O){if(F==="throw")throw V;return{value:f,done:!0}}for(k.method=F,k.arg=V;;){var z=k.delegate;if(z){var _=v(z,k);if(_){if(_===E)continue;return _}}if(k.method==="next")k.sent=k._sent=k.arg;else if(k.method==="throw"){if(j===S)throw j=O,k.arg;k.dispatchException(k.arg)}else k.method==="return"&&k.abrupt("return",k.arg);j=o;var P=I(m,g,k);if(P.type==="normal"){if(j=k.done?O:M,P.arg===E)continue;return{value:P.arg,done:k.done}}P.type==="throw"&&(j=O,k.method="throw",k.arg=P.arg)}}}function v(m,g){var k=g.method,j=m.iterator[k];if(j===f)return g.delegate=null,k==="throw"&&m.iterator.return&&(g.method="return",g.arg=f,v(m,g),g.method==="throw")||k!=="return"&&(g.method="throw",g.arg=new TypeError("The iterator does not provide a '"+k+"' method")),E;var F=I(j,m.iterator,g.arg);if(F.type==="throw")return g.method="throw",g.arg=F.arg,g.delegate=null,E;var V=F.arg;return V?V.done?(g[m.resultName]=V.value,g.next=m.nextLoc,g.method!=="return"&&(g.method="next",g.arg=f),g.delegate=null,E):V:(g.method="throw",g.arg=new TypeError("iterator result is not an object"),g.delegate=null,E)}function N(m){var g={tryLoc:m[0]};1 in m&&(g.catchLoc=m[1]),2 in m&&(g.finallyLoc=m[2],g.afterLoc=m[3]),this.tryEntries.push(g)}function D(m){var g=m.completion||{};g.type="normal",delete g.arg,m.completion=g}function L(m){this.tryEntries=[{tryLoc:"root"}],m.forEach(N,this),this.reset(!0)}function x(m){if(m||m===""){var g=m[r];if(g)return g.call(m);if(typeof m.next=="function")return m;if(!isNaN(m.length)){var k=-1,j=function F(){for(;++k<m.length;)if(e.call(m,k))return F.value=m[k],F.done=!1,F;return F.value=f,F.done=!0,F};return j.next=j}}throw new TypeError(typeof m+" is not iterable")}return C.prototype=p,t(s,"constructor",{value:p,configurable:!0}),t(p,"constructor",{value:C,configurable:!0}),C.displayName=b(p,y,"GeneratorFunction"),u.isGeneratorFunction=function(m){var g=typeof m=="function"&&m.constructor;return!!g&&(g===C||(g.displayName||g.name)==="GeneratorFunction")},u.mark=function(m){return Object.setPrototypeOf?Object.setPrototypeOf(m,p):(m.__proto__=p,b(m,y,"GeneratorFunction")),m.prototype=Object.create(s),m},u.awrap=function(m){return{__await:m}},n(h.prototype),b(h.prototype,A,function(){return this}),u.AsyncIterator=h,u.async=function(m,g,k,j,F){F===void 0&&(F=Promise);var V=new h(T(m,g,k,j),F);return u.isGeneratorFunction(g)?V:V.next().then(function(z){return z.done?z.value:V.next()})},n(s),b(s,y,"Generator"),b(s,r,function(){return this}),b(s,"toString",function(){return"[object Generator]"}),u.keys=function(m){var g=Object(m),k=[];for(var j in g)k.push(j);return k.reverse(),function F(){for(;k.length;){var V=k.pop();if(V in g)return F.value=V,F.done=!1,F}return F.done=!0,F}},u.values=x,L.prototype={constructor:L,reset:function(m){if(this.prev=0,this.next=0,this.sent=this._sent=f,this.done=!1,this.delegate=null,this.method="next",this.arg=f,this.tryEntries.forEach(D),!m)for(var g in this)g.charAt(0)==="t"&&e.call(this,g)&&!isNaN(+g.slice(1))&&(this[g]=f)},stop:function(){this.done=!0;var m=this.tryEntries[0].completion;if(m.type==="throw")throw m.arg;return this.rval},dispatchException:function(m){if(this.done)throw m;var g=this;function k(P,U){return V.type="throw",V.arg=m,g.next=P,U&&(g.method="next",g.arg=f),!!U}for(var j=this.tryEntries.length-1;j>=0;--j){var F=this.tryEntries[j],V=F.completion;if(F.tryLoc==="root")return k("end");if(F.tryLoc<=this.prev){var z=e.call(F,"catchLoc"),_=e.call(F,"finallyLoc");if(z&&_){if(this.prev<F.catchLoc)return k(F.catchLoc,!0);if(this.prev<F.finallyLoc)return k(F.finallyLoc)}else if(z){if(this.prev<F.catchLoc)return k(F.catchLoc,!0)}else{if(!_)throw Error("try statement without catch or finally");if(this.prev<F.finallyLoc)return k(F.finallyLoc)}}}},abrupt:function(m,g){for(var k=this.tryEntries.length-1;k>=0;--k){var j=this.tryEntries[k];if(j.tryLoc<=this.prev&&e.call(j,"finallyLoc")&&this.prev<j.finallyLoc){var F=j;break}}F&&(m==="break"||m==="continue")&&F.tryLoc<=g&&g<=F.finallyLoc&&(F=null);var V=F?F.completion:{};return V.type=m,V.arg=g,F?(this.method="next",this.next=F.finallyLoc,E):this.complete(V)},complete:function(m,g){if(m.type==="throw")throw m.arg;return m.type==="break"||m.type==="continue"?this.next=m.arg:m.type==="return"?(this.rval=this.arg=m.arg,this.method="return",this.next="end"):m.type==="normal"&&g&&(this.next=g),E},finish:function(m){for(var g=this.tryEntries.length-1;g>=0;--g){var k=this.tryEntries[g];if(k.finallyLoc===m)return this.complete(k.completion,k.afterLoc),D(k),E}},catch:function(m){for(var g=this.tryEntries.length-1;g>=0;--g){var k=this.tryEntries[g];if(k.tryLoc===m){var j=k.completion;if(j.type==="throw"){var F=j.arg;D(k)}return F}}throw Error("illegal catch attempt")},delegateYield:function(m,g,k){return this.delegate={iterator:x(m),resultName:g,nextLoc:k},this.method==="next"&&(this.arg=f),E}},u}function mt(f,u){return mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,e){return l.__proto__=e,l},mt(f,u)}function ri(f,u){for(;!{}.hasOwnProperty.call(f,u)&&(f=Te(f))!==null;);return f}function ii(f,u,l,e){var t=gt(Te(f.prototype),u,l);return typeof t=="function"?function(i){return t.apply(l,i)}:t}function oi(f,u){if(typeof f!="object"||!f)return f;var l=f[Symbol.toPrimitive];if(l!==void 0){var e=l.call(f,u);if(typeof e!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(f)}function si(f){var u=oi(f,"string");return typeof u=="symbol"?u:u+""}function Le(f){"@babel/helpers - typeof";return Le=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},Le(f)}var $e=function(){function f(){oe(this,f)}return se(f,[{key:"listenForWhisper",value:function(l,e){return this.listen(".client-"+l,e)}},{key:"notification",value:function(l){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",l)}},{key:"stopListeningForWhisper",value:function(l,e){return this.stopListening(".client-"+l,e)}}])}();function _e(f,u){var l={};for(var e in f)Object.prototype.hasOwnProperty.call(f,e)&&u.indexOf(e)<0&&(l[e]=f[e]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var t=0,e=Object.getOwnPropertySymbols(f);t<e.length;t++)u.indexOf(e[t])<0&&Object.prototype.propertyIsEnumerable.call(f,e[t])&&(l[e[t]]=f[e[t]]);return l}function We(f,u,l,e){function t(i){return i instanceof l?i:new l(function(r){r(i)})}return new(l||(l=Promise))(function(i,r){function A(T){try{b(e.next(T))}catch(I){r(I)}}function y(T){try{b(e.throw(T))}catch(I){r(I)}}function b(T){T.done?i(T.value):t(T.value).then(A,y)}b((e=e.apply(f,[])).next())})}var Rt=function(){function f(u){oe(this,f),this.namespace=u}return se(f,[{key:"format",value:function(l){return[".","\\"].includes(l.charAt(0))?l.substring(1):(this.namespace&&(l=this.namespace+"."+l),l.replace(/\./g,"\\"))}},{key:"setNamespace",value:function(l){this.namespace=l}}])}(),St=function(f){function u(l,e,t){var i,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;return oe(this,u),i=le(this,u),i._alertErrorListeners=function(A){A&&i.errorListeners.forEach(function(y){return y(A)})},i.name=e,i.ably=l,i.options=t,i.eventFormatter=new Rt(i.options.namespace),i.subscribedListeners=[],i.errorListeners=[],i.channel=l.channels.get(e),i.callbacks=new Map,r&&i.subscribe(),i}return fe(u,f),se(u,[{key:"subscribe",value:function(){var e=this;this.channel.on(function(t){var i=t.previous,r=t.current,A=t.reason;i!=="attached"&&r=="attached"?e.subscribedListeners.forEach(function(y){return y()}):A&&e._alertErrorListeners(t)}),this.channel.attach(this._alertErrorListeners)}},{key:"unsubscribe",value:function(){this.channel.unsubscribe(),this.callbacks.clear(),this.unregisterError(),this.unregisterSubscribed(),this.channel.off(),this.channel.detach()}},{key:"listen",value:function(e,t){return this.callbacks.set(t,function(i){var r=i.data,A=_e(i,["data"]);return t(r,A)}),this.channel.subscribe(this.eventFormatter.format(e),this.callbacks.get(t)),this}},{key:"listenToAll",value:function(e){var t=this;return this.callbacks.set(e,function(i){var r=i.name,A=i.data,y=_e(i,["name","data"]),b=t.options.namespace.replace(/\./g,"\\"),T=r.startsWith(b)?r.substring(b.length+1):"."+r;e(T,A,y)}),this.channel.subscribe(this.callbacks.get(e)),this}},{key:"stopListening",value:function(e,t){return t?(this.channel.unsubscribe(this.eventFormatter.format(e),this.callbacks.get(t)),this.callbacks.delete(t)):this.channel.unsubscribe(this.eventFormatter.format(e)),this}},{key:"stopListeningToAll",value:function(e){return e?(this.channel.unsubscribe(this.callbacks.get(e)),this.callbacks.delete(e)):this.channel.unsubscribe(),this}},{key:"subscribed",value:function(e){return this.subscribedListeners.push(e),this}},{key:"error",value:function(e){return this.errorListeners.push(e),this}},{key:"unregisterSubscribed",value:function(e){return e?this.subscribedListeners=this.subscribedListeners.filter(function(t){return t!=e}):this.subscribedListeners=[],this}},{key:"unregisterError",value:function(e){return e?this.errorListeners=this.errorListeners.filter(function(t){return t!=e}):this.errorListeners=[],this}}])}($e),ai=function(f){function u(l,e,t,i){var r;return oe(this,u),r=le(this,u,[l,e,t,!1]),r.channel.on("failed",i.onChannelFailed(r)),r.subscribe(),r}return fe(u,f),se(u,[{key:"whisper",value:function(e,t,i){return i?this.channel.publish("client-".concat(e),t,i):this.channel.publish("client-".concat(e),t),this}}])}(St),vn=function(f){function u(l,e,t,i){var r;return oe(this,u),r=le(this,u,[l,e,t,!1]),r.channel.on("failed",i.onChannelFailed(r)),r.channel.on("attached",function(){return r.enter(r.presenceData,r._alertErrorListeners)}),r.subscribe(),r}return fe(u,f),se(u,[{key:"unsubscribe",value:function(){this.leave(this.presenceData,this._alertErrorListeners),this.channel.presence.unsubscribe(),ii(u,"unsubscribe",this)([])}},{key:"here",value:function(e){var t=this;return this.channel.presence.subscribe(["enter","update","leave"],function(){return t.channel.presence.get(function(i,r){return e(r.map(function(A){var y=A.data;return y}),i)})}),this}},{key:"joining",value:function(e){return this.channel.presence.subscribe(["enter","update"],function(t){var i=t.data,r=_e(t,["data"]);e(i,r)}),this}},{key:"leaving",value:function(e){return this.channel.presence.subscribe("leave",function(t){var i=t.data,r=_e(t,["data"]);e(i,r)}),this}},{key:"enter",value:function(e,t){return this.channel.presence.enter(e,t),this}},{key:"leave",value:function(e,t){return this.channel.presence.leave(e,t),this}},{key:"update",value:function(e,t){return this.channel.presence.update(e,t),this}},{key:"whisper",value:function(e,t,i){return i?this.channel.publish("client-".concat(e),t,i):this.channel.publish("client-".concat(e),t),this}}])}(St),ui=function(u){return u==null||u===void 0},gn=function(u){var l=u.split(".")[0],e=l.replace("-","+").replace("_","/"),t=JSON.parse(jt(e)),i=u.split(".")[1],r=i.replace("-","+").replace("_","/"),A=JSON.parse(jt(r));return{header:t,payload:A}},at=function(u){var l=gn(u),e=l.payload;return{clientId:e["x-ably-clientId"],expires:e.exp*1e3,issued:e.iat*1e3,token:u}},Ye=(typeof window>"u"?"undefined":Le(window))==="object",jt=function(u){var l=u.replace(/-/g,"+").replace(/_/g,"/"),e=u.length%4===0?"":"=".repeat(4-u.length%4),t=l+e;return Ye?atob(t):Buffer.from(t,"base64").toString()},ci=function(u){var l="";return Ye?l=btoa(u):l=Buffer.from(u).toString("base64"),l.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},li=function(u){return u&&u.indexOf("http://")===0||u.indexOf("https://")===0},fi=function(u){var l,e,t;if(!li(u)&&typeof window<"u"){var i=(l=window==null?void 0:window.location)===null||l===void 0?void 0:l.hostname,r=(e=window==null?void 0:window.location)===null||e===void 0?void 0:e.port,A=(t=window==null?void 0:window.location)===null||t===void 0?void 0:t.protocol.replace(":","");if(i&&r&&A)return A+"://"+i+":"+r+u}return u},ut;function di(f,u){ut||(ut=new Ably.Rest.Platform.Http),Ye?delete f.headers["Content-Length"]:f.method=f.method.toLowerCase(),ut.doUri(f.method,null,f.uri,f.headers,f.body,f.paramsIfNoHeaders||{},u)}var hi=function(u){return new Promise(function(l,e){di(u,function(t,i){if(t)e(t);else if(typeof i=="string")l(JSON.parse(i));else if(!Ye&&Buffer.isBuffer(i))try{l(JSON.parse(i.toString()))}catch{l(i)}else l(i)})})},Ht=!1,pi=function(u,l){var e=u.channels.get("dummy");if(e.__proto__.authorizeChannel=l,Ht)return;var t=e.__proto__._attach;if(ui(t)){console.warn("Failed to enable authorize for pre-attach, please check for right library version");return}function i(r,A,y){var b=this;if(!this.authorizing){this.authorizing=!0;var T=t.bind(this);this.authorizeChannel(this,function(I){if(b.authorizing=!1,I){y?y(I):console.error("channel ".concat(b.name," auth error => ").concat(I));return}else T(r,A,y)})}}e.__proto__._attach=i,Ht=!0},vi=se(function f(){var u=this,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0;oe(this,f),this.execute=function(t){return new Promise(function(i,r){u.queue.run(function(){return We(u,void 0,void 0,Re().mark(function A(){var y,b,T;return Re().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.prev=0,S.next=3,t(this.cachedToken);case 3:y=S.sent,b=y.token,T=y.info,this.cachedToken=b,i({token:b,info:T}),S.next=13;break;case 10:S.prev=10,S.t0=S.catch(0),r(S.t0);case 13:case"end":return S.stop()}},A,this,[[0,10]])}))})})},this.request=function(t){return u.execute(function(i){return u.requestTokenFn(t,i)})},this.cachedToken=l,this.requestTokenFn=e,this.queue=new gi}),gi=se(function f(){var u=this,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;oe(this,f),this.canRunNext=function(){return u.running.length<u.count&&u.todo.length},this.run=function(t){return We(u,void 0,void 0,Re().mark(function i(){var r;return Re().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:t&&this.todo.push(t);case 1:if(!this.canRunNext()){y.next=9;break}return r=this.todo.shift(),this.running.push(r),y.next=6,r();case 6:this.running.shift(),y.next=1;break;case 9:case"end":return y.stop()}},i,this)}))},this.total=l.length,this.todo=l,this.running=[],this.count=e}),mi=se(function f(u,l){var e=this;oe(this,f),this.expiredAuthChannels=new Set,this.setExpired=function(y){return e.expiredAuthChannels.add(y)},this.isExpired=function(y){return e.expiredAuthChannels.has(y)},this.removeExpired=function(y){return e.expiredAuthChannels.delete(y)},this.options={queryTime:!0,useTokenAuth:!0,authCallback:function(b,T){return We(e,void 0,void 0,Re().mark(function I(){var S,M,o;return Re().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.prev=0,E.next=3,this.authRequestExecuter.request(null);case 3:S=E.sent,M=S.token,o=at(M),T(null,o),E.next=12;break;case 9:E.prev=9,E.t0=E.catch(0),T(E.t0,null);case 12:case"end":return E.stop()}},I,this,[[0,9]])}))},echoMessages:!1},this.requestToken=function(y,b){return We(e,void 0,void 0,Re().mark(function T(){var I,S;return Re().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return I=JSON.stringify({channel_name:y,token:b}),S={uri:this.authEndpoint,method:"POST",headers:me({Accept:"application/json","Content-Type":"application/json","Content-Length":I.length},this.authHeaders),body:I},o.next=4,hi(S);case 4:return o.abrupt("return",o.sent);case 5:case"end":return o.stop()}},T,this)}))},this.ablyClient=function(){return e.ablyConnector.ably},this.existingToken=function(){return e.ablyClient().auth.tokenDetails},this.getChannel=function(y){return e.ablyConnector.channels[y]},this.enableAuthorizeBeforeChannelAttach=function(){var y=e.ablyClient();y.auth.getTimestamp(e.options.queryTime,function(){}),pi(y,function(b,T){var I=b.name;if(I.startsWith("public:")){T(null);return}var S=e.existingToken();if(S&&!e.isExpired(I)){var M=gn(S.token).payload["x-ably-capability"],o=M.includes("".concat(I,'"'));if(o&&S.expires>y.auth.getTimestampUsingOffset()){T(null);return}}e.authRequestExecuter.request(I).then(function(O){var E=O.token,w=O.info,C=e.getChannel(I);e.setPresenceInfo(C,w),e.tryAuthorizeOnSameConnection(me(me({},e.options),{token:at(E)}),function(p,R){p?T(p):(e.removeExpired(I),T(null))})}).catch(function(O){return T(O)})})},this.allowReconnectOnUserLogin=function(){var y=e.ablyClient().connection,b=function(I){I.reason.code==40102&&(y.off(b),console.warn("User login detected, re-connecting again!"),e.onClientIdChanged())};y.on("failed",b)},this.onClientIdChanged=function(){e.ablyClient().connect();for(var y=0,b=Object.values(e.ablyConnector.channels);y<b.length;y++){var T=b[y];T.channel.attach(T._alertErrorListeners)}},this.tryAuthorizeOnSameConnection=function(y,b){e.ablyClient().auth.authorize(null,y,b)},this.onChannelFailed=function(y){return function(b){var T;((T=b.reason)===null||T===void 0?void 0:T.code)==40160&&e.handleChannelAuthError(y)}},this.handleChannelAuthError=function(y){if(!y.skipAuth){var b=y.name;e.authRequestExecuter.request(b).then(function(T){var I=T.token,S=T.info;e.setPresenceInfo(y,S),e.tryAuthorizeOnSameConnection(me(me({},e.options),{token:at(I)}),function(M,o){M?y._alertErrorListeners(M):(y.skipAuth=!0,y.channel.once("attached",function(){y.skipAuth=!1}),y.channel.attach(y._alertErrorListeners))})}).catch(function(T){return y._alertErrorListeners(T)})}},this.setPresenceInfo=function(y,b){y instanceof vn&&(y.presenceData=b)},this.ablyConnector=u;var t=l.authEndpoint,i=l.auth.headers,r=l.token,A=l.requestTokenFn;this.authEndpoint=fi(t),this.authHeaders=i,this.authRequestExecuter=new vi(r,A??this.requestToken)}),Ze=function(f){function u(l,e,t){var i;return oe(this,u),i=le(this,u),i.name=e,i.pusher=l,i.options=t,i.eventFormatter=new Rt(i.options.namespace),i.subscribe(),i}return fe(u,f),se(u,[{key:"subscribe",value:function(){this.subscription=this.pusher.subscribe(this.name)}},{key:"unsubscribe",value:function(){this.pusher.unsubscribe(this.name)}},{key:"listen",value:function(e,t){return this.on(this.eventFormatter.format(e),t),this}},{key:"listenToAll",value:function(e){var t=this;return this.subscription.bind_global(function(i,r){if(!i.startsWith("pusher:")){var A=t.options.namespace.replace(/\./g,"\\"),y=i.startsWith(A)?i.substring(A.length+1):"."+i;e(y,r)}}),this}},{key:"stopListening",value:function(e,t){return t?this.subscription.unbind(this.eventFormatter.format(e),t):this.subscription.unbind(this.eventFormatter.format(e)),this}},{key:"stopListeningToAll",value:function(e){return e?this.subscription.unbind_global(e):this.subscription.unbind_global(),this}},{key:"subscribed",value:function(e){return this.on("pusher:subscription_succeeded",function(){e()}),this}},{key:"error",value:function(e){return this.on("pusher:subscription_error",function(t){e(t)}),this}},{key:"on",value:function(e,t){return this.subscription.bind(e,t),this}}])}($e),yi=function(f){function u(){return oe(this,u),le(this,u,arguments)}return fe(u,f),se(u,[{key:"whisper",value:function(e,t){return this.pusher.channels.channels[this.name].trigger("client-".concat(e),t),this}}])}(Ze),Ci=function(f){function u(){return oe(this,u),le(this,u,arguments)}return fe(u,f),se(u,[{key:"whisper",value:function(e,t){return this.pusher.channels.channels[this.name].trigger("client-".concat(e),t),this}}])}(Ze),Oi=function(f){function u(){return oe(this,u),le(this,u,arguments)}return fe(u,f),se(u,[{key:"here",value:function(e){return this.on("pusher:subscription_succeeded",function(t){e(Object.keys(t.members).map(function(i){return t.members[i]}))}),this}},{key:"joining",value:function(e){return this.on("pusher:member_added",function(t){e(t.info)}),this}},{key:"whisper",value:function(e,t){return this.pusher.channels.channels[this.name].trigger("client-".concat(e),t),this}},{key:"leaving",value:function(e){return this.on("pusher:member_removed",function(t){e(t.info)}),this}}])}(Ze),mn=function(f){function u(l,e,t){var i;return oe(this,u),i=le(this,u),i.events={},i.listeners={},i.name=e,i.socket=l,i.options=t,i.eventFormatter=new Rt(i.options.namespace),i.subscribe(),i}return fe(u,f),se(u,[{key:"subscribe",value:function(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"unsubscribe",value:function(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"listen",value:function(e,t){return this.on(this.eventFormatter.format(e),t),this}},{key:"stopListening",value:function(e,t){return this.unbindEvent(this.eventFormatter.format(e),t),this}},{key:"subscribed",value:function(e){return this.on("connect",function(t){e(t)}),this}},{key:"error",value:function(e){return this}},{key:"on",value:function(e,t){var i=this;return this.listeners[e]=this.listeners[e]||[],this.events[e]||(this.events[e]=function(r,A){i.name===r&&i.listeners[e]&&i.listeners[e].forEach(function(y){return y(A)})},this.socket.on(e,this.events[e])),this.listeners[e].push(t),this}},{key:"unbind",value:function(){var e=this;Object.keys(this.events).forEach(function(t){e.unbindEvent(t)})}},{key:"unbindEvent",value:function(e,t){this.listeners[e]=this.listeners[e]||[],t&&(this.listeners[e]=this.listeners[e].filter(function(i){return i!==t})),(!t||this.listeners[e].length===0)&&(this.events[e]&&(this.socket.removeListener(e,this.events[e]),delete this.events[e]),delete this.listeners[e])}}])}($e),yn=function(f){function u(){return oe(this,u),le(this,u,arguments)}return fe(u,f),se(u,[{key:"whisper",value:function(e,t){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(e),data:t}),this}}])}(mn),bi=function(f){function u(){return oe(this,u),le(this,u,arguments)}return fe(u,f),se(u,[{key:"here",value:function(e){return this.on("presence:subscribed",function(t){e(t.map(function(i){return i.user_info}))}),this}},{key:"joining",value:function(e){return this.on("presence:joining",function(t){return e(t.user_info)}),this}},{key:"whisper",value:function(e,t){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(e),data:t}),this}},{key:"leaving",value:function(e){return this.on("presence:leaving",function(t){return e(t.user_info)}),this}}])}(yn),Ve=function(f){function u(){return oe(this,u),le(this,u,arguments)}return fe(u,f),se(u,[{key:"subscribe",value:function(){}},{key:"unsubscribe",value:function(){}},{key:"listen",value:function(e,t){return this}},{key:"listenToAll",value:function(e){return this}},{key:"stopListening",value:function(e,t){return this}},{key:"subscribed",value:function(e){return this}},{key:"error",value:function(e){return this}},{key:"on",value:function(e,t){return this}}])}($e),Ft=function(f){function u(){return oe(this,u),le(this,u,arguments)}return fe(u,f),se(u,[{key:"whisper",value:function(e,t){return this}}])}(Ve),Ri=function(f){function u(){return oe(this,u),le(this,u,arguments)}return fe(u,f),se(u,[{key:"here",value:function(e){return this}},{key:"joining",value:function(e){return this}},{key:"whisper",value:function(e,t){return this}},{key:"leaving",value:function(e){return this}}])}(Ve),et=function(){function f(u){oe(this,f),this._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},broadcaster:"pusher",csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"},this.setOptions(u),this.connect()}return se(f,[{key:"setOptions",value:function(l){this.options=me(this._defaultOptions,l);var e=this.csrfToken();return e&&(this.options.auth.headers["X-CSRF-TOKEN"]=e,this.options.userAuthentication.headers["X-CSRF-TOKEN"]=e),e=this.options.bearerToken,e&&(this.options.auth.headers.Authorization="Bearer "+e,this.options.userAuthentication.headers.Authorization="Bearer "+e),l}},{key:"csrfToken",value:function(){var l;return typeof window<"u"&&window.Laravel&&window.Laravel.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:typeof document<"u"&&typeof document.querySelector=="function"&&(l=document.querySelector('meta[name="csrf-token"]'))?l.getAttribute("content"):null}}])}(),Gt=function(f){function u(){var l;return oe(this,u),l=le(this,u,arguments),l.channels={},l}return fe(u,f),se(u,[{key:"connect",value:function(){typeof this.options.client<"u"?this.pusher=this.options.client:this.options.Pusher?this.pusher=new this.options.Pusher(this.options.key,this.options):this.pusher=new Pusher(this.options.key,this.options)}},{key:"signin",value:function(){this.pusher.signin()}},{key:"listen",value:function(e,t,i){return this.channel(e).listen(t,i)}},{key:"channel",value:function(e){return this.channels[e]||(this.channels[e]=new Ze(this.pusher,e,this.options)),this.channels[e]}},{key:"privateChannel",value:function(e){return this.channels["private-"+e]||(this.channels["private-"+e]=new yi(this.pusher,"private-"+e,this.options)),this.channels["private-"+e]}},{key:"encryptedPrivateChannel",value:function(e){return this.channels["private-encrypted-"+e]||(this.channels["private-encrypted-"+e]=new Ci(this.pusher,"private-encrypted-"+e,this.options)),this.channels["private-encrypted-"+e]}},{key:"presenceChannel",value:function(e){return this.channels["presence-"+e]||(this.channels["presence-"+e]=new Oi(this.pusher,"presence-"+e,this.options)),this.channels["presence-"+e]}},{key:"leave",value:function(e){var t=this,i=[e,"private-"+e,"private-encrypted-"+e,"presence-"+e];i.forEach(function(r,A){t.leaveChannel(r)})}},{key:"leaveChannel",value:function(e){this.channels[e]&&(this.channels[e].unsubscribe(),delete this.channels[e])}},{key:"socketId",value:function(){return this.pusher.connection.socket_id}},{key:"disconnect",value:function(){this.pusher.disconnect()}}])}(et),Si=function(f){function u(){var l;return oe(this,u),l=le(this,u,arguments),l.channels={},l}return fe(u,f),se(u,[{key:"connect",value:function(){var e=this,t=this.getSocketIO();return this.socket=t(this.options.host,this.options),this.socket.on("reconnect",function(){Object.values(e.channels).forEach(function(i){i.subscribe()})}),this.socket}},{key:"getSocketIO",value:function(){if(typeof this.options.client<"u")return this.options.client;if(typeof io<"u")return io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}},{key:"listen",value:function(e,t,i){return this.channel(e).listen(t,i)}},{key:"channel",value:function(e){return this.channels[e]||(this.channels[e]=new mn(this.socket,e,this.options)),this.channels[e]}},{key:"privateChannel",value:function(e){return this.channels["private-"+e]||(this.channels["private-"+e]=new yn(this.socket,"private-"+e,this.options)),this.channels["private-"+e]}},{key:"presenceChannel",value:function(e){return this.channels["presence-"+e]||(this.channels["presence-"+e]=new bi(this.socket,"presence-"+e,this.options)),this.channels["presence-"+e]}},{key:"leave",value:function(e){var t=this,i=[e,"private-"+e,"presence-"+e];i.forEach(function(r){t.leaveChannel(r)})}},{key:"leaveChannel",value:function(e){this.channels[e]&&(this.channels[e].unsubscribe(),delete this.channels[e])}},{key:"socketId",value:function(){return this.socket.id}},{key:"disconnect",value:function(){this.socket.disconnect()}}])}(et),Ai=function(f){function u(){var l;return oe(this,u),l=le(this,u,arguments),l.channels={},l}return fe(u,f),se(u,[{key:"connect",value:function(){}},{key:"listen",value:function(e,t,i){return new Ve}},{key:"channel",value:function(e){return new Ve}},{key:"privateChannel",value:function(e){return new Ft}},{key:"encryptedPrivateChannel",value:function(e){return new Ft}},{key:"presenceChannel",value:function(e){return new Ri}},{key:"leave",value:function(e){}},{key:"leaveChannel",value:function(e){}},{key:"socketId",value:function(){return"fake-socket-id"}},{key:"disconnect",value:function(){}}])}(et),Cn=function(f){function u(){var l;return oe(this,u),l=le(this,u,arguments),l.channels={},l}return fe(u,f),se(u,[{key:"connect",value:function(){typeof this.options.client<"u"?this.ably=this.options.client:(this.ablyAuth=new mi(this,this.options),this.options.agents||(this.options.agents={}),this.options.agents["laravel-echo"]=u.LIB_VERSION,this.ably=new Ably.Realtime(me(me({},this.ablyAuth.options),this.options)),this.ablyAuth.enableAuthorizeBeforeChannelAttach(),this.ablyAuth.allowReconnectOnUserLogin())}},{key:"listen",value:function(e,t,i){return this.channel(e).listen(t,i)}},{key:"channel",value:function(e){var t="public:".concat(e);return this.channels[t]||(this.channels[t]=new St(this.ably,t,this.options)),this.channels[t]}},{key:"privateChannel",value:function(e){var t="private:".concat(e);return this.channels[t]||(this.channels[t]=new ai(this.ably,t,this.options,this.ablyAuth)),this.channels[t]}},{key:"presenceChannel",value:function(e){var t="presence:".concat(e);return this.channels[t]||(this.channels[t]=new vn(this.ably,t,this.options,this.ablyAuth)),this.channels[t]}},{key:"leave",value:function(e){var t=this,i=["public:".concat(e),"private:".concat(e),"presence:".concat(e)];i.forEach(function(r,A){t.leaveChannel(r)})}},{key:"leaveChannel",value:function(e){if(e.indexOf("public:")!==0&&e.indexOf("private:")!==0&&e.indexOf("presence:")!==0)throw new Error("Error leaving ".concat(e,', name should be prefixed with either "public:", "private:" or "presence:"'));this.channels[e]&&(this.channels[e].unsubscribe(),this.ablyAuth.setExpired(e),delete this.channels[e])}},{key:"socketId",value:function(){var e,t={connectionKey:this.ably.connection.key,clientId:(e=this.ably.auth.clientId)!==null&&e!==void 0?e:null};return ci(JSON.stringify(t))}},{key:"disconnect",value:function(){this.ably.close()}}])}(et);Cn.LIB_VERSION="1.0.6";var Ei=function(){function f(u){oe(this,f),this.options=u,this.connect(),this.options.withoutInterceptors||this.registerInterceptors()}return se(f,[{key:"channel",value:function(l){return this.connector.channel(l)}},{key:"connect",value:function(){if(this.options.broadcaster=="ably")this.connector=new Cn(this.options);else if(this.options.broadcaster=="reverb")this.connector=new Gt(me(me({},this.options),{cluster:""}));else if(this.options.broadcaster=="pusher")this.connector=new Gt(this.options);else if(this.options.broadcaster=="socket.io")this.connector=new Si(this.options);else if(this.options.broadcaster=="null")this.connector=new Ai(this.options);else if(typeof this.options.broadcaster=="function")this.connector=new this.options.broadcaster(this.options);else throw new Error("Broadcaster ".concat(Le(this.options.broadcaster)," ").concat(this.options.broadcaster," is not supported."))}},{key:"disconnect",value:function(){this.connector.disconnect()}},{key:"join",value:function(l){return this.connector.presenceChannel(l)}},{key:"leave",value:function(l){this.connector.leave(l)}},{key:"leaveChannel",value:function(l){this.connector.leaveChannel(l)}},{key:"leaveAllChannels",value:function(){for(var l in this.connector.channels)this.leaveChannel(l)}},{key:"listen",value:function(l,e,t){return this.connector.listen(l,e,t)}},{key:"private",value:function(l){return this.connector.privateChannel(l)}},{key:"encryptedPrivate",value:function(l){return this.connector.encryptedPrivateChannel(l)}},{key:"socketId",value:function(){return this.connector.socketId()}},{key:"registerInterceptors",value:function(){typeof Vue=="function"&&Vue.http&&this.registerVueRequestInterceptor(),typeof axios=="function"&&this.registerAxiosRequestInterceptor(),typeof jQuery=="function"&&this.registerjQueryAjaxSetup(),(typeof Turbo>"u"?"undefined":Le(Turbo))==="object"&&this.registerTurboRequestInterceptor()}},{key:"registerVueRequestInterceptor",value:function(){var l=this;Vue.http.interceptors.push(function(e,t){l.socketId()&&e.headers.set("X-Socket-ID",l.socketId()),t()})}},{key:"registerAxiosRequestInterceptor",value:function(){var l=this;axios.interceptors.request.use(function(e){return l.socketId()&&(e.headers["X-Socket-Id"]=l.socketId()),e})}},{key:"registerjQueryAjaxSetup",value:function(){var l=this;typeof jQuery.ajax<"u"&&jQuery.ajaxPrefilter(function(e,t,i){l.socketId()&&i.setRequestHeader("X-Socket-Id",l.socketId())})}},{key:"registerTurboRequestInterceptor",value:function(){var l=this;document.addEventListener("turbo:before-fetch-request",function(e){e.detail.fetchOptions.headers["X-Socket-Id"]=l.socketId()})}}])}();function Ti(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var ct={exports:{}};/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.50
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */var _t;function wi(){return _t||(_t=1,function(f,u){(function(e,t){f.exports=t()})(window,function(){return function(l){var e={};function t(i){if(e[i])return e[i].exports;var r=e[i]={i,l:!1,exports:{}};return l[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=l,t.c=e,t.d=function(i,r,A){t.o(i,r)||Object.defineProperty(i,r,{enumerable:!0,get:A})},t.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},t.t=function(i,r){if(r&1&&(i=t(i)),r&8||r&4&&typeof i=="object"&&i&&i.__esModule)return i;var A=Object.create(null);if(t.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:i}),r&2&&typeof i!="string")for(var y in i)t.d(A,y,(function(b){return i[b]}).bind(null,y));return A},t.n=function(i){var r=i&&i.__esModule?function(){return i.default}:function(){return i};return t.d(r,"a",r),r},t.o=function(i,r){return Object.prototype.hasOwnProperty.call(i,r)},t.p="",t(t.s=42)}([function(l,e,t){t.r(e),t.d(e,"__extends",function(){return r}),t.d(e,"__assign",function(){return A}),t.d(e,"__rest",function(){return y}),t.d(e,"__decorate",function(){return b}),t.d(e,"__param",function(){return T}),t.d(e,"__metadata",function(){return I}),t.d(e,"__awaiter",function(){return S}),t.d(e,"__generator",function(){return M}),t.d(e,"__createBinding",function(){return o}),t.d(e,"__exportStar",function(){return O}),t.d(e,"__values",function(){return E}),t.d(e,"__read",function(){return w}),t.d(e,"__spread",function(){return C}),t.d(e,"__spreadArrays",function(){return p}),t.d(e,"__spreadArray",function(){return R}),t.d(e,"__await",function(){return c}),t.d(e,"__asyncGenerator",function(){return a}),t.d(e,"__asyncDelegator",function(){return s}),t.d(e,"__asyncValues",function(){return n}),t.d(e,"__makeTemplateObject",function(){return h}),t.d(e,"__importStar",function(){return v}),t.d(e,"__importDefault",function(){return N}),t.d(e,"__classPrivateFieldGet",function(){return D}),t.d(e,"__classPrivateFieldSet",function(){return L});/*! *****************************************************************************
		Copyright (c) Microsoft Corporation.

		Permission to use, copy, modify, and/or distribute this software for any
		purpose with or without fee is hereby granted.

		THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
		REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
		AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
		INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
		LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
		OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
		PERFORMANCE OF THIS SOFTWARE.
		***************************************************************************** */var i=function(x,m){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,k){g.__proto__=k}||function(g,k){for(var j in k)Object.prototype.hasOwnProperty.call(k,j)&&(g[j]=k[j])},i(x,m)};function r(x,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");i(x,m);function g(){this.constructor=x}x.prototype=m===null?Object.create(m):(g.prototype=m.prototype,new g)}var A=function(){return A=Object.assign||function(m){for(var g,k=1,j=arguments.length;k<j;k++){g=arguments[k];for(var F in g)Object.prototype.hasOwnProperty.call(g,F)&&(m[F]=g[F])}return m},A.apply(this,arguments)};function y(x,m){var g={};for(var k in x)Object.prototype.hasOwnProperty.call(x,k)&&m.indexOf(k)<0&&(g[k]=x[k]);if(x!=null&&typeof Object.getOwnPropertySymbols=="function")for(var j=0,k=Object.getOwnPropertySymbols(x);j<k.length;j++)m.indexOf(k[j])<0&&Object.prototype.propertyIsEnumerable.call(x,k[j])&&(g[k[j]]=x[k[j]]);return g}function b(x,m,g,k){var j=arguments.length,F=j<3?m:k===null?k=Object.getOwnPropertyDescriptor(m,g):k,V;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")F=Reflect.decorate(x,m,g,k);else for(var z=x.length-1;z>=0;z--)(V=x[z])&&(F=(j<3?V(F):j>3?V(m,g,F):V(m,g))||F);return j>3&&F&&Object.defineProperty(m,g,F),F}function T(x,m){return function(g,k){m(g,k,x)}}function I(x,m){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(x,m)}function S(x,m,g,k){function j(F){return F instanceof g?F:new g(function(V){V(F)})}return new(g||(g=Promise))(function(F,V){function z(U){try{P(k.next(U))}catch(B){V(B)}}function _(U){try{P(k.throw(U))}catch(B){V(B)}}function P(U){U.done?F(U.value):j(U.value).then(z,_)}P((k=k.apply(x,m||[])).next())})}function M(x,m){var g={label:0,sent:function(){if(F[0]&1)throw F[1];return F[1]},trys:[],ops:[]},k,j,F,V;return V={next:z(0),throw:z(1),return:z(2)},typeof Symbol=="function"&&(V[Symbol.iterator]=function(){return this}),V;function z(P){return function(U){return _([P,U])}}function _(P){if(k)throw new TypeError("Generator is already executing.");for(;g;)try{if(k=1,j&&(F=P[0]&2?j.return:P[0]?j.throw||((F=j.return)&&F.call(j),0):j.next)&&!(F=F.call(j,P[1])).done)return F;switch(j=0,F&&(P=[P[0]&2,F.value]),P[0]){case 0:case 1:F=P;break;case 4:return g.label++,{value:P[1],done:!1};case 5:g.label++,j=P[1],P=[0];continue;case 7:P=g.ops.pop(),g.trys.pop();continue;default:if(F=g.trys,!(F=F.length>0&&F[F.length-1])&&(P[0]===6||P[0]===2)){g=0;continue}if(P[0]===3&&(!F||P[1]>F[0]&&P[1]<F[3])){g.label=P[1];break}if(P[0]===6&&g.label<F[1]){g.label=F[1],F=P;break}if(F&&g.label<F[2]){g.label=F[2],g.ops.push(P);break}F[2]&&g.ops.pop(),g.trys.pop();continue}P=m.call(x,g)}catch(U){P=[6,U],j=0}finally{k=F=0}if(P[0]&5)throw P[1];return{value:P[0]?P[1]:void 0,done:!0}}}var o=Object.create?function(x,m,g,k){k===void 0&&(k=g),Object.defineProperty(x,k,{enumerable:!0,get:function(){return m[g]}})}:function(x,m,g,k){k===void 0&&(k=g),x[k]=m[g]};function O(x,m){for(var g in x)g!=="default"&&!Object.prototype.hasOwnProperty.call(m,g)&&o(m,x,g)}function E(x){var m=typeof Symbol=="function"&&Symbol.iterator,g=m&&x[m],k=0;if(g)return g.call(x);if(x&&typeof x.length=="number")return{next:function(){return x&&k>=x.length&&(x=void 0),{value:x&&x[k++],done:!x}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function w(x,m){var g=typeof Symbol=="function"&&x[Symbol.iterator];if(!g)return x;var k=g.call(x),j,F=[],V;try{for(;(m===void 0||m-- >0)&&!(j=k.next()).done;)F.push(j.value)}catch(z){V={error:z}}finally{try{j&&!j.done&&(g=k.return)&&g.call(k)}finally{if(V)throw V.error}}return F}function C(){for(var x=[],m=0;m<arguments.length;m++)x=x.concat(w(arguments[m]));return x}function p(){for(var x=0,m=0,g=arguments.length;m<g;m++)x+=arguments[m].length;for(var k=Array(x),j=0,m=0;m<g;m++)for(var F=arguments[m],V=0,z=F.length;V<z;V++,j++)k[j]=F[V];return k}function R(x,m,g){if(g||arguments.length===2)for(var k=0,j=m.length,F;k<j;k++)(F||!(k in m))&&(F||(F=Array.prototype.slice.call(m,0,k)),F[k]=m[k]);return x.concat(F||Array.prototype.slice.call(m))}function c(x){return this instanceof c?(this.v=x,this):new c(x)}function a(x,m,g){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var k=g.apply(x,m||[]),j,F=[];return j={},V("next"),V("throw"),V("return"),j[Symbol.asyncIterator]=function(){return this},j;function V(H){k[H]&&(j[H]=function(W){return new Promise(function(Q,X){F.push([H,W,Q,X])>1||z(H,W)})})}function z(H,W){try{_(k[H](W))}catch(Q){B(F[0][3],Q)}}function _(H){H.value instanceof c?Promise.resolve(H.value.v).then(P,U):B(F[0][2],H)}function P(H){z("next",H)}function U(H){z("throw",H)}function B(H,W){H(W),F.shift(),F.length&&z(F[0][0],F[0][1])}}function s(x){var m,g;return m={},k("next"),k("throw",function(j){throw j}),k("return"),m[Symbol.iterator]=function(){return this},m;function k(j,F){m[j]=x[j]?function(V){return(g=!g)?{value:c(x[j](V)),done:j==="return"}:F?F(V):V}:F}}function n(x){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=x[Symbol.asyncIterator],g;return m?m.call(x):(x=typeof E=="function"?E(x):x[Symbol.iterator](),g={},k("next"),k("throw"),k("return"),g[Symbol.asyncIterator]=function(){return this},g);function k(F){g[F]=x[F]&&function(V){return new Promise(function(z,_){V=x[F](V),j(z,_,V.done,V.value)})}}function j(F,V,z,_){Promise.resolve(_).then(function(P){F({value:P,done:z})},V)}}function h(x,m){return Object.defineProperty?Object.defineProperty(x,"raw",{value:m}):x.raw=m,x}var d=Object.create?function(x,m){Object.defineProperty(x,"default",{enumerable:!0,value:m})}:function(x,m){x.default=m};function v(x){if(x&&x.__esModule)return x;var m={};if(x!=null)for(var g in x)g!=="default"&&Object.prototype.hasOwnProperty.call(x,g)&&o(m,x,g);return d(m,x),m}function N(x){return x&&x.__esModule?x:{default:x}}function D(x,m,g,k){if(g==="a"&&!k)throw new TypeError("Private accessor was defined without a getter");if(typeof m=="function"?x!==m||!k:!m.has(x))throw new TypeError("Cannot read private member from an object whose class did not declare it");return g==="m"?k:g==="a"?k.call(x):k?k.value:m.get(x)}function L(x,m,g,k,j){if(k==="m")throw new TypeError("Private method is not writable");if(k==="a"&&!j)throw new TypeError("Private accessor was defined without a setter");if(typeof m=="function"?x!==m||!j:!m.has(x))throw new TypeError("Cannot write private member to an object whose class did not declare it");return k==="a"?j.call(x,g):j?j.value=g:m.set(x,g),g}},function(l,e,t){(function(i){Object.defineProperty(e,"__esModule",{value:!0}),e.allToUpperCase=e.allToLowerCase=e.encodeBody=e.decodeBody=e.Format=e.promisify=e.trim=e.arrChooseN=e.randomHexString=e.randomString=e.cheapRandStr=e.dataSizeBytes=e.inspectBody=e.inspectError=e.isErrorInfoOrPartialErrorInfo=e.now=e.parseQueryString=e.toQueryString=e.arrPopRandomElement=e.defaultPostHeaders=e.defaultGetHeaders=e.allSame=e.arrEvery=e.arrFilter=e.arrMap=e.safeArrForEach=e.arrForEach=e.forInOwnNonNullProperties=e.valuesArray=e.keysArray=e.arrWithoutValue=e.arrDeleteValue=e.arrIn=e.arrIndexOf=e.arrSubtract=e.arrIntersectOb=e.arrIntersect=e.intersect=e.containsValue=e.inherits=e.prototypicalClone=e.shallowClone=e.isEmptyArg=e.isOnlyPropIn=e.isEmpty=e.isObject=e.ensureArray=e.isArray=e.copy=e.mixin=void 0,e.arrEquals=e.toBase64=e.matchDerivedChannel=e.shallowEquals=e.getGlobalObject=e.getRetryTime=e.getJitterCoefficient=e.getBackoffCoefficient=void 0;var r=t(0),A=r.__importDefault(t(3)),y=r.__importStar(t(8)),b=r.__importDefault(t(4)),T=t(11),I=t(31);function S(G){return Math.floor(Math.random()*G.length)}function M(G){for(var K=[],J=1;J<arguments.length;J++)K[J-1]=arguments[J];for(var Y=0;Y<K.length;Y++){var ne=K[Y];if(!ne)break;var pe=Object.prototype.hasOwnProperty;for(var Pe in ne)(!pe||pe.call(ne,Pe))&&(G[Pe]=ne[Pe])}return G}e.mixin=M;function o(G){return M({},G)}e.copy=o,e.isArray=Array.isArray||function(G){return Object.prototype.toString.call(G)=="[object Array]"};function O(G){return p(G)?[]:(0,e.isArray)(G)?G:[G]}e.ensureArray=O;function E(G){return Object.prototype.toString.call(G)=="[object Object]"}e.isObject=E;function w(G){for(var K in G)return!1;return!0}e.isEmpty=w;function C(G,K){for(var J in G)if(J!==K)return!1;return!0}e.isOnlyPropIn=C;function p(G){return G==null}e.isEmptyArg=p;function R(G){var K=new Object;for(var J in G)K[J]=G[J];return K}e.shallowClone=R;function c(G,K){var J=function(){function ne(){}return ne}();J.prototype=G;var Y=new J;return K&&M(Y,K),Y}e.prototypicalClone=c;var a=function(G,K){if(A.default.Config.inherits){A.default.Config.inherits(G,K);return}G.super_=K,G.prototype=c(K.prototype,{constructor:G})};e.inherits=a;function s(G,K){for(var J in G)if(G[J]==K)return!0;return!1}e.containsValue=s;function n(G,K){return(0,e.isArray)(K)?h(G,K):d(G,K)}e.intersect=n;function h(G,K){for(var J=[],Y=0;Y<G.length;Y++){var ne=G[Y];(0,e.arrIndexOf)(K,ne)!=-1&&J.push(ne)}return J}e.arrIntersect=h;function d(G,K){for(var J=[],Y=0;Y<G.length;Y++){var ne=G[Y];ne in K&&J.push(ne)}return J}e.arrIntersectOb=d;function v(G,K){for(var J=[],Y=0;Y<G.length;Y++){var ne=G[Y];(0,e.arrIndexOf)(K,ne)==-1&&J.push(ne)}return J}e.arrSubtract=v,e.arrIndexOf=Array.prototype.indexOf?function(G,K,J){return G.indexOf(K,J)}:function(G,K,J){J=J||0;for(var Y=G.length;J<Y;J++)if(G[J]===K)return J;return-1};function N(G,K){return(0,e.arrIndexOf)(G,K)!==-1}e.arrIn=N;function D(G,K){var J=(0,e.arrIndexOf)(G,K),Y=J!=-1;return Y&&G.splice(J,1),Y}e.arrDeleteValue=D;function L(G,K){var J=G.slice();return D(J,K),J}e.arrWithoutValue=L;function x(G,K){var J=[];for(var Y in G)K&&!Object.prototype.hasOwnProperty.call(G,Y)||J.push(Y);return J}e.keysArray=x;function m(G,K){var J=[];for(var Y in G)K&&!Object.prototype.hasOwnProperty.call(G,Y)||J.push(G[Y]);return J}e.valuesArray=m;function g(G,K){for(var J in G)Object.prototype.hasOwnProperty.call(G,J)&&G[J]&&K(J)}e.forInOwnNonNullProperties=g,e.arrForEach=Array.prototype.forEach?function(G,K){G.forEach(K)}:function(G,K){for(var J=G.length,Y=0;Y<J;Y++)K(G[Y],Y,G)};function k(G,K){return(0,e.arrForEach)(G.slice(),K)}e.safeArrForEach=k,e.arrMap=Array.prototype.map?function(G,K){return G.map(K)}:function(G,K){for(var J=[],Y=G.length,ne=0;ne<Y;ne++)J.push(K(G[ne],ne,G));return J},e.arrFilter=Array.prototype.filter?function(G,K){return G.filter(K)}:function(G,K){for(var J=[],Y=G.length,ne=0;ne<Y;ne++)K(G[ne])&&J.push(G[ne]);return J},e.arrEvery=Array.prototype.every?function(G,K){return G.every(K)}:function(G,K){for(var J=G.length,Y=0;Y<J;Y++)if(!K(G[Y],Y,G))return!1;return!0};function j(G,K){if(G.length===0)return!0;var J=G[0][K];return(0,e.arrEvery)(G,function(Y){return Y[K]===J})}e.allSame=j;var F={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function V(G,K){var J=F[K||ie.json];return{accept:J,"X-Ably-Version":y.default.protocolVersion.toString(),"Ably-Agent":(0,y.getAgentString)(G)}}e.defaultGetHeaders=V;function z(G,K){var J,Y=J=F[K||ie.json];return{accept:Y,"content-type":J,"X-Ably-Version":y.default.protocolVersion.toString(),"Ably-Agent":(0,y.getAgentString)(G)}}e.defaultPostHeaders=z;function _(G){return G.splice(S(G),1)[0]}e.arrPopRandomElement=_;function P(G){var K=[];if(G)for(var J in G)K.push(encodeURIComponent(J)+"="+encodeURIComponent(G[J]));return K.length?"?"+K.join("&"):""}e.toQueryString=P;function U(G){for(var K,J=/([^?&=]+)=?([^&]*)/g,Y={};K=J.exec(G);)Y[decodeURIComponent(K[1])]=decodeURIComponent(K[2]);return Y}e.parseQueryString=U,e.now=Date.now||function(){return new Date().getTime()};function B(G){return typeof G=="object"&&G!==null&&(G.constructor.name=="ErrorInfo"||G.constructor.name=="PartialErrorInfo")}e.isErrorInfoOrPartialErrorInfo=B;function H(G){var K,J;return G instanceof Error||((K=G==null?void 0:G.constructor)===null||K===void 0?void 0:K.name)==="ErrorInfo"||((J=G==null?void 0:G.constructor)===null||J===void 0?void 0:J.name)==="PartialErrorInfo"?G.toString():A.default.Config.inspect(G)}e.inspectError=H;function W(G){return A.default.BufferUtils.isBuffer(G)?G.toString():typeof G=="string"?G:A.default.Config.inspect(G)}e.inspectBody=W;function Q(G){if(A.default.BufferUtils.isBuffer(G))return A.default.BufferUtils.byteLength(G);if(typeof G=="string")return A.default.Config.stringByteSize(G);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof G)}e.dataSizeBytes=Q;function X(){return String(Math.random()).substr(2)}e.cheapRandStr=X;var Z=function(G){if(A.default.Config.getRandomValues&&typeof Uint8Array<"u"){var K=new Uint8Array(G);return A.default.Config.getRandomValues(K),A.default.BufferUtils.base64Encode(K)}for(var J=A.default.BufferUtils.base64CharSet,Y=Math.round(G*4/3),ne="",pe=0;pe<Y;pe++)ne+=J[S(J)];return ne};e.randomString=Z;var ee=function(G){if(A.default.Config.getRandomValues&&typeof Uint8Array<"u"){var K=new Uint8Array(G);return A.default.Config.getRandomValues(K),A.default.BufferUtils.hexEncode(K)}for(var J=A.default.BufferUtils.hexCharSet,Y=G*2,ne="",pe=0;pe<Y;pe++)ne+=J[S(J)];return ne};e.randomHexString=ee;function re(G,K){for(var J=Math.min(K,G.length),Y=G.slice(),ne=[],pe=0;pe<J;pe++)ne.push(_(Y));return ne}e.arrChooseN=re,e.trim=String.prototype.trim?function(G){return G.trim()}:function(G){return G.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function $(G,K,J){return new Promise(function(Y,ne){G[K].apply(G,r.__spreadArray(r.__spreadArray([],J,!1),[function(pe,Pe){pe?ne(pe):Y(Pe)}],!1))})}e.promisify=$;var ie;(function(G){G.msgpack="msgpack",G.json="json"})(ie=e.Format||(e.Format={}));function ce(G,K){return K=="msgpack"?A.default.Config.msgpack.decode(G):JSON.parse(String(G))}e.decodeBody=ce;function he(G,K){return K=="msgpack"?A.default.Config.msgpack.encode(G,!0):JSON.stringify(G)}e.encodeBody=he;function ue(G){return G.map(function(K){return K&&K.toLowerCase()})}e.allToLowerCase=ue;function be(G){return G.map(function(K){return K&&K.toUpperCase()})}e.allToUpperCase=be;function Ue(G){return Math.min((G+2)/3,2)}e.getBackoffCoefficient=Ue;function ye(){return 1-Math.random()*.2}e.getJitterCoefficient=ye;function ke(G,K){return G*Ue(K)*ye()}e.getRetryTime=ke;function tt(){return i||(typeof window<"u"?window:self)}e.getGlobalObject=tt;function nt(G,K){return Object.keys(G).every(function(J){return G[J]===K[J]})&&Object.keys(K).every(function(J){return K[J]===G[J]})}e.shallowEquals=nt;function bn(G){var K=/^(\[([^?]*)(?:(.*))\])?(.+)$/,J=G.match(K);if(!J||!J.length||J.length<5)throw new b.default("regex match failed",400,40010);if(J[2])throw new b.default("cannot use a derived option with a ".concat(J[2]," channel"),400,40010);return{qualifierParam:J[3]||"",channelName:J[4]}}e.matchDerivedChannel=bn;function Rn(G){return A.default.Config.createHmac?Buffer.from(G,"ascii").toString("base64"):(0,T.stringify)((0,I.parse)(G))}e.toBase64=Rn;function Sn(G,K){return G.length===K.length&&(0,e.arrEvery)(G,function(J,Y){return J===K[Y]})}e.arrEquals=Sn}).call(this,t(13))},function(l,e,t){(function(i){Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),A=r.__importDefault(t(3)),y=i||(typeof window<"u"?window:self),b;(function(o){o[o.None=0]="None",o[o.Error=1]="Error",o[o.Major=2]="Major",o[o.Minor=3]="Minor",o[o.Micro=4]="Micro"})(b||(b={}));function T(o,O){return"".concat(o).padStart(O?3:2,"0")}function I(o){return A.default.Config.logTimestamps?function(O){var E=new Date;o(T(E.getHours())+":"+T(E.getMinutes())+":"+T(E.getSeconds())+"."+T(E.getMilliseconds(),1)+" "+O)}:o}var S=function(){var o,O,E,w;return typeof Window>"u"&&typeof WorkerGlobalScope>"u"||typeof((O=(o=y==null?void 0:y.console)===null||o===void 0?void 0:o.log)===null||O===void 0?void 0:O.apply)=="function"?(E=function(){for(var C=[],p=0;p<arguments.length;p++)C[p]=arguments[p];console.log.apply(console,C)},w=console.warn?function(){for(var C=[],p=0;p<arguments.length;p++)C[p]=arguments[p];console.warn.apply(console,C)}:E):y!=null&&y.console.log?E=w=function(){Function.prototype.apply.call(console.log,console,arguments)}:E=w=function(){},[E,w].map(I)},M=function(){function o(){o.logLevel=o.LOG_DEFAULT}return o.initLogHandlers=function(){var O=S(),E=O[0],w=O[1];this.logHandler=E,this.logErrorHandler=w},o.renamedClientOption=function(O,E){o.deprecationWarning("The `".concat(O,"` client option has been renamed to `").concat(E,"`. Please update your code to use `").concat(E,"` instead. `").concat(O,"` will be removed in a future version."))},o.renamedMethod=function(O,E,w){o.deprecationWarning("`".concat(O,"`s `").concat(E,"` method has been renamed to `").concat(w,"`. Please update your code to use `").concat(w,"` instead. `").concat(E,"` will be removed in a future version."))},o.deprecationWarning=function(O){o.shouldLog(b.Error)&&o.logErrorHandler("Ably: Deprecation warning - ".concat(O))},o.logLevel=b.Error,o.LOG_NONE=b.None,o.LOG_ERROR=b.Error,o.LOG_MAJOR=b.Major,o.LOG_MINOR=b.Minor,o.LOG_MICRO=b.Micro,o.LOG_DEFAULT=b.Error,o.LOG_DEBUG=b.Micro,o.logAction=function(O,E,w){o.shouldLog(O)&&(O===b.Error?o.logErrorHandler:o.logHandler)("Ably: "+E+": "+w)},o.deprecated=function(O,E){o.deprecationWarning("".concat(O," is deprecated and will be removed in a future version. ").concat(E))},o.shouldLog=function(O){return O<=o.logLevel},o.setLog=function(O,E){O!==void 0&&(o.logLevel=O),E!==void 0&&(o.logHandler=o.logErrorHandler=E)},o}();e.default=M}).call(this,t(13))},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function r(){}return r}();e.default=i},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.PartialErrorInfo=void 0;var i=t(0),r=i.__importDefault(t(3)),A=i.__importStar(t(1));function y(I){var S="["+I.constructor.name;return I.message&&(S+=": "+I.message),I.statusCode&&(S+="; statusCode="+I.statusCode),I.code&&(S+="; code="+I.code),I.cause&&(S+="; cause="+A.inspectError(I.cause)),I.href&&!(I.message&&I.message.indexOf("help.ably.io")>-1)&&(S+="; see "+I.href+" "),S+="]",S}var b=function(I){i.__extends(S,I);function S(M,o,O,E){var w=I.call(this,M)||this;return typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(w,S.prototype),w.code=o,w.statusCode=O,w.cause=E,w}return S.prototype.toString=function(){return y(this)},S.fromValues=function(M){var o=M,O=o.message,E=o.code,w=o.statusCode;if(typeof O!="string"||typeof E!="number"||typeof w!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+r.default.Config.inspect(M));var C=Object.assign(new S(O,E,w),M);return C.code&&!C.href&&(C.href="https://help.ably.io/error/"+C.code),C},S}(Error);e.default=b;var T=function(I){i.__extends(S,I);function S(M,o,O,E){var w=I.call(this,M)||this;return typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(w,S.prototype),w.code=o,w.statusCode=O,w.cause=E,w}return S.prototype.toString=function(){return y(this)},S}(Error);e.PartialErrorInfo=T},function(l,e,t){(function(i,r){l.exports=r(t(6))})(this,function(i){return function(){if(typeof ArrayBuffer=="function"){var r=i,A=r.lib,y=A.WordArray,b=y.init,T=y.init=function(I){if(I instanceof ArrayBuffer&&(I=new Uint8Array(I)),(I instanceof Int8Array||typeof Uint8ClampedArray<"u"&&I instanceof Uint8ClampedArray||I instanceof Int16Array||I instanceof Uint16Array||I instanceof Int32Array||I instanceof Uint32Array||I instanceof Float32Array||I instanceof Float64Array)&&(I=new Uint8Array(I.buffer,I.byteOffset,I.byteLength)),I instanceof Uint8Array){for(var S=I.byteLength,M=[],o=0;o<S;o++)M[o>>>2]|=I[o]<<24-o%4*8;b.call(this,M,S)}else b.apply(this,arguments)};T.prototype=y}}(),i.lib.WordArray})},function(l,e,t){(function(i){(function(r,A){l.exports=A()})(this,function(){var r=r||function(A,y){var b;if(typeof window<"u"&&window.crypto&&(b=window.crypto),!b&&typeof window<"u"&&window.msCrypto&&(b=window.msCrypto),!b&&typeof i<"u"&&i.crypto&&(b=i.crypto),!b)try{b=t(44)}catch{}var T=function(){if(b){if(typeof b.getRandomValues=="function")try{return b.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof b.randomBytes=="function")try{return b.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},I=Object.create||function(){function a(){}return function(s){var n;return a.prototype=s,n=new a,a.prototype=null,n}}(),S={},M=S.lib={},o=M.Base=function(){return{extend:function(a){var s=I(this);return a&&s.mixIn(a),(!s.hasOwnProperty("init")||this.init===s.init)&&(s.init=function(){s.$super.init.apply(this,arguments)}),s.init.prototype=s,s.$super=this,s},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var s in a)a.hasOwnProperty(s)&&(this[s]=a[s]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),O=M.WordArray=o.extend({init:function(a,s){a=this.words=a||[],s!=y?this.sigBytes=s:this.sigBytes=a.length*4},toString:function(a){return(a||w).stringify(this)},concat:function(a){var s=this.words,n=a.words,h=this.sigBytes,d=a.sigBytes;if(this.clamp(),h%4)for(var v=0;v<d;v++){var N=n[v>>>2]>>>24-v%4*8&255;s[h+v>>>2]|=N<<24-(h+v)%4*8}else for(var v=0;v<d;v+=4)s[h+v>>>2]=n[v>>>2];return this.sigBytes+=d,this},clamp:function(){var a=this.words,s=this.sigBytes;a[s>>>2]&=4294967295<<32-s%4*8,a.length=A.ceil(s/4)},clone:function(){var a=o.clone.call(this);return a.words=this.words.slice(0),a},random:function(a){for(var s=[],n=0;n<a;n+=4)s.push(T());return new O.init(s,a)}}),E=S.enc={},w=E.Hex={stringify:function(a){for(var s=a.words,n=a.sigBytes,h=[],d=0;d<n;d++){var v=s[d>>>2]>>>24-d%4*8&255;h.push((v>>>4).toString(16)),h.push((v&15).toString(16))}return h.join("")},parse:function(a){for(var s=a.length,n=[],h=0;h<s;h+=2)n[h>>>3]|=parseInt(a.substr(h,2),16)<<24-h%8*4;return new O.init(n,s/2)}},C=E.Latin1={stringify:function(a){for(var s=a.words,n=a.sigBytes,h=[],d=0;d<n;d++){var v=s[d>>>2]>>>24-d%4*8&255;h.push(String.fromCharCode(v))}return h.join("")},parse:function(a){for(var s=a.length,n=[],h=0;h<s;h++)n[h>>>2]|=(a.charCodeAt(h)&255)<<24-h%4*8;return new O.init(n,s)}},p=E.Utf8={stringify:function(a){try{return decodeURIComponent(escape(C.stringify(a)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(a){return C.parse(unescape(encodeURIComponent(a)))}},R=M.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new O.init,this._nDataBytes=0},_append:function(a){typeof a=="string"&&(a=p.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(a){var s,n=this._data,h=n.words,d=n.sigBytes,v=this.blockSize,N=v*4,D=d/N;a?D=A.ceil(D):D=A.max((D|0)-this._minBufferSize,0);var L=D*v,x=A.min(L*4,d);if(L){for(var m=0;m<L;m+=v)this._doProcessBlock(h,m);s=h.splice(0,L),n.sigBytes-=x}return new O.init(s,x)},clone:function(){var a=o.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});M.Hasher=R.extend({cfg:o.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){R.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){a&&this._append(a);var s=this._doFinalize();return s},blockSize:16,_createHelper:function(a){return function(s,n){return new a.init(n).finalize(s)}},_createHmacHelper:function(a){return function(s,n){return new c.HMAC.init(a,n).finalize(s)}}});var c=S.algo={};return S}(Math);return r})}).call(this,t(13))},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),A=i.__importDefault(t(2)),y=i.__importDefault(t(3));function b(S,M,o){try{M.apply(S,o)}catch(O){A.default.logAction(A.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+O+"; stack = "+(O&&O.stack))}}function T(S,M,o){for(var O,E,w,C=0;C<S.length;C++)if(O=S[C],o&&(O=O[o]),r.isArray(O)){for(;(E=r.arrIndexOf(O,M))!==-1;)O.splice(E,1);o&&O.length===0&&delete S[C][o]}else if(r.isObject(O))for(w in O)Object.prototype.hasOwnProperty.call(O,w)&&r.isArray(O[w])&&T([O],M,w)}var I=function(){function S(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return S.prototype.on=function(){for(var M=this,o=[],O=0;O<arguments.length;O++)o[O]=arguments[O];if(o.length===1){var E=o[0];if(typeof E=="function")this.any.push(E);else throw new Error("EventListener.on(): Invalid arguments: "+y.default.Config.inspect(o))}if(o.length===2){var w=o[0],C=o[1];if(typeof C!="function")throw new Error("EventListener.on(): Invalid arguments: "+y.default.Config.inspect(o));if(r.isEmptyArg(w))this.any.push(C);else if(r.isArray(w))w.forEach(function(R){M.on(R,C)});else{if(typeof w!="string")throw new Error("EventListener.on(): Invalid arguments: "+y.default.Config.inspect(o));var p=this.events[w]||(this.events[w]=[]);p.push(C)}}},S.prototype.off=function(){for(var M,o=this,O=[],E=0;E<arguments.length;E++)O[E]=arguments[E];if(O.length==0||r.isEmptyArg(O[0])&&r.isEmptyArg(O[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var w=O[0],C=O[1],p=null,R=null;if(O.length===1||!C)typeof w=="function"?p=w:R=w;else{if(typeof C!="function")throw new Error("EventEmitter.off(): invalid arguments:"+y.default.Config.inspect(O));M=[w,C],R=M[0],p=M[1]}if(p&&r.isEmptyArg(R)){T([this.any,this.events,this.anyOnce,this.eventsOnce],p);return}if(r.isArray(R)){R.forEach(function(c){o.off(c,p)});return}if(typeof R!="string")throw new Error("EventEmitter.off(): invalid arguments:"+y.default.Config.inspect(O));p?T([this.events,this.eventsOnce],p,R):(delete this.events[R],delete this.eventsOnce[R])},S.prototype.listeners=function(M){if(M){var o=this.events[M]||[];return this.eventsOnce[M]&&Array.prototype.push.apply(o,this.eventsOnce[M]),o.length?o:null}return this.any.length?this.any:null},S.prototype.emit=function(M){for(var o=[],O=1;O<arguments.length;O++)o[O-1]=arguments[O];var E={event:M},w=[];this.anyOnce.length&&(Array.prototype.push.apply(w,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(w,this.any);var C=this.eventsOnce[M];C&&(Array.prototype.push.apply(w,C),delete this.eventsOnce[M]);var p=this.events[M];p&&Array.prototype.push.apply(w,p),r.arrForEach(w,function(R){b(E,R,o)})},S.prototype.once=function(){for(var M=this,o=[],O=0;O<arguments.length;O++)o[O]=arguments[O];var E=o.length;if((E===0||E===1&&typeof o[0]!="function")&&y.default.Config.Promise){var w=o[0];return new y.default.Config.Promise(function(s){M.once(w,s)})}var C=o[0],p=o[1];if(o.length===1&&typeof C=="function")this.anyOnce.push(C);else if(r.isEmptyArg(C)){if(typeof p!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+y.default.Config.inspect(o));this.anyOnce.push(p)}else if(r.isArray(C)){var R=this,c=function(){var s=Array.prototype.slice.call(arguments);if(r.arrForEach(C,function(n){R.off(n,c)}),typeof p!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+y.default.Config.inspect(o));p.apply(this,s)};r.arrForEach(C,function(s){R.on(s,c)})}else{if(typeof C!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+y.default.Config.inspect(o));var a=this.eventsOnce[C]||(this.eventsOnce[C]=[]);if(p){if(typeof p!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+y.default.Config.inspect(o));a.push(p)}}},S.prototype.whenState=function(M,o,O){for(var E=this,w=[],C=3;C<arguments.length;C++)w[C-3]=arguments[C];var p={event:M};if(typeof M!="string"||typeof o!="string")throw"whenState requires a valid event String argument";if(typeof O!="function"&&y.default.Config.Promise)return new y.default.Config.Promise(function(R){S.prototype.whenState.apply(E,[M,o,R].concat(w))});M===o?b(p,O,w):this.once(M,O)},S}();e.default=I},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.getDefaults=e.normaliseOptions=e.objectifyOptions=e.getAgentString=e.getHosts=e.getFallbackHosts=e.environmentFallbackHosts=e.getHttpScheme=e.getPort=e.getHost=void 0;var i=t(0),r=i.__importDefault(t(3)),A=i.__importStar(t(1)),y=i.__importDefault(t(2)),b=i.__importDefault(t(4)),T=t(43),I="ably-js/"+T.version,S={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:T.version,protocolVersion:2,agent:I,getHost:M,getPort:o,getHttpScheme:O,environmentFallbackHosts:E,getFallbackHosts:w,getHosts:C,checkHost:p,objectifyOptions:s,normaliseOptions:n};function M(d,v,N){return N?v=v==d.restHost&&d.realtimeHost||v||d.realtimeHost:v=v||d.restHost,v}e.getHost=M;function o(d,v){return v||d.tls?d.tlsPort:d.port}e.getPort=o;function O(d){return d.tls?"https://":"http://"}e.getHttpScheme=O;function E(d){return[d+"-a-fallback.ably-realtime.com",d+"-b-fallback.ably-realtime.com",d+"-c-fallback.ably-realtime.com",d+"-d-fallback.ably-realtime.com",d+"-e-fallback.ably-realtime.com"]}e.environmentFallbackHosts=E;function w(d){var v=d.fallbackHosts,N=typeof d.httpMaxRetryCount<"u"?d.httpMaxRetryCount:S.httpMaxRetryCount;return v?A.arrChooseN(v,N):[]}e.getFallbackHosts=w;function C(d){return[d.restHost].concat(w(d))}e.getHosts=C;function p(d){if(typeof d!="string")throw new b.default("host must be a string; was a "+typeof d,4e4,400);if(!d.length)throw new b.default("host must not be zero-length",4e4,400)}function R(d,v,N){return d.realtimeHost?d.realtimeHost:d.restHost?(y.default.logAction(y.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+d.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+d.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),d.restHost):v?S.REALTIME_HOST:N+"-"+S.REALTIME_HOST}function c(d){var v={};for(var N in S.TIMEOUTS)v[N]=d[N]||S.TIMEOUTS[N];return v}function a(d){var v=S.agent;if(d.agents)for(var N in d.agents)v+=" "+N+"/"+d.agents[N];return v}e.getAgentString=a;function s(d){return typeof d=="string"?d.indexOf(":")==-1?{token:d}:{key:d}:d}e.objectifyOptions=s;function n(d){if(d.host&&(y.default.renamedClientOption("host","restHost"),d.restHost=d.host),d.wsHost&&(y.default.renamedClientOption("wsHost","realtimeHost"),d.realtimeHost=d.wsHost),d.queueEvents&&(y.default.renamedClientOption("queueEvents","queueMessages"),d.queueMessages=d.queueEvents),d.headers&&y.default.deprecated("the `headers` client option",""),d.fallbackHostsUseDefault){if(d.fallbackHosts){var v="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw y.default.logAction(y.default.LOG_ERROR,"Defaults.normaliseOptions",v),new b.default(v,4e4,400)}if(d.port||d.tlsPort){var v="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw y.default.logAction(y.default.LOG_ERROR,"Defaults.normaliseOptions",v),new b.default(v,4e4,400)}d.environment?y.default.deprecated("The `fallbackHostsUseDefault` client option","If youre using this client option to force the library to make use of fallback hosts even though youve set the `environment` client option, then this is no longer necessary: remove your usage of the `fallbackHostsUseDefault` client option and the library will then automatically choose the correct fallback hosts to use for the specified environment."):y.default.deprecated("The `fallbackHostsUseDefault` client option","If youre using this client option to force the library to make use of fallback hosts even though youre not using the primary Ably environment, then stop using `fallbackHostsUseDefault`, and update your code to either pass the `environment` client option (in which case the library will automatically choose the correct fallback hosts to use for the specified environment), or to pass the `fallbackHosts` client option to specify a custom list of fallback hosts to use (for example, if youre using a custom CNAME, in which case Ably will have provided you with an explicit list of fallback hosts)."),d.fallbackHosts=S.FALLBACK_HOSTS}d.recover===!0&&(y.default.deprecated("The ability to use a boolean value for the `recover` client option","If you wish for the connection to always be recovered, replace `{ recover: true }` with a function that always passes `true` to its callback: `{ recover: function(lastConnectionDetails, cb) { cb(true); } }`"),d.recover=function(_,P){P(!0)}),typeof d.recover=="function"&&d.closeOnUnload===!0&&(y.default.logAction(y.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),d.recover=void 0),"closeOnUnload"in d||(d.closeOnUnload=!d.recover),d.transports&&A.arrIn(d.transports,"xhr")&&(y.default.deprecationWarning('The "xhr" transport has been renamed to "xhr_streaming". Please update your client options code to use `transports: ["xhr_streaming"]` instead. The ability to use `transports: ["xhr"]` will be removed in a future version.'),A.arrDeleteValue(d.transports,"xhr"),d.transports.push("xhr_streaming")),"queueMessages"in d||(d.queueMessages=!0);var N=d.environment&&String(d.environment).toLowerCase()||S.ENVIRONMENT,D=!N||N==="production";!d.fallbackHosts&&!d.restHost&&!d.realtimeHost&&!d.port&&!d.tlsPort&&(d.fallbackHosts=D?S.FALLBACK_HOSTS:E(N));var L=d.restHost||(D?S.REST_HOST:N+"-"+S.REST_HOST),x=R(d,D,N);A.arrForEach((d.fallbackHosts||[]).concat(L,x),p),d.port=d.port||S.PORT,d.tlsPort=d.tlsPort||S.TLS_PORT,"tls"in d||(d.tls=!0);var m=c(d);if("useBinaryProtocol"in d?d.useBinaryProtocol=r.default.Config.supportsBinary&&d.useBinaryProtocol:d.useBinaryProtocol=r.default.Config.preferBinary,d.clientId){var g=d.headers=d.headers||{};g["X-Ably-ClientId"]=r.default.BufferUtils.base64Encode(r.default.BufferUtils.utf8Encode(d.clientId))}"idempotentRestPublishing"in d||(d.idempotentRestPublishing=!0),d.promises&&!r.default.Config.Promise&&(y.default.logAction(y.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),d.promises=!1);var k=null,j=d.connectivityCheckUrl;if(d.connectivityCheckUrl){var F=d.connectivityCheckUrl.split("?"),V=F[0],z=F[1];k=z?A.parseQueryString(z):{},V.indexOf("://")===-1&&(V="https://"+V),j=V}return i.__assign(i.__assign({},d),{useBinaryProtocol:"useBinaryProtocol"in d?r.default.Config.supportsBinary&&d.useBinaryProtocol:r.default.Config.preferBinary,realtimeHost:x,restHost:L,maxMessageSize:d.maxMessageSize||S.maxMessageSize,timeouts:m,connectivityCheckParams:k,connectivityCheckUrl:j})}e.normaliseOptions=n,e.default=S;function h(d){return Object.assign(S,d)}e.getDefaults=h},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(3)),A=i.__importDefault(t(2)),y=i.__importDefault(t(4)),b=i.__importStar(t(1));function T(o){return!o||!o.channelOptions?{channelOptions:o,plugins:{},baseEncodedPreviousPayload:void 0}:o}function I(o){if(o&&o.cipher){if(!r.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var O=r.default.Crypto.getCipher(o.cipher);return{cipher:O.cipherParams,channelCipher:O.cipher}}return o??{}}function S(o){var O=0;return o.name&&(O+=o.name.length),o.clientId&&(O+=o.clientId.length),o.extras&&(O+=JSON.stringify(o.extras).length),o.data&&(O+=b.dataSizeBytes(o.data)),O}var M=function(){function o(){}return o.prototype.toJSON=function(){var O=this.encoding,E=this.data;return E&&r.default.BufferUtils.isBuffer(E)&&(arguments.length>0?(O=O?O+"/base64":"base64",E=r.default.BufferUtils.base64Encode(E)):E=r.default.BufferUtils.toBuffer(E)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:O,data:E}},o.prototype.toString=function(){var O="[Message";return this.name&&(O+="; name="+this.name),this.id&&(O+="; id="+this.id),this.timestamp&&(O+="; timestamp="+this.timestamp),this.clientId&&(O+="; clientId="+this.clientId),this.connectionId&&(O+="; connectionId="+this.connectionId),this.encoding&&(O+="; encoding="+this.encoding),this.extras&&(O+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?O+="; data="+this.data:r.default.BufferUtils.isBuffer(this.data)?O+="; data (buffer)="+r.default.BufferUtils.base64Encode(this.data):O+="; data (json)="+JSON.stringify(this.data)),this.extras&&(O+="; extras="+JSON.stringify(this.extras)),O+="]",O},o.encrypt=function(O,E,w){var C=O.data,p=O.encoding,R=E.channelCipher;p=p?p+"/":"",r.default.BufferUtils.isBuffer(C)||(C=r.default.BufferUtils.utf8Encode(String(C)),p=p+"utf-8/"),R.encrypt(C,function(c,a){if(c){w(c);return}O.data=a,O.encoding=p+"cipher+"+R.algorithm,w(null,O)})},o.encode=function(O,E,w){var C=O.data,p=typeof C=="string"||r.default.BufferUtils.isBuffer(C)||C===null||C===void 0;if(!p)if(b.isObject(C)||b.isArray(C))O.data=JSON.stringify(C),O.encoding=O.encoding?O.encoding+"/json":"json";else throw new y.default("Data type is unsupported",40013,400);E!=null&&E.cipher?o.encrypt(O,E,w):w(null,O)},o.encodeArray=function(O,E,w){for(var C=0,p=0;p<O.length;p++)o.encode(O[p],E,function(R){if(R){w(R);return}C++,C==O.length&&w(null,O)})},o.decode=function(O,E){var w=T(E),C=O.data,p=O.encoding;if(p){var R=p.split("/"),c=void 0,a=R.length,s=O.data,n="";try{for(;(c=a)>0;){var h=R[--a].match(/([-\w]+)(\+([\w-]+))?/);if(!h)break;switch(n=h[1],n){case"base64":s=r.default.BufferUtils.base64Decode(String(s)),c==R.length&&(C=s);continue;case"utf-8":s=r.default.BufferUtils.utf8Decode(s);continue;case"json":s=JSON.parse(s);continue;case"cipher":if(w.channelOptions!=null&&w.channelOptions.cipher&&w.channelOptions.channelCipher){var d=h[3],v=w.channelOptions.channelCipher;if(d!=v.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");s=v.decrypt(s);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!w.plugins||!w.plugins.vcdiff)throw new y.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array>"u")throw new y.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var N=w.baseEncodedPreviousPayload;typeof N=="string"&&(N=r.default.BufferUtils.utf8Encode(N)),N=r.default.BufferUtils.toBuffer(N),s=r.default.BufferUtils.toBuffer(s),s=r.default.BufferUtils.typedArrayToBuffer(w.plugins.vcdiff.decode(s,N)),C=s}catch(L){throw new y.default("Vcdiff delta decode failed with "+L,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(L){var D=L;throw new y.default("Error processing the "+n+" encoding, decoder returned "+D.message+"",D.code||40013,400)}finally{O.encoding=c<=0?null:R.slice(0,c).join("/"),O.data=s}}w.baseEncodedPreviousPayload=C},o.fromResponseBody=function(O,E,w){w&&(O=b.decodeBody(O,w));for(var C=0;C<O.length;C++){var p=O[C]=o.fromValues(O[C]);try{o.decode(p,E)}catch(R){A.default.logAction(A.default.LOG_ERROR,"Message.fromResponseBody()",R.toString())}}return O},o.fromValues=function(O){return Object.assign(new o,O)},o.fromValuesArray=function(O){for(var E=O.length,w=new Array(E),C=0;C<E;C++)w[C]=o.fromValues(O[C]);return w},o.fromEncoded=function(O,E){var w=o.fromValues(O),C=I(E??null);try{o.decode(w,C)}catch(p){A.default.logAction(A.default.LOG_ERROR,"Message.fromEncoded()",p.toString())}return w},o.fromEncodedArray=function(O,E){return O.map(function(w){return o.fromEncoded(w,E)})},o.getMessagesSize=function(O){for(var E,w=0,C=0;C<O.length;C++)E=O[C],w+=E.size||(E.size=S(E));return w},o.serialize=b.encodeBody,o}();e.default=M},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),A=i.__importDefault(t(4)),y=i.__importDefault(t(9)),b=i.__importDefault(t(16)),T={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18},I=[];Object.keys(T).forEach(function(w){I[T[w]]=w});var S={HAS_PRESENCE:1,HAS_BACKLOG:2,RESUMED:4,TRANSIENT:16,ATTACH_RESUME:32,PRESENCE:65536,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},M=Object.keys(S);S.MODE_ALL=S.PRESENCE|S.PUBLISH|S.SUBSCRIBE|S.PRESENCE_SUBSCRIBE;function o(w){var C=[];if(w)for(var p=0;p<w.length;p++)C.push(w[p].toString());return"[ "+C.join(", ")+" ]"}var O="id channel channelSerial connectionId count msgSerial timestamp".split(" "),E=function(){function w(){var C=this;this.hasFlag=function(p){return(C.flags&S[p])>0}}return w.prototype.setFlag=function(C){return this.flags=this.flags|S[C]},w.prototype.getMode=function(){return this.flags&&this.flags&S.MODE_ALL},w.prototype.encodeModesToFlags=function(C){var p=this;C.forEach(function(R){return p.setFlag(R)})},w.prototype.decodeModesFromFlags=function(){var C=this,p=[];return w.channelModes.forEach(function(R){C.hasFlag(R)&&p.push(R)}),p.length>0?p:void 0},w.fromValues=function(C){return Object.assign(new w,C)},w.Action=T,w.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],w.ActionName=I,w.serialize=r.encodeBody,w.deserialize=function(C,p){var R=r.decodeBody(C,p);return w.fromDeserialized(R)},w.fromDeserialized=function(C){var p=C.error;p&&(C.error=A.default.fromValues(p));var R=C.messages;if(R)for(var c=0;c<R.length;c++)R[c]=y.default.fromValues(R[c]);var a=C.presence;if(a)for(var c=0;c<a.length;c++)a[c]=b.default.fromValues(a[c],!0);return Object.assign(new w,C)},w.stringify=function(C){var p="[ProtocolMessage";C.action!==void 0&&(p+="; action="+w.ActionName[C.action]||!1);for(var R,c=0;c<O.length;c++)R=O[c],C[R]!==void 0&&(p+="; "+R+"="+C[R]);if(C.messages&&(p+="; messages="+o(y.default.fromValuesArray(C.messages))),C.presence&&(p+="; presence="+o(b.default.fromValuesArray(C.presence))),C.error&&(p+="; error="+A.default.fromValues(C.error).toString()),C.auth&&C.auth.accessToken&&(p+="; token="+C.auth.accessToken),C.flags&&(p+="; flags="+M.filter(C.hasFlag).join(",")),C.params){var a="";r.forInOwnNonNullProperties(C.params,function(s){a.length>0&&(a+="; "),a+=s+"="+C.params[s]}),a.length>0&&(p+="; params=["+a+"]")}return p+="]",p},w}();e.default=E},function(l,e,t){(function(i,r){l.exports=r(t(6))})(this,function(i){return function(){var r=i,A=r.lib,y=A.WordArray,b=r.enc;b.Base64={stringify:function(I){var S=I.words,M=I.sigBytes,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";I.clamp();for(var O=[],E=0;E<M;E+=3)for(var w=S[E>>>2]>>>24-E%4*8&255,C=S[E+1>>>2]>>>24-(E+1)%4*8&255,p=S[E+2>>>2]>>>24-(E+2)%4*8&255,R=w<<16|C<<8|p,c=0;c<4&&E+c*.75<M;c++)O.push(o.charAt(R>>>6*(3-c)&63));var a=o.charAt(64);if(a)for(;O.length%4;)O.push(a);return O.join("")},parse:function(I){var S=I.length,M="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var O=0;O<M.length;O++)o[M.charCodeAt(O)]=O}var E=M.charAt(64);if(E){var w=I.indexOf(E);w!==-1&&(S=w)}return T(I,S,o)}};function T(I,S,M){for(var o=[],O=0,E=0;E<S;E++)if(E%4){var w=M[I.charCodeAt(E-1)]<<E%4*2,C=M[I.charCodeAt(E)]>>>6-E%4*2,p=w|C;o[O>>>2]|=p<<24-O%4*8,O++}return y.create(o,O)}}(),i.enc.Base64})},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),A=i.__importDefault(t(10)),y=i.__importDefault(t(26)),b=i.__importDefault(t(2)),T=i.__importDefault(t(8)),I=i.__importDefault(t(21)),S=i.__importDefault(t(18)),M=i.__importDefault(t(4)),o=i.__importDefault(t(22)),O=i.__importDefault(t(3));function E(p){var R=[80015,80017,80030];return p.code?S.default.isTokenErr(p)?!1:r.arrIn(R,p.code)?!0:p.code>=4e4&&p.code<5e4:!1}function w(p){return E(p)?[A.default.fromValues({action:A.default.Action.ERROR,error:p})]:[A.default.fromValues({action:A.default.Action.DISCONNECTED,error:p})]}var C=function(p){i.__extends(R,p);function R(c,a,s){var n=p.call(this,c,a,s,!0)||this;return n.onAuthUpdated=function(h){n.authParams={access_token:h.token}},n.stream="stream"in s?s.stream:!0,n.sendRequest=null,n.recvRequest=null,n.pendingCallback=null,n.pendingItems=null,n}return R.prototype.connect=function(){var c=this;b.default.logAction(b.default.LOG_MINOR,"CometTransport.connect()","starting"),y.default.prototype.connect.call(this);var a=this.params,s=a.options,n=T.default.getHost(s,a.host),h=T.default.getPort(s),d=s.tls?"https://":"http://";this.baseUri=d+n+":"+h+"/comet/";var v=this.baseUri+"connect";b.default.logAction(b.default.LOG_MINOR,"CometTransport.connect()","uri: "+v),this.auth.getAuthParams(function(N,D){if(N){c.disconnect(N);return}if(!c.isDisposed){c.authParams=D;var L=c.params.getConnectParams(D);"stream"in L&&(c.stream=L.stream),b.default.logAction(b.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+r.toQueryString(L));var x=!1,m=c.recvRequest=c.createRequest(v,null,L,null,c.stream?o.default.REQ_RECV_STREAM:o.default.REQ_RECV);m.on("data",function(g){c.recvRequest&&(x||(x=!0,c.emit("preconnect")),c.onData(g))}),m.on("complete",function(g){if(c.recvRequest||(g=g||new M.default("Request cancelled",80003,400)),c.recvRequest=null,!x&&!g&&(x=!0,c.emit("preconnect")),c.onActivity(),g){g.code?c.onData(w(g)):c.disconnect(g);return}O.default.Config.nextTick(function(){c.recv()})}),m.exec()}})},R.prototype.requestClose=function(){b.default.logAction(b.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},R.prototype.requestDisconnect=function(){b.default.logAction(b.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},R.prototype._requestCloseOrDisconnect=function(c){var a=this,s=c?this.closeUri:this.disconnectUri;if(s){var n=this.createRequest(s,null,this.authParams,null,o.default.REQ_SEND);n.on("complete",function(h){h&&(b.default.logAction(b.default.LOG_ERROR,"CometTransport.request"+(c?"Close()":"Disconnect()"),"request returned err = "+r.inspectError(h)),a.finish("disconnected",h))}),n.exec()}},R.prototype.dispose=function(){var c=this;b.default.logAction(b.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(b.default.logAction(b.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",I.default.disconnected()),O.default.Config.nextTick(function(){c.emit("disposed")}))},R.prototype.onConnect=function(c){var a;if(!this.isDisposed){var s=(a=c.connectionDetails)===null||a===void 0?void 0:a.connectionKey;y.default.prototype.onConnect.call(this,c);var n=this.baseUri+s;b.default.logAction(b.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+n),this.sendUri=n+"/send",this.recvUri=n+"/recv",this.closeUri=n+"/close",this.disconnectUri=n+"/disconnect"}},R.prototype.send=function(c){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(c);return}var a=this.pendingItems||[];a.push(c),this.pendingItems=null,this.sendItems(a)},R.prototype.sendAnyPending=function(){var c=this.pendingItems;c&&(this.pendingItems=null,this.sendItems(c))},R.prototype.sendItems=function(c){var a=this,s=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(c),o.default.REQ_SEND);s.on("complete",function(n,h){if(n&&b.default.logAction(b.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+r.inspectError(n)),a.sendRequest=null,n){n.code?a.onData(w(n)):a.disconnect(n);return}h&&a.onData(h),a.pendingItems&&O.default.Config.nextTick(function(){a.sendRequest||a.sendAnyPending()})}),s.exec()},R.prototype.recv=function(){var c=this;if(!this.recvRequest&&this.isConnected){var a=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?o.default.REQ_RECV_STREAM:o.default.REQ_RECV_POLL);a.on("data",function(s){c.onData(s)}),a.on("complete",function(s){if(c.recvRequest=null,c.onActivity(),s){s.code?c.onData(w(s)):c.disconnect(s);return}O.default.Config.nextTick(function(){c.recv()})}),a.exec()}},R.prototype.onData=function(c){try{var a=this.decodeResponse(c);if(a&&a.length)for(var s=0;s<a.length;s++)this.onProtocolMessage(A.default.fromDeserialized(a[s]))}catch(n){b.default.logAction(b.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+n.stack)}},R.prototype.encodeRequest=function(c){return JSON.stringify(c)},R.prototype.decodeResponse=function(c){return typeof c=="string"?JSON.parse(c):c},R}(y.default);e.default=C},function(l,e){var t;t=function(){return this}();try{t=t||new Function("return this")()}catch{typeof window=="object"&&(t=window)}l.exports=t},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.isSuccessCode=void 0;var i;(function(A){A[A.Success=200]="Success",A[A.NoContent=204]="NoContent",A[A.BadRequest=400]="BadRequest",A[A.Unauthorized=401]="Unauthorized",A[A.Forbidden=403]="Forbidden",A[A.RequestTimeout=408]="RequestTimeout",A[A.InternalServerError=500]="InternalServerError"})(i||(i={}));function r(A){return A>=i.Success&&A<i.BadRequest}e.isSuccessCode=r,e.default=i},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(3)),A=i.__importStar(t(1)),y=i.__importDefault(t(2)),b=i.__importDefault(t(18)),T=i.__importDefault(t(19)),I=t(4),S=i.__importDefault(t(14));function M(p,R,c,a,s){p.http.supportsAuthHeaders?p.auth.getAuthHeaders(function(n,h){n?a(n):s(A.mixin(h,R),c)}):p.auth.getAuthParams(function(n,h){n?a(n):s(R,A.mixin(h,c))})}function o(p,R){return function(c,a,s,n,h){if(c&&!a){p(c);return}if(h===S.default.NoContent){p(c,[],s,!0,h);return}if(!n)try{a=A.decodeBody(a,R)}catch(x){A.isErrorInfoOrPartialErrorInfo(x)?p(x):p(new I.PartialErrorInfo(A.inspectError(x),null));return}if(!a){p(new I.PartialErrorInfo("unenvelope(): Response body is missing",null));return}var d=a,v=d.statusCode,N=d.response,D=d.headers;if(v===void 0){p(c,a,s,!0,h);return}if(v<200||v>=300){var L=N&&N.error||c;L||(L=new Error("Error in unenveloping "+a),L.statusCode=v),p(L,N,D,!0,v);return}p(c,N,D,!0,v)}}function O(p){var R=[];if(p)for(var c in p)R.push(c+"="+p[c]);return R.join("&")}function E(p,R){return p+(R?"?":"")+O(R)}function w(p,R,c,a){return function(s,n,h,d,v){s?y.default.logAction(y.default.LOG_MICRO,"Resource."+R+"()","Received Error; "+E(c,a)+"; Error: "+A.inspectError(s)):y.default.logAction(y.default.LOG_MICRO,"Resource."+R+"()","Received; "+E(c,a)+"; Headers: "+O(h)+"; StatusCode: "+v+"; Body: "+(r.default.BufferUtils.isBuffer(n)?n.toString():n)),p&&p(s,n,h,d,v)}}var C=function(){function p(){}return p.get=function(R,c,a,s,n,h){p.do(T.default.Get,R,c,null,a,s,n,h)},p.delete=function(R,c,a,s,n,h){p.do(T.default.Delete,R,c,null,a,s,n,h)},p.post=function(R,c,a,s,n,h,d){p.do(T.default.Post,R,c,a,s,n,h,d)},p.patch=function(R,c,a,s,n,h,d){p.do(T.default.Patch,R,c,a,s,n,h,d)},p.put=function(R,c,a,s,n,h,d){p.do(T.default.Put,R,c,a,s,n,h,d)},p.do=function(R,c,a,s,n,h,d,v){y.default.shouldLog(y.default.LOG_MICRO)&&(v=w(v,R,a,h)),d&&(v=v&&o(v,d),(h=h||{}).envelope=d);function N(D,L){var x;if(y.default.shouldLog(y.default.LOG_MICRO)&&y.default.logAction(y.default.LOG_MICRO,"Resource."+R+"()","Sending; "+E(a,L)),y.default.shouldLog(y.default.LOG_MICRO)){var m=s;if(((x=D["content-type"])===null||x===void 0?void 0:x.indexOf("msgpack"))>0)try{m=r.default.Config.msgpack.decode(s)}catch(g){y.default.logAction(y.default.LOG_MICRO,"Resource."+R+"()","Sending MsgPack Decoding Error: "+A.inspectError(g))}y.default.logAction(y.default.LOG_MICRO,"Resource."+R+"()","Sending; "+E(a,L)+"; Body: "+m)}c.http.do(R,c,a,D,s,L,function(g,k,j,F,V){if(g&&b.default.isTokenErr(g)){c.auth.authorize(null,null,function(z){if(z){v(z);return}M(c,D,L,v,N)});return}v(g,k,j,F,V)})}M(c,n,h,v,N)},p}();e.default=C},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(2)),A=i.__importDefault(t(3)),y=i.__importDefault(t(9)),b=i.__importStar(t(1));function T(S){return I.Actions.indexOf(S)}var I=function(){function S(){}return S.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},S.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var M=this.id.split(":");return{connectionId:M[0],msgSerial:parseInt(M[1],10),index:parseInt(M[2],10)}},S.prototype.toJSON=function(){var M=this.data,o=this.encoding;return M&&A.default.BufferUtils.isBuffer(M)&&(arguments.length>0?(o=o?o+"/base64":"base64",M=A.default.BufferUtils.base64Encode(M)):M=A.default.BufferUtils.toBuffer(M)),{id:this.id,clientId:this.clientId,action:T(this.action),data:M,encoding:o,extras:this.extras}},S.prototype.toString=function(){var M="[PresenceMessage";return M+="; action="+this.action,this.id&&(M+="; id="+this.id),this.timestamp&&(M+="; timestamp="+this.timestamp),this.clientId&&(M+="; clientId="+this.clientId),this.connectionId&&(M+="; connectionId="+this.connectionId),this.encoding&&(M+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?M+="; data="+this.data:A.default.BufferUtils.isBuffer(this.data)?M+="; data (buffer)="+A.default.BufferUtils.base64Encode(this.data):M+="; data (json)="+JSON.stringify(this.data)),this.extras&&(M+="; extras="+JSON.stringify(this.extras)),M+="]",M},S.fromResponseBody=function(M,o,O){var E=[];O&&(M=b.decodeBody(M,O));for(var w=0;w<M.length;w++){var C=E[w]=S.fromValues(M[w],!0);try{S.decode(C,o)}catch(p){r.default.logAction(r.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",p.toString())}}return E},S.fromValues=function(M,o){return o&&(M.action=S.Actions[M.action]),Object.assign(new S,M)},S.fromValuesArray=function(M){for(var o=M.length,O=new Array(o),E=0;E<o;E++)O[E]=S.fromValues(M[E]);return O},S.fromEncoded=function(M,o){var O=S.fromValues(M,!0);try{S.decode(O,o??{})}catch(E){r.default.logAction(r.default.LOG_ERROR,"PresenceMessage.fromEncoded()",E.toString())}return O},S.fromEncodedArray=function(M,o){return M.map(function(O){return S.fromEncoded(O,o)})},S.fromData=function(M){return M instanceof S?M:S.fromValues({data:M})},S.Actions=["absent","present","enter","leave","update"],S.encode=y.default.encode,S.decode=y.default.decode,S.getMessagesSize=y.default.getMessagesSize,S}();e.default=I},function(l,e,t){(function(i){Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),A=r.__importStar(t(1)),y=r.__importDefault(t(7)),b=r.__importStar(t(4)),T=r.__importDefault(t(2)),I=r.__importDefault(t(8)),S=r.__importDefault(t(22)),M=r.__importDefault(t(3));function o(d,v){return A.arrIn(A.allToLowerCase(A.keysArray(v)),"x-ably-errorcode")}function O(d,v){if(o(d,v))return d.error&&b.default.fromValues(d.error)}var E=function(){},w=0,C={},p=typeof i<"u"&&i.XDomainRequest;function R(){var d=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return d&&Number(d[1])}function c(){var d;return p&&(d=R())&&d===10}function a(d,v){return d.getResponseHeader&&d.getResponseHeader(v)}function s(d){return d.getResponseHeader&&(d.getResponseHeader("transfer-encoding")||!d.getResponseHeader("content-length"))}function n(d){for(var v=A.trim(d.getAllResponseHeaders()).split(`\r
`),N={},D=0;D<v.length;D++){var L=v[D].split(":").map(A.trim);N[L[0].toLowerCase()]=L[1]}return N}var h=function(d){r.__extends(v,d);function v(N,D,L,x,m,g,k){var j=d.call(this)||this;return L=L||{},L.rnd=A.cheapRandStr(),c()&&!L.envelope&&(L.envelope="json"),j.uri=N+A.toQueryString(L),j.headers=D||{},j.body=x,j.method=k?k.toUpperCase():A.isEmptyArg(x)?"GET":"POST",j.requestMode=m,j.timeouts=g,j.timedOut=!1,j.requestComplete=!1,j.id=String(++w),C[j.id]=j,j}return v.createRequest=function(N,D,L,x,m,g,k){var j=g||I.default.TIMEOUTS;return new v(N,D,A.copy(L),x,m,j,k)},v.prototype.complete=function(N,D,L,x,m){this.requestComplete||(this.requestComplete=!0,!N&&D&&this.emit("data",D),this.emit("complete",N,D,L,x,m),this.dispose())},v.prototype.abort=function(){this.dispose()},v.prototype.exec=function(){var N=this,D=this.headers,L=this.requestMode==S.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,x=this.timer=setTimeout(function(){N.timedOut=!0,g.abort()},L),m=this.method,g=this.xhr=new XMLHttpRequest,k=D.accept,j=this.body,F="text";if(k?k.indexOf("application/x-msgpack")===0&&(F="arraybuffer"):D.accept="application/json",j){var V=D["content-type"]||(D["content-type"]="application/json");V.indexOf("application/json")>-1&&typeof j!="string"&&(j=JSON.stringify(j))}g.open(m,this.uri,!0),g.responseType=F,"authorization"in D&&(g.withCredentials=!0);for(var z in D)g.setRequestHeader(z,D[z]);var _=function($,ie,ce,he){var ue,be=ie+" (event type: "+$.type+")";!((ue=N==null?void 0:N.xhr)===null||ue===void 0)&&ue.statusText&&(be+=", current statusText is "+N.xhr.statusText),T.default.logAction(T.default.LOG_ERROR,"Request.on"+$.type+"()",be),N.complete(new b.PartialErrorInfo(be,ce,he))};g.onerror=function($){_($,"XHR error occurred",null,400)},g.onabort=function($){N.timedOut?_($,"Request aborted due to request timeout expiring",null,408):_($,"Request cancelled",null,400)},g.ontimeout=function($){_($,"Request timed out",null,408)};var P,U,B,H=0,W=!1,Q=function(){if(clearTimeout(x),B=U<400,U==204){N.complete(null,null,null,null,U);return}P=N.requestMode==S.default.REQ_RECV_STREAM&&B&&s(g)},X=function(){var $;try{var ie=a(g,"content-type"),ce=ie?ie.indexOf("application/json")>=0:g.responseType=="text";if(ce){var he=g.responseType==="arraybuffer"?M.default.BufferUtils.utf8Decode(g.response):String(g.responseText);he.length?$=JSON.parse(he):$=he,W=!0}else $=g.response;$.response!==void 0?(U=$.statusCode,B=U<400,D=$.headers,$=$.response):D=n(g)}catch(be){N.complete(new b.PartialErrorInfo("Malformed response body from server: "+be.message,null,400));return}if(B||A.isArray($)){N.complete(null,$,D,W,U);return}var ue=O($,D);ue||(ue=new b.PartialErrorInfo("Error response received from server: "+U+" body was: "+M.default.Config.inspect($),null,U)),N.complete(ue,$,D,W,U)};function Z(){for(var $=g.responseText,ie=$.length-1,ce,he;H<ie&&(ce=$.indexOf(`
`,H))>-1;)he=$.slice(H,ce),H=ce+1,ee(he)}var ee=function($){try{$=JSON.parse($)}catch(ie){N.complete(new b.PartialErrorInfo("Malformed response body from server: "+ie.message,null,400));return}N.emit("data",$)},re=function(){Z(),N.streamComplete=!0,M.default.Config.nextTick(function(){N.complete()})};g.onreadystatechange=function(){var $=g.readyState;$<3||g.status!==0&&(U===void 0&&(U=g.status,U===1223&&(U=204),Q()),$==3&&P?Z():$==4&&(P?re():X()))},g.send(j)},v.prototype.dispose=function(){var N=this.xhr;if(N){N.onreadystatechange=N.onerror=N.onabort=N.ontimeout=E,this.xhr=null;var D=this.timer;D&&(clearTimeout(D),this.timer=null),this.requestComplete||N.abort()}delete C[this.id]},v}(y.default);e.default=h}).call(this,t(13))},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(2)),A=i.__importStar(t(1)),y=i.__importDefault(t(24)),b=i.__importDefault(t(4)),T=i.__importDefault(t(45)),I=t(11),S=i.__importDefault(t(19)),M=i.__importDefault(t(14)),o=i.__importDefault(t(3)),O=i.__importDefault(t(15)),E=Math.pow(2,17);function w(){}function C(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function p(L){return!!L.connection}function R(L){return A.isErrorInfoOrPartialErrorInfo(L)?(L.code||(L.statusCode===403?L.code=40300:(L.code=40170,L.statusCode=401)),L):new b.default(A.inspectError(L),L.code||40170,L.statusCode||401)}var c=function(L,x){if(o.default.Config.createHmac){var m=o.default.Config.createHmac("SHA256",x);return m.update(L),m.digest("base64")}return(0,I.stringify)((0,T.default)(L,x))};function a(L){if(!L)return"";typeof L=="string"&&(L=JSON.parse(L));var x=Object.create(null),m=A.keysArray(L,!0);if(!m)return"";m.sort();for(var g=0;g<m.length;g++)x[m[g]]=L[m[g]].sort();return JSON.stringify(x)}function s(L){if(L.authCallback)r.default.logAction(r.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(L.authUrl)r.default.logAction(r.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(L.key)r.default.logAction(r.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(L.tokenDetails)r.default.logAction(r.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var x="authOptions must include valid authentication parameters";throw r.default.logAction(r.default.LOG_ERROR,"Auth()",x),new Error(x)}}function n(L){return"useTokenAuth"in L&&!L.useTokenAuth}function h(L){return L.useTokenAuth||!n(L)&&(L.authCallback||L.authUrl||L.token||L.tokenDetails)}function d(L){return!L.key&&!L.authCallback&&!L.authUrl}var v=0;function N(){return v++}var D=function(){function L(x,m){if(this.authOptions={},this.client=x,this.tokenParams=m.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,h(m)){if(m.key&&!c){var g="client-side token request signing not supported";throw r.default.logAction(r.default.LOG_ERROR,"Auth()",g),new Error(g)}d(m)&&r.default.logAction(r.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(m.defaultTokenParams,m),s(this.authOptions)}else{if(!m.key){var g="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw r.default.logAction(r.default.LOG_ERROR,"Auth()",g),new b.default(g,40160,401)}r.default.logAction(r.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(m)}}return L.prototype.authorize=function(x,m,g){var k=this,j;if(typeof x=="function"&&!g?(g=x,j=x=null):typeof m=="function"&&!g?(g=m,j=null):j=m,!g&&this.client.options.promises)return A.promisify(this,"authorize",arguments);if(j&&j.key&&this.authOptions.key!==j.key)throw new b.default("Unable to update auth options with incompatible key",40102,401);j&&"force"in j&&(r.default.deprecated("The `force` auth option","If youre using this option to force `authorize()` to fetch a new token even if the current token has not expired, this is no longer necessary, as `authorize()` now always fetches a new token. Update your code to no longer pass the `force` auth option. Note that, in general, passing an auth options argument to `authorize()` will overwrite the librarys stored auth options, which may not be what you want. The library currently contains a special case behavior where passing an auth options object which only contains `{ force: true }` will _not_ overwrite the stored options. This special case behavior will be removed alongside support for the `force` option, so if youre currently passing `authorize()` an auth options object which only contains `{ force: true }`, you should stop passing it an auth options object entirely."),A.isOnlyPropIn(j,"force")&&(j=null)),this._forceNewToken(x,j,function(F,V){if(F){k.client.connection&&F.statusCode===M.default.Forbidden&&k.client.connection.connectionManager.actOnErrorFromAuthorize(F),g==null||g(F);return}p(k.client)?k.client.connection.connectionManager.onAuthUpdated(V,g||w):g==null||g(null,V)})},L.prototype.authorise=function(x,m,g){r.default.renamedMethod("Auth","authorise","authorize"),this.authorize(x,m,g)},L.prototype._forceNewToken=function(x,m,g){var k=this;this.tokenDetails=null,this._saveTokenOptions(x,m),s(this.authOptions),this._ensureValidAuthCredentials(!0,function(j,F){delete k.tokenParams.timestamp,delete k.authOptions.queryTime,g(j,F)})},L.prototype.requestToken=function(x,m,g){var k=this;if(typeof x=="function"&&!g?(g=x,m=x=null):typeof m=="function"&&!g&&(g=m,m=null),!g&&this.client.options.promises)return A.promisify(this,"requestToken",arguments);m=m||this.authOptions,x=x||A.copy(this.tokenParams);var j=g||w,F,V=this.client;if(m.authCallback)r.default.logAction(r.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),F=m.authCallback;else if(m.authUrl)r.default.logAction(r.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),F=function(H,W){var Q=A.mixin({accept:"application/json, text/plain"},m.authHeaders),X=m.authMethod&&m.authMethod.toLowerCase()==="post",Z,ee=m.authUrl.indexOf("?");ee>-1&&(Z=A.parseQueryString(m.authUrl.slice(ee)),m.authUrl=m.authUrl.slice(0,ee),X||(m.authParams=A.mixin(Z,m.authParams)));var re=A.mixin({},m.authParams||{},H),$=function(he,ue,be,Ue){var ye;if(he?r.default.logAction(r.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+A.inspectError(he)):(ye=be["content-type"],r.default.logAction(r.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+ye+"; body: "+A.inspectBody(ue))),he||Ue)return W(he,ue);if(o.default.BufferUtils.isBuffer(ue)&&(ue=ue.toString()),!ye){W(new b.default("authUrl response is missing a content-type header",40170,401));return}var ke=ye.indexOf("application/json")>-1,tt=ye.indexOf("text/plain")>-1||ye.indexOf("application/jwt")>-1;if(!ke&&!tt){W(new b.default("authUrl responded with unacceptable content-type "+ye+", should be either text/plain, application/jwt or application/json",40170,401));return}if(ke){if(ue.length>E){W(new b.default("authUrl response exceeded max permitted length",40170,401));return}try{ue=JSON.parse(ue)}catch(nt){W(new b.default("Unexpected error processing authURL response; err = "+nt.message,40170,401));return}}W(null,ue,ye)};if(r.default.logAction(r.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+m.authUrl+"; Params: "+JSON.stringify(re)+"; method: "+(X?"POST":"GET")),X){var ie=Q||{};ie["content-type"]="application/x-www-form-urlencoded";var ce=A.toQueryString(re).slice(1);k.client.http.doUri(S.default.Post,V,m.authUrl,ie,ce,Z,$)}else k.client.http.doUri(S.default.Get,V,m.authUrl,Q||{},null,re,$)};else if(m.key)r.default.logAction(r.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),F=function(H,W){k.createTokenRequest(H,m,W)};else{var z="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";r.default.logAction(r.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),j(new b.default(z,40171,403));return}"capability"in x&&(x.capability=a(x.capability));var _=function(H,W){var Q=H.keyName,X="/keys/"+Q+"/requestToken",Z=function(re){return V.baseUri(re)+X},ee=A.defaultPostHeaders(k.client.options);m.requestHeaders&&A.mixin(ee,m.requestHeaders),r.default.logAction(r.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+X+"; Token params: "+JSON.stringify(H)),k.client.http.do(S.default.Post,V,Z,ee,JSON.stringify(H),null,W)},P=!1,U=this.client.options.timeouts.realtimeRequestTimeout,B=setTimeout(function(){P=!0;var H="Token request callback timed out after "+U/1e3+" seconds";r.default.logAction(r.default.LOG_ERROR,"Auth.requestToken()",H),j(new b.default(H,40170,401))},U);F(x,function(H,W,Q){if(!P){if(clearTimeout(B),H){r.default.logAction(r.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+A.inspectError(H)),j(R(H));return}if(typeof W=="string"){W.length===0?j(new b.default("Token string is empty",40170,401)):W.length>E?j(new b.default("Token string exceeded max permitted length (was "+W.length+" bytes)",40170,401)):W==="undefined"||W==="null"?j(new b.default("Token string was literal null/undefined",40170,401)):W[0]==="{"&&!(Q&&Q.indexOf("application/jwt")>-1)?j(new b.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):j(null,{token:W});return}if(typeof W!="object"){var X="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof W;r.default.logAction(r.default.LOG_ERROR,"Auth.requestToken()",X),j(new b.default(X,40170,401));return}var Z=JSON.stringify(W).length;if(Z>E&&!m.suppressMaxLengthCheck){j(new b.default("Token request/details object exceeded max permitted stringified size (was "+Z+" bytes)",40170,401));return}if("issued"in W){j(null,W);return}if(!("keyName"in W)){var X="Expected token request callback to call back with a token string, token request object, or token details object";r.default.logAction(r.default.LOG_ERROR,"Auth.requestToken()",X),j(new b.default(X,40170,401));return}_(W,function(ee,re,$,ie){if(ee){r.default.logAction(r.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+A.inspectError(ee)),j(R(ee));return}ie||(re=JSON.parse(re)),r.default.logAction(r.default.LOG_MINOR,"Auth.getToken()","token received"),j(null,re)})}})},L.prototype.createTokenRequest=function(x,m,g){var k=this;if(typeof x=="function"&&!g?(g=x,m=x=null):typeof m=="function"&&!g&&(g=m,m=null),!g&&this.client.options.promises)return A.promisify(this,"createTokenRequest",arguments);m=m||this.authOptions,x=x||A.copy(this.tokenParams);var j=m.key;if(!j){g(new b.default("No key specified",40101,403));return}var F=j.split(":"),V=F[0],z=F[1];if(!z){g(new b.default("Invalid key specified",40101,403));return}if(x.clientId===""){g(new b.default("clientId cant be an empty string",40012,400));return}"capability"in x&&(x.capability=a(x.capability));var _=A.mixin({keyName:V},x),P=x.clientId||"",U=x.ttl||"",B=x.capability||"";(function(H){if(_.timestamp){H();return}k.getTimestamp(m&&m.queryTime,function(W,Q){if(W){g(W);return}_.timestamp=Q,H()})})(function(){var H=_.nonce||(_.nonce=C()),W=_.timestamp,Q=_.keyName+`
`+U+`
`+B+`
`+P+`
`+W+`
`+H+`
`;_.mac=_.mac||c(Q,z),r.default.logAction(r.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),g(null,_)})},L.prototype.getAuthParams=function(x){this.method=="basic"?x(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(m,g){if(m){x(m);return}if(!g)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");x(null,{access_token:g.token})})},L.prototype.getAuthHeaders=function(x){this.method=="basic"?x(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(m,g){if(m){x(m);return}if(!g)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");x(null,{authorization:"Bearer "+A.toBase64(g.token)})})},L.prototype.getTimestamp=function(x,m){!this.isTimeOffsetSet()&&(x||this.authOptions.queryTime)?this.client.time(m):m(null,this.getTimestampUsingOffset())},L.prototype.getTimestampUsingOffset=function(){return A.now()+(this.client.serverTimeOffset||0)},L.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},L.prototype._saveBasicOptions=function(x){this.method="basic",this.key=x.key,this.basicKey=A.toBase64(x.key),this.authOptions=x||{},"clientId"in x&&this._userSetClientId(x.clientId)},L.prototype._saveTokenOptions=function(x,m){this.method="token",x&&(this.tokenParams=x),m&&(m.token&&(m.tokenDetails=typeof m.token=="string"?{token:m.token}:m.token),m.tokenDetails&&(this.tokenDetails=m.tokenDetails),"clientId"in m&&this._userSetClientId(m.clientId),this.authOptions=m)},L.prototype._ensureValidAuthCredentials=function(x,m){var g=this,k=this.tokenDetails;if(k){if(this._tokenClientIdMismatch(k.clientId)){m(new b.default("Mismatch between clientId in token ("+k.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!k.expires||k.expires>=this.getTimestampUsingOffset()){r.default.logAction(r.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+k.expires),m(null,k);return}r.default.logAction(r.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=y.default.create())).push(m),!(this.currentTokenRequestId!==null&&!x)){var j=this.currentTokenRequestId=N();this.requestToken(this.tokenParams,this.authOptions,function(F,V){if(g.currentTokenRequestId>j){r.default.logAction(r.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}g.currentTokenRequestId=null;var z=g.waitingForTokenRequest||w;if(g.waitingForTokenRequest=null,F){z(F);return}z(null,g.tokenDetails=V)})}},L.prototype._userSetClientId=function(x){if(typeof x=="string"||x===null){if(x==="*")throw new b.default('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var m=this._uncheckedSetClientId(x);if(m)throw m}else throw new b.default("clientId must be either a string or null",40012,400)},L.prototype._uncheckedSetClientId=function(x){if(this._tokenClientIdMismatch(x)){var m="Unexpected clientId mismatch: client has "+this.clientId+", requested "+x,g=new b.default(m,40102,401);return r.default.logAction(r.default.LOG_ERROR,"Auth._uncheckedSetClientId()",m),g}else return this.clientId=this.tokenParams.clientId=x,null},L.prototype._tokenClientIdMismatch=function(x){return!!(this.clientId&&this.clientId!=="*"&&x&&x!=="*"&&this.clientId!==x)},L.isTokenErr=function(x){return x.code&&x.code>=40140&&x.code<40150},L.prototype.revokeTokens=function(x,m,g){if(h(this.client.options))throw new b.default("Cannot revoke tokens when using token auth",40162,401);var k=this.client.options.keyName,j;if(typeof m=="function"?(g=m,j={}):j=m??{},g===void 0){if(this.client.options.promises)return A.promisify(this,"revokeTokens",[x,j]);g=w}var F=g,V=i.__assign({targets:x.map(function(U){return"".concat(U.type,":").concat(U.value)})},j),z=this.client.options.useBinaryProtocol?A.Format.msgpack:A.Format.json,_=A.defaultPostHeaders(this.client.options,z);this.client.options.headers&&A.mixin(_,this.client.options.headers);var P=A.encodeBody(V,z);O.default.post(this.client,"/keys/".concat(k,"/revokeTokens"),P,_,{newBatchResponse:"true"},null,function(U,B,H,W){if(U){F(U);return}var Q=W?B:A.decodeBody(B,z);F(null,Q)})},L}();e.default=D},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i;(function(r){r.Get="get",r.Delete="delete",r.Post="post",r.Put="put",r.Patch="patch"})(i||(i={})),e.default=i},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.HttpPaginatedResponse=e.PaginatedResult=void 0;var i=t(0),r=i.__importStar(t(1)),A=i.__importDefault(t(2)),y=i.__importDefault(t(15)),b=i.__importDefault(t(14));function T(E){var w=E.match(/^\.\/(\w+)\?(.*)$/);return w&&w[2]&&r.parseQueryString(w[2])}function I(E){typeof E=="string"&&(E=E.split(","));for(var w={},C=0;C<E.length;C++){var p=E[C].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(p){var R=T(p[1]);R&&(w[p[2]]=R)}}return w}function S(E,w,C){return!(C&&(w||typeof E.code=="number"))}var M=function(){function E(w,C,p,R,c,a){this.rest=w,this.path=C,this.headers=p,this.envelope=R??null,this.bodyHandler=c,this.useHttpPaginatedResponse=a||!1}return E.prototype.get=function(w,C){var p=this;y.default.get(this.rest,this.path,this.headers,w,this.envelope,function(R,c,a,s,n){p.handlePage(R,c,a,s,n,C)})},E.prototype.delete=function(w,C){var p=this;y.default.delete(this.rest,this.path,this.headers,w,this.envelope,function(R,c,a,s,n){p.handlePage(R,c,a,s,n,C)})},E.prototype.post=function(w,C,p){var R=this;y.default.post(this.rest,this.path,C,this.headers,w,this.envelope,function(c,a,s,n,h){p&&R.handlePage(c,a,s,n,h,p)})},E.prototype.put=function(w,C,p){var R=this;y.default.put(this.rest,this.path,C,this.headers,w,this.envelope,function(c,a,s,n,h){p&&R.handlePage(c,a,s,n,h,p)})},E.prototype.patch=function(w,C,p){var R=this;y.default.patch(this.rest,this.path,C,this.headers,w,this.envelope,function(c,a,s,n,h){p&&R.handlePage(c,a,s,n,h,p)})},E.prototype.handlePage=function(w,C,p,R,c,a){if(w&&S(w,C,this.useHttpPaginatedResponse)){A.default.logAction(A.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+r.inspectError(w)),a==null||a(w);return}var s,n,h;try{s=c==b.default.NoContent?[]:this.bodyHandler(C,p||{},R)}catch(d){a==null||a(w||d);return}p&&(n=p.Link||p.link)&&(h=I(n)),this.useHttpPaginatedResponse?a(null,new O(this,s,p||{},c,h,w)):a(null,new o(this,s,h))},E}(),o=function(){function E(w,C,p){var R=this;this.resource=w,this.items=C;var c=this;p&&("first"in p&&(this.first=function(a){if(!a&&c.resource.rest.options.promises)return r.promisify(c,"first",[]);c.get(p.first,a)}),"current"in p&&(this.current=function(a){if(!a&&c.resource.rest.options.promises)return r.promisify(c,"current",[]);c.get(p.current,a)}),this.next=function(a){if(!a&&c.resource.rest.options.promises)return r.promisify(c,"next",[]);"next"in p?c.get(p.next,a):a(null,null)},this.hasNext=function(){return"next"in p},this.isLast=function(){var a;return!(!((a=R.hasNext)===null||a===void 0)&&a.call(R))})}return E.prototype.get=function(w,C){var p=this.resource;y.default.get(p.rest,p.path,p.headers,w,p.envelope,function(R,c,a,s,n){p.handlePage(R,c,a,s,n,C)})},E}();e.PaginatedResult=o;var O=function(E){i.__extends(w,E);function w(C,p,R,c,a,s){var n=E.call(this,C,p,a)||this;return n.statusCode=c,n.success=c<300&&c>=200,n.headers=R,n.errorCode=s&&s.code,n.errorMessage=s&&s.message,n}return w.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},w}(o);e.HttpPaginatedResponse=O,e.default=M},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.isRetriable=void 0;var i=t(0),r=i.__importDefault(t(4)),A={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},y={disconnected:function(){return r.default.fromValues({statusCode:400,code:A.DISCONNECTED,message:"Connection to server temporarily unavailable"})},suspended:function(){return r.default.fromValues({statusCode:400,code:A.SUSPENDED,message:"Connection to server unavailable"})},failed:function(){return r.default.fromValues({statusCode:400,code:A.FAILED,message:"Connection failed or disconnected by server"})},closing:function(){return r.default.fromValues({statusCode:400,code:A.CLOSING,message:"Connection closing"})},closed:function(){return r.default.fromValues({statusCode:400,code:A.CLOSED,message:"Connection closed"})},unknownConnectionErr:function(){return r.default.fromValues({statusCode:500,code:A.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"})},unknownChannelErr:function(){return r.default.fromValues({statusCode:500,code:A.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})}};function b(T){return!T.statusCode||!T.code||T.statusCode>=500?!0:Object.values(A).includes(T.code)}e.isRetriable=b,e.default=y},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i;(function(r){r[r.REQ_SEND=0]="REQ_SEND",r[r.REQ_RECV=1]="REQ_RECV",r[r.REQ_RECV_POLL=2]="REQ_RECV_POLL",r[r.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(i||(i={})),e.default=i},function(l,e,t){(function(i,r){l.exports=r(t(6),t(5),t(58),t(11),t(40),t(32),t(25),t(27),t(28),t(59),t(60))})(this,function(i){return i})},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(2)),A=function(){function y(b){this.members=b||[]}return y.prototype.call=function(){for(var b=[],T=0;T<arguments.length;T++)b[T]=arguments[T];for(var I=0,S=this.members;I<S.length;I++){var M=S[I];if(M)try{M.apply(void 0,b)}catch(o){r.default.logAction(r.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+o+"; stack = "+o.stack)}}},y.prototype.push=function(){for(var b,T=[],I=0;I<arguments.length;I++)T[I]=arguments[I];(b=this.members).push.apply(b,T)},y.create=function(b){var T=new y(b);return Object.assign(function(){for(var I=[],S=0;S<arguments.length;S++)I[S]=arguments[S];return T.call.apply(T,I)},{push:function(I){return T.push(I)}})},y}();e.default=A},function(l,e,t){(function(i,r){l.exports=r(t(6))})(this,function(i){(function(){var r=i,A=r.lib,y=A.Base,b=r.enc,T=b.Utf8,I=r.algo;I.HMAC=y.extend({init:function(S,M){S=this._hasher=new S.init,typeof M=="string"&&(M=T.parse(M));var o=S.blockSize,O=o*4;M.sigBytes>O&&(M=S.finalize(M)),M.clamp();for(var E=this._oKey=M.clone(),w=this._iKey=M.clone(),C=E.words,p=w.words,R=0;R<o;R++)C[R]^=1549556828,p[R]^=909522486;E.sigBytes=w.sigBytes=O,this.reset()},reset:function(){var S=this._hasher;S.reset(),S.update(this._iKey)},update:function(S){return this._hasher.update(S),this},finalize:function(S){var M=this._hasher,o=M.finalize(S);M.reset();var O=M.finalize(this._oKey.clone().concat(o));return O}})})()})},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(10)),A=i.__importStar(t(1)),y=i.__importDefault(t(7)),b=i.__importDefault(t(2)),T=i.__importDefault(t(21)),I=i.__importDefault(t(4)),S=i.__importDefault(t(3)),M=r.default.Action,o=r.default.fromValues({action:M.CLOSE}),O=r.default.fromValues({action:M.DISCONNECT}),E=function(w){i.__extends(C,w);function C(p,R,c,a){var s=w.call(this)||this;return a&&(c.format=void 0,c.heartbeats=!0),s.connectionManager=p,p.registerProposedTransport(s),s.auth=R,s.params=c,s.timeouts=c.options.timeouts,s.format=c.format,s.isConnected=!1,s.isFinished=!1,s.isDisposed=!1,s.maxIdleInterval=null,s.idleTimer=null,s.lastActivity=null,s}return C.prototype.connect=function(){},C.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",T.default.closed())},C.prototype.disconnect=function(p){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",p||T.default.disconnected())},C.prototype.fail=function(p){this.isConnected&&this.requestDisconnect(),this.finish("failed",p||T.default.failed())},C.prototype.finish=function(p,R){var c;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((c=this.idleTimer)!==null&&c!==void 0?c:void 0),this.idleTimer=null,this.emit(p,R),this.dispose())},C.prototype.onProtocolMessage=function(p){switch(b.default.shouldLog(b.default.LOG_MICRO)&&b.default.logAction(b.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+r.default.stringify(p)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),p.action){case M.HEARTBEAT:b.default.logAction(b.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",p.id);break;case M.CONNECTED:this.onConnect(p),this.emit("connected",p.error,p.connectionId,p.connectionDetails,p);break;case M.CLOSED:this.onClose(p);break;case M.DISCONNECTED:this.onDisconnect(p);break;case M.ACK:this.emit("ack",p.msgSerial,p.count);break;case M.NACK:this.emit("nack",p.msgSerial,p.count,p.error);break;case M.SYNC:this.connectionManager.onChannelMessage(p,this);break;case M.ACTIVATE:break;case M.AUTH:this.auth.authorize(function(R){R&&b.default.logAction(b.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+A.inspectError(R))});break;case M.ERROR:if(b.default.logAction(b.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+S.default.Config.inspect(p.error)+(p.channel?", channel: "+p.channel:"")),p.channel===void 0){this.onFatalError(p);break}this.connectionManager.onChannelMessage(p,this);break;default:this.connectionManager.onChannelMessage(p,this)}},C.prototype.onConnect=function(p){if(this.isConnected=!0,!p.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var R=p.connectionDetails.maxIdleInterval;R&&(this.maxIdleInterval=R+this.timeouts.realtimeRequestTimeout,this.onActivity())},C.prototype.onDisconnect=function(p){var R=p&&p.error;b.default.logAction(b.default.LOG_MINOR,"Transport.onDisconnect()","err = "+A.inspectError(R)),this.finish("disconnected",R)},C.prototype.onFatalError=function(p){var R=p&&p.error;b.default.logAction(b.default.LOG_MINOR,"Transport.onFatalError()","err = "+A.inspectError(R)),this.finish("failed",R)},C.prototype.onClose=function(p){var R=p&&p.error;b.default.logAction(b.default.LOG_MINOR,"Transport.onClose()","err = "+A.inspectError(R)),this.finish("closed",R)},C.prototype.requestClose=function(){b.default.logAction(b.default.LOG_MINOR,"Transport.requestClose()",""),this.send(o)},C.prototype.requestDisconnect=function(){b.default.logAction(b.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(O)},C.prototype.ping=function(p){var R={action:r.default.Action.HEARTBEAT};p&&(R.id=p),this.send(r.default.fromValues(R))},C.prototype.dispose=function(){b.default.logAction(b.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},C.prototype.onActivity=function(){this.maxIdleInterval&&(this.lastActivity=this.connectionManager.lastActivity=A.now(),this.setIdleTimer(this.maxIdleInterval+100))},C.prototype.setIdleTimer=function(p){var R=this;this.idleTimer||(this.idleTimer=setTimeout(function(){R.onIdleTimerExpire()},p))},C.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var p=A.now()-this.lastActivity,R=this.maxIdleInterval-p;if(R<=0){var c="No activity seen from realtime in "+p+"ms; assuming connection has dropped";b.default.logAction(b.default.LOG_ERROR,"Transport.onIdleTimerExpire()",c),this.disconnect(new I.default(c,80003,408))}else this.setIdleTimer(R+100)},C.tryConnect=function(p,R,c,a,s){var n=new p(R,c,a),h,d=function(N){clearTimeout(h),s({event:this.event,error:N})},v=R.options.timeouts.realtimeRequestTimeout;h=setTimeout(function(){n.off(["preconnect","disconnected","failed"]),n.dispose(),d.call({event:"disconnected"},new I.default("Timeout waiting for transport to indicate itself viable",5e4,500))},v),n.on(["failed","disconnected"],d),n.on("preconnect",function(){b.default.logAction(b.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+n),clearTimeout(h),n.off(["failed","disconnected"],d),s(null,n)}),n.connect()},C}(y.default);e.default=E},function(l,e,t){(function(i,r){l.exports=r(t(6),t(40),t(25))})(this,function(i){return function(){var r=i,A=r.lib,y=A.Base,b=A.WordArray,T=r.algo,I=T.MD5,S=T.EvpKDF=y.extend({cfg:y.extend({keySize:128/32,hasher:I,iterations:1}),init:function(M){this.cfg=this.cfg.extend(M)},compute:function(M,o){for(var O,E=this.cfg,w=E.hasher.create(),C=b.create(),p=C.words,R=E.keySize,c=E.iterations;p.length<R;){O&&w.update(O),O=w.update(M).finalize(o),w.reset();for(var a=1;a<c;a++)O=w.finalize(O),w.reset();C.concat(O)}return C.sigBytes=R*4,C}});r.EvpKDF=function(M,o,O){return S.create(O).compute(M,o)}}(),i.EvpKDF})},function(l,e,t){(function(i,r){l.exports=r(t(6),t(27))})(this,function(i){i.lib.Cipher||function(r){var A=i,y=A.lib,b=y.Base,T=y.WordArray,I=y.BufferedBlockAlgorithm,S=A.enc;S.Utf8;var M=S.Base64,o=A.algo,O=o.EvpKDF,E=y.Cipher=I.extend({cfg:b.extend(),createEncryptor:function(D,L){return this.create(this._ENC_XFORM_MODE,D,L)},createDecryptor:function(D,L){return this.create(this._DEC_XFORM_MODE,D,L)},init:function(D,L,x){this.cfg=this.cfg.extend(x),this._xformMode=D,this._key=L,this.reset()},reset:function(){I.reset.call(this),this._doReset()},process:function(D){return this._append(D),this._process()},finalize:function(D){D&&this._append(D);var L=this._doFinalize();return L},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function D(L){return typeof L=="string"?N:h}return function(L){return{encrypt:function(x,m,g){return D(m).encrypt(L,x,m,g)},decrypt:function(x,m,g){return D(m).decrypt(L,x,m,g)}}}}()});y.StreamCipher=E.extend({_doFinalize:function(){var D=this._process(!0);return D},blockSize:1});var w=A.mode={},C=y.BlockCipherMode=b.extend({createEncryptor:function(D,L){return this.Encryptor.create(D,L)},createDecryptor:function(D,L){return this.Decryptor.create(D,L)},init:function(D,L){this._cipher=D,this._iv=L}}),p=w.CBC=function(){var D=C.extend();D.Encryptor=D.extend({processBlock:function(x,m){var g=this._cipher,k=g.blockSize;L.call(this,x,m,k),g.encryptBlock(x,m),this._prevBlock=x.slice(m,m+k)}}),D.Decryptor=D.extend({processBlock:function(x,m){var g=this._cipher,k=g.blockSize,j=x.slice(m,m+k);g.decryptBlock(x,m),L.call(this,x,m,k),this._prevBlock=j}});function L(x,m,g){var k,j=this._iv;j?(k=j,this._iv=r):k=this._prevBlock;for(var F=0;F<g;F++)x[m+F]^=k[F]}return D}(),R=A.pad={},c=R.Pkcs7={pad:function(D,L){for(var x=L*4,m=x-D.sigBytes%x,g=m<<24|m<<16|m<<8|m,k=[],j=0;j<m;j+=4)k.push(g);var F=T.create(k,m);D.concat(F)},unpad:function(D){var L=D.words[D.sigBytes-1>>>2]&255;D.sigBytes-=L}};y.BlockCipher=E.extend({cfg:E.cfg.extend({mode:p,padding:c}),reset:function(){var D;E.reset.call(this);var L=this.cfg,x=L.iv,m=L.mode;this._xformMode==this._ENC_XFORM_MODE?D=m.createEncryptor:(D=m.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==D?this._mode.init(this,x&&x.words):(this._mode=D.call(m,this,x&&x.words),this._mode.__creator=D)},_doProcessBlock:function(D,L){this._mode.processBlock(D,L)},_doFinalize:function(){var D,L=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(L.pad(this._data,this.blockSize),D=this._process(!0)):(D=this._process(!0),L.unpad(D)),D},blockSize:128/32});var a=y.CipherParams=b.extend({init:function(D){this.mixIn(D)},toString:function(D){return(D||this.formatter).stringify(this)}}),s=A.format={},n=s.OpenSSL={stringify:function(D){var L,x=D.ciphertext,m=D.salt;return m?L=T.create([1398893684,1701076831]).concat(m).concat(x):L=x,L.toString(M)},parse:function(D){var L,x=M.parse(D),m=x.words;return m[0]==1398893684&&m[1]==1701076831&&(L=T.create(m.slice(2,4)),m.splice(0,4),x.sigBytes-=16),a.create({ciphertext:x,salt:L})}},h=y.SerializableCipher=b.extend({cfg:b.extend({format:n}),encrypt:function(D,L,x,m){m=this.cfg.extend(m);var g=D.createEncryptor(x,m),k=g.finalize(L),j=g.cfg;return a.create({ciphertext:k,key:x,iv:j.iv,algorithm:D,mode:j.mode,padding:j.padding,blockSize:D.blockSize,formatter:m.format})},decrypt:function(D,L,x,m){m=this.cfg.extend(m),L=this._parse(L,m.format);var g=D.createDecryptor(x,m).finalize(L.ciphertext);return g},_parse:function(D,L){return typeof D=="string"?L.parse(D,this):D}}),d=A.kdf={},v=d.OpenSSL={execute:function(D,L,x,m){m||(m=T.random(64/8));var g=O.create({keySize:L+x}).compute(D,m),k=T.create(g.words.slice(L),x*4);return g.sigBytes=L*4,a.create({key:g,iv:k,salt:m})}},N=y.PasswordBasedCipher=h.extend({cfg:h.cfg.extend({kdf:v}),encrypt:function(D,L,x,m){m=this.cfg.extend(m);var g=m.kdf.execute(x,D.keySize,D.ivSize);m.iv=g.iv;var k=h.encrypt.call(this,D,L,g.key,m);return k.mixIn(g),k},decrypt:function(D,L,x,m){m=this.cfg.extend(m),L=this._parse(L,m.format);var g=m.kdf.execute(x,D.keySize,D.ivSize,L.salt);m.iv=g.iv;var k=h.decrypt.call(this,D,L,g.key,m);return k}})}()})},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.Request=e.createRequest=void 0;var i=t(0),r=i.__importStar(t(1)),A=i.__importDefault(t(12)),y=i.__importDefault(t(3)),b=i.__importDefault(t(7)),T=t(4),I=i.__importDefault(t(8)),S=i.__importDefault(t(2)),M=i.__importDefault(t(22)),o=r.getGlobalObject(),O=function(){},E=o._ablyjs_jsonp={};E._=function(s){return E["_"+s]||O};var w=1,C="jsonp";function p(s,n,h,d,v,N,D){return N=N||I.default.TIMEOUTS,new c(void 0,s,n,r.copy(h),d,v,N,D)}e.createRequest=p;var R=function(s){i.__extends(n,s);function n(h,d,v){var N=s.call(this,h,d,v)||this;return N.shortName=C,v.stream=!1,N}return n.isAvailable=function(){return y.default.Config.jsonpSupported&&y.default.Config.allowComet},n.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},n.prototype.createRequest=function(h,d,v,N,D,L,x){return L=(this===null||this===void 0?void 0:this.timeouts)||L||I.default.TIMEOUTS,p(h,d,v,N,D,L,x)},n}(A.default),c=function(s){i.__extends(n,s);function n(h,d,v,N,D,L,x,m){var g=s.call(this)||this;return h===void 0&&(h=w++),g.id=h,g.uri=d,g.params=N||{},g.params.rnd=r.cheapRandStr(),v&&(v["X-Ably-Version"]&&(g.params.v=v["X-Ably-Version"]),v["X-Ably-Lib"]&&(g.params.lib=v["X-Ably-Lib"])),g.body=D,g.method=m,g.requestMode=L,g.timeouts=x,g.requestComplete=!1,g}return n.prototype.exec=function(){var h=this,d=this.id,v=this.body,N=this.method,D=this.uri,L=this.params;L.callback="_ablyjs_jsonp._("+d+")",L.envelope="jsonp",v&&(L.body=v),N&&N!=="get"&&(L.method=N);var x=this.script=document.createElement("script"),m=D+r.toQueryString(L);x.src=m,x.src.split("/").slice(-1)[0]!==m.split("/").slice(-1)[0]&&S.default.logAction(S.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),x.async=!0,x.type="text/javascript",x.charset="UTF-8",x.onerror=function(j){h.complete(new T.PartialErrorInfo("JSONP script error (event: "+y.default.Config.inspect(j)+")",null,400))},E["_"+d]=function(j){if(j.statusCode){var F=j.response;if(j.statusCode==204)h.complete(null,null,null,j.statusCode);else if(!F)h.complete(new T.PartialErrorInfo("Invalid server response: no envelope detected",null,500));else if(j.statusCode<400||r.isArray(F))h.complete(null,F,j.headers,j.statusCode);else{var V=F.error||new T.PartialErrorInfo("Error response received from server",null,j.statusCode);h.complete(V)}}else h.complete(null,j)};var g=this.requestMode==M.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),g);var k=document.getElementsByTagName("head")[0];k.insertBefore(x,k.firstChild)},n.prototype.complete=function(h,d,v,N){if(v=v||{},!this.requestComplete){this.requestComplete=!0;var D=void 0;d&&(D=typeof d=="string"?"text/plain":"application/json",v["content-type"]=D,this.emit("data",d)),this.emit("complete",h,d,v,!0,N),this.dispose()}},n.prototype.abort=function(){this.dispose()},n.prototype.dispose=function(){var h=this.timer;h&&(clearTimeout(h),this.timer=null);var d=this.script;d.parentNode&&d.parentNode.removeChild(d),delete E[this.id],this.emit("disposed")},n}(b.default);e.Request=c;function a(s){return o.JSONPTransport=R,R.isAvailable()&&(s.supportedTransports[C]=R),R}e.default=a},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),A=i.__importDefault(t(2)),y=i.__importDefault(t(8)),b=i.__importDefault(t(18)),T=i.__importDefault(t(46)),I=i.__importDefault(t(20)),S=i.__importDefault(t(33)),M=i.__importDefault(t(4)),o=i.__importDefault(t(49)),O=i.__importDefault(t(19)),E=i.__importDefault(t(3)),w=i.__importDefault(t(9)),C=i.__importDefault(t(16)),p=i.__importDefault(t(15)),R=function(){},c=function(){function s(n){if(!n){var h="no options provided";throw A.default.logAction(A.default.LOG_ERROR,"Rest()",h),new Error(h)}var d=y.default.objectifyOptions(n);d.log?(A.default.setLog(d.log.level,d.log.handler),A.default.deprecated("The `log` client option","Equivalent functionality is provided by the `logLevel` and `logHandler` client options. Update your client options code of the form `{ log: { level: logLevel, handler: logHandler } }` to instead be `{ logLevel, logHandler }`.")):A.default.setLog(d.logLevel,d.logHandler),A.default.logAction(A.default.LOG_MICRO,"Rest()","initialized with clientOptions "+E.default.Config.inspect(n));var v=this.options=y.default.normaliseOptions(d);if(v.key){var N=v.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!N){var h="invalid key parameter";throw A.default.logAction(A.default.LOG_ERROR,"Rest()",h),new M.default(h,40400,404)}v.keyName=N[1],v.keySecret=N[2]}if("clientId"in v)if(typeof v.clientId=="string"||v.clientId===null){if(v.clientId==="*")throw new M.default('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new M.default("clientId must be either a string or null",40012,400);A.default.logAction(A.default.LOG_MINOR,"Rest()","started; version = "+y.default.version),this.baseUri=this.authority=function(D){return y.default.getHttpScheme(v)+D+":"+y.default.getPort(v,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new E.default.Http(v),this.auth=new b.default(this,v),this.channels=new a(this),this.push=new T.default(this)}return s.prototype.stats=function(n,h){if(h===void 0)if(typeof n=="function")h=n,n=null;else{if(this.options.promises)return r.promisify(this,"stats",[n]);h=R}var d=r.defaultGetHeaders(this.options),v=this.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,N=this.http.supportsLinkHeaders?void 0:v;this.options.headers&&r.mixin(d,this.options.headers),new I.default(this,"/stats",d,N,function(D,L,x){for(var m=x?D:JSON.parse(D),g=0;g<m.length;g++)m[g]=o.default.fromValues(m[g]);return m}).get(n,h)},s.prototype.time=function(n,h){var d=this;if(h===void 0){if(typeof n=="function")h=n,n=null;else if(this.options.promises)return r.promisify(this,"time",[n])}var v=h||R,N=r.defaultGetHeaders(this.options);this.options.headers&&r.mixin(N,this.options.headers);var D=function(L){return d.authority(L)+"/time"};this.http.do(O.default.Get,this,D,N,null,n,function(L,x,m,g){if(L){v(L);return}g||(x=JSON.parse(x));var k=x[0];if(!k){v(new M.default("Internal error (unexpected result type from GET /time)",5e4,500));return}d.serverTimeOffset=k-r.now(),v(null,k)})},s.prototype.request=function(n,h,d,v,N,D){var L=this.options.useBinaryProtocol,x=L?E.default.Config.msgpack.encode:JSON.stringify,m=L?E.default.Config.msgpack.decode:JSON.parse,g=L?r.Format.msgpack:r.Format.json,k=this.http.supportsLinkHeaders?void 0:g;d=d||{};var j=n.toLowerCase(),F=j=="get"?r.defaultGetHeaders(this.options,g):r.defaultPostHeaders(this.options,g);if(D===void 0){if(this.options.promises)return r.promisify(this,"request",[n,h,d,v,N]);D=R}typeof v!="string"&&(v=x(v)),this.options.headers&&r.mixin(F,this.options.headers),N&&r.mixin(F,N);var V=new I.default(this,h,F,k,function(z,_,P){return r.ensureArray(P?z:m(z))},!0);if(!r.arrIn(E.default.Http.methods,j))throw new M.default("Unsupported method "+j,40500,405);r.arrIn(E.default.Http.methodsWithBody,j)?V[j](d,v,D):V[j](d,D)},s.prototype.batchPublish=function(n,h){if(h===void 0){if(this.options.promises)return r.promisify(this,"batchPublish",[n]);h=R}var d=h,v,N;r.isArray(n)?(v=n,N=!1):(v=[n],N=!0);var D=this.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,L=r.defaultPostHeaders(this.options,D);this.options.headers&&r.mixin(L,this.options.headers);var x=r.encodeBody(v,D);p.default.post(this,"/messages",x,L,{newBatchResponse:"true"},null,function(m,g,k,j){if(m){d(m);return}var F=j?g:r.decodeBody(g,D);N?d(null,F[0]):d(null,F)})},s.prototype.batchPresence=function(n,h){if(h===void 0){if(this.options.promises)return r.promisify(this,"batchPresence",[n]);h=R}var d=h,v=this.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,N=r.defaultPostHeaders(this.options,v);this.options.headers&&r.mixin(N,this.options.headers);var D=n.join(",");p.default.get(this,"/presence",N,{newBatchResponse:"true",channels:D},null,function(L,x,m,g){if(L){d(L);return}var k=g?x:r.decodeBody(x,v);d(null,k)})},s.prototype.setLog=function(n){A.default.setLog(n.level,n.handler)},s.Promise=function(n){return n=y.default.objectifyOptions(n),n.promises=!0,new s(n)},s.Callbacks=s,s.Platform=E.default,s.Message=w.default,s.PresenceMessage=C.default,s}(),a=function(){function s(n){this.rest=n,this.all=Object.create(null)}return s.prototype.get=function(n,h){n=String(n);var d=this.all[n];return d?h&&d.setOptions(h):this.all[n]=d=new S.default(this.rest,n,h),d},s.prototype.release=function(n){delete this.all[String(n)]},s}();e.default=c},function(l,e,t){(function(i,r){l.exports=r(t(6))})(this,function(i){return i.enc.Utf8})},function(l,e,t){(function(i,r){l.exports=r(t(6))})(this,function(i){return function(r){var A=i,y=A.lib,b=y.WordArray,T=y.Hasher,I=A.algo,S=[],M=[];(function(){function E(R){for(var c=r.sqrt(R),a=2;a<=c;a++)if(!(R%a))return!1;return!0}function w(R){return(R-(R|0))*4294967296|0}for(var C=2,p=0;p<64;)E(C)&&(p<8&&(S[p]=w(r.pow(C,1/2))),M[p]=w(r.pow(C,1/3)),p++),C++})();var o=[],O=I.SHA256=T.extend({_doReset:function(){this._hash=new b.init(S.slice(0))},_doProcessBlock:function(E,w){for(var C=this._hash.words,p=C[0],R=C[1],c=C[2],a=C[3],s=C[4],n=C[5],h=C[6],d=C[7],v=0;v<64;v++){if(v<16)o[v]=E[w+v]|0;else{var N=o[v-15],D=(N<<25|N>>>7)^(N<<14|N>>>18)^N>>>3,L=o[v-2],x=(L<<15|L>>>17)^(L<<13|L>>>19)^L>>>10;o[v]=D+o[v-7]+x+o[v-16]}var m=s&n^~s&h,g=p&R^p&c^R&c,k=(p<<30|p>>>2)^(p<<19|p>>>13)^(p<<10|p>>>22),j=(s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25),F=d+j+m+M[v]+o[v],V=k+g;d=h,h=n,n=s,s=a+F|0,a=c,c=R,R=p,p=F+V|0}C[0]=C[0]+p|0,C[1]=C[1]+R|0,C[2]=C[2]+c|0,C[3]=C[3]+a|0,C[4]=C[4]+s|0,C[5]=C[5]+n|0,C[6]=C[6]+h|0,C[7]=C[7]+d|0},_doFinalize:function(){var E=this._data,w=E.words,C=this._nDataBytes*8,p=E.sigBytes*8;return w[p>>>5]|=128<<24-p%32,w[(p+64>>>9<<4)+14]=r.floor(C/4294967296),w[(p+64>>>9<<4)+15]=C,E.sigBytes=w.length*4,this._process(),this._hash},clone:function(){var E=T.clone.call(this);return E._hash=this._hash.clone(),E}});A.SHA256=T._createHelper(O),A.HmacSHA256=T._createHmacHelper(O)}(Math),i.SHA256})},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),A=i.__importDefault(t(7)),y=i.__importDefault(t(2)),b=i.__importDefault(t(34)),T=i.__importDefault(t(9)),I=i.__importDefault(t(4)),S=i.__importDefault(t(20)),M=i.__importDefault(t(15)),o=i.__importDefault(t(3));function O(){}var E=9;function w(R){return r.arrEvery(R,function(c){return!c.id})}function C(R){var c=R||{};if(c.cipher){if(!o.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var a=o.default.Crypto.getCipher(c.cipher);c.cipher=a.cipherParams,c.channelCipher=a.cipher}else"cipher"in c&&(c.cipher=void 0,c.channelCipher=null);return c}var p=function(R){i.__extends(c,R);function c(a,s,n){var h=R.call(this)||this;return y.default.logAction(y.default.LOG_MINOR,"Channel()","started; name = "+s),h.rest=a,h.name=s,h.basePath="/channels/"+encodeURIComponent(s),h.presence=new b.default(h),h.channelOptions=C(n),h}return c.prototype.setOptions=function(a){this.channelOptions=C(a)},c.prototype.history=function(a,s){if(y.default.logAction(y.default.LOG_MICRO,"Channel.history()","channel = "+this.name),s===void 0)if(typeof a=="function")s=a,a=null;else{if(this.rest.options.promises)return r.promisify(this,"history",arguments);s=O}this._history(a,s)},c.prototype._history=function(a,s){var n=this.rest,h=n.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,d=this.rest.http.supportsLinkHeaders?void 0:h,v=r.defaultGetHeaders(n.options,h);n.options.headers&&r.mixin(v,n.options.headers);var N=this.channelOptions;new S.default(n,this.basePath+"/messages",v,d,function(D,L,x){return T.default.fromResponseBody(D,N,x?void 0:h)}).get(a,s)},c.prototype.publish=function(){var a=this,s=arguments.length,n=arguments[0],h=arguments[1],d=arguments[s-1],v,N;if(typeof d!="function"){if(this.rest.options.promises)return r.promisify(this,"publish",arguments);d=O}if(typeof n=="string"||n===null)v=[T.default.fromValues({name:n,data:h})],N=arguments[2];else if(r.isObject(n))v=[T.default.fromValues(n)],N=arguments[1];else if(r.isArray(n))v=T.default.fromValuesArray(n),N=arguments[1];else throw new I.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof N!="object"||!N)&&(N={});var D=this.rest,L=D.options,x=L.useBinaryProtocol?r.Format.msgpack:r.Format.json,m=D.options.idempotentRestPublishing,g=r.defaultPostHeaders(D.options,x);if(L.headers&&r.mixin(g,L.headers),m&&w(v)){var k=r.randomString(E);r.arrForEach(v,function(j,F){j.id=k+":"+F.toString()})}T.default.encodeArray(v,this.channelOptions,function(j){if(j){d(j);return}var F=T.default.getMessagesSize(v),V=L.maxMessageSize;if(F>V){d(new I.default("Maximum size of messages that can be published at once exceeded ( was "+F+" bytes; limit is "+V+" bytes)",40009,400));return}a._publish(T.default.serialize(v,x),g,N,d)})},c.prototype._publish=function(a,s,n,h){M.default.post(this.rest,this.basePath+"/messages",a,s,n,null,h)},c.prototype.status=function(a){if(typeof a!="function"&&this.rest.options.promises)return r.promisify(this,"status",[]);var s=this.rest.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,n=r.defaultPostHeaders(this.rest.options,s);M.default.get(this.rest,this.basePath,n,{},s,a||O)},c}(A.default);e.default=p},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),A=i.__importDefault(t(7)),y=i.__importDefault(t(2)),b=i.__importDefault(t(20)),T=i.__importDefault(t(16));function I(){}var S=function(M){i.__extends(o,M);function o(O){var E=M.call(this)||this;return E.channel=O,E.basePath=O.basePath+"/presence",E}return o.prototype.get=function(O,E){if(y.default.logAction(y.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),E===void 0)if(typeof O=="function")E=O,O=null;else{if(this.channel.rest.options.promises)return r.promisify(this,"get",arguments);E=I}var w=this.channel.rest,C=w.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,p=this.channel.rest.http.supportsLinkHeaders?void 0:C,R=r.defaultGetHeaders(w.options,C);w.options.headers&&r.mixin(R,w.options.headers);var c=this.channel.channelOptions;new b.default(w,this.basePath,R,p,function(a,s,n){return T.default.fromResponseBody(a,c,n?void 0:C)}).get(O,E)},o.prototype.history=function(O,E){return y.default.logAction(y.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(O,E)},o.prototype._history=function(O,E){if(E===void 0)if(typeof O=="function")E=O,O=null;else{if(this.channel.rest.options.promises)return r.promisify(this,"_history",[O]);E=I}var w=this.channel.rest,C=w.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,p=this.channel.rest.http.supportsLinkHeaders?void 0:C,R=r.defaultGetHeaders(w.options,C);w.options.headers&&r.mixin(R,w.options.headers);var c=this.channel.channelOptions;new b.default(w,this.basePath+"/history",R,p,function(a,s,n){return T.default.fromResponseBody(a,c,n?void 0:C)}).get(O,E)},o}(A.default);e.default=S},function(l,e,t){(function(i){Object.defineProperty(e,"__esModule",{value:!0}),e.TransportParams=void 0;var r=t(0),A=r.__importDefault(t(10)),y=r.__importStar(t(1)),b=r.__importStar(t(52)),T=r.__importStar(t(8)),I=r.__importDefault(t(3)),S=r.__importDefault(t(7)),M=r.__importDefault(t(36)),o=r.__importDefault(t(2)),O=r.__importDefault(t(37)),E=r.__importStar(t(21)),w=r.__importStar(t(4)),C=r.__importDefault(t(18)),p=r.__importDefault(t(9)),R=r.__importDefault(t(24)),c=r.__importDefault(t(53)),a=r.__importDefault(t(26)),s=r.__importDefault(t(14)),n=function(){var z;return typeof I.default.WebStorage<"u"&&((z=I.default.WebStorage)===null||z===void 0?void 0:z.localSupported)},h=function(){var z;return typeof I.default.WebStorage<"u"&&((z=I.default.WebStorage)===null||z===void 0?void 0:z.sessionSupported)},d=A.default.Action,v=function(){},N="ably-transport-preference",D="ably-connection-recovery";function L(){var z,_;return h()&&((_=(z=I.default.WebStorage)===null||z===void 0?void 0:z.getSession)===null||_===void 0?void 0:_.call(z,D))}function x(z){var _,P;return h()&&((P=(_=I.default.WebStorage)===null||_===void 0?void 0:_.setSession)===null||P===void 0?void 0:P.call(_,D,z))}function m(){var z,_;return h()&&((_=(z=I.default.WebStorage)===null||z===void 0?void 0:z.removeSession)===null||_===void 0?void 0:_.call(z,D))}function g(z,_){return y.arrIndexOf(I.default.Defaults.transportPreferenceOrder,z.shortName)>y.arrIndexOf(I.default.Defaults.transportPreferenceOrder,_.shortName)}function k(z,_,P){var U;if(z.channel!==_.channel||(U=z.action)!==d.PRESENCE&&U!==d.MESSAGE||U!==_.action)return!1;var B=U===d.PRESENCE?"presence":"messages",H=z[B].concat(_[B]),W=p.default.getMessagesSize(H);return W>P||!y.allSame(H,"clientId")||!y.arrEvery(H,function(Q){return!Q.id})?!1:(z[B]=H,!0)}function j(z){try{return JSON.parse(z)}catch{return null}}var F=function(){function z(_,P,U,B){this.options=_,this.host=P,this.mode=U,this.connectionKey=B,this.format=_.useBinaryProtocol?y.Format.msgpack:y.Format.json}return z.prototype.getConnectParams=function(_){var P=_?y.copy(_):{},U=this.options;switch(this.mode){case"upgrade":P.upgrade=this.connectionKey;break;case"resume":P.resume=this.connectionKey;break;case"recover":{var B=j(U.recover);B&&(P.recover=B.connectionKey);break}}return U.clientId!==void 0&&(P.clientId=U.clientId),U.echoMessages===!1&&(P.echo="false"),this.format!==void 0&&(P.format=this.format),this.stream!==void 0&&(P.stream=this.stream),this.heartbeats!==void 0&&(P.heartbeats=this.heartbeats),P.v=T.default.protocolVersion,P.agent=(0,T.getAgentString)(this.options),U.transportParams!==void 0&&y.mixin(P,U.transportParams),P},z.prototype.toString=function(){var _="[mode="+this.mode;return this.host&&(_+=",host="+this.host),this.connectionKey&&(_+=",connectionKey="+this.connectionKey),this.format&&(_+=",format="+this.format),_+="]",_},z}();e.TransportParams=F;var V=function(z){r.__extends(_,z);function _(P,U){var B=z.call(this)||this;B.disconnectedRetryCount=0,_.initTransports(),B.realtime=P,B.options=U;var H=U.timeouts,W=H.preferenceConnectTimeout+H.realtimeRequestTimeout;if(B.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:W,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:H.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:H.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:H.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},B.state=B.states.initialized,B.errorReason=null,B.queuedMessages=new M.default,B.msgSerial=0,B.connectionDetails=void 0,B.connectionId=void 0,B.connectionKey=void 0,B.connectionStateTtl=H.connectionStateTtl,B.maxIdleInterval=null,B.transports=y.intersect(U.transports||T.default.defaultTransports,_.supportedTransports),B.baseTransport=y.intersect(T.default.baseTransportOrder,B.transports)[0],B.upgradeTransports=y.intersect(B.transports,T.default.upgradeTransports),B.transportPreference=null,B.httpHosts=T.default.getHosts(U),B.activeProtocol=null,B.proposedTransports=[],B.pendingTransports=[],B.host=null,B.lastAutoReconnectAttempt=null,B.lastActivity=null,B.forceFallbackHost=!1,B.connectCounter=0,o.default.logAction(o.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),o.default.logAction(o.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(U.transports||T.default.defaultTransports)+"]"),o.default.logAction(o.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+B.transports+"]"),o.default.logAction(o.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+B.httpHosts+"]"),!B.transports.length){var Q="no requested transports available";throw o.default.logAction(o.default.LOG_ERROR,"realtime.ConnectionManager()",Q),new Error(Q)}var X=I.default.Config.addEventListener;return X&&(h()&&typeof U.recover=="function"&&X("beforeunload",B.persistConnection.bind(B)),U.closeOnUnload===!0&&X("beforeunload",function(){o.default.logAction(o.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),B.requestState({state:"closing"})}),X("online",function(){B.state==B.states.disconnected||B.state==B.states.suspended?(o.default.logAction(o.default.LOG_MINOR,"ConnectionManager caught browser online event","reattempting connection"),B.requestState({state:"connecting"})):B.state==B.states.connecting&&(B.pendingTransports.forEach(function(Z){Z.off()}),B.disconnectAllTransports(),B.startConnect())}),X("offline",function(){B.state==B.states.connected&&(o.default.logAction(o.default.LOG_MINOR,"ConnectionManager caught browser offline event","disconnecting active transport"),B.disconnectAllTransports())})),B}return _.initTransports=function(){(0,c.default)(_),y.arrForEach(I.default.Transports,function(P){P(_)})},_.prototype.createTransportParams=function(P,U){return new F(this.options,P,U,this.connectionKey)},_.prototype.getTransportParams=function(P){var U=this,B=function(H){if(U.connectionKey){H("resume");return}if(typeof U.options.recover=="string"){H("recover");return}var W=U.options.recover,Q=L();if(Q&&typeof W=="function"){o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),W(Q,function(X){X?(U.options.recover=Q.recoveryKey,H("recover")):H("clean")});return}H("clean")};B(function(H){var W=U.createTransportParams(null,H);if(H==="recover"){o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+U.options.recover);var Q=j(U.options.recover);Q&&(U.msgSerial=Q.msgSerial)}else o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+W.toString());P(W)})},_.prototype.tryATransport=function(P,U,B){var H=this;o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+U),a.default.tryConnect(_.supportedTransports[U],this,this.realtime.auth,P,function(W,Q){var X=H.state;if(X==H.states.closing||X==H.states.closed||X==H.states.failed){Q&&(o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+X.state+" while we were attempting the transport; closing "+Q),Q.close()),B(!0);return}if(W){o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+U+" "+W.event+", err: "+W.error.toString()),C.default.isTokenErr(W.error)&&!(H.errorReason&&C.default.isTokenErr(H.errorReason))?(H.errorReason=W.error,H.realtime.auth._forceNewToken(null,null,function(Z){if(Z){H.actOnErrorFromAuthorize(Z);return}H.tryATransport(P,U,B)})):W.event==="failed"?(H.notifyState({state:"failed",error:W.error}),B(!0)):W.event==="disconnected"&&((0,E.isRetriable)(W.error)?B(!1):(H.notifyState({state:H.states.connecting.failState,error:W.error}),B(!0)));return}o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+U+"; setting pending"),H.setTransportPending(Q,P),B(null,Q)})},_.prototype.setTransportPending=function(P,U){var B=this,H=U.mode;o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+P+"; mode = "+H),y.arrDeleteValue(this.proposedTransports,P),this.pendingTransports.push(P);var W=I.default.Defaults.transportPreferenceOrder[I.default.Defaults.transportPreferenceOrder.length-1];P.once("connected",function(X,Z,ee){H=="upgrade"&&B.activeProtocol?P.shortName!==W&&y.arrIn(B.getUpgradePossibilities(),W)&&B.activeProtocol?setTimeout(function(){B.scheduleTransportActivation(X,P,Z,ee)},B.options.timeouts.parallelUpgradeDelay):B.scheduleTransportActivation(X,P,Z,ee):(B.activateTransport(X,P,Z,ee),I.default.Config.nextTick(function(){B.connectImpl(U)})),H==="recover"&&B.options.recover&&(B.options.recover=null,B.unpersistConnection())});var Q=this;P.on(["disconnected","closed","failed"],function(X){Q.deactivateTransport(P,this.event,X)}),this.emit("transport.pending",P)},_.prototype.scheduleTransportActivation=function(P,U,B,H){var W=this,Q=this.activeProtocol&&this.activeProtocol.getTransport(),X=function(){U.disconnect(),y.arrDeleteValue(W.pendingTransports,U)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+U.shortName),X();return}if(Q&&!g(U,Q)){o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+U.shortName+" is no better than current active transport "+Q.shortName+" - abandoning upgrade"),X();return}o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+U);var Z=null;if(!U.isConnected){o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+U.shortName+"is no longer connected; abandoning upgrade"),X();return}if(this.state===this.states.connected)o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),this.state=this.states.synchronizing,Z=this.activeProtocol;else if(this.state!==this.states.connecting){o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+U.shortName),X();return}o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+U);var ee=function(){o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+U),U.send(A.default.fromValues({action:d.ACTIVATE})),W.activateTransport(P,U,B,H),W.state===W.states.synchronizing?(o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+U),W.state=W.states.connected):o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+W.state.state+", so leaving unchanged"),W.state.sendEvents&&W.sendQueuedMessages()};Z?Z.onceIdle(ee):ee()},_.prototype.activateTransport=function(P,U,B,H){var W=this;o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+U),P&&o.default.logAction(o.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+P),B&&o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+B),H&&o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(H)),this.persistTransportPreference(U);var Q=this.state,X=this.states.connected.state;if(o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+Q.state),Q.state==this.states.closing.state||Q.state==this.states.closed.state||Q.state==this.states.failed.state)return o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),U.disconnect(),!1;if(y.arrDeleteValue(this.pendingTransports,U),!U.isConnected)return o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+U+" since it appears to no longer be connected"),!1;var Z=this.activeProtocol;this.activeProtocol=new b.default(U),this.host=U.params.host;var ee=H.connectionKey;if(ee&&this.connectionKey!=ee&&this.setConnection(B,H,!!P),this.onConnectionDetailsUpdate(H,U),I.default.Config.nextTick(function(){U.on("connected",function($,ie,ce){W.onConnectionDetailsUpdate(ce,U),W.emit("update",new O.default(X,X,null,$))})}),Q.state===this.states.connected.state?P&&(this.errorReason=this.realtime.connection.errorReason=P,this.emit("update",new O.default(X,X,null,P))):(this.notifyState({state:"connected",error:P}),this.errorReason=this.realtime.connection.errorReason=P||null),this.emit("transport.active",U),Z)if(Z.messageQueue.count()>0&&o.default.logAction(o.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+Z.transport.shortName+", new one is "+U.shortName+") finishing with "+Z.messageQueue.count()+" messages still pending"),Z.transport===U){var re="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+U.shortName+"; stack = "+new Error().stack;o.default.logAction(o.default.LOG_ERROR,"ConnectionManager.activateTransport()",re)}else Z.finish();return y.safeArrForEach(this.pendingTransports,function($){if($===U){var ie="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+U.shortName+"; stack = "+new Error().stack;o.default.logAction(o.default.LOG_ERROR,"ConnectionManager.activateTransport()",ie),y.arrDeleteValue(W.pendingTransports,U)}else $.disconnect()}),y.safeArrForEach(this.proposedTransports,function($){$===U?(o.default.logAction(o.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+U.shortName+"; stack = "+new Error().stack),y.arrDeleteValue(W.proposedTransports,U)):$.dispose()}),!0},_.prototype.deactivateTransport=function(P,U,B){var H=this.activeProtocol,W=H&&H.getTransport()===P,Q=y.arrDeleteValue(this.pendingTransports,P),X=y.arrDeleteValue(this.proposedTransports,P),Z=this.noTransportsScheduledForActivation();if(o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+P),o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+U+(W?"; was active":Q?"; was pending":X?"; was proposed":"")+(Z?"":"; another transport is scheduled for activation")),B&&B.message&&o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+B.message),W&&(o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(H.getPendingMessages()),I.default.Config.nextTick(function(){H.clearPendingMessages()}),this.activeProtocol=this.host=null),this.emit("transport.inactive",P),W&&Z||W&&U==="failed"||U==="closed"||H===null&&Q&&this.pendingTransports.length===0){if(U==="disconnected"&&B&&B.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:U,error:B,retryImmediately:!0});return}var ee=U==="failed"&&C.default.isTokenErr(B)?"disconnected":U;this.notifyState({state:ee,error:B});return}W&&U==="disconnected"&&this.state!==this.states.synchronizing&&(o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:B}))},_.prototype.noTransportsScheduledForActivation=function(){return y.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(P){return!P.isConnected})},_.prototype.setConnection=function(P,U,B){var H=this.connectionId,W=H&&H!==P,Q=!H&&B;(W||Q)&&(o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==P&&o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=P,this.realtime.connection.key=this.connectionKey=U.connectionKey},_.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()},_.prototype.createRecoveryKey=function(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null},_.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var P=y.now()-this.lastActivity;P>this.connectionStateTtl+this.maxIdleInterval&&(o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+P+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},_.prototype.persistConnection=function(){if(h()){var P=this.createRecoveryKey();P&&x({recoveryKey:P,disconnectedAt:y.now(),location:i.location,clientId:this.realtime.auth.clientId})}},_.prototype.unpersistConnection=function(){m()},_.prototype.getError=function(){return this.errorReason||this.getStateError()},_.prototype.getStateError=function(){var P,U;return(U=(P=E.default)[this.state.state])===null||U===void 0?void 0:U.call(P)},_.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},_.prototype.enactStateChange=function(P){var U=P.current==="failed"?o.default.LOG_ERROR:o.default.LOG_MAJOR;o.default.logAction(U,"Connection state",P.current+(P.reason?"; reason: "+P.reason:"")),o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+P.current+"; reason = "+(P.reason&&P.reason.message));var B=this.state=this.states[P.current];P.reason&&(this.errorReason=P.reason,this.realtime.connection.errorReason=P.reason),(B.terminal||B.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",P)},_.prototype.startTransitionTimer=function(P){var U=this;o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+P.state),this.transitionTimer&&(o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){U.transitionTimer&&(U.transitionTimer=null,o.default.logAction(o.default.LOG_MINOR,"ConnectionManager "+P.state+" timer expired","requesting new state: "+P.failState),U.notifyState({state:P.failState}))},P.retryDelay)},_.prototype.cancelTransitionTimer=function(){o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},_.prototype.startSuspendTimer=function(){var P=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){P.suspendTimer&&(P.suspendTimer=null,o.default.logAction(o.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),P.states.connecting.failState="suspended",P.notifyState({state:"suspended"}))},this.connectionStateTtl))},_.prototype.checkSuspendTimer=function(P){P!=="disconnected"&&P!=="suspended"&&P!=="connecting"&&this.cancelSuspendTimer()},_.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},_.prototype.startRetryTimer=function(P){var U=this;this.retryTimer=setTimeout(function(){o.default.logAction(o.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),U.retryTimer=null,U.requestState({state:"connecting"})},P)},_.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},_.prototype.notifyState=function(P){var U=this,B,H,W=P.state,Q=W==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||P.retryImmediately||this.state===this.states.connecting&&P.error&&C.default.isTokenErr(P.error)&&!(this.errorReason&&C.default.isTokenErr(this.errorReason)));if(o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+W+(Q?"; will retry connection immediately":"")),W!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(P.state),(W==="suspended"||W==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var X=this.states[P.state],Z=X.retryDelay;X.state==="disconnected"&&(this.disconnectedRetryCount++,Z=y.getRetryTime(X.retryDelay,this.disconnectedRetryCount));var ee=new O.default(this.state.state,X.state,Z,P.error||((H=(B=E.default)[X.state])===null||H===void 0?void 0:H.call(B)));if(Q){var re=function(){U.state===U.states.disconnected&&(U.lastAutoReconnectAttempt=y.now(),U.requestState({state:"connecting"}))},$=this.lastAutoReconnectAttempt&&y.now()-this.lastAutoReconnectAttempt+1;$&&$<1e3?(o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+$+"ms ago, waiting another "+(1e3-$)+"ms before trying again"),setTimeout(re,1e3-$)):I.default.Config.nextTick(re)}else(W==="disconnected"||W==="suspended")&&this.startRetryTimer(Z);(W==="disconnected"&&!Q||W==="suspended"||X.terminal)&&I.default.Config.nextTick(function(){U.disconnectAllTransports()}),W=="connected"&&!this.activeProtocol&&o.default.logAction(o.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(ee),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(W,ee.reason),this.failQueuedMessages(ee.reason))}},_.prototype.requestState=function(P){var U=this,B,H,W=P.state;if(o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+W+"; current state: "+this.state.state),W!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(W),!(W=="connecting"&&this.state.state=="connected")&&!(W=="closing"&&this.state.state=="closed"))){var Q=this.states[W],X=new O.default(this.state.state,Q.state,null,P.error||((H=(B=E.default)[Q.state])===null||H===void 0?void 0:H.call(B)));this.enactStateChange(X),W=="connecting"&&I.default.Config.nextTick(function(){U.startConnect()}),W=="closing"&&this.closeImpl()}},_.prototype.startConnect=function(){var P=this;if(this.state!==this.states.connecting){o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var U=this.realtime.auth,B=++this.connectCounter,H=function(){P.checkConnectionStateFreshness(),P.getTransportParams(function(Q){if(Q.mode==="recover"&&Q.options.recover){var X=j(Q.options.recover);X&&P.realtime.channels.recoverChannels(X.channelSerials)}B===P.connectCounter&&P.connectImpl(Q,B)})};if(o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),U.method==="basic")H();else{var W=function(Q){B===P.connectCounter&&(Q?P.actOnErrorFromAuthorize(Q):H())};this.errorReason&&C.default.isTokenErr(this.errorReason)?U._forceNewToken(null,null,W):U._ensureValidAuthCredentials(!1,W)}},_.prototype.connectImpl=function(P,U){var B=this.state.state;B!==this.states.connecting.state&&B!==this.states.connected.state?o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+B):this.pendingTransports.length?o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):B==this.states.connected.state?this.upgradeIfNeeded(P):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(P,U):this.connectBase(P,U)},_.prototype.connectPreference=function(P,U){var B=this,H=this.getTransportPreference(),W=!1;y.arrIn(this.transports,H)||(this.unpersistTransportPreference(),this.connectImpl(P,U)),o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+H);var Q=setTimeout(function(){W=!0,B.state.state!==B.states.connected.state&&(o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+H+" failed; clearing preference and trying from scratch"),B.disconnectAllTransports(),B.unpersistTransportPreference()),B.connectImpl(P,U)},this.options.timeouts.preferenceConnectTimeout);P.host=this.httpHosts[0],this.tryATransport(P,H,function(X,Z){clearTimeout(Q),W&&Z?(Z.off(),Z.disconnect(),y.arrDeleteValue(B.pendingTransports,Z)):!Z&&!X&&(B.unpersistTransportPreference(),B.connectImpl(P,U))})},_.prototype.connectBase=function(P,U){var B=this,H=function(ee){B.notifyState({state:B.states.connecting.failState,error:ee})},W=this.httpHosts.slice(),Q=function(ee,re){U===B.connectCounter&&!re&&!ee&&Z()};o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var X=W.shift();if(!X){H(new w.default("Unable to connect (no available host)",80003,404));return}P.host=X;var Z=function(){if(!W.length){H(new w.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!B.realtime.http.checkConnectivity){H(new w.PartialErrorInfo("Internal error: Http.checkConnectivity not set",null,500));return}B.realtime.http.checkConnectivity(function(ee,re){if(U===B.connectCounter){if(ee){H(ee);return}if(!re){H(new w.default("Unable to connect (network unreachable)",80003,404));return}P.host=y.arrPopRandomElement(W),B.tryATransport(P,B.baseTransport,Q)}})};if(this.forceFallbackHost&&W.length){this.forceFallbackHost=!1,Z();return}this.tryATransport(P,this.baseTransport,Q)},_.prototype.getUpgradePossibilities=function(){var P=this.activeProtocol.getTransport().shortName,U=y.arrIndexOf(this.upgradeTransports,P);return this.upgradeTransports.slice(U+1)},_.prototype.upgradeIfNeeded=function(P){var U=this,B=this.getUpgradePossibilities();o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+I.default.Config.inspect(B)),B.length&&y.arrForEach(B,function(H){var W=U.createTransportParams(P.host,"upgrade");U.tryATransport(W,H,v)})},_.prototype.closeImpl=function(){o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),y.safeArrForEach(this.pendingTransports,function(P){o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+P),P&&P.close()}),y.safeArrForEach(this.proposedTransports,function(P){o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+P),P&&P.dispose()}),this.activeProtocol&&(o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},_.prototype.onAuthUpdated=function(P,U){var B=this,H;switch(this.state.state){case"connected":{if(o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var W=this.activeProtocol.getTransport().params;I.default.Config.nextTick(function(){B.state.state==="connected"&&B.upgradeIfNeeded(W)})}var Q=(H=this.activeProtocol)===null||H===void 0?void 0:H.getTransport();Q&&Q.onAuthUpdated&&Q.onAuthUpdated(P);var X=A.default.fromValues({action:d.AUTH,auth:{accessToken:P.token}});this.send(X);var Z=function(){B.off(ee),U(null,P)},ee=function($){$.current==="failed"&&(B.off(Z),B.off(ee),U($.reason||B.getStateError()))};this.once("connectiondetails",Z),this.on("connectionstate",ee);break}case"connecting":o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var re=function($){switch($.current){case"connected":B.off(re),U(null,P);break;case"failed":case"closed":case"suspended":B.off(re),U($.reason||B.getStateError());break}};this.on("connectionstate",re),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},_.prototype.disconnectAllTransports=function(P){o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(P?" except the active transport":"")),this.connectCounter++,y.safeArrForEach(this.pendingTransports,function(U){o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+U),U&&U.disconnect()}),this.pendingTransports=[],y.safeArrForEach(this.proposedTransports,function(U){o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+U),U&&U.dispose()}),this.proposedTransports=[],this.activeProtocol&&!P&&(o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},_.prototype.send=function(P,U,B){B=B||v;var H=this.state;if(H.sendEvents){o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new b.PendingMessage(P,B));return}var W=U&&H.queueEvents||H.forceQueueEvents;if(!W){var Q="rejecting event, queueEvent was "+U+", state was "+H.state;o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.send()",Q),B(this.errorReason||new w.default(Q,9e4,400));return}o.default.shouldLog(o.default.LOG_MICRO)&&o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+A.default.stringify(P)),this.queue(P,B)},_.prototype.sendImpl=function(P){var U=P.message;P.ackRequired&&!P.sendAttempted&&(U.msgSerial=this.msgSerial++);try{this.activeProtocol.send(P)}catch(B){o.default.logAction(o.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+B.stack)}},_.prototype.queue=function(P,U){o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var B=this.queuedMessages.last(),H=this.options.maxMessageSize;B&&!B.sendAttempted&&k(B.message,P,H)?(B.merged||(B.callback=R.default.create([B.callback]),B.merged=!0),B.callback.push(U)):this.queuedMessages.push(new b.PendingMessage(P,U))},_.prototype.sendQueuedMessages=function(){o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var P;P=this.queuedMessages.shift();)this.sendImpl(P)},_.prototype.queuePendingMessages=function(P){P&&P.length&&(o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+P.length+" pending messages"),this.queuedMessages.prepend(P))},_.prototype.failQueuedMessages=function(P){var U=this.queuedMessages.count();U>0&&(o.default.logAction(o.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+U+" queued messages, err = "+y.inspectError(P)),this.queuedMessages.completeAllMessages(P))},_.prototype.onChannelMessage=function(P,U){var B=this.activeProtocol&&U===this.activeProtocol.getTransport(),H=y.arrIn(this.pendingTransports,U)&&this.state==this.states.synchronizing;B||H?this.realtime.channels.onChannelMessage(P):y.arrIndexOf([d.ACK,d.NACK,d.ERROR],P.action)>-1?this.realtime.channels.onChannelMessage(P):o.default.logAction(o.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(P)+"on defunct transport; discarding")},_.prototype.ping=function(P,U){var B=this;if(P){o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+P);var H=function(){P.off("heartbeat",X),U(new w.default("Timeout waiting for heartbeat response",5e4,500))},W=y.now(),Q=y.cheapRandStr(),X=function(ie){if(ie===Q){P.off("heartbeat",X),clearTimeout(Z);var ce=y.now()-W;U(null,ce)}},Z=setTimeout(H,this.options.timeouts.realtimeRequestTimeout);P.on("heartbeat",X),P.ping(Q);return}if(this.state.state!=="connected"){U(new w.default("Unable to ping service; not connected",4e4,400));return}var ee=!1,re=function(ie,ce){B.off("transport.active",$),ee||(ee=!0,U(ie,ce))},$=function(){ee||(ee=!0,I.default.Config.nextTick(function(){B.ping(null,U)}))};this.on("transport.active",$),this.ping(this.activeProtocol.getTransport(),re)},_.prototype.abort=function(P){this.activeProtocol.getTransport().fail(P)},_.prototype.registerProposedTransport=function(P){this.proposedTransports.push(P)},_.prototype.getTransportPreference=function(){var P,U;return this.transportPreference||n()&&((U=(P=I.default.WebStorage)===null||P===void 0?void 0:P.get)===null||U===void 0?void 0:U.call(P,N))},_.prototype.persistTransportPreference=function(P){var U,B;y.arrIn(T.default.upgradeTransports,P.shortName)&&(this.transportPreference=P.shortName,n()&&((B=(U=I.default.WebStorage)===null||U===void 0?void 0:U.set)===null||B===void 0||B.call(U,N,P.shortName)))},_.prototype.unpersistTransportPreference=function(){var P,U;this.transportPreference=null,n()&&((U=(P=I.default.WebStorage)===null||P===void 0?void 0:P.remove)===null||U===void 0||U.call(P,N))},_.prototype.actOnErrorFromAuthorize=function(P){if(P.code===40171)this.notifyState({state:"failed",error:P});else if(P.code===40102)this.notifyState({state:"failed",error:P});else if(P.statusCode===s.default.Forbidden){var U="Client configured authentication provider returned 403; failing the connection";o.default.logAction(o.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",U),this.notifyState({state:"failed",error:new w.default(U,80019,403,P)})}else{var U="Client configured authentication provider request failed";o.default.logAction(o.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",U),this.notifyState({state:this.state.failState,error:new w.default(U,80019,401,P)})}},_.prototype.onConnectionDetailsUpdate=function(P,U){if(P){this.connectionDetails=P,P.maxMessageSize&&(this.options.maxMessageSize=P.maxMessageSize);var B=P.clientId;if(B){var H=this.realtime.auth._uncheckedSetClientId(B);if(H){o.default.logAction(o.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",H.message),U.fail(H);return}}var W=P.connectionStateTtl;W&&(this.connectionStateTtl=W),this.maxIdleInterval=P.maxIdleInterval,this.emit("connectiondetails",P)}},_.supportedTransports={},_}(S.default);e.default=V}).call(this,t(13))},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(7)),A=i.__importDefault(t(2)),y=function(b){i.__extends(T,b);function T(){var I=b.call(this)||this;return I.messages=[],I}return T.prototype.count=function(){return this.messages.length},T.prototype.push=function(I){this.messages.push(I)},T.prototype.shift=function(){return this.messages.shift()},T.prototype.last=function(){return this.messages[this.messages.length-1]},T.prototype.copyAll=function(){return this.messages.slice()},T.prototype.append=function(I){this.messages.push.apply(this.messages,I)},T.prototype.prepend=function(I){this.messages.unshift.apply(this.messages,I)},T.prototype.completeMessages=function(I,S,M){A.default.logAction(A.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+I+"; count = "+S),M=M||null;var o=this.messages;if(o.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var O=o[0];if(O){var E=O.message.msgSerial,w=I+S;if(w>E)for(var C=o.splice(0,w-E),p=0,R=C;p<R.length;p++){var c=R[p];c.callback(M)}o.length==0&&this.emit("idle")}},T.prototype.completeAllMessages=function(I){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,I)},T.prototype.resetSendAttempted=function(){for(var I=0,S=this.messages;I<S.length;I++){var M=S[I];M.sendAttempted=!1}},T.prototype.clear=function(){A.default.logAction(A.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},T}(r.default);e.default=y},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function r(A,y,b,T){this.previous=A,this.current=y,b&&(this.retryIn=b),T&&(this.reason=T)}return r}();e.default=i},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(10)),A=i.__importDefault(t(7)),y=i.__importStar(t(1)),b=i.__importDefault(t(33)),T=i.__importDefault(t(2)),I=i.__importDefault(t(54)),S=i.__importDefault(t(9)),M=i.__importDefault(t(39)),o=i.__importStar(t(4)),O=i.__importDefault(t(16)),E=i.__importDefault(t(21)),w=r.default.Action,C=function(){};function p(a){if(a&&"params"in a&&!y.isObject(a.params))return new o.default("options.params must be an object",4e4,400);if(a&&"modes"in a){if(!y.isArray(a.modes))return new o.default("options.modes must be an array",4e4,400);for(var s=0;s<a.modes.length;s++){var n=a.modes[s];if(!n||typeof n!="string"||!y.arrIn(r.default.channelModes,String.prototype.toUpperCase.call(n)))return new o.default("Invalid channel mode: "+n,4e4,400)}}}var R=function(a){i.__extends(s,a);function s(n,h,d){var v=a.call(this,n,h,d)||this;return v.retryCount=0,v.history=function(N,D){if(T.default.logAction(T.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),D===void 0)if(typeof N=="function")D=N,N=null;else{if(this.rest.options.promises)return y.promisify(this,"history",arguments);D=C}if(N&&N.untilAttach){if(this.state!=="attached"){D(new o.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){D(new o.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete N.untilAttach,N.from_serial=this.properties.attachSerial}b.default.prototype._history.call(this,N,D)},v.whenState=function(N,D){return A.default.prototype.whenState.call(v,N,v.state,D)},T.default.logAction(T.default.LOG_MINOR,"RealtimeChannel()","started; name = "+h),v.realtime=n,v.presence=new I.default(v),v.connectionManager=n.connection.connectionManager,v.state="initialized",v.subscriptions=new A.default,v.syncChannelSerial=void 0,v.properties={attachSerial:void 0,channelSerial:void 0},v.setOptions(d),v.errorReason=null,v._requestedFlags=null,v._mode=null,v._attachResume=!1,v._decodingContext={channelOptions:v.channelOptions,plugins:n.options.plugins||{},baseEncodedPreviousPayload:void 0},v._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},v._allChannelChanges=new A.default,v}return s.prototype.invalidStateError=function(){return new o.default("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)},s.processListenerArgs=function(n){return n=Array.prototype.slice.call(n),typeof n[0]=="function"&&n.unshift(null),n[n.length-1]==null&&n.pop(),n},s.prototype.setOptions=function(n,h){var d=this.channelOptions;if(!h&&this.rest.options.promises)return y.promisify(this,"setOptions",arguments);var v=h||function(D){D&&T.default.logAction(T.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+D.toString())},N=p(n);if(N){v(N);return}b.default.prototype.setOptions.call(this,n),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(n,d)?(this.attachImpl(),this._allChannelChanges.once(["attached","update","detached","failed"],function(D){switch(this.event){case"update":case"attached":v==null||v(null);return;default:v==null||v(D.reason);return}})):v()},s.prototype._shouldReattachToSetOptions=function(n,h){if(!(this.state==="attached"||this.state==="attaching"))return!1;if(n!=null&&n.params){var d=c(n.params),v=c(h.params);if(Object.keys(d).length!==Object.keys(v).length||!y.shallowEquals(v,d))return!0}return!!(n!=null&&n.modes&&(!h.modes||!y.arrEquals(n.modes,h.modes)))},s.prototype.publish=function(){for(var n=this,h=[],d=0;d<arguments.length;d++)h[d]=arguments[d];var v=h[0],N=h.length,D=h[N-1];if(typeof D!="function"){if(this.realtime.options.promises)return y.promisify(this,"publish",arguments);D=C,++N}if(!this.connectionManager.activeState()){D(this.connectionManager.getError());return}if(N==2)if(y.isObject(v))v=[S.default.fromValues(v)];else if(y.isArray(v))v=S.default.fromValuesArray(v);else throw new o.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else v=[S.default.fromValues({name:h[0],data:h[1]})];var L=this.realtime.options.maxMessageSize;S.default.encodeArray(v,this.channelOptions,function(x){if(x){D(x);return}var m=S.default.getMessagesSize(v);if(m>L){D(new o.default("Maximum size of messages that can be published at once exceeded ( was "+m+" bytes; limit is "+L+" bytes)",40009,400));return}n.__publish(v,D)})},s.prototype.__publish=function(n,h){T.default.logAction(T.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+n.length);var d=this.state;switch(d){case"failed":case"suspended":h(o.default.fromValues(this.invalidStateError()));break;default:{T.default.logAction(T.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+d);var v=new r.default;v.action=w.MESSAGE,v.channel=this.name,v.messages=n,this.sendMessage(v,h);break}}},s.prototype.onEvent=function(n){T.default.logAction(T.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var h=this.subscriptions,d=0;d<n.length;d++){var v=n[d];h.emit(v.name,v)}},s.prototype.attach=function(n,h){var d;if(typeof n=="function"?(h=n,d=null):d=n,!h){if(this.realtime.options.promises)return y.promisify(this,"attach",arguments);h=function(v){v&&T.default.logAction(T.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+v.toString())}}if(d)T.default.deprecated("The ability to pass an array of channel mode flags as the first argument of `RealtimeChannel.attach()`","To set channel mode flags, populate the `modes` property of the channel options object that you pass to `Channels.get()` or `RealtimeChannel.setOptions()`."),this._requestedFlags=d;else if(this.state==="attached"){h(null,null);return}this._attach(!1,null,h)},s.prototype._attach=function(n,h,d){d||(d=function(N){N&&T.default.logAction(T.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+N.toString())});var v=this.connectionManager;if(!v.activeState()){d(v.getError());return}(this.state!=="attaching"||n)&&this.requestState("attaching",h),this.once(function(N){switch(this.event){case"attached":d==null||d(null,N);break;case"detached":case"suspended":case"failed":d==null||d(N.reason||v.getError()||new o.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":d==null||d(new o.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},s.prototype.attachImpl=function(){T.default.logAction(T.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");var n=r.default.fromValues({action:w.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this._requestedFlags?n.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&n.encodeModesToFlags(y.allToUpperCase(this.channelOptions.modes)),this._attachResume&&n.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(n.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(n,C)},s.prototype.detach=function(n){if(!n){if(this.realtime.options.promises)return y.promisify(this,"detach",arguments);n=C}var h=this.connectionManager;if(!h.activeState()){n(h.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),n();break;case"detached":n();break;case"failed":n(new o.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(d){switch(this.event){case"detached":n();break;case"attached":case"suspended":case"failed":n(d.reason||h.getError()||new o.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":n(new o.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},s.prototype.detachImpl=function(n){T.default.logAction(T.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");var h=r.default.fromValues({action:w.DETACH,channel:this.name});this.sendMessage(h,n||C)},s.prototype.subscribe=function(){for(var n=[],h=0;h<arguments.length;h++)n[h]=arguments[h];var d=s.processListenerArgs(n),v=d[0],N=d[1],D=d[2];if(!D&&this.realtime.options.promises)return y.promisify(this,"subscribe",[v,N]);if(this.state==="failed"){D==null||D(o.default.fromValues(this.invalidStateError()));return}return v&&typeof v=="object"&&!Array.isArray(v)?this._subscribeFilter(v,N):this.subscriptions.on(v,N),this.attach(D||C)},s.prototype._subscribeFilter=function(n,h){var d=function(v){var N,D,L,x,m,g,k={name:v.name,refTimeserial:(D=(N=v.extras)===null||N===void 0?void 0:N.ref)===null||D===void 0?void 0:D.timeserial,refType:(x=(L=v.extras)===null||L===void 0?void 0:L.ref)===null||x===void 0?void 0:x.type,isRef:!!(!((g=(m=v.extras)===null||m===void 0?void 0:m.ref)===null||g===void 0)&&g.timeserial),clientId:v.clientId};Object.entries(n).find(function(j){var F=j[0],V=j[1];return V!==void 0?k[F]!==V:!1})||h(v)};this._addFilteredSubscription(n,h,d),this.subscriptions.on(d)},s.prototype._addFilteredSubscription=function(n,h,d){var v;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(h)){var N=this.filteredSubscriptions.get(h);N.set(n,((v=N==null?void 0:N.get(n))===null||v===void 0?void 0:v.concat(d))||[d])}else this.filteredSubscriptions.set(h,new Map([[n,[d]]]))},s.prototype._getAndDeleteFilteredSubscriptions=function(n,h){var d=this;if(!this.filteredSubscriptions)return[];if(!h&&n)return Array.from(this.filteredSubscriptions.entries()).map(function(L){var x,m=L[0],g=L[1],k=g.get(n);return g.delete(n),g.size===0&&((x=d.filteredSubscriptions)===null||x===void 0||x.delete(m)),k}).reduce(function(L,x){var m;return x?(m=L).concat.apply(m,x):L},[]);if(!h||!this.filteredSubscriptions.has(h))return[];var v=this.filteredSubscriptions.get(h);if(!n){var N=Array.from(v.values()).reduce(function(L,x){return L.concat.apply(L,x)},[]);return this.filteredSubscriptions.delete(h),N}var D=v.get(n);return v.delete(n),D||[]},s.prototype.unsubscribe=function(){for(var n=this,h,d=[],v=0;v<arguments.length;v++)d[v]=arguments[v];var N=s.processListenerArgs(d),D=N[0],L=N[1];if(typeof D=="object"&&!L||!((h=this.filteredSubscriptions)===null||h===void 0)&&h.has(L)){this._getAndDeleteFilteredSubscriptions(D,L).forEach(function(x){return n.subscriptions.off(x)});return}this.subscriptions.off(D,L)},s.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new o.PartialErrorInfo("Unable to sync to channel; not attached",4e4)}var n=this.connectionManager;if(!n.activeState())throw n.getError();var h=r.default.fromValues({action:w.SYNC,channel:this.name});this.syncChannelSerial&&(h.channelSerial=this.syncChannelSerial),n.send(h)},s.prototype.sendMessage=function(n,h){this.connectionManager.send(n,this.realtime.options.queueMessages,h)},s.prototype.sendPresence=function(n,h){var d=r.default.fromValues({action:w.PRESENCE,channel:this.name,presence:y.isArray(n)?O.default.fromValuesArray(n):[O.default.fromValues(n)]});this.sendMessage(d,h)},s.prototype.onMessage=function(n){(n.action===w.ATTACHED||n.action===w.MESSAGE||n.action===w.PRESENCE)&&this.setChannelSerial(n.channelSerial);var h,d=!1;switch(n.action){case w.ATTACHED:{this.properties.attachSerial=n.channelSerial,this._mode=n.getMode(),this.params=n.params||{};var v=n.decodeModesFromFlags();this.modes=v&&y.allToLowerCase(v)||void 0;var N=n.hasFlag("RESUMED"),D=n.hasFlag("HAS_PRESENCE"),L=n.hasFlag("HAS_BACKLOG");if(this.state==="attached"){N||this.presence.onAttached(D);var x=new M.default(this.state,this.state,N,L,n.error);this._allChannelChanges.emit("update",x),(!N||this.channelOptions.updateOnAttached)&&this.emit("update",x)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",n.error,N,D,L);break}case w.DETACHED:{var m=n.error?o.default.fromValues(n.error):new o.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",m):this.state==="attaching"?this.notifyState("suspended",m):this.requestState("attaching",m);break}case w.SYNC:if(d=!0,h=this.syncChannelSerial=n.channelSerial,!n.presence)break;case w.PRESENCE:{for(var g=n.presence,k=n.id,j=n.connectionId,F=n.timestamp,V=this.channelOptions,z=void 0,_=0;_<g.length;_++)try{z=g[_],O.default.decode(z,V),z.connectionId||(z.connectionId=j),z.timestamp||(z.timestamp=F),z.id||(z.id=k+":"+_)}catch(Q){T.default.logAction(T.default.LOG_ERROR,"RealtimeChannel.onMessage()",Q.toString())}this.presence.setPresence(g,d,h);break}case w.MESSAGE:{if(this.state!=="attached"){T.default.logAction(T.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+n.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var P=n.messages,U=P[0],B=P[P.length-1],k=n.id,j=n.connectionId,F=n.timestamp;if(U.extras&&U.extras.delta&&U.extras.delta.from!==this._lastPayload.messageId){var H='Delta message decode failure - previous message not available for message "'+n.id+'" on this channel "'+this.name+'".';T.default.logAction(T.default.LOG_ERROR,"RealtimeChannel.onMessage()",H),this._startDecodeFailureRecovery(new o.default(H,40018,400));break}for(var _=0;_<P.length;_++){var H=P[_];try{S.default.decode(H,this._decodingContext)}catch($){switch(T.default.logAction(T.default.LOG_ERROR,"RealtimeChannel.onMessage()",$.toString()),$.code){case 40018:this._startDecodeFailureRecovery($);return;case 40019:case 40021:this.notifyState("failed",$);return}}H.connectionId||(H.connectionId=j),H.timestamp||(H.timestamp=F),H.id||(H.id=k+":"+_)}this._lastPayload.messageId=B.id,this._lastPayload.protocolMessageChannelSerial=n.channelSerial,this.onEvent(P);break}case w.ERROR:{var W=n.error;W&&W.code==80016?this.checkPendingState():this.notifyState("failed",o.default.fromValues(W));break}default:T.default.logAction(T.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+n.action+")"),this.connectionManager.abort(E.default.unknownChannelErr())}},s.prototype._startDecodeFailureRecovery=function(n){var h=this;this._lastPayload.decodeFailureRecoveryInProgress||(T.default.logAction(T.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,n,function(){h._lastPayload.decodeFailureRecoveryInProgress=!1}))},s.prototype.onAttached=function(){T.default.logAction(T.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},s.prototype.notifyState=function(n,h,d,v,N){if(T.default.logAction(T.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+n),this.clearStateTimer(),y.arrIn(["detached","suspended","failed"],n)&&(this.properties.channelSerial=null),n!==this.state){this.presence.actOnChannelState(n,v,h),n==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),h&&(this.errorReason=h);var D=new M.default(this.state,n,d,N,h),L=n==="failed"?T.default.LOG_ERROR:T.default.LOG_MAJOR;T.default.logAction(L,'Channel state for channel "'+this.name+'"',n+(h?"; reason: "+h:"")),n!=="attaching"&&n!=="suspended"&&(this.retryCount=0),n==="attached"&&this.onAttached(),n==="attached"?this._attachResume=!0:(n==="detaching"||n==="failed")&&(this._attachResume=!1),this.state=n,this._allChannelChanges.emit(n,D),this.emit(n,D)}},s.prototype.requestState=function(n,h){T.default.logAction(T.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+n),this.notifyState(n,h),this.checkPendingState()},s.prototype.checkPendingState=function(){var n=this.connectionManager.state;if(!(n.sendEvents||n.forceQueueEvents)){T.default.logAction(T.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(T.default.logAction(T.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break}},s.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var n=new o.default("Channel attach timed out",90007,408);this.notifyState("suspended",n);break}case"detaching":{var n=new o.default("Channel detach timed out",90007,408);this.notifyState("attached",n);break}default:this.checkPendingState();break}},s.prototype.startStateTimerIfNotRunning=function(){var n=this;this.stateTimer||(this.stateTimer=setTimeout(function(){T.default.logAction(T.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),n.stateTimer=null,n.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},s.prototype.clearStateTimer=function(){var n=this.stateTimer;n&&(clearTimeout(n),this.stateTimer=null)},s.prototype.startRetryTimer=function(){var n=this;if(!this.retryTimer){this.retryCount++;var h=y.getRetryTime(this.realtime.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(function(){n.state==="suspended"&&n.connectionManager.state.sendEvents&&(n.retryTimer=null,T.default.logAction(T.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),n.requestState("attaching"))},h)}},s.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},s.prototype.getReleaseErr=function(){var n=this.state;return n==="initialized"||n==="detached"||n==="failed"?null:new o.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+n,90001,400)},s.prototype.setChannelSerial=function(n){T.default.logAction(T.default.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+n+"; previous = "+this.properties.channelSerial),n&&(this.properties.channelSerial=n)},s}(b.default);function c(a){var s=a||{};s.agent;var n=i.__rest(s,["agent"]);return n}e.default=R},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function r(A,y,b,T,I){this.previous=A,this.current=y,y==="attached"&&(this.resumed=b,this.hasBacklog=T),I&&(this.reason=I)}return r}();e.default=i},function(l,e,t){(function(i,r){l.exports=r(t(6))})(this,function(i){return function(){var r=i,A=r.lib,y=A.WordArray,b=A.Hasher,T=r.algo,I=[],S=T.SHA1=b.extend({_doReset:function(){this._hash=new y.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(M,o){for(var O=this._hash.words,E=O[0],w=O[1],C=O[2],p=O[3],R=O[4],c=0;c<80;c++){if(c<16)I[c]=M[o+c]|0;else{var a=I[c-3]^I[c-8]^I[c-14]^I[c-16];I[c]=a<<1|a>>>31}var s=(E<<5|E>>>27)+R+I[c];c<20?s+=(w&C|~w&p)+1518500249:c<40?s+=(w^C^p)+1859775393:c<60?s+=(w&C|w&p|C&p)-1894007588:s+=(w^C^p)-899497514,R=p,p=C,C=w<<30|w>>>2,w=E,E=s}O[0]=O[0]+E|0,O[1]=O[1]+w|0,O[2]=O[2]+C|0,O[3]=O[3]+p|0,O[4]=O[4]+R|0},_doFinalize:function(){var M=this._data,o=M.words,O=this._nDataBytes*8,E=M.sigBytes*8;return o[E>>>5]|=128<<24-E%32,o[(E+64>>>9<<4)+14]=Math.floor(O/4294967296),o[(E+64>>>9<<4)+15]=O,M.sigBytes=o.length*4,this._process(),this._hash},clone:function(){var M=b.clone.call(this);return M._hash=this._hash.clone(),M}});r.SHA1=b._createHelper(S),r.HmacSHA1=b._createHmacHelper(S)}(),i.SHA1})},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});function i(c){if(c===void 0)return"undefined";var a,s;if(c instanceof ArrayBuffer?(s="ArrayBuffer",a=new DataView(c)):c instanceof DataView&&(s="DataView",a=c),!a)return JSON.stringify(c);for(var n=[],h=0;h<c.byteLength;h++){if(h>20){n.push("...");break}var d=a.getUint8(h).toString(16);d.length===1&&(d="0"+d),n.push(d)}return"<"+s+" "+n.join(" ")+">"}function r(c,a,s){for(var n=0,h=s.length;n<h;n++){var d=s.charCodeAt(n);if(d<128){c.setUint8(a++,d>>>0&127|0);continue}if(d<2048){c.setUint8(a++,d>>>6&31|192),c.setUint8(a++,d>>>0&63|128);continue}if(d<65536){c.setUint8(a++,d>>>12&15|224),c.setUint8(a++,d>>>6&63|128),c.setUint8(a++,d>>>0&63|128);continue}if(d<1114112){c.setUint8(a++,d>>>18&7|240),c.setUint8(a++,d>>>12&63|128),c.setUint8(a++,d>>>6&63|128),c.setUint8(a++,d>>>0&63|128);continue}throw new Error("bad codepoint "+d)}}function A(c,a,s){for(var n="",h=a,d=a+s;h<d;h++){var v=c.getUint8(h);if(!(v&128)){n+=String.fromCharCode(v);continue}if((v&224)===192){n+=String.fromCharCode((v&15)<<6|c.getUint8(++h)&63);continue}if((v&240)===224){n+=String.fromCharCode((v&15)<<12|(c.getUint8(++h)&63)<<6|(c.getUint8(++h)&63)<<0);continue}if((v&248)===240){n+=String.fromCharCode((v&7)<<18|(c.getUint8(++h)&63)<<12|(c.getUint8(++h)&63)<<6|(c.getUint8(++h)&63)<<0);continue}throw new Error("Invalid byte "+v.toString(16))}return n}function y(c){for(var a=0,s=0,n=c.length;s<n;s++){var h=c.charCodeAt(s);if(h<128){a+=1;continue}if(h<2048){a+=2;continue}if(h<65536){a+=3;continue}if(h<1114112){a+=4;continue}throw new Error("bad codepoint "+h)}return a}function b(c,a){var s=R(c,a);if(s!==0){var n=new ArrayBuffer(s),h=new DataView(n);return p(c,h,0,a),n}}var T=65536*65536,I=1/T;function S(c,a){return a=a||0,c.getInt32(a)*T+c.getUint32(a+4)}function M(c,a){return a=a||0,c.getUint32(a)*T+c.getUint32(a+4)}function o(c,a,s){s<9223372036854776e3?(c.setInt32(a,Math.floor(s*I)),c.setInt32(a+4,s&-1)):(c.setUint32(a,2147483647),c.setUint32(a+4,2147483647))}function O(c,a,s){s<18446744073709552e3?(c.setUint32(a,Math.floor(s*I)),c.setInt32(a+4,s&-1)):(c.setUint32(a,4294967295),c.setUint32(a+4,4294967295))}var E=function(){function c(a,s){var n=this;this.map=function(h){for(var d={},v=0;v<h;v++){var N=n.parse();d[N]=n.parse()}return d},this.bin=function(h){var d=new ArrayBuffer(h);return new Uint8Array(d).set(new Uint8Array(n.view.buffer,n.offset,h),0),n.offset+=h,d},this.buf=this.bin,this.str=function(h){var d=A(n.view,n.offset,h);return n.offset+=h,d},this.array=function(h){for(var d=new Array(h),v=0;v<h;v++)d[v]=n.parse();return d},this.ext=function(h){return n.offset+=h,{type:n.view.getInt8(n.offset),data:n.buf(h)}},this.parse=function(){var h=n.view.getUint8(n.offset),d,v;if(!(h&128))return n.offset++,h;if((h&240)===128)return v=h&15,n.offset++,n.map(v);if((h&240)===144)return v=h&15,n.offset++,n.array(v);if((h&224)===160)return v=h&31,n.offset++,n.str(v);if((h&224)===224)return d=n.view.getInt8(n.offset),n.offset++,d;switch(h){case 192:return n.offset++,null;case 193:n.offset++;return;case 194:return n.offset++,!1;case 195:return n.offset++,!0;case 196:return v=n.view.getUint8(n.offset+1),n.offset+=2,n.bin(v);case 197:return v=n.view.getUint16(n.offset+1),n.offset+=3,n.bin(v);case 198:return v=n.view.getUint32(n.offset+1),n.offset+=5,n.bin(v);case 199:return v=n.view.getUint8(n.offset+1),n.offset+=2,n.ext(v);case 200:return v=n.view.getUint16(n.offset+1),n.offset+=3,n.ext(v);case 201:return v=n.view.getUint32(n.offset+1),n.offset+=5,n.ext(v);case 202:return d=n.view.getFloat32(n.offset+1),n.offset+=5,d;case 203:return d=n.view.getFloat64(n.offset+1),n.offset+=9,d;case 204:return d=n.view.getUint8(n.offset+1),n.offset+=2,d;case 205:return d=n.view.getUint16(n.offset+1),n.offset+=3,d;case 206:return d=n.view.getUint32(n.offset+1),n.offset+=5,d;case 207:return d=M(n.view,n.offset+1),n.offset+=9,d;case 208:return d=n.view.getInt8(n.offset+1),n.offset+=2,d;case 209:return d=n.view.getInt16(n.offset+1),n.offset+=3,d;case 210:return d=n.view.getInt32(n.offset+1),n.offset+=5,d;case 211:return d=S(n.view,n.offset+1),n.offset+=9,d;case 212:return v=1,n.offset++,n.ext(v);case 213:return v=2,n.offset++,n.ext(v);case 214:return v=4,n.offset++,n.ext(v);case 215:return v=8,n.offset++,n.ext(v);case 216:return v=16,n.offset++,n.ext(v);case 217:return v=n.view.getUint8(n.offset+1),n.offset+=2,n.str(v);case 218:return v=n.view.getUint16(n.offset+1),n.offset+=3,n.str(v);case 219:return v=n.view.getUint32(n.offset+1),n.offset+=5,n.str(v);case 220:return v=n.view.getUint16(n.offset+1),n.offset+=3,n.array(v);case 221:return v=n.view.getUint32(n.offset+1),n.offset+=5,n.array(v);case 222:return v=n.view.getUint16(n.offset+1),n.offset+=3,n.map(v);case 223:return v=n.view.getUint32(n.offset+1),n.offset+=5,n.map(v)}throw new Error("Unknown type 0x"+h.toString(16))},this.offset=s||0,this.view=a}return c}();function w(c){var a=new DataView(c),s=new E(a),n=s.parse();if(s.offset!==c.byteLength)throw new Error(c.byteLength-s.offset+" trailing bytes");return n}function C(c,a){return Object.keys(c).filter(function(s){var n=c[s],h=typeof n;return(!a||n!=null)&&(h!=="function"||!!n.toJSON)})}function p(c,a,s,n){var h=typeof c;if(typeof c=="string"){var d=y(c);if(d<32)return a.setUint8(s,d|160),r(a,s+1,c),1+d;if(d<256)return a.setUint8(s,217),a.setUint8(s+1,d),r(a,s+2,c),2+d;if(d<65536)return a.setUint8(s,218),a.setUint16(s+1,d),r(a,s+3,c),3+d;if(d<4294967296)return a.setUint8(s,219),a.setUint32(s+1,d),r(a,s+5,c),5+d}if(ArrayBuffer.isView&&ArrayBuffer.isView(c)&&(c=c.buffer),c instanceof ArrayBuffer){var v=c.byteLength;if(v<256)return a.setUint8(s,196),a.setUint8(s+1,v),new Uint8Array(a.buffer).set(new Uint8Array(c),s+2),2+v;if(v<65536)return a.setUint8(s,197),a.setUint16(s+1,v),new Uint8Array(a.buffer).set(new Uint8Array(c),s+3),3+v;if(v<4294967296)return a.setUint8(s,198),a.setUint32(s+1,v),new Uint8Array(a.buffer).set(new Uint8Array(c),s+5),5+v}if(typeof c=="number"){if(Math.floor(c)!==c)return a.setUint8(s,203),a.setFloat64(s+1,c),9;if(c>=0){if(c<128)return a.setUint8(s,c),1;if(c<256)return a.setUint8(s,204),a.setUint8(s+1,c),2;if(c<65536)return a.setUint8(s,205),a.setUint16(s+1,c),3;if(c<4294967296)return a.setUint8(s,206),a.setUint32(s+1,c),5;if(c<18446744073709552e3)return a.setUint8(s,207),O(a,s+1,c),9;throw new Error("Number too big 0x"+c.toString(16))}if(c>=-32)return a.setInt8(s,c),1;if(c>=-128)return a.setUint8(s,208),a.setInt8(s+1,c),2;if(c>=-32768)return a.setUint8(s,209),a.setInt16(s+1,c),3;if(c>=-2147483648)return a.setUint8(s,210),a.setInt32(s+1,c),5;if(c>=-9223372036854776e3)return a.setUint8(s,211),o(a,s+1,c),9;throw new Error("Number too small -0x"+(-c).toString(16).substr(1))}if(h==="undefined")return n?0:(a.setUint8(s,212),a.setUint8(s+1,0),a.setUint8(s+2,0),3);if(c===null)return n?0:(a.setUint8(s,192),1);if(h==="boolean")return a.setUint8(s,c?195:194),1;if(typeof c.toJSON=="function")return p(c.toJSON(),a,s,n);if(h==="object"){var N,D=0,L=void 0,x=Array.isArray(c);if(x?N=c.length:(L=C(c,n),N=L.length),N<16?(a.setUint8(s,N|(x?144:128)),D=1):N<65536?(a.setUint8(s,x?220:222),a.setUint16(s+1,N),D=3):N<4294967296&&(a.setUint8(s,x?221:223),a.setUint32(s+1,N),D=5),x)for(var m=0;m<N;m++)D+=p(c[m],a,s+D,n);else if(L)for(var m=0;m<N;m++){var g=L[m];D+=p(g,a,s+D),D+=p(c[g],a,s+D,n)}return D}if(h==="function")return 0;throw new Error("Unknown type "+h)}function R(c,a){var s=typeof c;if(s==="string"){var n=y(c);if(n<32)return 1+n;if(n<256)return 2+n;if(n<65536)return 3+n;if(n<4294967296)return 5+n}if(ArrayBuffer.isView&&ArrayBuffer.isView(c)&&(c=c.buffer),c instanceof ArrayBuffer){var h=c.byteLength;if(h<256)return 2+h;if(h<65536)return 3+h;if(h<4294967296)return 5+h}if(typeof c=="number"){if(Math.floor(c)!==c)return 9;if(c>=0){if(c<128)return 1;if(c<256)return 2;if(c<65536)return 3;if(c<4294967296)return 5;if(c<18446744073709552e3)return 9;throw new Error("Number too big 0x"+c.toString(16))}if(c>=-32)return 1;if(c>=-128)return 2;if(c>=-32768)return 3;if(c>=-2147483648)return 5;if(c>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+c.toString(16).substr(1))}if(s==="boolean")return 1;if(c===null)return a?0:1;if(c===void 0)return a?0:3;if(typeof c.toJSON=="function")return R(c.toJSON(),a);if(s==="object"){var d,v=0;if(Array.isArray(c)){d=c.length;for(var N=0;N<d;N++)v+=R(c[N],a)}else{var D=C(c,a);d=D.length;for(var N=0;N<d;N++){var L=D[N];v+=R(L)+R(c[L],a)}}if(d<16)return 1+v;if(d<65536)return 3+v;if(d<4294967296)return 5+v;throw new Error("Array or object too long 0x"+d.toString(16))}if(s==="function")return 0;throw new Error("Unknown type "+s)}e.default={encode:b,decode:w,inspect:i,utf8Write:r,utf8Read:A,utf8ByteCount:y}},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(30)),A=i.__importDefault(t(50)),y=i.__importDefault(t(3)),b=i.__importDefault(t(4)),T=i.__importDefault(t(55)),I=i.__importDefault(t(57)),S=i.__importDefault(t(62)),M=i.__importDefault(t(64)),o=i.__importDefault(t(68)),O=i.__importDefault(t(2)),E=t(8),w=i.__importDefault(t(65)),C=i.__importDefault(t(66)),p=i.__importDefault(t(41)),R=(0,I.default)(M.default,T.default);y.default.Crypto=R,y.default.BufferUtils=T.default,y.default.Http=S.default,y.default.Config=M.default,y.default.Transports=o.default,y.default.WebStorage=w.default,r.default.Crypto=R,A.default.Crypto=R,O.default.initLogHandlers(),y.default.Defaults=(0,E.getDefaults)(C.default),y.default.Config.agent&&(y.default.Defaults.agent+=" "+y.default.Config.agent),y.default.Config.noUpgrade&&(y.default.Defaults.upgradeTransports=[]),e.default={ErrorInfo:b.default,Rest:r.default,Realtime:A.default,msgpack:p.default}},function(l){l.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.50","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**","src/**","react/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.5","ws":"^8.14.2"},"peerDependencies":{"react":">=16.8.0","react-dom":">=16.8.0"},"peerDependenciesMeta":{"react":{"optional":true},"react-dom":{"optional":true}},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@arethetypeswrong/cli":"^0.13.1","@babel/preset-env":"^7.23.6","@testing-library/react":"^13.3.0","@types/crypto-js":"^4.0.1","@types/jmespath":"^0.15.2","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","@vitejs/plugin-react":"^1.3.2","async":"ably-forks/async#requirejs","aws-sdk":"^2.1413.0","babel-loader":"^8.3.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"^2.8.5","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-import":"^2.28.0","eslint-plugin-jsdoc":"^40.0.0","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.6.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","jmespath":"^0.16.0","jsdom":"^20.0.0","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","mocha-junit-reporter":"^2.2.1","null-loader":"^4.0.1","playwright":"^1.39.0","prettier":"^2.5.1","react":">=18.1.0","react-dom":">=18.1.0","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^4.0.1","tslib":"^2.3.1","typedoc":"^0.23.8","typescript":"^4.6.4","vite":"^4.4.9","vitest":"^0.18.0","webpack":"^4.44.2","webpack-cli":"^4.2.0","webpack-node-externals":"^3.0.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"build"},"main":"ably"},"scripts":{"start:react":"npx vite serve","grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:node:skip-build":"grunt mocha","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","test:react":"vitest run","concat":"grunt concat","build":"grunt build:all && npm run build:react","build:node":"grunt build:node","build:browser":"grunt build:browser","build:react":"npm run build:react:mjs && npm run build:react:cjs && cp src/platform/react-hooks/res/package.react.json react/package.json","build:react:mjs":"tsc --project src/platform/react-hooks/tsconfig.mjs.json && cp src/platform/react-hooks/res/package.mjs.json react/mjs/package.json","build:react:cjs":"tsc --project src/platform/react-hooks/tsconfig.cjs.json && cp src/platform/react-hooks/res/package.cjs.json react/cjs/package.json","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js docs/chrome-mv3.md","format:check":"prettier --check --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js","docs":"typedoc --entryPoints ably.d.ts --out docs/generated/default --readme docs/landing-pages/default.md && typedoc --entryPoints promises.d.ts --out docs/generated/promises --name \\"ably (Promise-based)\\" --readme docs/landing-pages/promises.md && cp docs/landing-pages/choose-library.html docs/generated/index.html"}}')},function(l,e){},function(l,e,t){(function(i,r){l.exports=r(t(6),t(32),t(25))})(this,function(i){return i.HmacSHA256})},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),A=i.__importDefault(t(47)),y=i.__importDefault(t(15)),b=i.__importDefault(t(20)),T=i.__importDefault(t(4)),I=i.__importDefault(t(48)),S=function(){},M=function(){function w(C){this.rest=C,this.admin=new o(C)}return w}(),o=function(){function w(C){this.rest=C,this.deviceRegistrations=new O(C),this.channelSubscriptions=new E(C)}return w.prototype.publish=function(C,p,R){var c=this.rest,a=c.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,s=r.defaultPostHeaders(c.options,a),n={},h=r.mixin({recipient:C},p);if(typeof R!="function"){if(this.rest.options.promises)return r.promisify(this,"publish",arguments);R=S}c.options.headers&&r.mixin(s,c.options.headers),c.options.pushFullWait&&r.mixin(n,{fullWait:"true"});var d=r.encodeBody(h,a);y.default.post(c,"/push/publish",d,s,n,null,function(v){return R(v)})},w}(),O=function(){function w(C){this.rest=C}return w.prototype.save=function(C,p){var R=this.rest,c=A.default.fromValues(C),a=R.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,s=r.defaultPostHeaders(R.options,a),n={};if(typeof p!="function"){if(this.rest.options.promises)return r.promisify(this,"save",arguments);p=S}R.options.headers&&r.mixin(s,R.options.headers),R.options.pushFullWait&&r.mixin(n,{fullWait:"true"});var h=r.encodeBody(c,a);y.default.put(R,"/push/deviceRegistrations/"+encodeURIComponent(C.id),h,s,n,null,function(d,v,N,D){p(d,d?void 0:A.default.fromResponseBody(v,D?void 0:a))})},w.prototype.get=function(C,p){var R=this.rest,c=R.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,a=r.defaultGetHeaders(R.options,c),s=C.id||C;if(typeof p!="function"){if(this.rest.options.promises)return r.promisify(this,"get",arguments);p=S}if(typeof s!="string"||!s.length){p(new T.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}R.options.headers&&r.mixin(a,R.options.headers),y.default.get(R,"/push/deviceRegistrations/"+encodeURIComponent(s),a,{},null,function(n,h,d,v){p(n,n?void 0:A.default.fromResponseBody(h,v?void 0:c))})},w.prototype.list=function(C,p){var R=this.rest,c=R.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,a=this.rest.http.supportsLinkHeaders?void 0:c,s=r.defaultGetHeaders(R.options,c);if(typeof p!="function"){if(this.rest.options.promises)return r.promisify(this,"list",arguments);p=S}R.options.headers&&r.mixin(s,R.options.headers),new b.default(R,"/push/deviceRegistrations",s,a,function(n,h,d){return A.default.fromResponseBody(n,d?void 0:c)}).get(C,p)},w.prototype.remove=function(C,p){var R=this.rest,c=R.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,a=r.defaultGetHeaders(R.options,c),s={},n=C.id||C;if(typeof p!="function"){if(this.rest.options.promises)return r.promisify(this,"remove",arguments);p=S}if(typeof n!="string"||!n.length){p(new T.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}R.options.headers&&r.mixin(a,R.options.headers),R.options.pushFullWait&&r.mixin(s,{fullWait:"true"}),y.default.delete(R,"/push/deviceRegistrations/"+encodeURIComponent(n),a,s,null,function(h){return p(h)})},w.prototype.removeWhere=function(C,p){var R=this.rest,c=R.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,a=r.defaultGetHeaders(R.options,c);if(typeof p!="function"){if(this.rest.options.promises)return r.promisify(this,"removeWhere",arguments);p=S}R.options.headers&&r.mixin(a,R.options.headers),R.options.pushFullWait&&r.mixin(C,{fullWait:"true"}),y.default.delete(R,"/push/deviceRegistrations",a,C,null,function(s){return p(s)})},w}(),E=function(){function w(C){this.remove=w.prototype.removeWhere,this.rest=C}return w.prototype.save=function(C,p){var R=this.rest,c=I.default.fromValues(C),a=R.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,s=r.defaultPostHeaders(R.options,a),n={};if(typeof p!="function"){if(this.rest.options.promises)return r.promisify(this,"save",arguments);p=S}R.options.headers&&r.mixin(s,R.options.headers),R.options.pushFullWait&&r.mixin(n,{fullWait:"true"});var h=r.encodeBody(c,a);y.default.post(R,"/push/channelSubscriptions",h,s,n,null,function(d,v,N,D){p(d,!d&&I.default.fromResponseBody(v,D?void 0:a))})},w.prototype.list=function(C,p){var R=this.rest,c=R.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,a=this.rest.http.supportsLinkHeaders?void 0:c,s=r.defaultGetHeaders(R.options,c);if(typeof p!="function"){if(this.rest.options.promises)return r.promisify(this,"list",arguments);p=S}R.options.headers&&r.mixin(s,R.options.headers),new b.default(R,"/push/channelSubscriptions",s,a,function(n,h,d){return I.default.fromResponseBody(n,d?void 0:c)}).get(C,p)},w.prototype.removeWhere=function(C,p){var R=this.rest,c=R.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,a=r.defaultGetHeaders(R.options,c);if(typeof p!="function"){if(this.rest.options.promises)return r.promisify(this,"removeWhere",arguments);p=S}R.options.headers&&r.mixin(a,R.options.headers),R.options.pushFullWait&&r.mixin(C,{fullWait:"true"}),y.default.delete(R,"/push/channelSubscriptions",a,C,null,function(s){return p(s)})},w.prototype.listChannels=function(C,p){var R=this.rest,c=R.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,a=this.rest.http.supportsLinkHeaders?void 0:c,s=r.defaultGetHeaders(R.options,c);if(typeof p!="function"){if(this.rest.options.promises)return r.promisify(this,"listChannels",arguments);p=S}R.options.headers&&r.mixin(s,R.options.headers),R.options.pushFullWait&&r.mixin(C,{fullWait:"true"}),new b.default(R,"/push/channels",s,a,function(n,h,d){for(var v=!d&&c?r.decodeBody(n,c):n,N=0;N<v.length;N++)v[N]=String(v[N]);return v}).get(C,p)},w}();e.default=M},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),A=i.__importDefault(t(4)),y;(function(I){I.Phone="phone",I.Tablet="tablet",I.Desktop="desktop",I.TV="tv",I.Watch="watch",I.Car="car",I.Embedded="embedded",I.Other="other"})(y||(y={}));var b;(function(I){I.Android="android",I.IOS="ios",I.Browser="browser"})(b||(b={}));var T=function(){function I(){}return I.prototype.toJSON=function(){var S,M,o;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(S=this.push)===null||S===void 0?void 0:S.recipient,state:(M=this.push)===null||M===void 0?void 0:M.state,error:(o=this.push)===null||o===void 0?void 0:o.error}}},I.prototype.toString=function(){var S,M,o,O,E="[DeviceDetails";return this.id&&(E+="; id="+this.id),this.platform&&(E+="; platform="+this.platform),this.formFactor&&(E+="; formFactor="+this.formFactor),this.clientId&&(E+="; clientId="+this.clientId),this.metadata&&(E+="; metadata="+this.metadata),this.deviceIdentityToken&&(E+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((S=this.push)===null||S===void 0)&&S.recipient&&(E+="; push.recipient="+JSON.stringify(this.push.recipient)),!((M=this.push)===null||M===void 0)&&M.state&&(E+="; push.state="+this.push.state),!((o=this.push)===null||o===void 0)&&o.error&&(E+="; push.error="+JSON.stringify(this.push.error)),!((O=this.push)===null||O===void 0)&&O.metadata&&(E+="; push.metadata="+this.push.metadata),E+="]",E},I.fromResponseBody=function(S,M){return M&&(S=r.decodeBody(S,M)),r.isArray(S)?I.fromValuesArray(S):I.fromValues(S)},I.fromValues=function(S){return S.error=S.error&&A.default.fromValues(S.error),Object.assign(new I,S)},I.fromValuesArray=function(S){for(var M=S.length,o=new Array(M),O=0;O<M;O++)o[O]=I.fromValues(S[O]);return o},I.toRequestBody=r.encodeBody,I}();e.default=T},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),A=function(){function y(){}return y.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},y.prototype.toString=function(){var b="[PushChannelSubscription";return this.channel&&(b+="; channel="+this.channel),this.deviceId&&(b+="; deviceId="+this.deviceId),this.clientId&&(b+="; clientId="+this.clientId),b+="]",b},y.fromResponseBody=function(b,T){return T&&(b=r.decodeBody(b,T)),r.isArray(b)?y.fromValuesArray(b):y.fromValues(b)},y.fromValues=function(b){return Object.assign(new y,b)},y.fromValuesArray=function(b){for(var T=b.length,I=new Array(T),S=0;S<T;S++)I[S]=y.fromValues(b[S]);return I},y.toRequestBody=r.encodeBody,y}();e.default=A},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),A=function(){function R(c){this.count=c&&c.count||0,this.data=c&&c.data||0,this.uncompressedData=c&&c.uncompressedData||0,this.failed=c&&c.failed||0,this.refused=c&&c.refused||0}return R}(),y=function(R){i.__extends(c,R);function c(a){var s=R.call(this,a)||this;return a&&a.category&&(s.category={},r.forInOwnNonNullProperties(a.category,function(n){s.category[n]=new A(a.category[n])})),s}return c}(A),b=function(){function R(c){this.peak=c&&c.peak||0,this.min=c&&c.min||0,this.mean=c&&c.mean||0,this.opened=c&&c.opened||0,this.refused=c&&c.refused||0}return R}(),T=function(){function R(c){this.succeeded=c&&c.succeeded||0,this.failed=c&&c.failed||0,this.refused=c&&c.refused||0}return R}(),I=function(){function R(c){this.plain=new b(c&&c.plain),this.tls=new b(c&&c.tls),this.all=new b(c&&c.all)}return R}(),S=function(){function R(c){this.messages=new y(c&&c.messages),this.presence=new y(c&&c.presence),this.all=new y(c&&c.all)}return R}(),M=function(){function R(c){this.realtime=new S(c&&c.realtime),this.rest=new S(c&&c.rest),this.webhook=new S(c&&c.webhook),this.sharedQueue=new S(c&&c.sharedQueue),this.externalQueue=new S(c&&c.externalQueue),this.httpEvent=new S(c&&c.httpEvent),this.push=new S(c&&c.push),this.all=new S(c&&c.all)}return R}(),o=function(){function R(c){this.all=new S(c&&c.all),this.inbound=new M(c&&c.inbound),this.outbound=new M(c&&c.outbound)}return R}(),O=function(){function R(c){this.all=new S(c&&c.all),this.producerPaid=new o(c&&c.producerPaid),this.consumerPaid=new o(c&&c.consumerPaid)}return R}(),E=function(){function R(c){this.messages=c&&c.messages||0;var a=c&&c.notifications;this.notifications={invalid:a&&a.invalid||0,attempted:a&&a.attempted||0,successful:a&&a.successful||0,failed:a&&a.failed||0},this.directPublishes=c&&c.directPublishes||0}return R}(),w=function(){function R(c){this.succeeded=c&&c.succeeded||0,this.skipped=c&&c.skipped||0,this.failed=c&&c.failed||0}return R}(),C=function(){function R(c){var a=this;this.delta=void 0,c&&c.delta&&(this.delta={},r.forInOwnNonNullProperties(c.delta,function(s){a.delta[s]=new w(c.delta[s])}))}return R}(),p=function(R){i.__extends(c,R);function c(a){var s=R.call(this,a)||this;return s.persisted=new S(a&&a.persisted),s.connections=new I(a&&a.connections),s.channels=new b(a&&a.channels),s.apiRequests=new T(a&&a.apiRequests),s.tokenRequests=new T(a&&a.tokenRequests),s.xchgProducer=new O(a&&a.xchgProducer),s.xchgConsumer=new O(a&&a.xchgConsumer),s.push=new E(a&&a.pushStats),s.processed=new C(a&&a.processed),s.inProgress=a&&a.inProgress||void 0,s.unit=a&&a.unit||void 0,s.intervalId=a&&a.intervalId||void 0,s}return c.fromValues=function(a){return new c(a)},c}(o);e.default=p},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),A=i.__importDefault(t(30)),y=i.__importDefault(t(7)),b=i.__importDefault(t(2)),T=i.__importDefault(t(51)),I=i.__importDefault(t(38)),S=i.__importDefault(t(8)),M=i.__importDefault(t(4)),o=i.__importDefault(t(10)),O=i.__importDefault(t(35)),E=i.__importDefault(t(3)),w=i.__importDefault(t(9)),C=function(R){i.__extends(c,R);function c(a){var s=R.call(this,a)||this;return b.default.logAction(b.default.LOG_MINOR,"Realtime()",""),s.connection=new T.default(s,s.options),s.channels=new p(s),a.autoConnect!==!1&&s.connect(),s}return c.prototype.connect=function(){b.default.logAction(b.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},c.prototype.close=function(){b.default.logAction(b.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},c.Promise=function(a){return a=S.default.objectifyOptions(a),a.promises=!0,new c(a)},c.Callbacks=c,c.Utils=r,c.ConnectionManager=O.default,c.Platform=E.default,c.ProtocolMessage=o.default,c.Message=w.default,c}(A.default),p=function(R){i.__extends(c,R);function c(a){var s=R.call(this)||this;return s.realtime=a,s.all=Object.create(null),a.connection.connectionManager.on("transport.active",function(){s.onTransportActive()}),s}return c.prototype.channelSerials=function(){for(var a={},s=0,n=r.keysArray(this.all,!0);s<n.length;s++){var h=n[s],d=this.all[h];d.properties.channelSerial&&(a[h]=d.properties.channelSerial)}return a},c.prototype.recoverChannels=function(a){for(var s=0,n=r.keysArray(a,!0);s<n.length;s++){var h=n[s],d=this.get(h);d.properties.channelSerial=a[h]}},c.prototype.onChannelMessage=function(a){var s=a.channel;if(s===void 0){b.default.logAction(b.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+a.action);return}var n=this.all[s];if(!n){b.default.logAction(b.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+s);return}n.onMessage(a)},c.prototype.onTransportActive=function(){for(var a in this.all){var s=this.all[a];s.state==="attaching"||s.state==="detaching"?s.checkPendingState():s.state==="suspended"?s._attach(!1,null):s.state==="attached"&&s.requestState("attaching")}},c.prototype.propogateConnectionInterruption=function(a,s){var n={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},h=["attaching","attached","detaching","suspended"],d=n[a];for(var v in this.all){var N=this.all[v];r.arrIn(h,N.state)&&N.notifyState(d,s)}},c.prototype.get=function(a,s){a=String(a);var n=this.all[a];if(!n)n=this.all[a]=new I.default(this.realtime,a,s);else if(s){if(n._shouldReattachToSetOptions(s,n.channelOptions))throw new M.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);n.setOptions(s)}return n},c.prototype.getDerived=function(a,s,n){if(s.filter){var h=r.toBase64(s.filter),d=r.matchDerivedChannel(a);a="[filter=".concat(h).concat(d.qualifierParam,"]").concat(d.channelName)}return this.get(a,n)},c.prototype.release=function(a){a=String(a);var s=this.all[a];if(s){var n=s.getReleaseErr();if(n)throw n;delete this.all[a]}},c}(y.default);e.default=C},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),A=i.__importDefault(t(7)),y=i.__importDefault(t(35)),b=i.__importDefault(t(2)),T=i.__importDefault(t(37)),I=i.__importDefault(t(3));function S(){}var M=function(o){i.__extends(O,o);function O(E,w){var C=o.call(this)||this;return C.whenState=function(p,R){return A.default.prototype.whenState.call(C,p,C.state,R,new T.default(void 0,p))},C.ably=E,C.connectionManager=new y.default(E,w),C.state=C.connectionManager.state.state,C.key=void 0,C.id=void 0,C.errorReason=null,C.connectionManager.on("connectionstate",function(p){var R=C.state=p.current;I.default.Config.nextTick(function(){C.emit(R,p)})}),C.connectionManager.on("update",function(p){I.default.Config.nextTick(function(){C.emit("update",p)})}),C}return O.prototype.connect=function(){b.default.logAction(b.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},O.prototype.ping=function(E){if(b.default.logAction(b.default.LOG_MINOR,"Connection.ping()",""),!E){if(this.ably.options.promises)return r.promisify(this,"ping",arguments);E=S}this.connectionManager.ping(null,E)},O.prototype.close=function(){b.default.logAction(b.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},Object.defineProperty(O.prototype,"recoveryKey",{get:function(){return this.createRecoveryKey()},enumerable:!1,configurable:!0}),O.prototype.createRecoveryKey=function(){return this.connectionManager.createRecoveryKey()},O}(A.default);e.default=M},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.PendingMessage=void 0;var i=t(0),r=i.__importDefault(t(10)),A=i.__importStar(t(1)),y=i.__importDefault(t(7)),b=i.__importDefault(t(2)),T=i.__importDefault(t(36)),I=i.__importDefault(t(4)),S=r.default.Action,M=function(){function O(E,w){this.message=E,this.callback=w,this.merged=!1;var C=E.action;this.sendAttempted=!1,this.ackRequired=C==S.MESSAGE||C==S.PRESENCE}return O}();e.PendingMessage=M;var o=function(O){i.__extends(E,O);function E(w){var C=O.call(this)||this;return C.transport=w,C.messageQueue=new T.default,w.on("ack",function(p,R){C.onAck(p,R)}),w.on("nack",function(p,R,c){C.onNack(p,R,c)}),C}return E.prototype.onAck=function(w,C){b.default.logAction(b.default.LOG_MICRO,"Protocol.onAck()","serial = "+w+"; count = "+C),this.messageQueue.completeMessages(w,C)},E.prototype.onNack=function(w,C,p){b.default.logAction(b.default.LOG_ERROR,"Protocol.onNack()","serial = "+w+"; count = "+C+"; err = "+A.inspectError(p)),p||(p=new I.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(w,C,p)},E.prototype.onceIdle=function(w){var C=this.messageQueue;if(C.count()===0){w();return}C.once("idle",w)},E.prototype.send=function(w){w.ackRequired&&this.messageQueue.push(w),b.default.shouldLog(b.default.LOG_MICRO)&&b.default.logAction(b.default.LOG_MICRO,"Protocol.send()","sending msg; "+r.default.stringify(w.message)),w.sendAttempted=!0,this.transport.send(w.message)},E.prototype.getTransport=function(){return this.transport},E.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},E.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},E.prototype.finish=function(){var w=this.transport;this.onceIdle(function(){w.disconnect()})},E}(y.default);e.default=o},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(3)),A=i.__importStar(t(1)),y=i.__importDefault(t(26)),b=i.__importDefault(t(8)),T=i.__importDefault(t(2)),I=i.__importDefault(t(10)),S=i.__importDefault(t(4)),M="web_socket";function o(w){return!!w.on}var O=function(w){i.__extends(C,w);function C(p,R,c){var a=w.call(this,p,R,c)||this;return a.shortName=M,c.heartbeats=r.default.Config.useProtocolHeartbeats,a.wsHost=b.default.getHost(c.options,c.host,!0),a}return C.isAvailable=function(){return!!r.default.Config.WebSocket},C.prototype.createWebSocket=function(p,R){return this.uri=p+A.toQueryString(R),new r.default.Config.WebSocket(this.uri)},C.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},C.prototype.connect=function(){T.default.logAction(T.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),y.default.prototype.connect.call(this);var p=this,R=this.params,c=R.options,a=c.tls?"wss://":"ws://",s=a+this.wsHost+":"+b.default.getPort(c)+"/";T.default.logAction(T.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+s),this.auth.getAuthParams(function(n,h){if(!p.isDisposed){var d="";for(var v in h)d+=" "+v+": "+h[v]+";";if(T.default.logAction(T.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+d+" err: "+n),n){p.disconnect(n);return}var N=R.getConnectParams(h);try{var D=p.wsConnection=p.createWebSocket(s,N);D.binaryType=r.default.Config.binaryType,D.onopen=function(){p.onWsOpen()},D.onclose=function(L){p.onWsClose(L)},D.onmessage=function(L){p.onWsData(L.data)},D.onerror=function(L){p.onWsError(L)},o(D)&&D.on("ping",function(){p.onActivity()})}catch(L){T.default.logAction(T.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(L.stack||L.message)),p.disconnect(L)}}})},C.prototype.send=function(p){var R=this.wsConnection;if(!R){T.default.logAction(T.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{R.send(I.default.serialize(p,this.params.format))}catch(a){var c="Exception from ws connection when trying to send: "+A.inspectError(a);T.default.logAction(T.default.LOG_ERROR,"WebSocketTransport.send()",c),this.finish("disconnected",new S.default(c,5e4,500))}},C.prototype.onWsData=function(p){T.default.logAction(T.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+p.length+"; type = "+typeof p);try{this.onProtocolMessage(I.default.deserialize(p,this.format))}catch(R){T.default.logAction(T.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+R.stack)}},C.prototype.onWsOpen=function(){T.default.logAction(T.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},C.prototype.onWsClose=function(p){var R,c;if(typeof p=="object"?(c=p.code,R=p.wasClean||c===1e3):(c=p,R=c==1e3),delete this.wsConnection,R){T.default.logAction(T.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var a=new S.default("Websocket closed",80003,400);this.finish("disconnected",a)}else{var s="Unclean disconnection of WebSocket ; code = "+c,a=new S.default(s,80003,400);T.default.logAction(T.default.LOG_MINOR,"WebSocketTransport.onWsClose()",s),this.finish("disconnected",a)}this.emit("disposed")},C.prototype.onWsError=function(p){var R=this;T.default.logAction(T.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+p.message),r.default.Config.nextTick(function(){R.disconnect(Error(p.message))})},C.prototype.dispose=function(){T.default.logAction(T.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var p=this.wsConnection;p&&(p.onmessage=function(){},delete this.wsConnection,r.default.Config.nextTick(function(){if(T.default.logAction(T.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!p)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");p.close()}))},C}(y.default);function E(w){return O.isAvailable()&&(w.supportedTransports[M]=O),O}e.default=E},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(1)),A=i.__importDefault(t(34)),y=i.__importDefault(t(7)),b=i.__importDefault(t(2)),T=i.__importDefault(t(16)),I=i.__importStar(t(4)),S=i.__importDefault(t(38)),M=i.__importDefault(t(24)),o=i.__importDefault(t(39)),O=function(){};function E(a){return a.channel.realtime.auth.clientId}function w(a){var s=a.channel.realtime,n=s.auth.clientId;return(!n||n==="*")&&s.connection.state==="connected"}function C(a,s,n){switch(a.state){case"attached":case"suspended":n();break;case"initialized":case"detached":case"detaching":case"attaching":a.attach(function(h){h?s(h):n()});break;default:s(I.default.fromValues(a.invalidStateError()))}}function p(a,s){if(a.isSynthesized()||s.isSynthesized())return a.timestamp>=s.timestamp;var n=a.parseId(),h=s.parseId();return n.msgSerial===h.msgSerial?n.index>h.index:n.msgSerial>h.msgSerial}var R=function(a){i.__extends(s,a);function s(n){var h=a.call(this,n)||this;return h.channel=n,h.syncComplete=!1,h.members=new c(h,function(d){return d.clientId+":"+d.connectionId}),h._myMembers=new c(h,function(d){return d.clientId}),h.subscriptions=new y.default,h.pendingPresence=[],h}return s.prototype.enter=function(n,h){if(w(this))throw new I.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,n,"enter",h)},s.prototype.update=function(n,h){if(w(this))throw new I.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,n,"update",h)},s.prototype.enterClient=function(n,h,d){return this._enterOrUpdateClient(void 0,n,h,"enter",d)},s.prototype.updateClient=function(n,h,d){return this._enterOrUpdateClient(void 0,n,h,"update",d)},s.prototype._enterOrUpdateClient=function(n,h,d,v,N){var D=this;if(!N)if(typeof d=="function")N=d,d=null;else{if(this.channel.realtime.options.promises)return r.promisify(this,"_enterOrUpdateClient",[n,h,d,v]);N=O}var L=this.channel;if(!L.connectionManager.activeState()){N(L.connectionManager.getError());return}b.default.logAction(b.default.LOG_MICRO,"RealtimePresence."+v+"Client()","channel = "+L.name+", id = "+n+", client = "+(h||"(implicit) "+E(this)));var x=T.default.fromData(d);x.action=v,n&&(x.id=n),h&&(x.clientId=h),T.default.encode(x,L.channelOptions,function(m){if(m){N(m);return}switch(L.state){case"attached":L.sendPresence(x,N);break;case"initialized":case"detached":L.attach();case"attaching":D.pendingPresence.push({presence:x,callback:N});break;default:m=new I.PartialErrorInfo("Unable to "+v+" presence channel while in "+L.state+" state",90001),m.code=90001,N(m)}})},s.prototype.leave=function(n,h){if(w(this))throw new I.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,n,h)},s.prototype.leaveClient=function(n,h,d){if(!d)if(typeof h=="function")d=h,h=null;else{if(this.channel.realtime.options.promises)return r.promisify(this,"leaveClient",[n,h]);d=O}var v=this.channel;if(!v.connectionManager.activeState()){d==null||d(v.connectionManager.getError());return}b.default.logAction(b.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+n);var N=T.default.fromData(h);switch(N.action="leave",n&&(N.clientId=n),v.state){case"attached":v.sendPresence(N,d);break;case"attaching":this.pendingPresence.push({presence:N,callback:d});break;case"initialized":case"failed":{var D=new I.PartialErrorInfo("Unable to leave presence channel (incompatible state)",90001);d==null||d(D);break}default:d==null||d(v.invalidStateError())}},s.prototype.get=function(n,h){var d=this,v=Array.prototype.slice.call(arguments);v.length==1&&typeof v[0]=="function"&&v.unshift(null),n=v[0],h=v[1];var N=!n||("waitForSync"in n?n.waitForSync:!0);if(!h){if(this.channel.realtime.options.promises)return r.promisify(this,"get",v);h=O}function D(L){h(null,n?L.list(n):L.values())}if(this.channel.state==="suspended"){N?h(I.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):D(this.members);return}C(this.channel,h,function(){var L=d.members;N?L.waitSync(function(){D(L)}):D(L)})},s.prototype.history=function(n,h){if(b.default.logAction(b.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),h===void 0)if(typeof n=="function")h=n,n=null;else{if(this.channel.realtime.options.promises)return r.promisify(this,"history",arguments);h=O}n&&n.untilAttach&&(this.channel.state==="attached"?(delete n.untilAttach,n.from_serial=this.channel.properties.attachSerial):h(new I.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),A.default.prototype._history.call(this,n,h)},s.prototype.setPresence=function(n,h,d){b.default.logAction(b.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+n.length+" participants; syncChannelSerial = "+d);var v,N,D=this.members,L=this._myMembers,x=[],m=this.channel.connectionManager.connectionId;h&&(this.members.startSync(),d&&(N=d.match(/^[\w-]+:(.*)$/))&&(v=N[1]));for(var g=0;g<n.length;g++){var k=T.default.fromValues(n[g]);switch(k.action){case"leave":D.remove(k)&&x.push(k),k.connectionId===m&&!k.isSynthesized()&&L.remove(k);break;case"enter":case"present":case"update":D.put(k)&&x.push(k),k.connectionId===m&&L.put(k);break}}h&&!v&&(D.endSync(),this.channel.syncChannelSerial=null);for(var g=0;g<x.length;g++){var k=x[g];this.subscriptions.emit(k.action,k)}},s.prototype.onAttached=function(n){b.default.logAction(b.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+n),n?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();var h=this.pendingPresence,d=h.length;if(d){this.pendingPresence=[];var v=[],N=M.default.create();b.default.logAction(b.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+d+" queued presence messages");for(var D=0;D<d;D++){var L=h[D];v.push(L.presence),N.push(L.callback)}this.channel.sendPresence(v,N)}},s.prototype.actOnChannelState=function(n,h,d){switch(n){case"attached":this.onAttached(h);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(d);break}},s.prototype.failPendingPresence=function(n){if(this.pendingPresence.length){b.default.logAction(b.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+r.inspectError(n));for(var h=0;h<this.pendingPresence.length;h++)try{this.pendingPresence[h].callback(n)}catch{}this.pendingPresence=[]}},s.prototype._clearMyMembers=function(){this._myMembers.clear()},s.prototype._ensureMyMembersPresent=function(){var n=this,h=this._myMembers,d=function(D){if(D){var L="Presence auto-re-enter failed: "+D.toString(),x=new I.default(L,91004,400);b.default.logAction(b.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",L);var m=new o.default(n.channel.state,n.channel.state,!0,!1,x);n.channel.emit("update",m)}};for(var v in h.map){var N=h.map[v];b.default.logAction(b.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+N.clientId+'" into the presence set'),this._enterOrUpdateClient(N.id,N.clientId,N.data,"enter",d)}},s.prototype._synthesizeLeaves=function(n){var h=this.subscriptions;r.arrForEach(n,function(d){var v=T.default.fromValues({action:"leave",connectionId:d.connectionId,clientId:d.clientId,data:d.data,encoding:d.encoding,timestamp:r.now()});h.emit("leave",v)})},s.prototype.on=function(){for(var n=[],h=0;h<arguments.length;h++)n[h]=arguments[h];b.default.renamedMethod("RealtimePresence","on","subscribe"),this.subscribe.apply(this,n)},s.prototype.off=function(){for(var n=[],h=0;h<arguments.length;h++)n[h]=arguments[h];b.default.renamedMethod("RealtimePresence","off","unsubscribe"),this.unsubscribe.apply(this,n)},s.prototype.subscribe=function(){for(var n=[],h=0;h<arguments.length;h++)n[h]=arguments[h];var d=S.default.processListenerArgs(n),v=d[0],N=d[1],D=d[2],L=this.channel;if(!D){if(this.channel.realtime.options.promises)return r.promisify(this,"subscribe",[v,N]);D=O}if(L.state==="failed"){D(I.default.fromValues(L.invalidStateError()));return}this.subscriptions.on(v,N),L.attach(D)},s.prototype.unsubscribe=function(){for(var n=[],h=0;h<arguments.length;h++)n[h]=arguments[h];var d=S.default.processListenerArgs(n),v=d[0],N=d[1];this.subscriptions.off(v,N)},s}(A.default),c=function(a){i.__extends(s,a);function s(n,h){var d=a.call(this)||this;return d.presence=n,d.map=Object.create(null),d.syncInProgress=!1,d.residualMembers=null,d.memberKey=h,d}return s.prototype.get=function(n){return this.map[n]},s.prototype.getClient=function(n){var h=this.map,d=[];for(var v in h){var N=h[v];N.clientId==n&&N.action!="absent"&&d.push(N)}return d},s.prototype.list=function(n){var h=this.map,d=n&&n.clientId,v=n&&n.connectionId,N=[];for(var D in h){var L=h[D];L.action!=="absent"&&(d&&d!=L.clientId||v&&v!=L.connectionId||N.push(L))}return N},s.prototype.put=function(n){(n.action==="enter"||n.action==="update")&&(n=T.default.fromValues(n),n.action="present");var h=this.map,d=this.memberKey(n);this.residualMembers&&delete this.residualMembers[d];var v=h[d];return v&&!p(n,v)?!1:(h[d]=n,!0)},s.prototype.values=function(){var n=this.map,h=[];for(var d in n){var v=n[d];v.action!="absent"&&h.push(v)}return h},s.prototype.remove=function(n){var h=this.map,d=this.memberKey(n),v=h[d];return v&&!p(n,v)?!1:(this.syncInProgress?(n=T.default.fromValues(n),n.action="absent",h[d]=n):delete h[d],!0)},s.prototype.startSync=function(){var n=this.map,h=this.syncInProgress;b.default.logAction(b.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+h),this.syncInProgress||(this.residualMembers=r.copy(n),this.setInProgress(!0))},s.prototype.endSync=function(){var n=this.map,h=this.syncInProgress;if(b.default.logAction(b.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+h),h){for(var d in n){var v=n[d];v.action==="absent"&&delete n[d]}this.presence._synthesizeLeaves(r.valuesArray(this.residualMembers));for(var d in this.residualMembers)delete n[d];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},s.prototype.waitSync=function(n){var h=this.syncInProgress;if(b.default.logAction(b.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+h),!h){n();return}this.once("sync",n)},s.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},s.prototype.setInProgress=function(n){b.default.logAction(b.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+n),this.syncInProgress=n,this.presence.syncComplete=!n},s}(y.default);e.default=R},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=t(56),A=t(31),y=t(11),b=i.__importDefault(t(5)),T=i.__importDefault(t(3)),I=function(){function S(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return S.prototype.isWordArray=function(M){return M!=null&&M.sigBytes!==void 0},S.prototype.isArrayBuffer=function(M){return M!=null&&M.constructor===ArrayBuffer},S.prototype.isTypedArray=function(M){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(M)},S.prototype.uint8ViewToBase64=function(M){for(var o="",O=this.base64CharSet,E=M.byteLength,w=E%3,C=E-w,p,R,c,a,s,n=0;n<C;n=n+3)s=M[n]<<16|M[n+1]<<8|M[n+2],p=(s&16515072)>>18,R=(s&258048)>>12,c=(s&4032)>>6,a=s&63,o+=O[p]+O[R]+O[c]+O[a];return w==1?(s=M[C],p=(s&252)>>2,R=(s&3)<<4,o+=O[p]+O[R]+"=="):w==2&&(s=M[C]<<8|M[C+1],p=(s&64512)>>10,R=(s&1008)>>4,c=(s&15)<<2,o+=O[p]+O[R]+O[c]+"="),o},S.prototype.base64ToArrayBuffer=function(M){for(var o=atob==null?void 0:atob(M),O=o.length,E=new Uint8Array(O),w=0;w<O;w++){var C=o.charCodeAt(w);E[w]=C}return E.buffer},S.prototype.isBuffer=function(M){return this.isArrayBuffer(M)||this.isWordArray(M)||this.isTypedArray(M)},S.prototype.toBuffer=function(M){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(M))return new Uint8Array(M);if(this.isTypedArray(M))return new Uint8Array(M.buffer);if(this.isWordArray(M)){for(var o=new ArrayBuffer(M.sigBytes),O=new Uint8Array(o),E=0;E<M.sigBytes;E++)O[E]=M.words[E>>>2]>>>24-E%4*8&255;return O}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},S.prototype.toArrayBuffer=function(M){return this.isArrayBuffer(M)?M:this.toBuffer(M).buffer},S.prototype.toWordArray=function(M){return this.isTypedArray(M)&&(M=M.buffer),this.isWordArray(M)?M:b.default.create(M)},S.prototype.base64Encode=function(M){return this.isWordArray(M)?(0,y.stringify)(M):this.uint8ViewToBase64(this.toBuffer(M))},S.prototype.base64Decode=function(M){return ArrayBuffer&&T.default.Config.atob?this.base64ToArrayBuffer(M):(0,y.parse)(M)},S.prototype.hexEncode=function(M){return(0,r.stringify)(this.toWordArray(M))},S.prototype.hexDecode=function(M){var o=(0,r.parse)(M);return ArrayBuffer?this.toArrayBuffer(o):o},S.prototype.utf8Encode=function(M){return T.default.Config.TextEncoder?new T.default.Config.TextEncoder().encode(M).buffer:(0,A.parse)(M)},S.prototype.utf8Decode=function(M){if(!this.isBuffer(M))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(M)?new TextDecoder().decode(M):(M=this.toWordArray(M),(0,A.stringify)(M))},S.prototype.bufferCompare=function(M,o){if(!M)return-1;if(!o)return 1;var O=this.toWordArray(M),E=this.toWordArray(o);O.clamp(),E.clamp();var w=O.sigBytes-E.sigBytes;if(w!=0)return w;for(var C=O.words,p=E.words,R=0;R<C.length;R++)if(w=C[R]-p[R],w!=0)return w;return 0},S.prototype.byteLength=function(M){return this.isArrayBuffer(M)||this.isTypedArray(M)?M.byteLength:this.isWordArray(M)?M.sigBytes:-1},S.prototype.typedArrayToBuffer=function(M){return M.buffer},S}();e.default=new I},function(l,e,t){(function(i,r){l.exports=r(t(6))})(this,function(i){return i.enc.Hex})},function(l,e,t){t.r(e);var i=t(5),r=t.n(i),A=t(11),y=t(23),b=t.n(y),T=t(2),I=t.n(T),S=t(4),M=t.n(S),o=function(O,E){var w="aes",C=256,p="cbc",R=16,c=4,a=4294967296,s=2147483648,n;if(O.getRandomWordArray)n=O.getRandomWordArray;else if(typeof Uint32Array<"u"&&O.getRandomValues){var h=new Uint32Array(c);n=function(g,k){var j=g/4,F=j==c?h:new Uint32Array(j);O.getRandomValues(F,function(V){typeof k<"u"&&k(V,E.toWordArray(F))})}}else n=function(g,k){I.a.logAction(I.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var j=g/4,F=new Array(j),V=0;V<j;V++)F[V]=Math.floor(Math.random()*a)-s;k(null,r.a.create(F))};function d(g){return g+R&-R}function v(g){if(g.algorithm==="aes"&&g.mode==="cbc"){if(g.keyLength===128||g.keyLength===256)return;throw new Error("Unsupported key length "+g.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function N(g){return g.replace("_","/").replace("-","+")}var D=[r.a.create([269488144,269488144,269488144,269488144],16),r.a.create([16777216],1),r.a.create([33685504],2),r.a.create([50529024],3),r.a.create([67372036],4),r.a.create([84215045,83886080],5),r.a.create([101058054,101056512],6),r.a.create([117901063,117901056],7),r.a.create([134744072,134744072],8),r.a.create([151587081,151587081,150994944],9),r.a.create([168430090,168430090,168427520],10),r.a.create([185273099,185273099,185273088],11),r.a.create([202116108,202116108,202116108],12),r.a.create([218959117,218959117,218959117,218103808],13),r.a.create([235802126,235802126,235802126,235798528],14),r.a.create([252645135,252645135,252645135,252645135],15),r.a.create([269488144,269488144,269488144,269488144],16)];function L(){}function x(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}L.CipherParams=x,L.getDefaultParams=function(g){var k;if(typeof g=="function"||typeof g=="string"){if(I.a.deprecated("The ability to pass a callback to `Crypto.getDefaultParams()`","This method now directly returns its result, instead of returning it asynchronously via a callback. Please update your code so that it uses the return value of this method instead of passing a callback."),typeof g=="function")I.a.deprecated("The ability to call `Crypto.getDefaultParams()` without specifying an encryption key","Please update your code so that it instead passes an object whose `key` property contains an encryption key. That is, replace `Crypto.getDefaultParams()` with `Crypto.getDefaultParams({ key })`, where `key` is an encryption key that you have generated (for example from the `Crypto.generateRandomKey()` method)."),L.generateRandomKey(function(F){g(null,L.getDefaultParams({key:F}))});else if(typeof arguments[1]=="function")I.a.deprecated("The ability to pass the encryption key as the first argument of `Crypto.getDefaultParams()`","Please update your code so that it instead passes an object whose `key` property contains the key. That is, replace `Crypto.getDefaultParams(key)` with `Crypto.getDefaultParams({ key })`."),arguments[1](null,L.getDefaultParams({key:g}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!g.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof g.key=="string"?k=Object(A.parse)(N(g.key)):k=E.toWordArray(g.key);var j=new x;if(j.key=k,j.algorithm=g.algorithm||w,j.keyLength=k.words.length*(4*8),j.mode=g.mode||p,g.keyLength&&g.keyLength!==j.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+g.keyLength+" was specified, but the key actually has length "+j.keyLength);return v(j),j},L.generateRandomKey=function(g,k){arguments.length==1&&typeof g=="function"&&(k=g,g=void 0),n((g||C)/8,function(j,F){k!==void 0&&k(j?M.a.fromValues(j):null,F)})},L.getCipher=function(g){var k=g instanceof x?g:L.getDefaultParams(g);return{cipherParams:k,cipher:new m(k,c,g.iv)}};function m(g,k,j){this.algorithm=g.algorithm+"-"+String(g.keyLength)+"-"+g.mode,this.cjsAlgorithm=g.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=E.toWordArray(g.key),j&&(this.iv=E.toWordArray(j).clone()),this.blockLengthWords=k}return m.prototype.encrypt=function(g,k){I.a.logAction(I.a.LOG_MICRO,"CBCCipher.encrypt()",""),g=E.toWordArray(g);var j=g.sigBytes,F=d(j),V=this,z=function(){V.getIv(function(_,P){if(_){k(_);return}var U=V.encryptCipher.process(g.concat(D[F-j])),B=P.concat(U);k(null,B)})};this.encryptCipher?z():this.iv?(this.encryptCipher=b.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),z()):n(R,function(_,P){if(_){k(_);return}V.encryptCipher=b.a.algo[V.cjsAlgorithm].createEncryptor(V.key,{iv:P}),V.iv=P,z()})},m.prototype.decrypt=function(g){I.a.logAction(I.a.LOG_MICRO,"CBCCipher.decrypt()",""),g=E.toWordArray(g);var k=this.blockLengthWords,j=g.words,F=r.a.create(j.slice(0,k)),V=r.a.create(j.slice(k)),z=b.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:F}),_=z.process(V),P=z.finalize();return z.reset(),P&&P.sigBytes&&_.concat(P),_},m.prototype.getIv=function(g){if(this.iv){var k=this.iv;this.iv=null,g(null,k);return}var j=this;n(R,function(F,V){if(F){g(F);return}g(null,j.encryptCipher.process(V))})},L};e.default=o},function(l,e,t){(function(i,r){l.exports=r(t(6))})(this,function(i){return function(){var r=i,A=r.lib,y=A.WordArray,b=r.enc;b.Utf16=b.Utf16BE={stringify:function(I){for(var S=I.words,M=I.sigBytes,o=[],O=0;O<M;O+=2){var E=S[O>>>2]>>>16-O%4*8&65535;o.push(String.fromCharCode(E))}return o.join("")},parse:function(I){for(var S=I.length,M=[],o=0;o<S;o++)M[o>>>1]|=I.charCodeAt(o)<<16-o%2*16;return y.create(M,S*2)}},b.Utf16LE={stringify:function(I){for(var S=I.words,M=I.sigBytes,o=[],O=0;O<M;O+=2){var E=T(S[O>>>2]>>>16-O%4*8&65535);o.push(String.fromCharCode(E))}return o.join("")},parse:function(I){for(var S=I.length,M=[],o=0;o<S;o++)M[o>>>1]|=T(I.charCodeAt(o)<<16-o%2*16);return y.create(M,S*2)}};function T(I){return I<<8&4278255360|I>>>8&16711935}}(),i.enc.Utf16})},function(l,e,t){(function(i,r){l.exports=r(t(6),t(28))})(this,function(i){return function(r){var A=i,y=A.lib,b=y.CipherParams,T=A.enc,I=T.Hex,S=A.format;S.Hex={stringify:function(M){return M.ciphertext.toString(I)},parse:function(M){var o=I.parse(M);return b.create({ciphertext:o})}}}(),i.format.Hex})},function(l,e,t){(function(i,r){l.exports=r(t(6),t(11),t(61),t(27),t(28))})(this,function(i){return function(){var r=i,A=r.lib,y=A.BlockCipher,b=r.algo,T=[],I=[],S=[],M=[],o=[],O=[],E=[],w=[],C=[],p=[];(function(){for(var a=[],s=0;s<256;s++)s<128?a[s]=s<<1:a[s]=s<<1^283;for(var n=0,h=0,s=0;s<256;s++){var d=h^h<<1^h<<2^h<<3^h<<4;d=d>>>8^d&255^99,T[n]=d,I[d]=n;var v=a[n],N=a[v],D=a[N],L=a[d]*257^d*16843008;S[n]=L<<24|L>>>8,M[n]=L<<16|L>>>16,o[n]=L<<8|L>>>24,O[n]=L;var L=D*16843009^N*65537^v*257^n*16843008;E[d]=L<<24|L>>>8,w[d]=L<<16|L>>>16,C[d]=L<<8|L>>>24,p[d]=L,n?(n=v^a[a[a[D^v]]],h^=a[a[h]]):n=h=1}})();var R=[0,1,2,4,8,16,32,64,128,27,54],c=b.AES=y.extend({_doReset:function(){var a;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var s=this._keyPriorReset=this._key,n=s.words,h=s.sigBytes/4,d=this._nRounds=h+6,v=(d+1)*4,N=this._keySchedule=[],D=0;D<v;D++)D<h?N[D]=n[D]:(a=N[D-1],D%h?h>6&&D%h==4&&(a=T[a>>>24]<<24|T[a>>>16&255]<<16|T[a>>>8&255]<<8|T[a&255]):(a=a<<8|a>>>24,a=T[a>>>24]<<24|T[a>>>16&255]<<16|T[a>>>8&255]<<8|T[a&255],a^=R[D/h|0]<<24),N[D]=N[D-h]^a);for(var L=this._invKeySchedule=[],x=0;x<v;x++){var D=v-x;if(x%4)var a=N[D];else var a=N[D-4];x<4||D<=4?L[x]=a:L[x]=E[T[a>>>24]]^w[T[a>>>16&255]]^C[T[a>>>8&255]]^p[T[a&255]]}}},encryptBlock:function(a,s){this._doCryptBlock(a,s,this._keySchedule,S,M,o,O,T)},decryptBlock:function(a,s){var n=a[s+1];a[s+1]=a[s+3],a[s+3]=n,this._doCryptBlock(a,s,this._invKeySchedule,E,w,C,p,I);var n=a[s+1];a[s+1]=a[s+3],a[s+3]=n},_doCryptBlock:function(a,s,n,h,d,v,N,D){for(var L=this._nRounds,x=a[s]^n[0],m=a[s+1]^n[1],g=a[s+2]^n[2],k=a[s+3]^n[3],j=4,F=1;F<L;F++){var V=h[x>>>24]^d[m>>>16&255]^v[g>>>8&255]^N[k&255]^n[j++],z=h[m>>>24]^d[g>>>16&255]^v[k>>>8&255]^N[x&255]^n[j++],_=h[g>>>24]^d[k>>>16&255]^v[x>>>8&255]^N[m&255]^n[j++],P=h[k>>>24]^d[x>>>16&255]^v[m>>>8&255]^N[g&255]^n[j++];x=V,m=z,g=_,k=P}var V=(D[x>>>24]<<24|D[m>>>16&255]<<16|D[g>>>8&255]<<8|D[k&255])^n[j++],z=(D[m>>>24]<<24|D[g>>>16&255]<<16|D[k>>>8&255]<<8|D[x&255])^n[j++],_=(D[g>>>24]<<24|D[k>>>16&255]<<16|D[x>>>8&255]<<8|D[m&255])^n[j++],P=(D[k>>>24]<<24|D[x>>>16&255]<<16|D[m>>>8&255]<<8|D[g&255])^n[j++];a[s]=V,a[s+1]=z,a[s+2]=_,a[s+3]=P},keySize:256/32});r.AES=y._createHelper(c)}(),i.AES})},function(l,e,t){(function(i,r){l.exports=r(t(6))})(this,function(i){return function(r){var A=i,y=A.lib,b=y.WordArray,T=y.Hasher,I=A.algo,S=[];(function(){for(var C=0;C<64;C++)S[C]=r.abs(r.sin(C+1))*4294967296|0})();var M=I.MD5=T.extend({_doReset:function(){this._hash=new b.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(C,p){for(var R=0;R<16;R++){var c=p+R,a=C[c];C[c]=(a<<8|a>>>24)&16711935|(a<<24|a>>>8)&4278255360}var s=this._hash.words,n=C[p+0],h=C[p+1],d=C[p+2],v=C[p+3],N=C[p+4],D=C[p+5],L=C[p+6],x=C[p+7],m=C[p+8],g=C[p+9],k=C[p+10],j=C[p+11],F=C[p+12],V=C[p+13],z=C[p+14],_=C[p+15],P=s[0],U=s[1],B=s[2],H=s[3];P=o(P,U,B,H,n,7,S[0]),H=o(H,P,U,B,h,12,S[1]),B=o(B,H,P,U,d,17,S[2]),U=o(U,B,H,P,v,22,S[3]),P=o(P,U,B,H,N,7,S[4]),H=o(H,P,U,B,D,12,S[5]),B=o(B,H,P,U,L,17,S[6]),U=o(U,B,H,P,x,22,S[7]),P=o(P,U,B,H,m,7,S[8]),H=o(H,P,U,B,g,12,S[9]),B=o(B,H,P,U,k,17,S[10]),U=o(U,B,H,P,j,22,S[11]),P=o(P,U,B,H,F,7,S[12]),H=o(H,P,U,B,V,12,S[13]),B=o(B,H,P,U,z,17,S[14]),U=o(U,B,H,P,_,22,S[15]),P=O(P,U,B,H,h,5,S[16]),H=O(H,P,U,B,L,9,S[17]),B=O(B,H,P,U,j,14,S[18]),U=O(U,B,H,P,n,20,S[19]),P=O(P,U,B,H,D,5,S[20]),H=O(H,P,U,B,k,9,S[21]),B=O(B,H,P,U,_,14,S[22]),U=O(U,B,H,P,N,20,S[23]),P=O(P,U,B,H,g,5,S[24]),H=O(H,P,U,B,z,9,S[25]),B=O(B,H,P,U,v,14,S[26]),U=O(U,B,H,P,m,20,S[27]),P=O(P,U,B,H,V,5,S[28]),H=O(H,P,U,B,d,9,S[29]),B=O(B,H,P,U,x,14,S[30]),U=O(U,B,H,P,F,20,S[31]),P=E(P,U,B,H,D,4,S[32]),H=E(H,P,U,B,m,11,S[33]),B=E(B,H,P,U,j,16,S[34]),U=E(U,B,H,P,z,23,S[35]),P=E(P,U,B,H,h,4,S[36]),H=E(H,P,U,B,N,11,S[37]),B=E(B,H,P,U,x,16,S[38]),U=E(U,B,H,P,k,23,S[39]),P=E(P,U,B,H,V,4,S[40]),H=E(H,P,U,B,n,11,S[41]),B=E(B,H,P,U,v,16,S[42]),U=E(U,B,H,P,L,23,S[43]),P=E(P,U,B,H,g,4,S[44]),H=E(H,P,U,B,F,11,S[45]),B=E(B,H,P,U,_,16,S[46]),U=E(U,B,H,P,d,23,S[47]),P=w(P,U,B,H,n,6,S[48]),H=w(H,P,U,B,x,10,S[49]),B=w(B,H,P,U,z,15,S[50]),U=w(U,B,H,P,D,21,S[51]),P=w(P,U,B,H,F,6,S[52]),H=w(H,P,U,B,v,10,S[53]),B=w(B,H,P,U,k,15,S[54]),U=w(U,B,H,P,h,21,S[55]),P=w(P,U,B,H,m,6,S[56]),H=w(H,P,U,B,_,10,S[57]),B=w(B,H,P,U,L,15,S[58]),U=w(U,B,H,P,V,21,S[59]),P=w(P,U,B,H,N,6,S[60]),H=w(H,P,U,B,j,10,S[61]),B=w(B,H,P,U,d,15,S[62]),U=w(U,B,H,P,g,21,S[63]),s[0]=s[0]+P|0,s[1]=s[1]+U|0,s[2]=s[2]+B|0,s[3]=s[3]+H|0},_doFinalize:function(){var C=this._data,p=C.words,R=this._nDataBytes*8,c=C.sigBytes*8;p[c>>>5]|=128<<24-c%32;var a=r.floor(R/4294967296),s=R;p[(c+64>>>9<<4)+15]=(a<<8|a>>>24)&16711935|(a<<24|a>>>8)&4278255360,p[(c+64>>>9<<4)+14]=(s<<8|s>>>24)&16711935|(s<<24|s>>>8)&4278255360,C.sigBytes=(p.length+1)*4,this._process();for(var n=this._hash,h=n.words,d=0;d<4;d++){var v=h[d];h[d]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360}return n},clone:function(){var C=T.clone.call(this);return C._hash=this._hash.clone(),C}});function o(C,p,R,c,a,s,n){var h=C+(p&R|~p&c)+a+n;return(h<<s|h>>>32-s)+p}function O(C,p,R,c,a,s,n){var h=C+(p&c|R&~c)+a+n;return(h<<s|h>>>32-s)+p}function E(C,p,R,c,a,s,n){var h=C+(p^R^c)+a+n;return(h<<s|h>>>32-s)+p}function w(C,p,R,c,a,s,n){var h=C+(R^(p|~c))+a+n;return(h<<s|h>>>32-s)+p}A.MD5=T._createHelper(M),A.HmacMD5=T._createHmacHelper(M)}(Math),i.MD5})},function(l,e,t){var i;Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),A=r.__importDefault(t(3)),y=r.__importStar(t(1)),b=r.__importDefault(t(8)),T=t(4),I=r.__importDefault(t(19)),S=r.__importDefault(t(17)),M=r.__importDefault(t(22)),o=r.__importDefault(t(2)),O=t(29),E=r.__importDefault(t(63)),w=t(14);function C(c){var a=c.statusCode;return a===408&&!c.code||a===400&&!c.code||a>=500&&a<=504}function p(c){var a=c.connection,s=a&&a.connectionManager.host;return s?[s].concat(b.default.getFallbackHosts(c.options)):b.default.getHosts(c.options)}var R=(i=function(){function c(a){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=p,this.options=a||{};var s=this.options.connectivityCheckUrl||b.default.connectivityCheckUrl,n=this.options.connectivityCheckParams,h=!this.options.connectivityCheckUrl;A.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(d,v,N,D,L,x,m){var g=S.default.createRequest(N,D,L,x,M.default.REQ_SEND,v&&v.options.timeouts,d);return g.once("complete",m),g.exec(),g},this.options.disableConnectivityCheck?this.checkConnectivity=function(d){d(null,!0)}:this.checkConnectivity=function(d){o.default.logAction(o.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+s),this.doUri(I.default.Get,null,s,null,null,n,function(v,N,D,L,x){var m=!1;h?m=!v&&(N==null?void 0:N.replace(/\n/,""))=="yes":m=!v&&(0,w.isSuccessCode)(x),o.default.logAction(o.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+m),d(null,m)})}):A.default.Config.jsonpSupported?(this.Request=function(d,v,N,D,L,x,m){var g=(0,O.createRequest)(N,D,L,x,M.default.REQ_SEND,v&&v.options.timeouts,d);return g.once("complete",m),A.default.Config.nextTick(function(){g.exec()}),g},this.options.disableConnectivityCheck?this.checkConnectivity=function(d){d(null,!0)}:this.checkConnectivity=function(d){var v=this,N=b.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(d);return}this.checksInProgress=[d],o.default.logAction(o.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+N);var D=new O.Request("isTheInternetUp",N,null,null,null,M.default.REQ_SEND,b.default.TIMEOUTS);D.once("complete",function(L,x){var m=!L&&x;o.default.logAction(o.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+m);for(var g=0;g<v.checksInProgress.length;g++)v.checksInProgress[g](null,m);v.checksInProgress=null}),A.default.Config.nextTick(function(){D.exec()})}):A.default.Config.fetchSupported?(this.supportsAuthHeaders=!0,this.Request=E.default,this.checkConnectivity=function(d){o.default.logAction(o.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+s),this.doUri(I.default.Get,null,s,null,null,null,function(v,N){var D=!v&&(N==null?void 0:N.replace(/\n/,""))=="yes";o.default.logAction(o.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+D),d(null,D)})}):this.Request=function(d,v,N,D,L,x,m){m(new T.PartialErrorInfo("no supported HTTP transports available",null,400),null)}}return c.prototype.do=function(a,s,n,h,d,v,N){var D=this,L=typeof n=="function"?n:function(k){return s.baseUri(k)+n},x=s._currentFallback;if(x)if(x.validUntil>y.now()){if(!this.Request){N==null||N(new T.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(a,s,L(x.host),h,v,d,function(k){for(var j=[],F=1;F<arguments.length;F++)j[F-1]=arguments[F];if(k&&C(k)){s._currentFallback=null,D.do(a,s,n,h,d,v,N);return}N==null||N.apply(void 0,r.__spreadArray([k],j,!1))});return}else s._currentFallback=null;var m=p(s);if(m.length===1){this.doUri(a,s,L(m[0]),h,d,v,N);return}var g=function(k,j){var F=k.shift();D.doUri(a,s,L(F),h,d,v,function(V){for(var z=[],_=1;_<arguments.length;_++)z[_-1]=arguments[_];if(V&&C(V)&&k.length){g(k,!0);return}j&&(s._currentFallback={host:F,validUntil:y.now()+s.options.timeouts.fallbackRetryTimeout}),N==null||N.apply(void 0,r.__spreadArray([V],z,!1))})};g(m)},c.prototype.doUri=function(a,s,n,h,d,v,N){if(!this.Request){N(new T.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(a,s,n,h,v,d,N)},c}(),i.methods=[I.default.Get,I.default.Delete,I.default.Post,I.default.Put,I.default.Patch],i.methodsWithoutBody=[I.default.Get,I.default.Delete],i.methodsWithBody=[I.default.Post,I.default.Put,I.default.Patch],i);e.default=R},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importStar(t(4)),A=i.__importDefault(t(3)),y=i.__importDefault(t(8)),b=i.__importStar(t(1)),T=t(1);function I(o,O){return!!O.get("x-ably-errorcode")}function S(o,O){if(I(o,O))return o.error&&r.default.fromValues(o.error)}function M(o,O,E,w,C,p,R){var c=new Headers(w||{}),a=o?o.toUpperCase():b.isEmptyArg(p)?"GET":"POST",s=new AbortController,n=setTimeout(function(){s.abort(),R(new r.PartialErrorInfo("Request timed out",null,408))},O?O.options.timeouts.httpRequestTimeout:y.default.TIMEOUTS.httpRequestTimeout),h={method:a,headers:c,body:p};A.default.Config.isWebworker||(h.credentials=c.has("authorization")?"include":"same-origin"),(0,T.getGlobalObject)().fetch(E+"?"+new URLSearchParams(C||{}),h).then(function(d){clearTimeout(n);var v=d.headers.get("Content-Type"),N;v&&v.indexOf("application/x-msgpack")>-1?N=d.arrayBuffer():v&&v.indexOf("application/json")>-1?N=d.json():N=d.text(),N.then(function(D){var L=!!v&&v.indexOf("application/x-msgpack")===-1;if(d.ok)R(null,D,d.headers,L,d.status);else{var x=S(D,d.headers)||new r.PartialErrorInfo("Error response received from server: "+d.status+" body was: "+A.default.Config.inspect(D),null,d.status);R(x,D,d.headers,L,d.status)}})}).catch(function(d){clearTimeout(n),R(d)})}e.default=M},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(41)),A=i.__importStar(t(1)),y=A.getGlobalObject();typeof Window>"u"&&typeof WorkerGlobalScope>"u"&&console.log("Warning: this distribution of Ably is intended for browsers. On nodejs, please use the 'ably' package on npm");function b(){var M=y.location;return!y.WebSocket||!M||!M.origin||M.origin.indexOf("http")>-1}var T=y.navigator&&y.navigator.userAgent.toString(),I=y.location&&y.location.href,S={agent:"browser",logTimestamps:!0,userAgent:T,currentUrl:I,noUpgrade:T&&!!T.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:y.WebSocket,fetchSupported:!!y.fetch,xhrSupported:y.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document<"u",allowComet:b(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:r.default,supportsBinary:!!y.TextDecoder,preferBinary:!1,ArrayBuffer:y.ArrayBuffer,atob:y.atob,nextTick:typeof y.setImmediate<"u"?y.setImmediate.bind(y):function(M){setTimeout(M,0)},addEventListener:y.addEventListener,inspect:JSON.stringify,stringByteSize:function(M){return y.TextDecoder&&new y.TextEncoder().encode(M).length||M.length},TextEncoder:y.TextEncoder,TextDecoder:y.TextDecoder,Promise:y.Promise,getRandomValues:function(M){if(M!==void 0)return function(o,O){M.getRandomValues(o),O&&O(null)}}(y.crypto||msCrypto)};e.default=S},function(l,e,t){(function(i){Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),A=r.__importStar(t(1)),y="ablyjs-storage-test",b=function(){function T(){try{i.sessionStorage.setItem(y,y),i.sessionStorage.removeItem(y),this.sessionSupported=!0}catch{this.sessionSupported=!1}try{i.localStorage.setItem(y,y),i.localStorage.removeItem(y),this.localSupported=!0}catch{this.localSupported=!1}}return T.prototype.get=function(I){return this._get(I,!1)},T.prototype.getSession=function(I){return this._get(I,!0)},T.prototype.remove=function(I){return this._remove(I,!1)},T.prototype.removeSession=function(I){return this._remove(I,!0)},T.prototype.set=function(I,S,M){return this._set(I,S,M,!1)},T.prototype.setSession=function(I,S,M){return this._set(I,S,M,!0)},T.prototype._set=function(I,S,M,o){var O={value:S};return M&&(O.expires=A.now()+M),this.storageInterface(o).setItem(I,JSON.stringify(O))},T.prototype._get=function(I,S){if(S&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!S&&!this.localSupported)throw new Error("Local Storage not supported");var M=this.storageInterface(S).getItem(I);if(!M)return null;var o=JSON.parse(M);return o.expires&&o.expires<A.now()?(this.storageInterface(S).removeItem(I),null):o.value},T.prototype._remove=function(I,S){return this.storageInterface(S).removeItem(I)},T.prototype.storageInterface=function(I){return I?i.sessionStorage:i.localStorage},T}();e.default=new b}).call(this,t(13))},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i=t(0),r=i.__importDefault(t(67)),A={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[r.default.XhrPolling,r.default.XhrStreaming,r.default.JsonP,r.default.WebSocket],baseTransportOrder:[r.default.XhrPolling,r.default.XhrStreaming,r.default.JsonP,r.default.WebSocket],transportPreferenceOrder:[r.default.JsonP,r.default.XhrPolling,r.default.XhrStreaming,r.default.WebSocket],upgradeTransports:[r.default.XhrStreaming,r.default.WebSocket]};e.default=A},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var i;(function(r){r.WebSocket="web_socket",r.Comet="comet",r.XhrStreaming="xhr_streaming",r.XhrPolling="xhr_polling",r.JsonP="jsonp"})(i||(i={})),e.default=i},function(l,e,t){t.r(e);var i=t(29),r=t.n(i),A=t(1),y=t(3),b=t.n(y),T=t(12),I=t.n(T),S=t(17),M=t.n(S),o=function(C){var p="xhr_polling";function R(c,a,s){s.stream=!1,I.a.call(this,c,a,s),this.shortName=p}return A.inherits(R,I.a),R.isAvailable=function(){return b.a.Config.xhrSupported&&b.a.Config.allowComet},R.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},R.prototype.createRequest=function(c,a,s,n,h){return M.a.createRequest(c,a,s,n,h,this.timeouts)},typeof C<"u"&&R.isAvailable()&&(C.supportedTransports[p]=R),R},O=o,E=function(C){var p="xhr_streaming";function R(c,a,s){I.a.call(this,c,a,s),this.shortName=p}return A.inherits(R,I.a),R.isAvailable=function(){return b.a.Config.xhrSupported&&b.a.Config.streamingSupported&&b.a.Config.allowComet},R.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},R.prototype.createRequest=function(c,a,s,n,h){return M.a.createRequest(c,a,s,n,h,this.timeouts)},typeof C<"u"&&R.isAvailable()&&(C.supportedTransports[p]=R),R},w=E;e.default=[r.a,O,w]}]).default})}(ct)),ct.exports}var On=wi();const Ii=Ti(On),Pi=An({__proto__:null,default:Ii},[On]);window.axios=ae;window.Ably=Pi;window.Echo=new Ei({broadcaster:"ably",authEndpoint:"/broadcasting/auth"});window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";window.Echo.connector.ably.connection.on(f=>{var u;console.log("LOGGER:: Connection event :: ",f),f.current==="disconnected"&&((u=f.reason)==null?void 0:u.code)===40142&&console.log("LOGGER:: Connection token expired https://help.ably.io/error/40142")});
